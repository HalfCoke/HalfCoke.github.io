---
title: 转载——Ubuntu xRDP一键部署脚本
author:
  nick: HalfCoke
  link: 'https://halfcoke.github.io/'
typora-copy-images-to: upload
mathjax: true
cover: 'https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102309451.jpeg'
tags:
  - xrdp
  - Linux
categories:
  - 转载
  - Linux
abbrlink: fbd067d7
date: 2021-01-12 21:54:33
update: 2021-01-12 21:54:33
subtitle: Ubuntu xRDP一键部署脚本
---

# 转载——Ubuntu xRDP一键部署脚本

**原文链接：[https://c-nergy.be/blog/?p=15978](https://c-nergy.be/blog/?p=15978)**

## 原文标题：xRDP –在Ubuntu 16.04、18.04、20.04、20.10（脚本版本1.2.2）上轻松安装xRDP

你好，世界， 

基于用户的反馈，意见和建议，我们将发布一个**新版本**的的**著名XRDP的安装程序脚本**。此新版本基本上修复了此版本中解决的一些**小错误**，并提供了一些更好的代码逻辑。我们没有时间进行真正的广泛测试，但我们希望这些小的更改不会破坏脚本。 

我们著名的xrdp安装脚本的新版本将设置为 **1.2.2** （即 **xrdp-installer-1.2.2.sh**）。该脚本替换了所有以前的版本。  

所以，走吧！ 

### 总览

该 **xrdp-installer-1.2.2.sh** 脚本 **缓解** 之上XRDP的安装后的配置操作 **的Ubuntu** 操作系统。该版本是该脚本的最新版本，其中包括对Ubuntu 20.10（最近于2020年10月发布）的支持。 

#### 脚本版本和受支持的Ubuntu版本

脚本版本将设置为 **1.2.2。**该 **xrdp-installer-1.2.2.sh** 脚本将支持以下Ubuntu操作系统版本 

- Ubuntu 16.04.x 
- Ubuntu 18.04.x
- Ubuntu 20.04.x
- Ubuntu 20.10

#### 先决条件和假设 

为了在使用脚本时获得最佳效果，应满足以下条件

- 我们假设您的计算机在执行安装时已连接到Internet。这是必需的，因为需要在Ubuntu机器上下载并安装其他软件包和软件。
- 该脚本可在受支持的操作系统（Ubuntu 16.04.x，Ubuntu 18.04.x，Ubuntu 20.04，Ubuntu 20.10）上运行
- 需要使用官方的Ubuntu发行版（ 到目前为止，我们 **不支持**其他Ubuntu版本!! –将来可能会改变） 
- 无需使用其他桌面界面（如果运行Ubuntu 16.04，xRDP会话将显示带有Dock菜单或Unity的Ubuntu Gnome Desktop）
- 如果还可以使用声音功能，则计算机上具有声音功能

#### 此版本有什么新功能？

如上所述，脚本并没有太大变化，仅引入了一些小的变化。它主要包括美观更改和较小的错误修复，以及将用户反馈建议包括到脚本中。因此，版本1.2.2解决了以下问题 

- 指向通用的ubuntu存档（archive.ubuntu.com）而不是使用本地化的存档（be.archive.ubuntu.com）–**感谢Thomas**
- 从github自动获取xrdp和xorgxrdp软件包，并在使用自定义安装模式时使用此信息来构建软件包（**感谢Hiero**）
- 选择删除选项时强制删除xrdp-installer-check.log文件，以确保相应地删除了xrdp文件夹（**感谢Hiero**）
- 自动化脚本版本控制 

**一个脚本的下载版本可在文章底部**

### 如何使用脚本

该**XRDP的安装程序-1.2.2**脚本会以类似的方式与以前的版本工作。下一节将说明如何使用脚本下载，提取，设置可执行模式以及执行安装。该脚本提供了一些可用于自定义安装过程的开关。

因此，让我们看看这将如何工作…

#### 免责声明

该脚本按**原样**提供。使用它需要**您自担风险**！ 

#### 步骤1 –下载脚本 

要下载脚本，您有多个选择。您可以从终端发出以下命令 

```
wget https://www.c-nergy.be/downloads/xrdp-installer-1.2.2.zip
```

您也可以只使用浏览器，然后单击链接来下载脚本：  

-  [xrdp-installer-1.2.2.zip](http://www.c-nergy.be/downloads/xrdp-installer-1.2.2.zip)

**为防止文件丢失，国内用户可使用这个链接[xrdp-installer-1.2.2.zip](https://gitee.com/halfcoke/storage/blob/master/xrdp-installer-1.2.2.zip)**

#### 步骤2 –解压缩文件 

下载包含文件的zip软件包后，您需要先将其解压缩。要解压缩软件包，可以使用终端控制台并发出以下命令 

```
 解压缩xrdp-installer-1.2.2.zip 
```

您还可以使用GUI和Nautilus文件管理器选择下载的软件包，右键单击它并选择选项“ **提取此处”。**

#### 步骤3 –在脚本上设置“执行权”

将**xrdp-installer-1.2.2.sh** 脚本下载到您的系统，提取内容并将其标记为可执行文件。为此，请在终端控制台中执行以下操作

```
chmod + x〜/ Downloads / xrdp-installer-1.2.2.sh
```

*注意：调整**xrdp-Installer-1.2.2.sh**脚本的路径 以反映您的* *环境*

#### 步骤4 –以普通用户身份运行 

该脚本**需要**以**普通用户身份运行**。该脚本将开始运行，并在启动sudo操作时提示您输入密码。如果您以root身份或使用sudo命令运行脚本，则root用户不存在Download文件夹，并且脚本无法按预期运行。为了克服这种情况，脚本还检查哪个用户正在执行脚本。如果脚本在sudo或root帐户下运行，将显示警告消息，并且脚本不会执行

#### 步骤5 –开关和参数 

该**xrdp-installer-1.2.2.sh**脚本可以执行为是（**不带参数或开关**）。这将执行xRDP的标准（和基本）安装。没有声音或自定义xrdp登录脚本将可用。但是，此安装模式将提供远程桌面，驱动器重定向和剪贴板重定向。 

该**xrdp-installer-1.2.2.sh**脚本也接受一些额外的参数，这将有助于定制XRDP安装并启用其他功能。该脚本提供以下参数 

```
--help或-h =>将显示基本的帮助菜单
--sound或-s =>将启用声音重定向 
--loginscreen或-l =>将自定义xRDP登录屏幕 
--remove或-r =>将删除xrdp软件包 
--custom或-c =>将执行自定义安装（即从源代码编译）
```

#### 步骤6 –使用脚本执行xRDP安装 

以下各节将提供一些有关如何使用脚本的示例和方案。 

##### 标准安装–无参数

如上所述，您可以决定使用Ubuntu存储库中可用的默认xrdp软件包，并执行基本安装，这将为您提供远程桌面功能并自定义远程会话。该脚本将确保当用户本地或远程登录时，将保持相同的外观。 

要执行 **标准安装**，请**不带参数**执行脚本 。打开 **终端控制台**，浏览到脚本已下载的位置，然后发出以下命令 

```
 ./xrdp-installer-1.2.2.sh
```

xrdp安装软件包将启动时，要求您 **输入密码。** 提供密码并继续安装。等待脚本完成。完成后，机器 **将不会自动重启** ，因此您可以查看脚本执行的操作…。

***重要笔记***

*如果您在**Ubuntu 16.04.x**上**运行脚本**，即使未指定任何参数，也**将始终执行**自定义安装。这是因为Ubuntu 16.04.x附带了一个非常老的xrdp软件包（0.6版），并且没有提供所有必需的功能。定制安装提供驱动器重定向，剪贴板和对Unity Desktop的访问*

##### 带参数的标准安装

该脚本可用于执行标准安装，并且仍然传递一些参数以获取大多数xRDP软件包及其功能。对于所有Ubuntu版本，我们可以使用以下参数组合 

```
./xrdp-installer-1.2.2.sh -s       （这将启用声音重定向） 
./xrdp-installer-1.2.2.sh -l      （这将自定义xrdp登录屏幕-请参见此处）
```

显然，您可以组合开关（任意顺序）以启用更多功能 

```
./xrdp-installer-1.2.2.sh -s -l       （这将启用声音重定向并自定义xrdp登录屏幕）
```

***重要笔记***

*该脚本**可以**在同一台计算机上多次**运行**。如果最初运行的脚本没有参数，但是之后决定启用其他功能，则可以重新执行脚本并启用其他功能。* 

##### 自定义安装–默认安装 

自定义安装脚本非常灵活。定制安装意味着脚本将从源二进制文件中编译xrdp软件包。定制安装脚本始终使用可用的最新xrdp软件包版本 

要执行**自定义安装**，您至少需要传递**一个参数**。以下命令行显示了如何执行自定义安装 

```
./xrdp-installer-1.2.2.sh -c      （这将执行自定义安装，但不会启用声音重定向或自定义登录屏幕之类的adv功能）
```

***重要笔记***

*如果您在**Ubuntu 16.04.x**上**运行脚本**，则-c开关将被忽略，并将执行自定义安装过程。**这是因为Ubuntu 16.04.x附带了一个非常老的xrdp软件包（0.6版），并且没有提供所有必需的功能。定制安装提供驱动器重定向，剪贴板和对Unity Desktop的访问*

##### 定制安装–其他选项 

如果用户要启用其他功能，则将传递一些其他参数，如以下示例所示 

```
 ./xrdp-installer-1.2.2.sh -c -s      （将执行自定义安装并启用声音重定向）
 ./xrdp-installer-1.2.2.sh -c -l      （将执行自定义安装并定制XRDP登录屏幕）
 ./xrdp-installer-1.2.2.sh -C -l -S   （这会执行自定义安装，启用声音和自定义登录屏幕）
```

***重要笔记***

*该脚本**可以**在同一台计算机上多次**运行**。如果最初运行的脚本没有参数，但是之后决定启用其他功能，则可以重新执行脚本并启用其他功能。* 

##### 删除安装选项

此版本的脚本还附带删除xRDP软件包的选项。仅当您使用此脚本的此版本执行安装时，才应使用删除选项。要删除xrdp软件包，您只需执行以下命令 

```
./xrdp-installer-1.2.2.sh -r      （删除xrdp软件包）
```

#### 步骤5 –测试您的配置 

在脚本运行之后，以及在重新启动/关闭和启动过程之后，就该进行测试了，看看您是否确实可以与Ubuntu计算机进行平滑的远程连接。请记住，使用xRDP解决方案时，用户可以在计算机**上本地****登录**或**远程登录**。如果执行远程连接的用户本地登录到系统，则远程连接将启动，但将立即终止。这就是如今的工作方式。 

因此，请确保执行测试的用户未在本地登录，请启动您喜欢的远程桌面客户端并执行连接。根据您的选择，将为您显示绿色的xrdp登录屏幕或自定义登录屏幕（紫色背景）。只需输入您的凭据并开始测试安装。如果一切正常，您将看到一个类似的桌面界面，其中使用了Gnome Desktop，并且可以看到Dock。 

### 已知问题和局限性 

#### 已知的问题 

##### 声音重定向问题

如果选择了**声音重定向**选项，则重启Ubuntu系统是不够的，声音重定向可能无法正常工作。如果选择了声音重定向选项，则必须**关闭**Ubuntu计算机，然后再次启动它，以确保声音重定向功能能够按预期工作。 

**声音重定向****在Ubuntu 19.10及更高版本上**无法**正常工作** 。模块已创建并复制到正确的位置。但是，xrdp接收器模块永远不会加载到远程会话中，也不会随机加载到远程会话中。为了解决这个问题，您只需要在远程会话中执行以下命令，声音就会开始起作用 

##### 驱动器重定向 

要将驱动器重定向到xrdp远程会话，必须 **确保在“本地资源”选项卡中选择的唯一选项是“剪贴板”选项和“驱动器”选项。**检查以下屏幕截图，并确保您具有相同的设置。

![](https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102309471.png)

![](https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102309501.png)

相应地设置了这些设置后，您应该会看到thin client文件夹中装有来自Windows计算机的重定向驱动器。

#### 局限性

##### 每个用户限制一个会话

每个用户只允许一个会话。这意味着，如果用户在Ubuntu计算机上本地登录，则该用户将无法执行远程会话（xRDP连接将启动，但将立即终止）。如果用户在系统上远程登录，将无法在本地登录（如果用户尝试在本地登录，则登录屏幕将循环播放，并且将再次向用户显示登录屏幕） 

##### 在标准和自定义安装之间切换

此版本的脚本可以在同一台计算机上多次运行。但是，由于这种新行为，您无法执行标准安装，然后决定执行自定义安装。一旦选择了安装模式，就必须坚持下去。这是由脚本检查的。 

因此，如果您执行了标准安装，但之后可能要使用自定义安装选项，则脚本将忽略该请求。如果要从标准安装模式转换为自定义模式（反之亦然），则正确的过程是 

- 删除xrdp（使用xrdp-installer-1.2.2.sh -r选项） 
- 使用您选择的安装模式（标准或自定义安装模式）执行新安装 

### 下载脚本 

该脚本可以在以下位置下载：  [xrdp-installer-1.2.2.zip](http://www.c-nergy.be/downloads/xrdp-installer-1.2.2.zip) 

*注意：**所有xrdp脚本都可以在[https://www.c-nergy.be/products.html](https://c-nergy.be/products.html)上找到*

### 最后说明

这是这个职位！ 

如果您有时间或想要帮助我们创建**最佳的xrdp安装程序脚本**，请下载该脚本，对其进行测试并提供建设性的反馈。如果您发现脚本有错误或问题，也请告知我们，以便我们对其进行修复。 

直到下一次