<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä½¿ç”¨NginxåŒæ—¶ä»£ç†WebæœåŠ¡ä¸Trojanï¼ˆæˆ–å…¶ä»–TCP/UDPæœåŠ¡ï¼‰</title>
      <link href="/2023/6b488705/"/>
      <url>/2023/6b488705/</url>
      
        <content type="html"><![CDATA[<p>æ•´ä½“éƒ¨ç½²å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šNginx+WebæœåŠ¡+Trojan</p><p>å…¶ä¸­webæœåŠ¡å¯ä»¥æ˜¯ä»»æ„è‡ªå®šä¹‰çš„æœåŠ¡ï¼Œåœ¨æœ¬æ–‡æœ€åç»™å‡ºæˆ‘çš„webæœåŠ¡çš„é…ç½®ï¼Œä½†ä¸åšè¿‡å¤šè¯´æ˜ã€‚</p><p>å¦å¤–ï¼ŒTrojanä½¿ç”¨dockeréƒ¨ç½²ï¼ŒNginxä½¿ç”¨å®¿ä¸»æœºéƒ¨ç½²çš„æœåŠ¡</p><h1 id="ä¸€äº›å‰ææ¡ä»¶"><a href="#ä¸€äº›å‰ææ¡ä»¶" class="headerlink" title="ä¸€äº›å‰ææ¡ä»¶"></a>ä¸€äº›å‰ææ¡ä»¶</h1><ol><li><p>éœ€è¦æœ‰è‡ªå·±çš„åŸŸåï¼Œå¯ä»¥è€ƒè™‘ç”³è¯·ä½¿ç”¨å…è´¹çš„åŸŸåï¼ˆeu.orgï¼‰ï¼Œä½†æ˜¯éœ€è¦æœ‰ä¸€æ®µæ—¶é—´çš„å®¡æ ¸ï¼Œç”³è¯·çš„æ•™ç¨‹å‚è€ƒ<a href="https://iweec.com/363.html">https://iweec.com/363.html</a></p></li><li><p>éœ€è¦ç”³è¯·sslè¯ä¹¦ï¼Œå»ºè®®ä½¿ç”¨certbotï¼Œå®‰è£…æ•™ç¨‹æœ‰å¾ˆå¤šï¼Œå®‰è£…å®Œæˆåå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”³è¯·è‡ªå®šä¹‰è¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…ç”³è¯·ï¼Œä¸è¿›è¡Œå®‰è£…</span></span><br><span class="line">certbot certonly --nginx -d test.example.org</span><br><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡crontabé…ç½®renew</span></span><br><span class="line">crontab -e</span><br><span class="line"><span class="comment"># åœ¨æ‰“å¼€çš„ç¼–è¾‘å™¨ä¸­æ”¾å…¥ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">0 12 * * * /usr/bin/certbot renew --quiet</span><br></pre></td></tr></table></figure></li></ol><h1 id="Trojanä»£ç†æœåŠ¡éƒ¨ç½²"><a href="#Trojanä»£ç†æœåŠ¡éƒ¨ç½²" class="headerlink" title="Trojanä»£ç†æœåŠ¡éƒ¨ç½²"></a>Trojanä»£ç†æœåŠ¡éƒ¨ç½²</h1><p>æ¥è‡ªChatGPTçš„è¯´æ˜ï¼š</p><blockquote><p>Trojanä»£ç†æœåŠ¡æ˜¯ä¸€ç§åŸºäºTrojanåè®®çš„ç½‘ç»œä»£ç†å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨ç”¨æˆ·ä¸äº’è”ç½‘ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŠ å¯†çš„é€šä¿¡éš§é“ï¼Œä»¥ä¿æŠ¤ç”¨æˆ·çš„ç½‘ç»œé€šä¿¡å®‰å…¨å’Œéšç§ã€‚é€šè¿‡ä½¿ç”¨Trojanä»£ç†æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥éšè—å…¶çœŸå®IPåœ°å€å’Œä½ç½®ï¼Œä»¥é¿å…è¢«è¿½è¸ªæˆ–ç›‘è§†ï¼ŒåŒæ—¶è¿˜å¯ä»¥ç»•è¿‡åœ°ç†é™åˆ¶å’Œç½‘ç»œå°é”ï¼Œè®¿é—®è¢«å±è”½çš„å†…å®¹å’ŒæœåŠ¡ã€‚</p><p>ä¸å…¶ä»–ä¼ ç»Ÿçš„ä»£ç†æœåŠ¡ä¸åŒï¼ŒTrojanä»£ç†æœåŠ¡ä½¿ç”¨äº†ä¸€ç§æ›´åŠ å®‰å…¨å’Œé«˜æ•ˆçš„åŠ å¯†æ–¹å¼ï¼Œå¯ä»¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚æ­¤å¤–ï¼ŒTrojanä»£ç†æœåŠ¡è¿˜æ”¯æŒå¤šç§åè®®å’Œä»£ç†æ¨¡å¼ï¼ŒåŒ…æ‹¬HTTPã€SOCKS5ç­‰ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚å’Œåº”ç”¨åœºæ™¯ã€‚</p><p>ç„¶è€Œï¼Œç”±äºTrojanä»£ç†æœåŠ¡å¯ä»¥è¢«ç”¨äºç»•è¿‡å°é”å’Œè®¿é—®è¢«å±è”½çš„å†…å®¹ï¼Œä¹Ÿå¯èƒ½è¢«ç”¨äºéæ³•æ´»åŠ¨ï¼Œå› æ­¤åœ¨ä½¿ç”¨Trojanä»£ç†æœåŠ¡æ—¶ï¼Œç”¨æˆ·åº”è¯¥æ³¨æ„åˆæ³•ä½¿ç”¨ï¼Œä¸è¦ç”¨äºè¿æ³•è¡Œä¸ºï¼ŒåŒæ—¶ä¹Ÿéœ€è¦é€‰æ‹©å¯é å’Œå®‰å…¨çš„æœåŠ¡æä¾›å•†ï¼Œä»¥ä¿è¯ä½¿ç”¨çš„å®‰å…¨å’Œéšç§ã€‚</p></blockquote><p>Tronjanä»£ç†æœåŠ¡ä½¿ç”¨dockeréƒ¨ç½²ï¼Œdocker-composeæ–‡ä»¶å¦‚ä¸‹ï¼š</p><p>å°†å…¶ä¸­çš„<code>test.example.org</code>æ¢æˆä½ è‡ªå·±çš„åŸŸå</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">trojan:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">trojangfw/trojan</span></span><br><span class="line">    <span class="comment">#restart: always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">trojan</span> <span class="string">/etc/trojan/config.json</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6443:443/tcp&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6443:443/udp&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config.json:/etc/trojan/config.json</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/letsencrypt/live/test.example.org/fullchain.pem:/etc/fullchain.pem</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/letsencrypt/live/test.example.org/privkey.pem:/etc/privkey.pem</span></span><br></pre></td></tr></table></figure><p>trojançš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><p>æ³¨æ„ä¿®æ”¹æ–‡ä»¶æ³¨é‡Šçš„éƒ¨åˆ†</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;run_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;local_addr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span><span class="punctuation">:</span> <span class="number">443</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remote_addr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span> <span class="comment">// ä¸€èˆ¬æƒ…å†µå¡«å†™æœ¬æœºçš„åœ°å€ï¼Œå½“è¯·æ±‚ä¸åŒ¹é…trojanåè®®æ—¶ï¼Œä¼šè‡ªåŠ¨å‘è¿™é‡Œå‘é€httpè¯·æ±‚</span></span><br><span class="line">    <span class="attr">&quot;remote_port&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;11111&quot;</span> <span class="comment">// æ¢æˆä½ çš„å¯†ç </span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;log_level&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;fastopen&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;no_delay&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;keepalive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reuse_port&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;udp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prefer_gro&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;buffer_size&quot;</span><span class="punctuation">:</span> <span class="number">6291456</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reuse_port&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ssl&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/fullchain.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/privkey.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;alpn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;http/1.1&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;verify&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;verify_hostname&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cipher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;session_ticket&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reuse_session&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;prefer_server_cipher&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sni&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test.example.org&quot;</span> <span class="comment">// æ¢æˆä½ è‡ªå·±çš„åŸŸå</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥<code>docker-compose up -d </code>å°±å¯ä»¥å¯åŠ¨äº†ï¼Œå¯ä»¥å…ˆè®¿é—®æµ‹è¯•ä¸€ä¸‹è¡Œä¸è¡Œï¼Œç„¶åå†é…ç½®é€šè¿‡nginxä»£ç†ã€‚</p><p>å¯ä»¥ç›´æ¥åœ¨clashçš„<code>setting -&gt; parsers</code>å¤„å¢åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">parsers:</span> <span class="comment"># array</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">https://....</span> <span class="comment"># ä½ è‡ªå·±çš„è®¢é˜…é“¾æ¥</span></span><br><span class="line">    <span class="attr">yaml:</span></span><br><span class="line">      <span class="attr">prepend-rules:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;DOMAIN-SUFFIX,openai.com,CHATGPT_PERSONAL&#x27;</span> <span class="comment"># æƒ³è¦è‡ªå·±å®šä¹‰çš„ä¸€äº›è§„åˆ™ï¼Œå¦‚æœä¸éœ€è¦ç›´æ¥åˆ æ‰</span></span><br><span class="line">      <span class="attr">append-proxies:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test.example.org</span>  <span class="comment"># åå­—éšä¾¿èµ·</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">trojan</span></span><br><span class="line">          <span class="attr">server:</span> <span class="string">test.example.org</span> <span class="comment"># ä½ è‡ªå·±çš„æœåŠ¡å™¨åŸŸå</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">          <span class="attr">password:</span> <span class="number">11111</span>  <span class="comment"># trojané…ç½®æ–‡ä»¶ä¸­çš„å¯†ç </span></span><br><span class="line">          <span class="attr">udp:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">sni:</span> <span class="string">test.example.org</span>  <span class="comment"># ä½ è‡ªå·±æœåŠ¡å™¨çš„åŸŸå</span></span><br><span class="line">      <span class="attr">append-proxy-groups:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CHATGPT_PERSONAL</span> <span class="comment"># åå­—éšä¾¿èµ·ï¼Œåˆ«å’Œä¸Šé¢ä¸€æ ·å°±è¡Œ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">          <span class="attr">proxies:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;test.example.org&quot;</span> <span class="comment"># ä¸Šé¢proxiesçš„name</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥ç¼–è¾‘clashçš„é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (HTTP and SOCKS5 in one port)</span></span><br><span class="line"><span class="attr">mixed-port:</span> <span class="number">7890</span></span><br><span class="line"><span class="comment"># RESTful API for clash</span></span><br><span class="line"><span class="attr">external-controller:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:58767</span></span><br><span class="line"><span class="attr">allow-lan:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">mode:</span> <span class="string">rule</span></span><br><span class="line"><span class="attr">log-level:</span> <span class="string">warning</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># proxies:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># proxy-groups:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rules:</span></span><br><span class="line"><span class="comment">#   - DOMAIN-SUFFIX,google.com,DIRECT</span></span><br><span class="line"><span class="comment">#   - DOMAIN-KEYWORD,google,DIRECT</span></span><br><span class="line"><span class="comment">#   - DOMAIN,google.com,DIRECT</span></span><br><span class="line"><span class="comment">#   - DOMAIN-SUFFIX,ad.com,REJECT</span></span><br><span class="line"><span class="comment">#   - GEOIP,CN,DIRECT</span></span><br><span class="line"><span class="comment">#   - MATCH,DIRECT</span></span><br><span class="line"><span class="attr">proxies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TEST_TROJAN</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">trojan</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">test.example.org</span> <span class="comment"># ä½ è‡ªå·±çš„æœåŠ¡å™¨åŸŸå</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span> <span class="comment"># æ³¨æ„ç«¯å£</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1111</span> <span class="comment"># trojané…ç½®æ–‡ä»¶ä¸­çš„å¯†ç </span></span><br><span class="line">    <span class="attr">udp:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sni:</span> <span class="string">test.example.org</span> <span class="comment"># ä½ è‡ªå·±çš„æœåŠ¡å™¨åŸŸå</span></span><br><span class="line"><span class="attr">proxy-groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ğŸ¯</span> <span class="string">å…¨çƒç›´è¿</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TEST_TROJAN</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GEOIP,CN,ğŸ¯</span> <span class="string">å…¨çƒç›´è¿</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ°ç°åœ¨ï¼Œåº”è¯¥å¯ä»¥é€šè¿‡trojanè¿›è¡Œä»£ç†äº†ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹å¦‚ä½•é€šè¿‡nginxåœ¨å‰é¢è¿›è¡Œåå‘ä»£ç†ï¼Œå®ç°ç«¯å£å¤ç”¨ã€‚</p><h1 id="Nginxé…ç½®"><a href="#Nginxé…ç½®" class="headerlink" title="Nginxé…ç½®"></a>Nginxé…ç½®</h1><p>ä¸€èˆ¬æƒ…å†µæˆ‘ä»¬ç›´æ¥ä½¿ç”¨nginxè¿›è¡Œhttpçš„åå‘ä»£ç†ï¼Œä½†æ˜¯trojanä¸æ˜¯æ ‡å‡†httpåè®®ï¼Œç›´æ¥ç”¨nginxçš„httpæ¨¡å—æ— æ³•ä½¿ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨nginxçš„streamæ¨¡å—ï¼Œæœ€æ–°ç‰ˆnginxå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>streamæ¨¡å—ä¸httpæ¨¡å—åŒçº§ï¼Œå¯ä»¥è¿›è¡Œtcp&#x2F;udpæµé‡çš„åå‘ä»£ç†ï¼Œä¸‹é¢ç»™å‡ºnginxä¸åŒéƒ¨åˆ†çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè¯´æ˜ã€‚</p><h2 id="ä»£ç†TrojanæœåŠ¡é…ç½®"><a href="#ä»£ç†TrojanæœåŠ¡é…ç½®" class="headerlink" title="ä»£ç†TrojanæœåŠ¡é…ç½®"></a>ä»£ç†TrojanæœåŠ¡é…ç½®</h2><p><code>/etc/nginx/nginx.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line">error_log  /var/log/nginx/error.log notice;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    <span class="comment"># æ—¥å¿—æ ¼å¼å¢åŠ äº†ä¸€ä¸ª$proxy_protocol_addrï¼Œåé¢ä¼šè¯´æ˜</span></span><br><span class="line">    log_format  main  <span class="string">&#x27;$proxy_protocol_addr - $remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>; </span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># å‰é¢å…¶ä½™é…ç½®å‡æ˜¯nginxé»˜è®¤é…ç½®ï¼Œæ²¡æœ‰åšæ”¹åŠ¨</span></span><br><span class="line"><span class="comment"># æ–°å¢streamæ¨¡å—</span></span><br><span class="line">stream &#123;</span><br><span class="line">    log_format steam_main <span class="string">&#x27;$remote_addr [$time_local] $protocol $status $bytes_sent $bytes_received&#x27;</span>;</span><br><span class="line">    <span class="comment"># mapçš„ä½œç”¨æ—¶å°†sniä¸­çš„ä¸»æœºåï¼Œè¿›è¡Œæ˜ å°„</span></span><br><span class="line">    <span class="comment"># ä¸‹é¢è¿™ä¸ªï¼Œå½“å†…éƒ¨å˜é‡$ssl_preread_server_nameåŒ¹é…åˆ°ä»»æ„ä¸€ä¸ªåŸŸåçš„æ—¶å€™ï¼Œä¼šå°†ç¬¬äºŒä¸ªå€¼èµ‹å€¼ç»™$backend_name</span></span><br><span class="line">    <span class="comment"># å…·ä½“æ¥è¯´ï¼Œå½“sniä¸ºtest.example.orgæ—¶ï¼Œå˜é‡$backend_nameçš„å€¼ä¸ºtrojan_proxy</span></span><br><span class="line">    map <span class="variable">$ssl_preread_server_name</span> <span class="variable">$backend_name</span> &#123;</span><br><span class="line">        test.example.org trojan_proxy;</span><br><span class="line">        default web;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># upstreamæ¨¡å—ä½œç”¨ä¸httpæ¨¡å—ä¸­çš„ç›¸åŒ</span></span><br><span class="line">    upstream web &#123;</span><br><span class="line">        server 127.0.0.1:80;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream chat &#123;</span><br><span class="line">       server 127.0.0.1:1443;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream trojan &#123;</span><br><span class="line">       server 127.0.0.1:6443;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">        access_log /var/log/nginx/stream.access.log steam_main;</span><br><span class="line">        error_log /var/log/nginx/stream.error.log debug;</span><br><span class="line">        listen 443 reuseport; <span class="comment"># è¿™é‡Œserverç›‘å¬443ç«¯å£ï¼Œhttpæ¨¡å—ä¸­çš„serverå°±ä¸èƒ½ç›‘å¬443ç«¯å£äº†ï¼Œéœ€è¦é€šè¿‡proxy_passä»£ç†</span></span><br><span class="line">        listen [::]:443 reuseport;</span><br><span class="line">        proxy_protocol on; <span class="comment"># å¼€å¯ä»£ç†åè®®ï¼Œä¼šå°†4å±‚è®¿é—®çš„çœŸå®åœ°å€ä¼ é€’ç»™åç«¯æœåŠ¡ï¼Œå½“ç„¶åç«¯æœåŠ¡ä¹Ÿéœ€è¦æ”¯æŒä»£ç†åè®®</span></span><br><span class="line">        ssl_preread on; <span class="comment"># å¼€å¯é¢„è¯»sniçš„åŠŸèƒ½ï¼Œä½¿å¾—mapæ¨¡å—æ­£å¸¸å·¥ä½œ</span></span><br><span class="line">        proxy_pass <span class="variable">$backend_name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># ç”±äºtrojanæœ¬èº«ä¸æ”¯æŒproxy_protocolä»£ç†åè®®ï¼Œéœ€è¦é€šè¿‡nginxåšä¸‹è½¬åŒ–</span></span><br><span class="line">    upstream trojan_proxy &#123;</span><br><span class="line">      server 127.0.0.1:6234;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">      listen 127.0.0.1:6234 proxy_protocol;</span><br><span class="line">      proxy_pass trojan;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nginxæ–‡ä»¶åšäº†å¦‚ä¸Šé…ç½®åï¼Œå°±åº”è¯¥å¯ä»¥æ­£å¸¸ä»£ç†åˆ°åç«¯çš„trojanæœåŠ¡äº†ã€‚</p><h2 id="ä»£ç†å…¶ä»–webæœåŠ¡é…ç½®"><a href="#ä»£ç†å…¶ä»–webæœåŠ¡é…ç½®" class="headerlink" title="ä»£ç†å…¶ä»–webæœåŠ¡é…ç½®"></a>ä»£ç†å…¶ä»–webæœåŠ¡é…ç½®</h2><p>å…¶ä»–httpæœåŠ¡ä¸­çš„serveråœ¨è¿›è¡Œç›‘å¬æ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨443ç«¯å£äº†ï¼Œéœ€è¦æŒ‡å®šå…¶ä»–ç«¯å£ï¼Œä¸‹é¢ç»™å‡ºæœåŠ¡é…ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        server_name test.example.org;</span><br><span class="line">        <span class="comment"># logging</span></span><br><span class="line">        access_log /var/log/nginx/access.log main;</span><br><span class="line">        error_log /var/log/nginx/error.log warn;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># reverse proxy</span></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://127.0.0.1:3002;</span><br><span class="line">                <span class="comment">#proxy_http_version      1.1;</span></span><br><span class="line">                proxy_cache_bypass      <span class="variable">$http_upgrade</span>;</span><br><span class="line">                proxy_set_header Upgrade                        <span class="variable">$http_upgrade</span>;</span><br><span class="line">                proxy_set_header Connection             <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">                proxy_set_header Host                           <span class="variable">$host</span>;</span><br><span class="line">                <span class="comment"># è¿™é‡Œåº”è¯¥æ¢æˆ$proxy_protocol_addrï¼Œç”±äºæˆ‘çš„åç«¯æœåŠ¡ä¸éœ€è¦ipï¼Œå°±æ²¡ä¿®æ”¹</span></span><br><span class="line">                proxy_set_header X-Real-IP                      <span class="variable">$remote_addr</span>; </span><br><span class="line">                proxy_set_header X-Forwarded-For        <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">                proxy_set_header X-Forwarded-Proto      <span class="variable">$scheme</span>;</span><br><span class="line">                proxy_set_header X-Forwarded-Host       <span class="variable">$host</span>;</span><br><span class="line">                proxy_set_header X-Forwarded-Port       <span class="variable">$server_port</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># additional config</span></span><br><span class="line">        <span class="comment"># favicon.ico</span></span><br><span class="line">        location = /favicon.ico &#123;</span><br><span class="line">                log_not_found off;</span><br><span class="line">                access_log off;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># robots.txt</span></span><br><span class="line">        location = /robots.txt &#123;</span><br><span class="line">                log_not_found off;</span><br><span class="line">                access_log off;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># gzip</span></span><br><span class="line">        gzip on;</span><br><span class="line">        gzip_vary on;</span><br><span class="line">        gzip_proxied any;</span><br><span class="line">        gzip_comp_level 6;</span><br><span class="line">        gzip_types text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ³¨æ„ç«¯å£ï¼Œå¹¶ä¸”éœ€è¦proxy_protocolè¿™ä¸ªå‚æ•°</span></span><br><span class="line">    listen [::]:1443 ssl ipv6only=on proxy_protocol; <span class="comment"># managed by Certbot</span></span><br><span class="line">    listen 1443 ssl proxy_protocol; <span class="comment"># managed by Certbot</span></span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/&lt;ä½ çš„webæœåŠ¡åŸŸå&gt;/fullchain.pems; <span class="comment"># managed by Certbot</span></span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/&lt;ä½ çš„webæœåŠ¡åŸŸå&gt;/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; <span class="comment"># managed by Certbot</span></span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$host</span> = &lt;ä½ çš„webæœåŠ¡åŸŸå&gt;) &#123;</span><br><span class="line">        <span class="built_in">return</span> 301 https://$host<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125; <span class="comment"># managed by Certbot</span></span><br><span class="line">    server_name &lt;ä½ çš„webæœåŠ¡åŸŸå&gt;;</span><br><span class="line">    <span class="comment"># æ³¨æ„è¿™é‡Œæ²¡æœ‰proxy_protocolå‚æ•°ï¼Œä¸ºäº†å®ç°è‡ªåŠ¨è·³è½¬è‡³https</span></span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    <span class="built_in">return</span> 404; <span class="comment"># managed by Certbot</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯nginxçš„httpå—é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä¿®æ”¹ä¸ºï¼ŒéæŒ‡å®šåŸŸåå‡æ— è¿”å›çš„è®¾ç½®äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       80 default_server;</span><br><span class="line">        listen       [::]:80 default_server; </span><br><span class="line">        listen       1443 ssl http2 default_server proxy_protocol;</span><br><span class="line">        listen       [::]:1443 ssl http2 default_server proxy_protocol;</span><br><span class="line">        server_name  _;</span><br><span class="line">        ssl_reject_handshake on ;</span><br><span class="line">        <span class="built_in">return</span> 444;</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li><a href="https://chat.openai.com/chat">https://chat.openai.com/chat</a></li><li><a href="https://razeen.me/posts/nginx-tcp-stream-proxy-keep-real-client-ip/">https://razeen.me/posts/nginx-tcp-stream-proxy-keep-real-client-ip/</a></li><li><a href="https://www.huangyuexiang.com/2020/05/09/Nginx%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AB%AF%E5%8F%A3%E5%90%8C%E6%97%B6%E5%A4%84%E7%90%86%E5%A4%9A%E7%A7%8D%E5%8D%8F%E8%AE%AE/">https://www.huangyuexiang.com/2020/05/09/Nginx%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AB%AF%E5%8F%A3%E5%90%8C%E6%97%B6%E5%A4%84%E7%90%86%E5%A4%9A%E7%A7%8D%E5%8D%8F%E8%AE%AE/</a></li><li><a href="https://www.chengxiaobai.com/trouble-maker/trojan-shared-443-port-scheme">https://www.chengxiaobai.com/trouble-maker/trojan-shared-443-port-scheme</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> æŠ˜è…¾ </category>
          
          <category> ç§‘å­¦å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
            <tag> Trojan </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç™½å«–ç³»åˆ—-åŸºäºGitHub Actionå’Œå›½å†…å…¬ç½‘æœåŠ¡å™¨æ„å»ºå…è´¹ç§‘å­¦å·¥å…·</title>
      <link href="/2022/a2e7677e/"/>
      <url>/2022/a2e7677e/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é‡è¦è¯´æ˜ï¼šè¿™ç¯‡æ–‡ç« ä»…ç”¨äºæŠ€æœ¯æ¢è®¨ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„</p></blockquote><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><h2 id="Github-Action"><a href="#Github-Action" class="headerlink" title="Github Action"></a>Github Action</h2><p>Github Actionæ˜¯ä¸€ç§æŒç»­é›†æˆå’Œéƒ¨ç½²ï¼ˆCI&#x2F;CDï¼‰å¹³å°ï¼Œå¯ç”¨äºè‡ªåŠ¨ç”Ÿæˆã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ<a href="https://docs.github.com/en/actions">å®˜ç½‘</a></p><p>ç”±äºGithubæœ¬èº«æ˜¯åœ¨å¤–ç½‘ï¼Œåœ¨æœ¬æ–‡ä¸­ä¾¿æ˜¯å€ŸåŠ©è¿™ä¸ªä¸´æ—¶ç¯å¢ƒéƒ¨ç½²äº†WS+VMESSç¯å¢ƒæ¥è¿›è¡Œç§‘å­¦ä¸Šç½‘ã€‚ï¼ˆå…³äºVMESSæ˜¯ä»€ä¹ˆè¯·è°·å“¥æˆ–åº¦å¨˜ï¼‰ã€‚</p><p>Github Actionå¯ä»¥åœ¨å…¬å¼€çš„ä»“åº“ä¸­å…è´¹ä½¿ç”¨ï¼Œä¸‹é¢ä¸»è¦ä»‹ç»ä¸æœ¬æ–‡ç›¸å…³çš„ä¸»è¦åŠŸèƒ½å’Œæ¦‚å¿µã€‚</p><h3 id="Github-ActionåŸºæœ¬ä»‹ç»"><a href="#Github-ActionåŸºæœ¬ä»‹ç»" class="headerlink" title="Github ActionåŸºæœ¬ä»‹ç»"></a>Github ActionåŸºæœ¬ä»‹ç»</h3><p>Actionçš„åŠŸèƒ½åœ¨è¿™é‡Œå¯ä»¥ç›´æ¥çœ‹åˆ°</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221030163949452.png"></p><p>Actionä¸»è¦é€šè¿‡å†™yamlæ–‡ä»¶è¿›è¡Œå®šä¹‰ï¼Œyamlæ–‡ä»¶éœ€è¦å®šä¹‰åœ¨<code>.github/workflows</code>è·¯å¾„ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221030164124222.png"></p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªç®€å•çš„actionæ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">action</span> <span class="string">name</span> <span class="comment"># è¿™é‡Œæ˜¯æè¿°è¿™ä¸ªactionçš„åå­—</span></span><br><span class="line"><span class="attr">on:</span> <span class="comment"># actionçš„è§¦å‘æ¡ä»¶ï¼Œæ¯”å¦‚æ‰‹åŠ¨ã€å®šæ—¶ã€æ”¶åˆ°pushäº‹ä»¶ç­‰</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span> <span class="comment"># è¿™ä¸ªè¡¨ç¤ºï¼Œè¯¥actionå¯ä»¥æ‰‹åŠ¨è§¦å‘</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="comment"># å®šæ—¶è°ƒåº¦è§„åˆ™</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">&#x27;*/30 * * * *&#x27;</span></span><br><span class="line"><span class="attr">jobs:</span> <span class="comment"># å¼€å§‹å®šä¹‰è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">  <span class="attr">first:</span> <span class="comment"># ä»»åŠ¡çš„åç§°ï¼Œè¿™ä¸ªâ€˜firstâ€™å¯ä»¥è‡ªå®šä¹‰åå­—</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">unbuntu-latest</span> <span class="comment"># éœ€è¦ä¾èµ–äºä»€ä¹ˆç¯å¢ƒè¿è¡Œï¼Œå‚è€ƒå®˜ç½‘https://docs.github.com/en/actions/using-jobs/choosing-the-runner-for-a-job</span></span><br><span class="line">    <span class="attr">steps:</span> <span class="comment"># å¼€å§‹å®šä¹‰ä»»åŠ¡æ‰§è¡Œçš„æ­¥éª¤</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">set</span> <span class="string">env</span> <span class="comment"># æ­¥éª¤çš„åå­—</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span> <span class="comment"># è¿™ä¸€æ­¥éª¤çš„è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥sudoæ‰§è¡Œå‘½ä»¤ï¼Œç¯å¢ƒä¸­çš„é»˜è®¤ç”¨æˆ·åæ˜¯runnerï¼Œä¸‹é¢è¿™ä¸ªè„šæœ¬å°±æ˜¯ä¿®æ”¹runnerçš„é»˜è®¤å¯†ç </span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">apt</span> <span class="string">update</span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">apt</span> <span class="string">-y</span> <span class="string">install</span> <span class="string">sshpass</span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">passwd</span> <span class="string">runner</span> <span class="string">&lt;&lt;</span> <span class="string">EOD</span></span><br><span class="line">          <span class="string">root</span></span><br><span class="line">          <span class="string">root</span></span><br><span class="line">          <span class="string">EOD</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step2</span></span><br><span class="line">      <span class="string">....</span></span><br></pre></td></tr></table></figure><p>ä¸‹å›¾å¯¹ä¸Šé¢éƒ¨åˆ†ä½ç½®åšäº†ç®€å•å¯¹åº”</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221030165206665.png"></p><h3 id="Github-action-secretsä»‹ç»"><a href="#Github-action-secretsä»‹ç»" class="headerlink" title="Github action secretsä»‹ç»"></a>Github action secretsä»‹ç»</h3><p>å› ä¸ºä»“åº“æ˜¯å…¬å¼€çš„ï¼Œsecretsä¸»è¦æ˜¯ä¸ºäº†å­˜å‚¨ä¸€äº›ä¸æƒ³è¢«åˆ«äººçœ‹åˆ°çš„ä¿¡æ¯ã€‚secretsçš„åˆ›å»ºä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œsecretsåˆ›å»ºåä¸èƒ½ä¿®æ”¹ï¼Œåªèƒ½æ›´æ–°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221030165456577.png"></p><p>secretsåˆ›å»ºåï¼Œå¯ä»¥åœ¨yamlæ–‡ä»¶ä¸­ä»¥<code>$&#123;&#123; secrets.SERVER_IP &#125;&#125;</code>çš„æ–¹å¼å¼•ç”¨ï¼Œæ³¨æ„ä¸¤ä¾§æœ‰ä¸¤ä¸ªç©ºæ ¼ã€‚</p><p>è‡³æ­¤ï¼Œæœ€ç®€å•çš„actioné…ç½®ä»‹ç»å®Œäº†ã€‚</p><h2 id="å…¬ç½‘æœåŠ¡å™¨"><a href="#å…¬ç½‘æœåŠ¡å™¨" class="headerlink" title="å…¬ç½‘æœåŠ¡å™¨"></a>å…¬ç½‘æœåŠ¡å™¨</h2><p>å…¬ç½‘æœåŠ¡å™¨çš„ç”³è¯·å¯ä»¥ä»é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å¤§å‚ç”³è¯·å›½å†…çš„å…¬ç½‘æœåŠ¡å™¨ï¼Œè¿™é‡Œä¸»è¦æ˜¯è¦æœ‰ä¸€ä¸ªå…¬ç½‘ipï¼Œæ–¹ä¾¿actionä¸­çš„è™šæ‹Ÿç¯å¢ƒå¯ä»¥ç›´æ¥è®¿é—®ï¼Œå¦‚æœå®¶åº­æœ‰å…¬ç½‘ipä¹Ÿå¯ä»¥ä¸ç”¨ç”³è¯·äº‘æœåŠ¡å™¨ã€‚</p><h2 id="ç§‘å­¦å·¥å…·"><a href="#ç§‘å­¦å·¥å…·" class="headerlink" title="ç§‘å­¦å·¥å…·"></a>ç§‘å­¦å·¥å…·</h2><p>æœ¬æ–‡çš„ç¯å¢ƒä½¿ç”¨clashå®¢æˆ·ç«¯ã€‚</p><p>ClashX For Macï¼š<a href="https://github.com/yichengchen/clashX/releases">https://github.com/yichengchen/clashX/releases</a></p><p>Clash For Windowsï¼ˆå½“å‰ä¹Ÿæ”¯æŒMacï¼‰ï¼š<a href="https://github.com/Fndroid/clash_for_windows_pkg/releases">https://github.com/Fndroid/clash_for_windows_pkg/releases</a></p><h1 id="åŸç†ä»‹ç»"><a href="#åŸç†ä»‹ç»" class="headerlink" title="åŸç†ä»‹ç»"></a>åŸç†ä»‹ç»</h1><p>æ•´ä¸ªå·¥ä½œè¿‡ç¨‹çš„åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŸç†å¾ˆç®€å•ï¼š</p><ol><li>Github Actionå°†å…¶ä¸­çš„VmessæœåŠ¡è½¬å‘è‡³å›½å†…çš„å…¬ç½‘æœåŠ¡å™¨ä¸Š</li><li>å®¢æˆ·ç«¯ç›´æ¥è¿æ¥å…¬ç½‘æœåŠ¡å™¨ä¸Šçš„ç«¯å£</li></ol><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221030172053793.png"></p><h1 id="éƒ¨ç½²åŠä½¿ç”¨"><a href="#éƒ¨ç½²åŠä½¿ç”¨" class="headerlink" title="éƒ¨ç½²åŠä½¿ç”¨"></a>éƒ¨ç½²åŠä½¿ç”¨</h1><h2 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h2><p>actionçš„é…ç½®æ–‡ä»¶å¯ä»¥ç›´æ¥ä»è¿™é‡Œä¸‹è½½ï¼š<a href="https://halfcoke.github.io/config/action/ssh-forward.yaml">https://halfcoke.github.io/config/action/ssh-forward.yaml</a></p><h3 id="v2rayé…ç½®è¯´æ˜"><a href="#v2rayé…ç½®è¯´æ˜" class="headerlink" title="v2rayé…ç½®è¯´æ˜"></a>v2rayé…ç½®è¯´æ˜</h3><p>ä¸‹é¢æ‘˜å‡ºäº†v2rayçš„config.jsonçš„é…ç½®æ–‡ä»¶ï¼Œåšä¸€äº›ç®€å•è¯´æ˜</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;loglevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;info&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">3456</span><span class="punctuation">,</span> <span class="comment">// v2rayç›‘å¬çš„ç«¯å£ï¼Œéœ€è¦ä¸caddyé…ç½®æ–‡ä»¶ä¸­ç›¸åŒ</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;allocate&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;26e3a620-e33e-****-****-4570b0ecf39c&quot;</span><span class="punctuation">,</span> <span class="comment">// uuidï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶ä½¿ç”¨ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ</span></span><br><span class="line">            <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;client@example.com&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;disableInsecureEncryption&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;connectionReuse&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/graphql&quot;</span> <span class="comment">// wsçš„è·¯å¾„</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;security&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tcpSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;header&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;response&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;200&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;headers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;Content-Type&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                  <span class="string">&quot;application/octet-stream&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="string">&quot;application/x-msdownload&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="string">&quot;text/html&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="string">&quot;application/x-shockwave-flash&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Transfer-Encoding&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;chunked&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Connection&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;keep-alive&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Pragma&quot;</span><span class="punctuation">:</span> <span class="string">&quot;no-cache&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blackhole&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blocked&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;domainStrategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AsIs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;0.0.0.0/8&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;10.0.0.0/8&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;100.64.0.0/10&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;127.0.0.0/8&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;169.254.0.0/16&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;172.16.0.0/12&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;192.0.0.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;192.0.2.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;192.168.0.0/16&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;198.18.0.0/15&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;198.51.100.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;203.0.113.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;::1/128&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;fc00::/7&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;fe80::/10&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;geoip:private&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blocked&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;bittorrent&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blocked&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Caddyé…ç½®è¯´æ˜"><a href="#Caddyé…ç½®è¯´æ˜" class="headerlink" title="Caddyé…ç½®è¯´æ˜"></a>Caddyé…ç½®è¯´æ˜</h3><p>ä¸‹é¢å¯¹Caddyé…ç½®æ–‡ä»¶è¿›è¡Œç®€å•è¯´æ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:<span class="variable">$&#123;&#123; secrets.SERVER_REMOTE_PORT &#125;</span>&#125; &#123; <span class="comment"># è¿™ä¸ªç«¯å£éœ€è¦ä¸sshè½¬å‘çš„ç«¯å£ç›¸åŒ</span></span><br><span class="line">  <span class="built_in">log</span> &#123;</span><br><span class="line">  output stdout</span><br><span class="line">  &#125;</span><br><span class="line">  root * /web</span><br><span class="line">  reverse_proxy localhost:3456 <span class="comment"># è¿™ä¸ªç«¯å£éœ€è¦ä¸v2rayç›¸åŒ</span></span><br><span class="line">&#125;</span><br><span class="line">auto_https off <span class="comment"># å…³é—­è‡ªåŠ¨https</span></span><br></pre></td></tr></table></figure><h3 id="sshè¿œç¨‹ç«¯å£è½¬å‘è¯´æ˜"><a href="#sshè¿œç¨‹ç«¯å£è½¬å‘è¯´æ˜" class="headerlink" title="sshè¿œç¨‹ç«¯å£è½¬å‘è¯´æ˜"></a>sshè¿œç¨‹ç«¯å£è½¬å‘è¯´æ˜</h3><p>å› ä¸ºsshæœ¬èº«ä¸æ”¯æŒåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¯†ç ï¼Œå¯ä»¥é‡‡ç”¨ç±»ä¼¼è¿™ç§æ–¹å¼ï¼Œæˆ–è€…ä½¿ç”¨sshpassï¼Œæœ¬æ–‡ä½¿ç”¨äº†sshpass</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd runner &lt;&lt; <span class="string">EOD</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string">EOD</span></span><br></pre></td></tr></table></figure><p>ç«¯å£è½¬å‘å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshpass -p <span class="variable">$&#123;&#123; secrets.SERVER_SSH_PASSWORD &#125;</span>&#125; ssh -o <span class="string">&quot;StrictHostKeyChecking no&quot;</span> -f -NT -p <span class="variable">$&#123;&#123; secrets.SERVER_SSH_PORT &#125;</span>&#125; -R :<span class="variable">$&#123;&#123; secrets.SERVER_REMOTE_PORT &#125;</span>&#125;:localhost:<span class="variable">$&#123;&#123; secrets.SERVER_REMOTE_PORT &#125;</span>&#125; <span class="variable">$&#123;&#123; secrets.SERVER_SSH_USER &#125;</span>&#125;@<span class="variable">$&#123;&#123; secrets.SERVER_IP &#125;</span>&#125;</span><br></pre></td></tr></table></figure><p>å…³äºsshç«¯å£è½¬å‘çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šSSHç«¯å£è½¬å‘è¯¦è§£<a href="https://halfcoke.github.io/2021/cac946/">https://halfcoke.github.io/2021/cac946/</a></p><h3 id="Github-Action-Secretsé…ç½®"><a href="#Github-Action-Secretsé…ç½®" class="headerlink" title="Github Action Secretsé…ç½®"></a>Github Action Secretsé…ç½®</h3><p>éœ€è¦åœ¨Secretsä¸­é…ç½®ä¸‹é¢è¿™å‡ ä¸ªå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SERVER_SSH_USER <span class="comment"># å…¬ç½‘æœåŠ¡å™¨çš„sshç”¨æˆ·</span></span><br><span class="line">SERVER_SSH_PASSWORD  <span class="comment"># å…¬ç½‘æœåŠ¡å™¨çš„sshå¯†ç </span></span><br><span class="line"></span><br><span class="line">SERVER_IP <span class="comment"># å…¬ç½‘æœåŠ¡å™¨çš„åŸŸåï¼Œç›®å‰å¿…é¡»ä½¿ç”¨åŸŸå</span></span><br><span class="line">SERVER_SSH_PORT <span class="comment"># å…¬ç½‘æœåŠ¡å™¨çš„sshç«¯å£</span></span><br><span class="line"></span><br><span class="line">SERVER_REMOTE_PORT <span class="comment"># vmessæœåŠ¡æƒ³è¦åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šç›‘å¬çš„ç«¯å£</span></span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><p>å®¢æˆ·ç«¯ä¸»è¦é…ç½®clashçš„é…ç½®æ–‡ä»¶ï¼Œå·²ç»æ ‡å‡ºäº†éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">redir-port:</span> <span class="number">7892</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸å±€åŸŸç½‘çš„è¿æ¥</span></span><br><span class="line"><span class="attr">allow-lan:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨æ›´æ–°å‘¨æœŸ</span></span><br><span class="line"></span><br><span class="line"><span class="attr">interval:</span> <span class="number">3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§„åˆ™æ¨¡å¼ï¼šRuleï¼ˆè§„åˆ™ï¼‰ / Globalï¼ˆå…¨å±€ä»£ç†ï¼‰/ Directï¼ˆå…¨å±€ç›´è¿ï¼‰</span></span><br><span class="line"><span class="attr">mode:</span> <span class="string">global</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ« (é»˜è®¤çº§åˆ«ï¼šsilentï¼Œå³ä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œä»¥é¿å…å› æ—¥å¿—å†…å®¹è¿‡å¤§è€Œå¯¼è‡´ç¨‹åºå†…å­˜æº¢å‡ºï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># 5 ä¸ªçº§åˆ«ï¼šsilent / info / warning / error / debugã€‚çº§åˆ«è¶Šé«˜æ—¥å¿—è¾“å‡ºé‡è¶Šå¤§ï¼Œè¶Šå€¾å‘äºè°ƒè¯•ï¼Œè‹¥éœ€è¦è¯·è‡ªè¡Œå¼€å¯ã€‚</span></span><br><span class="line"><span class="attr">log-level:</span> <span class="string">silent</span></span><br><span class="line"><span class="comment"># Clash çš„ RESTful API</span></span><br><span class="line"><span class="attr">external-controller:</span> <span class="string">&#x27;0.0.0.0:9090&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RESTful API çš„å£ä»¤</span></span><br><span class="line"><span class="attr">secret:</span> <span class="string">&#x27;&#x27;</span> </span><br><span class="line"><span class="attr">proxies:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;ä»£ç†åå­—&quot;</span> <span class="comment"># éœ€è¦ä¿®æ”¹</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">&quot;æœåŠ¡å™¨åŸŸå&quot;</span> <span class="comment"># éœ€è¦ä¿®æ”¹</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£</span> <span class="comment"># éœ€è¦ä¿®æ”¹</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">vmess</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">vmessé…ç½®æ–‡ä»¶ä¸­çš„uuid</span> <span class="comment"># éœ€è¦ä¿®æ”¹</span></span><br><span class="line">    <span class="attr">alterId:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">auto</span></span><br><span class="line">    <span class="attr">network:</span> <span class="string">ws</span></span><br><span class="line">    <span class="attr">tls:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">ws-path:</span> <span class="string">/graphql</span></span><br><span class="line">    <span class="attr">ws-opts:</span> </span><br><span class="line">      <span class="attr">path:</span> <span class="string">/graphql</span></span><br><span class="line"><span class="attr">proxy-groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ğŸ¯</span> <span class="string">å…¨çƒç›´è¿</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ä»£ç†åå­—</span> <span class="comment"># éœ€è¦ä¿®æ”¹</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">GEOIP,CN,ğŸ¯</span> <span class="string">å…¨çƒç›´è¿</span></span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œå¿«å»æµ‹è¯•ä¸€ä¸‹å§ï¼</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>github action. <a href="https://docs.github.com/en/actions">https://docs.github.com/en/actions</a></li><li>v2rayæœåŠ¡. <a href="https://www.v2fly.org/">https://www.v2fly.org/</a></li><li>caddyé…ç½®. <a href="https://caddyserver.com/docs/">https://caddyserver.com/docs/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> æŠ˜è…¾ </category>
          
          <category> ç§‘å­¦å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½¬å‘ </tag>
            
            <tag> éš§é“ </tag>
            
            <tag> Gihub Action </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>K3S å®‰è£…åŠéƒ¨ç½²</title>
      <link href="/2022/50e64521/"/>
      <url>/2022/50e64521/</url>
      
        <content type="html"><![CDATA[<h1 id="K3s"><a href="#K3s" class="headerlink" title="K3s"></a>K3s</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><blockquote><p>Lightweight Kubernetes. Easy to install, half the memory, all in a binary of less than 100 MB.</p></blockquote><p>K3sæ˜¯K8sè½»é‡çº§çš„å‘è¡Œç‰ˆï¼ŒK3så®Œå…¨å…¼å®¹K8sï¼Œä¸»è¦æ˜¯ä¸ºäº†è¾¹ç¼˜è®¡ç®—å’Œç‰©è”ç½‘ï¼Œæ‰€ä»¥K3sä¹Ÿæ”¯æŒARMæ¶æ„ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h3><h4 id="é€šç”¨"><a href="#é€šç”¨" class="headerlink" title="é€šç”¨"></a>é€šç”¨</h4><blockquote><p>If all your nodes have the same hostname, use the <code>--with-node-id</code> option to append a random suffix for each node, or otherwise devise a unique name to pass with <code>--node-name</code> or <code>$K3S_NODE_NAME</code> for each node you add to the cluster.</p></blockquote><p>æ¯ä¸ªä¸»æœºä¸èƒ½æœ‰ç›¸åŒçš„åå­—ï¼Œå¦‚æœæœ‰ç›¸åŒçš„åå­—å¯ä»¥ä½¿ç”¨<code>--with-node-id</code>å‚æ•°æ¥ç”Ÿæˆéšæœºåç¼€ï¼Œæˆ–è€…ä½¿ç”¨<code>--node-name</code>æˆ–å˜é‡<code>$K3S_NODE_NAME</code>æŒ‡å®šèŠ‚ç‚¹åç§°ã€‚</p><h4 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h4><p>å¯¹äºRed Hat&#x2F;Centoséœ€è¦å…³é—­firewalld</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld --now</span><br></pre></td></tr></table></figure><p>å…¶ä»–ç³»ç»Ÿçš„å‰ç½®æ¡ä»¶å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼ˆ<a href="https://docs.k3s.io/advanced#additional-os-preparations%EF%BC%89">https://docs.k3s.io/advanced#additional-os-preparationsï¼‰</a></p><h4 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h4><ol><li>æ‰€æœ‰èŠ‚ç‚¹éœ€è¦èƒ½å¤Ÿè®¿é—®K3s serverçš„<code>6443</code>ç«¯å£</li><li>å½“ä½¿ç”¨Flannel VXLANæ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹éœ€è¦èƒ½å¤Ÿäº’ç›¸è®¿é—®<code>8472/udp</code>ï¼›å½“ä½¿ç”¨Flannel Wireguardæ—¶ï¼Œéœ€è¦èƒ½å¤Ÿäº’ç›¸è®¿é—®<code>51820/udp</code>å’Œ<code>51821/udp</code>ï¼ˆIPv6ï¼‰</li><li>å¦‚æœä½¿ç”¨metrics server è¿˜éœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¼€å¯<code>10250</code>ç«¯å£</li><li>å¦‚æœè¦é€šè¿‡å†…å»ºçš„etcdå®ç°serverçš„é«˜å¯ç”¨ï¼Œè¿˜éœ€è¦å¼€å¯<code>2379</code>å’Œ<code>2380</code>ç«¯å£</li></ol><blockquote><p><strong>Important:</strong> The VXLAN port on nodes should not be exposed to the world as it opens up your cluster network to be accessed by anyone. Run your nodes behind a firewall&#x2F;security group that disables access to port 8472. <strong>Warning:</strong> Flannel relies on the <a href="https://www.cni.dev/plugins/current/main/bridge/">Bridge CNI plugin</a> to create a L2 network that switches traffic. Rogue pods with NET_RAW capabilities can abuse that L2 network to launch attacks such as [ARP spoofing](<a href="https://static.sched.com/hosted_files/kccncna19/72/ARP">https://static.sched.com/hosted_files/kccncna19/72/ARP</a> DNS spoof.pdf). Therefore, as documented in the <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/">kubernetes docs</a>, please set a restricted profile that disables NET_RAW on non-trustable pods.</p></blockquote><p>æ³¨æ„äº‹é¡¹ï¼š</p><p> VXLAN portåº”ä»…èƒ½è¢«å„ä¸ªèŠ‚ç‚¹è®¿é—®ï¼Œä¸èƒ½è¢«å¤–éƒ¨è®¿é—®</p><table><thead><tr><th>Protocol</th><th>Port</th><th>Source</th><th>Description</th></tr></thead><tbody><tr><td>TCP</td><td>6443</td><td>K3s agent nodes</td><td>Kubernetes API Server</td></tr><tr><td>UDP</td><td>8472</td><td>K3s server and agent nodes</td><td>Required only for Flannel VXLAN</td></tr><tr><td>UDP</td><td>51820</td><td>K3s server and agent nodes</td><td>Required only for Flannel Wireguard backend</td></tr><tr><td>UDP</td><td>51821</td><td>K3s server and agent nodes</td><td>Required only for Flannel Wireguard backend with IPv6</td></tr><tr><td>TCP</td><td>10250</td><td>K3s server and agent nodes</td><td>Kubelet metrics</td></tr><tr><td>TCP</td><td>2379-2380</td><td>K3s server nodes</td><td>Required only for HA with embedded etcd</td></tr></tbody></table><ol start="5"><li>å¯ä»¥é€šè¿‡<code>--cluster-cidr</code>æŒ‡å®šå­ç½‘èŒƒå›´ï¼Œä½†æ˜¯è¦æ³¨æ„podæ•°é‡ï¼Œåˆ«è€—å…‰æ‰€æœ‰ip</li></ol><h3 id="ç¦»çº¿ç¯å¢ƒå‡†å¤‡"><a href="#ç¦»çº¿ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¦»çº¿ç¯å¢ƒå‡†å¤‡"></a>ç¦»çº¿ç¯å¢ƒå‡†å¤‡</h3><h4 id="æ­å»ºç§æœ‰ä»“åº“-ubuntu20"><a href="#æ­å»ºç§æœ‰ä»“åº“-ubuntu20" class="headerlink" title="æ­å»ºç§æœ‰ä»“åº“(ubuntu20)"></a>æ­å»ºç§æœ‰ä»“åº“(ubuntu20)</h4><ol><li><p>åœ¨ä¸»èŠ‚ç‚¹ä¸Šå®‰è£…docker</p><p>è¯´æ˜ï¼šç›´æ¥ä½¿ç”¨k3så¯ä»¥ä¸ç”¨å®‰è£…dockerï¼Œä½†æ˜¯å»ºè®®åœ¨ä¸€ä¸ªæœ‰ç½‘ç»œçš„æœºå™¨ä¸Šå®‰è£…docker æ–¹ä¾¿æ‹‰å–é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æ·»åŠ å¯†é’¥</span></span><br><span class="line">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># 2. æ·»åŠ ä»“åº“</span></span><br><span class="line">add-apt-repository \</span><br><span class="line"><span class="string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \</span></span><br><span class="line"><span class="string"><span class="subst">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">stable&quot;</span></span><br><span class="line"><span class="comment"># 3. å®‰è£…docker</span></span><br><span class="line">apt install docker-ce</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ç§æœ‰ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart=always --name registry registry:2</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®æœ¬åœ°ä»“åº“http</p><p>ç¼–è¾‘<code>/etc/docker/daemon.json</code></p><p>æ ¹æ®å®é™…ipè¿›è¡Œä¿®æ”¹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;insecure-registries&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.6.1:5000&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>ä¸‹è½½K3så¿…è¦é•œåƒ</p><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/k3s-io/k3s/releases/download/v1.25.2%2Bk3s1/k3s-airgap-images-amd64.tar.gz">https://github.com/k3s-io/k3s/releases/download/v1.25.2%2Bk3s1/k3s-airgap-images-amd64.tar.gz</a></p></li><li><p>ä¸‹è½½ingress-nginxå¿…è¦é•œåƒï¼ˆéœ€è¦ä»£ç†æˆ–è€…ç§‘å­¦ï¼‰</p><p>æˆ–è€…ä¸‹è½½ï¼š<a href="https://github.com/HalfCoke/HalfCoke.github.io/releases/download/nginx-ingress/nginx-ingress.tar.gz">https://github.com/HalfCoke/HalfCoke.github.io/releases/download/nginx-ingress/nginx-ingress.tar.gz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx/nginx-ingress:2.4.1</span><br><span class="line">docker pull docker-registry.nginx.com/nap-dos/app_protect_dos_arb:1.1.0</span><br></pre></td></tr></table></figure></li><li><p>å°†é•œåƒæ¨é€è‡³ç§æœ‰ä»“åº“</p><p>æ ¹æ®å®é™…ç‰ˆæœ¬ä¿®æ”¹è„šæœ¬ä¸­çš„ç‰ˆæœ¬å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">PRIVATE_REGISTRY=&quot;192.168.6.1:5000&quot;</span><br><span class="line">docker load -i k3s-airgap-images-amd64.tar.gz</span><br><span class="line">docker load -i nginx-ingress.tar.gz</span><br><span class="line">BUSYBOX=&quot;1.34.1&quot;</span><br><span class="line">HELM=&quot;v0.7.3-build20220613&quot;</span><br><span class="line">TRAEFIK=&quot;2.6.2&quot;</span><br><span class="line">COREDNS=&quot;1.9.1&quot;</span><br><span class="line">KLIPPER_LB=&quot;v0.3.5&quot;</span><br><span class="line">PROVISIONER=&quot;v0.0.21&quot;</span><br><span class="line">METRICS=&quot;v0.5.2&quot;</span><br><span class="line">PAUSE=&quot;3.6&quot;</span><br><span class="line"></span><br><span class="line">INGRESS_NGINX_APP_PROTECT=&quot;1.1.0&quot;</span><br><span class="line">INGRESS_NGINX_CONTROLLER=&quot;2.4.1&quot;</span><br><span class="line"></span><br><span class="line">docker tag rancher/mirrored-library-busybox:$BUSYBOX $PRIVATE_REGISTRY/rancher/mirrored-library-busybox:$BUSYBOX            </span><br><span class="line">docker tag rancher/klipper-helm:$HELM $PRIVATE_REGISTRY/rancher/klipper-helm:$HELM</span><br><span class="line">docker tag rancher/mirrored-library-traefik:$TRAEFIK $PRIVATE_REGISTRY/rancher/mirrored-library-traefik:$TRAEFIK</span><br><span class="line">docker tag rancher/mirrored-coredns-coredns:$COREDNS $PRIVATE_REGISTRY/rancher/mirrored-coredns-coredns:$COREDNS  </span><br><span class="line">docker tag rancher/klipper-lb:$KLIPPER_LB $PRIVATE_REGISTRY/rancher/klipper-lb:$KLIPPER_LB</span><br><span class="line">docker tag rancher/local-path-provisioner:$PROVISIONER $PRIVATE_REGISTRY/rancher/local-path-provisioner:$PROVISIONER</span><br><span class="line">docker tag rancher/mirrored-metrics-server:$METRICS $PRIVATE_REGISTRY/rancher/mirrored-metrics-server:$METRICS</span><br><span class="line">docker tag rancher/mirrored-pause:$PAUSE $PRIVATE_REGISTRY/rancher/mirrored-pause:$PAUSE</span><br><span class="line">docker tag nginx/nginx-ingress:$INGRESS_NGINX_CONTROLLER $PRIVATE_REGISTRY/nginx/nginx-ingress:$INGRESS_NGINX_CONTROLLER</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ³¨æ„ä¸‹é¢è¿™ä¸ªtagçš„æ›¿æ¢ï¼Œæ‰“æ ‡è®°æ—¶å»æ‰äº†docker-registry.nginx.comï¼Œè¿™æ˜¯ä¸ºäº†é…åˆk3sç§æœ‰ä»“åº“è¿›è¡Œæ‹‰å–</span></span><br><span class="line">docker tag docker-registry.nginx.com/nap-dos/app_protect_dos_arb:$INGRESS_NGINX_APP_PROTECT $PRIVATE_REGISTRY/nap-dos/app_protect_dos_arb:$INGRESS_NGINX_APP_PROTECT</span><br><span class="line"></span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/mirrored-library-busybox:$BUSYBOX </span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/klipper-helm:$HELM</span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/mirrored-library-traefik:$TRAEFIK</span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/mirrored-coredns-coredns:$COREDNS</span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/klipper-lb:$KLIPPER_LB</span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/local-path-provisioner:$PROVISIONER</span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/mirrored-metrics-server:$METRICS</span><br><span class="line">docker push $PRIVATE_REGISTRY/rancher/mirrored-pause:$PAUSE</span><br><span class="line">docker push $PRIVATE_REGISTRY/nap-dos/app_protect_dos_arb:$INGRESS_NGINX_APP_PROTECT</span><br><span class="line">docker push $PRIVATE_REGISTRY/nginx/nginx-ingress:$INGRESS_NGINX_CONTROLLER</span><br></pre></td></tr></table></figure></li></ol><h4 id="é…ç½®k3sç§æœ‰ä»“åº“"><a href="#é…ç½®k3sç§æœ‰ä»“åº“" class="headerlink" title="é…ç½®k3sç§æœ‰ä»“åº“"></a>é…ç½®k3sç§æœ‰ä»“åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/rancher/k3s/</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/rancher/k3s/registries.yaml  &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">mirrors:</span></span><br><span class="line"><span class="string">  docker.io:</span></span><br><span class="line"><span class="string">    endpoint:</span></span><br><span class="line"><span class="string">      - &quot;http://192.168.6.1:5000&quot;</span></span><br><span class="line"><span class="string">  docker-registry.nginx.com:</span></span><br><span class="line"><span class="string">    endpoint:</span></span><br><span class="line"><span class="string">      - &quot;http://192.168.6.1:5000&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h4 id="ä¸‹è½½k3så®‰è£…æ–‡ä»¶åŠæ‰§è¡Œæ–‡ä»¶"><a href="#ä¸‹è½½k3så®‰è£…æ–‡ä»¶åŠæ‰§è¡Œæ–‡ä»¶" class="headerlink" title="ä¸‹è½½k3så®‰è£…æ–‡ä»¶åŠæ‰§è¡Œæ–‡ä»¶"></a>ä¸‹è½½k3så®‰è£…æ–‡ä»¶åŠæ‰§è¡Œæ–‡ä»¶</h4><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/k3s-io/k3s/releases/download/v1.25.2%2Bk3s1/k3s">https://github.com/k3s-io/k3s/releases/download/v1.25.2%2Bk3s1/k3s</a></p><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://get.k3s.io./">https://get.k3s.io./</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x k3s</span><br><span class="line"><span class="built_in">chmod</span> +x install.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> k3s /usr/local/bin/</span><br></pre></td></tr></table></figure><h4 id="ç¦»çº¿å®‰è£…ingress-nginx-controller"><a href="#ç¦»çº¿å®‰è£…ingress-nginx-controller" class="headerlink" title="ç¦»çº¿å®‰è£…ingress-nginx-controller"></a>ç¦»çº¿å®‰è£…ingress-nginx-controller</h4><p>å®˜æ–¹å®‰è£…è¯´æ˜ï¼š<a href="https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/">https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/</a></p><p>å°†æ‰€éœ€æ–‡ä»¶å­˜å‚¨ä¸º<code>ingress-nginx.yml</code></p><p>æ³¨æ„ï¼šingressé»˜è®¤åªèƒ½è¿›è¡Œhttp(s)ä»£ç†ï¼Œä¸ºäº†è¿›è¡Œtcpæˆ–udpä»£ç†ï¼Œå¹¶ä¸”å°†æœåŠ¡ç«¯å£æš´éœ²åœ¨å®¿ä¸»æœºæ¡‘ï¼Œéœ€è¦å¯¹å®˜æ–¹æ–‡ä»¶è¿›è¡Œä¸€äº›è°ƒæ•´</p><ol><li>åœ¨ingressçš„DaemonSetä¸­çš„spec.template.specä¸­å¢åŠ <code>hostNetwork: true</code></li><li>åœ¨argséƒ¨åˆ†å–æ¶ˆ<code>- -global-configuration=$(POD_NAMESPACE)/nginx-configuration</code>æ³¨é‡Š</li></ol><p>å¯ä»¥ä»è¿™é‡Œä¸‹è½½å·²ç»ä¿®æ”¹å¥½çš„ymlï¼Œé“¾æ¥ï¼š<a href="https://halfcoke.github.io/config/nginx-ingress/nginx-ingress.yml">https://halfcoke.github.io/config/nginx-ingress/nginx-ingress.yml</a></p><p>ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ingress-nginx.yml</span><br></pre></td></tr></table></figure><h3 id="å•Server"><a href="#å•Server" class="headerlink" title="å•Server"></a>å•Server</h3><p>ä½¿ç”¨å†…å»ºetcdå®‰è£…ï¼Œåç»­æ¯”è¾ƒæ–¹ä¾¿å‡çº§é«˜å¯ç”¨</p><h4 id="æœåŠ¡ç«¯å®‰è£…"><a href="#æœåŠ¡ç«¯å®‰è£…" class="headerlink" title="æœåŠ¡ç«¯å®‰è£…"></a>æœåŠ¡ç«¯å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALL_K3S_SKIP_DOWNLOAD=<span class="literal">true</span> INSTALL_K3S_EXEC=<span class="string">&#x27;server --cluster-init --disable traefik&#x27;</span> K3S_TOKEN=FpqAiu2DZgSEyuHHoH83mFrm ./install.sh</span><br></pre></td></tr></table></figure><h4 id="ä»£ç†å®‰è£…"><a href="#ä»£ç†å®‰è£…" class="headerlink" title="ä»£ç†å®‰è£…"></a>ä»£ç†å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALL_K3S_SKIP_DOWNLOAD=<span class="literal">true</span> K3S_URL=https://192.168.6.1:6443 K3S_TOKEN=FpqAiu2DZgSEyuHHoH83mFrm ./install.sh</span><br></pre></td></tr></table></figure><h4 id="ç¦»çº¿å®‰è£…ingress-nginx-controller-1"><a href="#ç¦»çº¿å®‰è£…ingress-nginx-controller-1" class="headerlink" title="ç¦»çº¿å®‰è£…ingress-nginx-controller"></a>ç¦»çº¿å®‰è£…ingress-nginx-controller</h4><p>å®˜æ–¹å®‰è£…è¯´æ˜ï¼š<a href="https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/">https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/</a></p><p>å°†æ‰€éœ€æ–‡ä»¶å­˜å‚¨ä¸º<code>ingress-nginx.yml</code></p><p>æ³¨æ„ï¼šingressé»˜è®¤åªèƒ½è¿›è¡Œhttp(s)ä»£ç†ï¼Œä¸ºäº†è¿›è¡Œtcpæˆ–udpä»£ç†ï¼Œå¹¶ä¸”å°†æœåŠ¡ç«¯å£æš´éœ²åœ¨å®¿ä¸»æœºä¸Šï¼Œéœ€è¦å¯¹å®˜æ–¹æ–‡ä»¶è¿›è¡Œä¸€äº›è°ƒæ•´</p><ol><li>åœ¨ingressçš„DaemonSetä¸­çš„spec.template.specä¸­å¢åŠ <code>hostNetwork: true</code></li><li>åœ¨argséƒ¨åˆ†å–æ¶ˆ<code>- -global-configuration=$(POD_NAMESPACE)/nginx-configuration</code>æ³¨é‡Š</li></ol><p>å¯ä»¥ä»è¿™é‡Œä¸‹è½½å·²ç»ä¿®æ”¹å¥½çš„yamlï¼Œé“¾æ¥ï¼š<a href="https://halfcoke.github.io/config/nginx-ingress/nginx-ingress.yml">https://halfcoke.github.io/config/nginx-ingress/nginx-ingress.yml</a></p><p>ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ingress-nginx.yml</span><br></pre></td></tr></table></figure><h3 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h3><p>todoâ€¦</p><h1 id="ç®€å•æœåŠ¡éƒ¨ç½²"><a href="#ç®€å•æœåŠ¡éƒ¨ç½²" class="headerlink" title="ç®€å•æœåŠ¡éƒ¨ç½²"></a>ç®€å•æœåŠ¡éƒ¨ç½²</h1><h2 id="ä½¿ç”¨nginxæœåŠ¡è¿›è¡Œæµ‹è¯•"><a href="#ä½¿ç”¨nginxæœåŠ¡è¿›è¡Œæµ‹è¯•" class="headerlink" title="ä½¿ç”¨nginxæœåŠ¡è¿›è¡Œæµ‹è¯•"></a>ä½¿ç”¨nginxæœåŠ¡è¿›è¡Œæµ‹è¯•</h2><ol><li><p>ç›´æ¥ä¸‹è½½nginxæœåŠ¡yamlæ–‡ä»¶ï¼ŒåŒ…å«äº†deploymentã€serviceã€ingress</p><p>ä½¿ç”¨<code>kubectl apply -f demo.yml</code>è¿›è¡Œéƒ¨ç½²</p><p>ä¸‹è½½é“¾æ¥ï¼š<a href="https://halfcoke.github.io/config/nginx-ingress/demo/demo.yml">https://halfcoke.github.io/config/nginx-ingress/demo/demo.yml</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-demo</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span> <span class="comment"># å‘ŠçŸ¥ Deployment è¿è¡Œ 1 ä¸ªä¸è¯¥æ¨¡æ¿åŒ¹é…çš„ Pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-demo</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-demo-container</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-demo</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-demo-port</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">nginx-port</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-igs</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">abc.test.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">nginx-service</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">8080</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">k8s.nginx.org/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">GlobalConfiguration</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-configuration</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">listeners:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-tcp</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">1234</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸‹è½½TransportServerçš„ymlæ–‡ä»¶</p><p>ã€<strong>æ³¨æ„</strong>ã€‘è¿™ä¸ªèµ„æºå¿…é¡»å•ç‹¬éƒ¨ç½²ï¼Œè¿™é‡Œä¸ºäº†å°†1234ç«¯å£æš´éœ²åœ¨å®¿ä¸»æœºä¸Šï¼Œå°†nginx-ingressè®¾ç½®ä¸ºhostNetworkï¼Œ<a href="https://halfcoke.github.io/2022/50e64521/#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85ingress-nginx-controller">ä¸Šæ–‡</a>æåˆ°äº†è¿™ä¸ªé…ç½®ã€‚</p><p>ä½¿ç”¨<code>kubectl apply -f demo-ts.yml</code>éƒ¨ç½²</p><p>ä¸‹è½½é“¾æ¥<a href="https://halfcoke.github.io/config/nginx-ingress/demo/demo-ts.yml">https://halfcoke.github.io/config/nginx-ingress/demo/demo-ts.yml</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¿…é¡»å•ç‹¬åˆ›å»º</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">k8s.nginx.org/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">TransportServer</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ts</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">listener:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-tcp</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="attr">upstreams:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-up</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">nginx-service</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">action:</span></span><br><span class="line">    <span class="attr">pass:</span> <span class="string">nginx-up</span></span><br></pre></td></tr></table></figure></li></ol><p>ç„¶åé€šè¿‡ä¸¤ç§æ–¹å¼å¯ä»¥è®¿é—®</p><ol><li><p>é€šè¿‡80ç«¯å£è®¿é—®ï¼Œè¿™ç§æ–¹å¼è¿›è¡Œäº†httpä»£ç†ï¼Œå³ä¸ƒå±‚ä»£ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&#x27;Host: abc.test.com&#x27;</span> ä½ çš„å®¿ä¸»æœºip</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡1234ç«¯å£è®¿é—®ï¼Œè¿™ç§æ–¹å¼è¿›è¡Œäº†tcpä»£ç†ï¼Œå³å››å±‚ä»£ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl ä½ çš„å®¿ä¸»æœºip:1234</span><br></pre></td></tr></table></figure></li></ol><h2 id="æš´éœ²ç«¯å£-æ–¹æ³•2ï¼ˆä¸ä½¿ç”¨hostNetworkï¼‰"><a href="#æš´éœ²ç«¯å£-æ–¹æ³•2ï¼ˆä¸ä½¿ç”¨hostNetworkï¼‰" class="headerlink" title="æš´éœ²ç«¯å£-æ–¹æ³•2ï¼ˆä¸ä½¿ç”¨hostNetworkï¼‰"></a>æš´éœ²ç«¯å£-æ–¹æ³•2ï¼ˆä¸ä½¿ç”¨hostNetworkï¼‰</h2><p>è¿™ç§æ–¹æ³•éœ€è¦ä¿®æ”¹nginx-ingress çš„ daemonSet</p><p>å®Œæ•´çš„DaemonSetå¦‚ä¸‹ï¼Œæ˜¯ä¸Šæ–‡é“¾æ¥<a href="https://halfcoke.github.io/config/nginx-ingress/nginx-ingress.yml%E4%B8%AD%E6%9C%80%E5%90%8E%E4%B8%80%E9%83%A8%E5%88%86%E7%9A%84%E5%86%85%E5%AE%B9">https://halfcoke.github.io/config/nginx-ingress/nginx-ingress.ymlä¸­æœ€åä¸€éƒ¨åˆ†çš„å†…å®¹</a></p><p>ä¿®æ”¹è¯´æ˜è¯·è§æ³¨é‡Š</p><p>æ¯æ¬¡ä¿®æ”¹åå»ºè®®å…ˆdeleteå†applyï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ‰€æœ‰ç«¯å£éƒ½æš´éœ²åœ¨å®¿ä¸»æœºä¸Šï¼ˆå³ä¾¿æ²¡é…ç½®hostPortï¼‰</p><p>è¿™æ ·ï¼Œä¹‹åå¦‚æœéœ€è¦æš´éœ²å‡ºå…¶ä»–ç«¯å£ï¼Œåˆ™éœ€è¦é‡å¯DaemoSetï¼Œè¿™æ ·å¯ä»¥å®ç°å®šç‚¹æš´éœ²ç«¯å£ã€‚</p><p>æ¯æ¬¡é‡å¯åªé‡å¯è¯¥DaemoSetå³å¯ï¼Œå…¶ä»–çš„èµ„æºä¸è¦åŠ¨ï¼Œå¦åˆ™é›†ç¾¤ä¸Šæ‰€æœ‰æœåŠ¡éƒ½è¦é‡å¯ã€‚</p><p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥å°†é»˜è®¤çš„80 443ç«¯å£æ³¨é‡Šæ‰ï¼Œç„¶åé€šè¿‡è‡ªå®šä¹‰ç«¯å£æš´éœ²æœåŠ¡ã€‚</p><p>è¿™æ ·åœ¨ä¸Šæ–‡çš„nginx-demoæ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥ä¸éœ€è¦Ingressèµ„æºï¼Œä»…éœ€è¦GCå’ŒTSå³å¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">     <span class="comment">#annotations:</span></span><br><span class="line">       <span class="comment">#prometheus.io/scrape: &quot;true&quot;</span></span><br><span class="line">       <span class="comment">#prometheus.io/port: &quot;9113&quot;</span></span><br><span class="line">       <span class="comment">#prometheus.io/scheme: http</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nginx-ingress</span></span><br><span class="line">      <span class="attr">automountServiceAccountToken:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># hostNetwork: true # åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹æ­¤è¿›è¡Œæ³¨é‡Š</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx/nginx-ingress:2.4.1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">80</span> <span class="comment"># containerç«¯å£æ˜¯å®¹å™¨ç«¯å£</span></span><br><span class="line">          <span class="attr">hostPort:</span> <span class="number">80</span> <span class="comment"># hostPortç”¨æ¥è¡¨ç¤ºæ˜¯å¦å°†å®¹å™¨çš„ç«¯å£æš´éœ²åœ¨å®¿ä¸»æœºä¸Šï¼Œç†è®ºä¸Šå¯ä»¥ä¸å®¹å™¨ç«¯å£ä¸ä¸€è‡´</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">          <span class="attr">hostPort:</span> <span class="number">443</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-test</span> <span class="comment"># åœ¨è¿™é‡Œæ–°å¢1234ç«¯å£</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">1234</span></span><br><span class="line">          <span class="attr">hostPort:</span> <span class="number">1234</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">readiness-port</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">8081</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">9113</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">         <span class="attr">httpGet:</span></span><br><span class="line">           <span class="attr">path:</span> <span class="string">/nginx-ready</span></span><br><span class="line">           <span class="attr">port:</span> <span class="string">readiness-port</span></span><br><span class="line">         <span class="attr">periodSeconds:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;128Mi&quot;</span></span><br><span class="line">         <span class="comment">#limits:</span></span><br><span class="line">         <span class="comment">#  cpu: &quot;1&quot;</span></span><br><span class="line">         <span class="comment">#  memory: &quot;1Gi&quot;</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">101</span> <span class="comment">#nginx</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">drop:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">            <span class="attr">add:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">NET_BIND_SERVICE</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-nginx-configmaps=$(POD_NAMESPACE)/nginx-config</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-global-configuration=$(POD_NAMESPACE)/nginx-configuration</span></span><br><span class="line">        <span class="comment"># - -ready-status=false # è¿™ä¸ªé€‰é¡¹ç”¨æ¥æ˜¯å¦å¼€å¯readinessï¼Œä¸å¼€å¯çš„è¯get podå®¹å™¨ä¸€ç›´æ— æ³•readyï¼ˆéœ€è¦é€šè¿‡å…¶ä»–æ–¹æ³•ï¼Œè¿™é‡Œä¸åšä»‹ç»ï¼‰</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-nginx-status=true</span> <span class="comment"># æ˜¯å¦å¼€å¯nginx statusæœåŠ¡</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-nginx-status-allow-cidrs=127.0.0.1,::1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-nginx-status-port=64231</span></span><br><span class="line">        <span class="comment">#- -include-year</span></span><br><span class="line">        <span class="comment">#- -v=3 # Enables extensive logging. Useful for troubleshooting.</span></span><br><span class="line">        <span class="comment">#- -report-ingress-status</span></span><br><span class="line">        <span class="comment">#- -external-service=nginx-ingress</span></span><br><span class="line">        <span class="comment">#- -enable-prometheus-metrics</span></span><br></pre></td></tr></table></figure><h2 id="ä¸‹ä¸€æ­¥"><a href="#ä¸‹ä¸€æ­¥" class="headerlink" title="ä¸‹ä¸€æ­¥"></a>ä¸‹ä¸€æ­¥</h2><ol><li>æ–‡ä»¶æŒ‚è½½</li><li>é«˜å¯ç”¨</li><li>é€šè¿‡ingressè¿›è¡Œè®¿é—®æ§åˆ¶</li></ol><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>k8s ingresså®ç°http&#x2F;https7å±‚å’Œtcpå››å±‚ä»£ç†ï¼Œ<a href="https://blog.51cto.com/leejia/2497454">https://blog.51cto.com/leejia/2497454</a></li><li>Nginx-ingressï¼Œ<a href="https://docs.nginx.com/nginx-ingress-controller/">https://docs.nginx.com/nginx-ingress-controller/</a></li><li>k3sæ–‡æ¡£ï¼Œ<a href="https://docs.k3s.io/">https://docs.k3s.io/</a></li><li>ä»£ç†tcp udpæœåŠ¡demoï¼Œ<a href="https://github.com/nginxinc/kubernetes-ingress/tree/v2.4.1/examples/ingress-resources/tcp-udp">https://github.com/nginxinc/kubernetes-ingress/tree/v2.4.1/examples/ingress-resources/tcp-udp</a></li><li>nodeportå’ŒhostNetowrkå¯¹æ¯”ï¼Œ<a href="https://xuxinkun.github.io/2019/06/11/ingress/">https://xuxinkun.github.io/2019/06/11/ingress/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
          <category> K3S </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Linux </tag>
            
            <tag> K3S </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Let&#39;s Encryptè·å–å…è´¹çš„è¯ä¹¦</title>
      <link href="/2022/b14aeca0/"/>
      <url>/2022/b14aeca0/</url>
      
        <content type="html"><![CDATA[<h1 id="Letâ€™s-Encryptç®€ä»‹ï¼ˆæ‘˜è‡ªå®˜ç½‘æ–‡æ¡£ï¼‰"><a href="#Letâ€™s-Encryptç®€ä»‹ï¼ˆæ‘˜è‡ªå®˜ç½‘æ–‡æ¡£ï¼‰" class="headerlink" title="Letâ€™s Encryptç®€ä»‹ï¼ˆæ‘˜è‡ªå®˜ç½‘æ–‡æ¡£ï¼‰"></a>Letâ€™s Encryptç®€ä»‹ï¼ˆæ‘˜è‡ªå®˜ç½‘æ–‡æ¡£ï¼‰</h1><p>ä¸ºäº†åœ¨ä½ çš„ç½‘ç«™ä¸Šè®¾å®šHTTPSï¼Œä½ éœ€è¦ä»å‡­è¯é¢å‘æœºæ„(Certificate Authority, CA) è·å–å‡­è¯ï¼Œè€ŒLetâ€™s Encrypt å°±æ˜¯ä¸€ä¸ªå‡­è¯é¢å‘æœºæ„ã€‚è¦ä»Letâ€™s Encrypt ä¸Šè·å¾—å±äºä½ ç½‘ç«™çš„å‡­è¯ï¼Œä½ å¿…é¡»è¯æ˜ä½ å¯¹åŸŸåçš„æ§åˆ¶æƒã€‚ä½ å¯ä»¥åœ¨ä½ çš„ä¸»æœºä¸Šè¿è¡Œä½¿ç”¨<a href="https://tools.ietf.org/html/rfc8555">ACME åè®®</a>çš„è½¯ä»¶ï¼Œæ¥è·å–Letâ€™s Encrypt çš„å‡­è¯ã€‚</p><p>Letâ€™s Encrypt å’Œ <a href="https://tools.ietf.org/html/rfc8555">ACME åè®®</a>çš„ç›®æ ‡æ˜¯ä½¿é…ç½®èƒ½å¤Ÿè‡ªåŠ¨è·å–å—ä¿¡ä»»æµè§ˆå™¨çš„è¯ä¹¦çš„ HTTPS æœåŠ¡å™¨æˆä¸ºå¯èƒ½ã€‚ è¿™æ˜¯é€šè¿‡åœ¨ web æœåŠ¡å™¨ä¸Šè¿è¡Œè¯ä¹¦ç®¡ç†ä»£ç†æ¥å®Œæˆçš„ã€‚</p><h2 id="åŸŸåè®¤è¯"><a href="#åŸŸåè®¤è¯" class="headerlink" title="åŸŸåè®¤è¯"></a>åŸŸåè®¤è¯</h2><p>Letâ€™s Encrypt é€šè¿‡å…¬é’¥è¯†åˆ«æœåŠ¡å™¨ç®¡ç†å‘˜ã€‚ è¯ä¹¦ç®¡ç†è½¯ä»¶é¦–æ¬¡ä¸ Letâ€™s Encrypt äº¤äº’æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„å¯†é’¥å¯¹ï¼Œå¹¶å‘ Letâ€™s Encrypt CA è¯æ˜æœåŠ¡å™¨æ§åˆ¶ç€ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸåã€‚ è¿™ç±»ä¼¼äºåˆ›å»ºå¸æˆ·å’Œå‘è¯¥å¸æˆ·æ·»åŠ åŸŸåçš„ä¼ ç»Ÿè¯ä¹¦é¢å‘æµç¨‹ã€‚</p><h2 id="ACMEå®¢æˆ·ç«¯"><a href="#ACMEå®¢æˆ·ç«¯" class="headerlink" title="ACMEå®¢æˆ·ç«¯"></a>ACMEå®¢æˆ·ç«¯</h2><p>Letâ€™s Encrypt ä½¿ç”¨ ACME åè®®æ¥éªŒè¯æ‚¨å¯¹ç»™å®šåŸŸåçš„æ§åˆ¶æƒå¹¶å‘æ‚¨é¢å‘è¯ä¹¦ã€‚ è¦è·å¾— Letâ€™s Encrypt è¯ä¹¦ï¼Œæ‚¨éœ€è¦é€‰æ‹©ä¸€ä¸ªè¦ä½¿ç”¨çš„ ACME å®¢æˆ·ç«¯è½¯ä»¶ã€‚</p><p>æˆ‘ä»¬å»ºè®®å¤§å¤šæ•°äººä» <a href="https://certbot.eff.org/">Certbot</a> å®¢æˆ·ç«¯å¼€å§‹ã€‚ å®ƒæ—¢å¯ä»¥åªä¸ºæ‚¨è·å–è¯ä¹¦ï¼Œä¹Ÿå¯ä»¥å¸®åŠ©æ‚¨è·å–å¹¶å®‰è£…è¯ä¹¦ã€‚ å®ƒæ˜“äºä½¿ç”¨ï¼Œé€‚ç”¨äºè®¸å¤šæ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”å…·æœ‰å‡ºè‰²çš„æ–‡æ¡£ã€‚</p><h1 id="Certbotç®€ä»‹"><a href="#Certbotç®€ä»‹" class="headerlink" title="Certbotç®€ä»‹"></a>Certbotç®€ä»‹</h1><p>Cerbotæ˜¯å…è´¹å¼€æºçš„å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨Letâ€™s Encryptä½¿ç½‘ç«™å¼€å¯HTTPS</p><h1 id="ACME-sh"><a href="#ACME-sh" class="headerlink" title="ACME.sh"></a>ACME.sh</h1><p><strong>acme.sh</strong>å®ç°äº†<code>acme</code>åè®®ï¼Œå¯ä»¥ä»letsencryptç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚</p><h1 id="åŸºäºACME-shä¸DNSPODå®ç°è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦"><a href="#åŸºäºACME-shä¸DNSPODå®ç°è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦" class="headerlink" title="åŸºäºACME.shä¸DNSPODå®ç°è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦"></a>åŸºäºACME.shä¸DNSPODå®ç°è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦</h1><blockquote><p>acme.shç›®å‰æ”¯æŒcloudflare, dnspod, cloudxns, godaddy ä»¥åŠ ovh ç­‰è§£æå•†ï¼Œå‚è€ƒ<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">https://github.com/acmesh-official/acme.sh/wiki/dnsapi</a></p><p>ä¸‹æ–‡ä»¥DNSPODä¸ºä¾‹</p></blockquote><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="è·å–DNSPODçš„idä¸key"><a href="#è·å–DNSPODçš„idä¸key" class="headerlink" title="è·å–DNSPODçš„idä¸key"></a>è·å–DNSPODçš„idä¸key</h3><ol><li><p>ç™»é™†DNSpod</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221003151659511.png"></p></li><li><p>ç‚¹å‡»APIå¯†é’¥</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221003151747649.png"></p><ol start="3"><li><p>ç‚¹å‡»Dnspod tokenï¼Œåˆ›å»ºå¯†é’¥</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221003151917001.png"></p></li><li><p>æŒ‰è¦æ±‚éªŒè¯åè¾“å…¥åç§°ï¼Œä¿å­˜IDä¸Token</p></li></ol><p>è‡³æ­¤è·å¾—Dnspodçš„token</p></li></ol><h3 id="å®‰è£…acme-shï¼ˆä»…åœ¨ä¸»æœºéƒ¨ç½²æ—¶ä½¿ç”¨ï¼‰"><a href="#å®‰è£…acme-shï¼ˆä»…åœ¨ä¸»æœºéƒ¨ç½²æ—¶ä½¿ç”¨ï¼‰" class="headerlink" title="å®‰è£…acme.shï¼ˆä»…åœ¨ä¸»æœºéƒ¨ç½²æ—¶ä½¿ç”¨ï¼‰"></a>å®‰è£…acme.shï¼ˆä»…åœ¨ä¸»æœºéƒ¨ç½²æ—¶ä½¿ç”¨ï¼‰</h3><p>å‚è€ƒacme.shæ–‡æ¡£<a href="https://github.com/acmesh-official/acme.sh/wiki/How-to-install%E5%8F%AF%E4%BB%A5%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC">https://github.com/acmesh-official/acme.sh/wiki/How-to-installå¯ä»¥æ‰‹åŠ¨å®‰è£…è„šæœ¬</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./acme.sh --install  \</span><br><span class="line">--home ~/myacme \</span><br><span class="line">--config-home ~/myacme/data \</span><br><span class="line">--cert-home  ~/mycerts \</span><br><span class="line">--accountemail  <span class="string">&quot;my@example.com&quot;</span> \</span><br><span class="line">--accountkey  ~/myaccount.key \</span><br><span class="line">--accountconf ~/myaccount.conf \</span><br><span class="line">--useragent  <span class="string">&quot;this is my client.&quot;</span></span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>--home</code>å‚æ•°æ˜¯è‡ªå®šä¹‰çš„å®‰è£…è·¯å¾„ï¼Œé»˜è®¤ï¼š<code>~/.acme.sh</code></li><li><code>--config-home</code>æ˜¯å†™å…¥é…ç½®çš„æ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬è¯ä¹¦ã€é…ç½®ç­‰å…¨éƒ¨æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯<code>--home</code></li><li><code>--cert-home</code>æ˜¯è‡ªå®šä¹‰çš„è·¯å¾„ä¿å­˜ç”³è¯·çš„è¯ä¹¦ï¼Œé»˜è®¤åœ¨<code>--config-home</code>ä¸­</li><li><code>--accountemail</code>æ˜¯ç”¨æ¥å‘Letâ€™s Encryptç”³è¯·è¯ä¹¦æ—¶æ‰€ç”¨çš„é‚®ç®±ï¼Œå°†åœ¨è¿™é‡Œæ”¶åˆ°æ›´æ–°æé†’</li><li><code>--accountkey</code>æ˜¯ç”¨æ¥å­˜å‚¨ç”¨æˆ·ç§é’¥çš„æ–‡ä»¶ï¼Œé»˜è®¤ä¿å­˜åœ¨<code>--config-home</code>ä¸­</li><li><code>--user-agent</code>æ˜¯å‘é€è‡³Letâ€™s Encryptçš„<code>user-agent</code>å¤´éƒ¨çš„å€¼</li><li><code>--nocron</code>è¡¨ç¤ºä¸è¿›è¡Œè‡ªåŠ¨è°ƒåº¦</li></ul><h3 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h3><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œè¿™é‡Œä½¿ç”¨äº†dnspodçš„apiï¼Œæ›´å¤šapié…ç½®è¯·å‚è€ƒ<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">https://github.com/acmesh-official/acme.sh/wiki/dnsapi</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DP_Id=<span class="string">&quot;1234&quot;</span></span><br><span class="line"><span class="built_in">export</span> DP_Key=<span class="string">&quot;sADDsdasdgdsf&quot;</span></span><br><span class="line"></span><br><span class="line">~/.acme.sh/acme.sh --issue --dns dns_dp -d *.example.com</span><br></pre></td></tr></table></figure><p><code>DP_ID</code>å’Œ<code>DP_Key</code>ä¼šè¢«ä¿å­˜åœ¨<code>~/.acme.sh/account.conf</code></p><h2 id="å®‰è£…è¯ä¹¦"><a href="#å®‰è£…è¯ä¹¦" class="headerlink" title="å®‰è£…è¯ä¹¦"></a>å®‰è£…è¯ä¹¦</h2><p>acme.shä¸å»ºè®®ç›´æ¥å°†nginx&#x2F;apacheçš„é…ç½®è·¯å¾„æŒ‡å®šä¸ºacme.shè¯ä¹¦å®‰è£…çš„è·¯å¾„</p><blockquote><p> æ³¨æ„, é»˜è®¤ç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨å®‰è£…ç›®å½•ä¸‹: <code>~/.acme.sh/</code>, è¯·ä¸è¦ç›´æ¥ä½¿ç”¨æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶, ä¾‹å¦‚: ä¸è¦ç›´æ¥è®© nginx&#x2F;apache çš„é…ç½®æ–‡ä»¶ä½¿ç”¨è¿™ä¸‹é¢çš„æ–‡ä»¶. è¿™é‡Œé¢çš„æ–‡ä»¶éƒ½æ˜¯å†…éƒ¨ä½¿ç”¨, è€Œä¸”ç›®å½•ç»“æ„å¯èƒ½ä¼šå˜åŒ–.</p></blockquote><h3 id="Case1-ä¸»æœºå·²æœ‰Nginx"><a href="#Case1-ä¸»æœºå·²æœ‰Nginx" class="headerlink" title="Case1: ä¸»æœºå·²æœ‰Nginx"></a>Case1: ä¸»æœºå·²æœ‰Nginx</h3><p>å·²æœ‰Nginxæ—¶å¯ç›´æ¥ä½¿ç”¨acme.shè„šæœ¬å¯¹è¯ä¹¦è¿›è¡Œå®‰è£…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/.acme.sh/acme.sh --install-cert -d example.com \</span><br><span class="line">--key-file       /path/to/keyfile/in/nginx/key.pem  \</span><br><span class="line">--fullchain-file /path/to/fullchain/nginx/cert.pem \</span><br><span class="line">--reloadcmd     <span class="string">&quot;service nginx force-reload&quot;</span></span><br></pre></td></tr></table></figure><p>(ä¸€ä¸ªå°æé†’, è¿™é‡Œç”¨çš„æ˜¯ <code>service nginx force-reload</code>, ä¸æ˜¯ <code>service nginx reload</code>, æ®æµ‹è¯•, <code>reload</code> å¹¶ä¸ä¼šé‡æ–°åŠ è½½è¯ä¹¦, æ‰€ä»¥ç”¨çš„ <code>force-reload</code>)</p><p>Nginx çš„é…ç½® <code>ssl_certificate</code> ä½¿ç”¨ <code>/etc/nginx/ssl/fullchain.cer</code> ï¼Œè€Œé <code>/etc/nginx/ssl/&lt;domain&gt;.cer</code> ï¼Œå¦åˆ™ <a href="https://www.ssllabs.com/ssltest/">SSL Labs</a> çš„æµ‹è¯•ä¼šæŠ¥ <code>Chain issues Incomplete</code> é”™è¯¯ã€‚</p><p><code>--install-cert</code>å‘½ä»¤å¯ä»¥æºå¸¦å¾ˆå¤šå‚æ•°, æ¥æŒ‡å®šç›®æ ‡æ–‡ä»¶. å¹¶ä¸”å¯ä»¥æŒ‡å®š reloadcmd, å½“è¯ä¹¦æ›´æ–°ä»¥å, reloadcmdä¼šè¢«è‡ªåŠ¨è°ƒç”¨,è®©æœåŠ¡å™¨ç”Ÿæ•ˆ.</p><p>è¯¦ç»†å‚æ•°è¯·å‚è€ƒ: <a href="https://github.com/Neilpang/acme.sh#3-install-the-issued-cert-to-apachenginx-etc">https://github.com/Neilpang/acme.sh#3-install-the-issued-cert-to-apachenginx-etc</a></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯, è¿™é‡ŒæŒ‡å®šçš„æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«è‡ªåŠ¨è®°å½•ä¸‹æ¥, å¹¶åœ¨å°†æ¥è¯ä¹¦è‡ªåŠ¨æ›´æ–°ä»¥å, è¢«å†æ¬¡è‡ªåŠ¨è°ƒç”¨.</p><h3 id="Case2-ä¸»æœºæ²¡æœ‰Nginxï¼Œä»…ç”¨äºç”Ÿæˆè¯ä¹¦ï¼Œæ‰‹åŠ¨å¤åˆ¶è‡³å…¶ä»–ä½ç½®"><a href="#Case2-ä¸»æœºæ²¡æœ‰Nginxï¼Œä»…ç”¨äºç”Ÿæˆè¯ä¹¦ï¼Œæ‰‹åŠ¨å¤åˆ¶è‡³å…¶ä»–ä½ç½®" class="headerlink" title="Case2: ä¸»æœºæ²¡æœ‰Nginxï¼Œä»…ç”¨äºç”Ÿæˆè¯ä¹¦ï¼Œæ‰‹åŠ¨å¤åˆ¶è‡³å…¶ä»–ä½ç½®"></a>Case2: ä¸»æœºæ²¡æœ‰Nginxï¼Œä»…ç”¨äºç”Ÿæˆè¯ä¹¦ï¼Œæ‰‹åŠ¨å¤åˆ¶è‡³å…¶ä»–ä½ç½®</h3><p>è¿™é‡Œä½¿ç”¨dockeræ¥å®ç°è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦è‡³æŒ‡å®šè·¯å¾„ï¼Œéœ€è¦å°†dockerçš„ç”Ÿæˆè·¯å¾„æš´éœ²å‡ºæ¥ã€‚</p><p>acme.shæœ¬èº«ä¹Ÿæä¾›äº†dockeræ–¹å¼ï¼Œacme.shæä¾›çš„dockeræ–¹å¼åº”è¯¥èƒ½å¤„ç†å¤§å¤šæ•°åœºæ™¯<a href="https://github.com/acmesh-official/acme.sh/wiki/Run-acme.sh-in-docker">https://github.com/acmesh-official/acme.sh/wiki/Run-acme.sh-in-docker</a></p><p>è¿™é‡Œä¸»è¦å®ç°çš„æ˜¯é€šè¿‡dockerè·å–è¯ä¹¦ï¼Œç„¶åå°†è¯ä¹¦è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­</p><p>Dockerfileç›¸å…³æ–‡ä»¶å‚è€ƒï¼š<a href="https://github.com/HalfCoke/open_action/tree/main/docker/acme.sh">https://github.com/HalfCoke/open_action/tree/main/docker/acme.sh</a></p><p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨<code>docker pull halfcoke/acme.sh</code>è¿™ä¸ªé•œåƒï¼š<a href="https://hub.docker.com/repository/docker/halfcoke/acme.sh">https://hub.docker.com/repository/docker/halfcoke/acme.sh</a></p><p>é•œåƒçš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-e EMAIL=abc@example.com \</span><br><span class="line">-e DOMAINS=<span class="string">&quot;a.example.com,b.example.com,*.c.example.com&quot;</span> \</span><br><span class="line">-e API=<span class="string">&quot;DNSPOD;dpid,dpkey&quot;</span> \</span><br><span class="line">-v /path/to/ssl:/ssl</span><br><span class="line">halfcoke/acme.sh</span><br></pre></td></tr></table></figure><p>ç›®å‰ä»…æ”¯æŒDNSPOD apiï¼Œåé¢ä¼šé€æ¸å¢åŠ ï¼Œæˆ–è€…è‡ªè¡Œæ”¹é€ ä¹Ÿæ¯”è¾ƒå®¹æ˜“ã€‚</p><p>å‘nginxä¸­é…ç½®è¯ä¹¦ï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªæ–‡ä»¶å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20221006173103336.png"></p><h3 id="Case3-todo"><a href="#Case3-todo" class="headerlink" title="Case3: todo"></a>Case3: todo</h3><p>é€æ¸å®Œå–„å…¶ä»–åœºæ™¯â€¦..</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol><li>Letâ€™s Encrypt å®˜ç½‘ï¼š<a href="https://letsencrypt.org/zh-cn/how-it-works/">https://letsencrypt.org/zh-cn/how-it-works/</a></li><li>Cerbotå®˜ç½‘ï¼š<a href="https://certbot.eff.org/">https://certbot.eff.org/</a></li><li>ACME.shï¼š<a href="https://github.com/acmesh-official/acme.sh">https://github.com/acmesh-official/acme.sh</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> ç³»ç»Ÿå·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Linux </tag>
            
            <tag> å·¥å…· </tag>
            
            <tag> è¯ä¹¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åˆ©ç”¨iptablesç®¡ç†dockerå¼€æ”¾çš„ç«¯å£ï¼Ÿ</title>
      <link href="/2022/27bb66e8/"/>
      <url>/2022/27bb66e8/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•åˆ©ç”¨iptablesç®¡ç†dockerå¼€æ”¾çš„ç«¯å£ï¼Ÿ"><a href="#å¦‚ä½•åˆ©ç”¨iptablesç®¡ç†dockerå¼€æ”¾çš„ç«¯å£ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ©ç”¨iptablesç®¡ç†dockerå¼€æ”¾çš„ç«¯å£ï¼Ÿ"></a>å¦‚ä½•åˆ©ç”¨iptablesç®¡ç†dockerå¼€æ”¾çš„ç«¯å£ï¼Ÿ</h1><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h3><p>æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ubuntu20.04.3ï¼Œå…¨æ–°å®‰è£…çš„ç¯å¢ƒ</p><h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><p>ubuntu20ä½¿ç”¨çš„ufwï¼Œå…ˆæŠŠè¿™ä¸ªåœæ­¢ï¼Œè¿™æ¬¡æµ‹è¯•ä¸»è¦ä½¿ç”¨iptables-serviceså’Œdockerï¼Œå…³é—­å…¶ä½™é˜²ç«å¢™çš„å½±å“</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20220918145446619.png"></p><h4 id="å®‰è£…iptables"><a href="#å®‰è£…iptables" class="headerlink" title="å®‰è£…iptables"></a>å®‰è£…iptables</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤å·²ç»å®‰è£…</span></span><br><span class="line">apt install iptables</span><br><span class="line"><span class="comment"># centoséœ€è¦å®‰è£…iptables-services</span></span><br><span class="line">yum install iptables-services</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹é…ç½®iptables"><a href="#åˆå§‹é…ç½®iptables" class="headerlink" title="åˆå§‹é…ç½®iptables"></a>åˆå§‹é…ç½®iptables</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå­˜æ”¾é…ç½®æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> /etc/sysconfig</span><br><span class="line"><span class="comment"># åˆ›å»ºiptablesé…ç½®æ–‡ä»¶</span></span><br><span class="line">vi /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆé¡ºåºæœ‰å…³ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨filterè¡¨</span><br><span class="line">*filter</span><br><span class="line"># ä¸‹é¢ä¸‰æ¡å†…å®¹å®šä¹‰äº†å†…å»ºçš„INPUTã€FORWAARDã€ACCEPTé“¾</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line"># å…è®¸æœ¬åœ°è®¿é—®</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line"># ä¸‹é¢è¿™æ¡ä¸é…ç½®ä¹Ÿå¯ä»¥ï¼Œå› ä¸ºä¸é™åˆ¶æ•°æ®åŒ…æµå‡º</span><br><span class="line">-A OUTPUT -o lo -j ACCEPT</span><br><span class="line"># ç¦æ­¢icmpæ¢æµ‹</span><br><span class="line">-A INPUT -p icmp -j REJECT</span><br><span class="line"># -m state --state ESTABLISHED,RELATEDè¿™ä¸ªæ¡ä»¶è¡¨ç¤ºæ‰€æœ‰å¤„äºESTABLISHEDæˆ–è€…RELATEDçŠ¶æ€çš„åŒ…ï¼Œç­–ç•¥éƒ½æ˜¯æ¥å—çš„ã€‚</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line"># -m state --state NEW è¿™ä¸ªæ¡ä»¶æ˜¯å½“connectionçš„çŠ¶æ€ä¸ºåˆå§‹è¿æ¥(NEW)æ—¶å€™çš„ç­–ç•¥ã€‚</span><br><span class="line"># 22ç«¯å£æ˜¯é»˜è®¤sshç«¯å£ï¼Œä¸å¼€å¯å®¹æ˜“æ— æ³•è¿æ¥</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m multiport --dports 22,80 -j ACCEPT</span><br><span class="line"></span><br><span class="line"># ç¦æ­¢å…¶ä»–è®¿é—®</span><br><span class="line">-A INPUT -j DROP</span><br><span class="line">-A FORWARD -j DROP</span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure><h3 id="dockerå®‰è£…"><a href="#dockerå®‰è£…" class="headerlink" title="dockerå®‰è£…"></a>dockerå®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">apt update &amp;&amp; \</span><br><span class="line">apt install -y \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release &amp;&amp; \</span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/apt/keyrings &amp;&amp; \</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg &amp;&amp; \</span><br><span class="line">apt update &amp;&amp; \</span><br><span class="line">apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 &amp;&amp; \</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo &amp;&amp; \</span><br><span class="line">yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®é•œåƒæºï¼Œå¹¶å¯åŠ¨docker</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/docker &amp;&amp; <span class="built_in">touch</span> /etc/docker/daemon.json &amp;&amp; \</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;registry-mirrors&quot;:[&quot;https://hub-mirror.c.163.com&quot;]&#x27;</span> &gt; /etc/docker/daemon.json &amp;&amp; \</span><br><span class="line">systemctl <span class="built_in">enable</span> docker &amp;&amp; systemctl start docker</span><br></pre></td></tr></table></figure><h2 id="é˜²ç«å¢™ä¸dockeré…ç½®"><a href="#é˜²ç«å¢™ä¸dockeré…ç½®" class="headerlink" title="é˜²ç«å¢™ä¸dockeré…ç½®"></a>é˜²ç«å¢™ä¸dockeré…ç½®</h2><p>ä½¿ç”¨iptables-save å¯¼å‡ºå½“å‰é˜²ç«å¢™é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables-save &gt; iptables.save</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 08:16:29 2022</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [39:4940]</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [1:40]</span><br><span class="line">:POSTROUTING ACCEPT [1:40]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 08:16:29 2022</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 08:16:29 2022</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [122:19744]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -j REJECT --reject-with icmp-port-unreachable</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m multiport --dports 22,80 -j ACCEPT</span><br><span class="line">-A INPUT -j DROP</span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -j DROP</span><br><span class="line">-A OUTPUT -o lo -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 08:16:29 2022</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°dockeråœ¨filterè¡¨ä¸­æ–°å¢äº†å‡ ä¸ªé“¾</p><h3 id="ä½¿ç”¨dockerå¯åŠ¨nginx"><a href="#ä½¿ç”¨dockerå¯åŠ¨nginx" class="headerlink" title="ä½¿ç”¨dockerå¯åŠ¨nginx"></a>ä½¿ç”¨dockerå¯åŠ¨nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 nginx</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æœåŠ¡å¯ä»¥ç›´æ¥è®¿é—®</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20220918162025557.png"></p><p>æ­¤æ—¶é˜²ç«å¢™çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 08:23:51 2022</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [25:2945]</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line">:POSTROUTING ACCEPT [1:64]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™æ¡ä¸ºæ–°å¢#############################################################################</span></span><br><span class="line">-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 80 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™æ¡ä¸ºæ–°å¢#############################################################################</span></span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8080 -j DNAT --to-destination 172.17.0.2:80</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 08:23:51 2022</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 08:23:51 2022</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [36:6464]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -j REJECT --reject-with icmp-port-unreachable</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m multiport --dports 22,80 -j ACCEPT</span><br><span class="line">-A INPUT -j DROP</span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -j DROP</span><br><span class="line">-A OUTPUT -o lo -j ACCEPT</span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™æ¡ä¸ºæ–°å¢#############################################################################</span></span><br><span class="line">-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 08:23:51 2022</span></span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™é…ç½®"><a href="#é˜²ç«å¢™é…ç½®" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><p>å¦‚æœæ˜¯åœ¨æœ¬æœºä¸Šçš„nginxï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œæ§åˆ¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT 4 -p tcp -m tcp --dport 8080 -j DROP</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç°åœ¨å‘ç°ï¼Œä½¿ç”¨dockerå¯åŠ¨çš„æœåŠ¡æ— æ³•è¿™ä¹ˆè°ƒæ•´äº†</p><p>å¦‚æœè¦å¯¹dockerä¸­çš„æœåŠ¡è¿›è¡Œé™åˆ¶ï¼Œéœ€è¦åœ¨dockerç›¸å…³çš„é“¾ä¸­è¿›è¡Œæ“ä½œ</p><h4 id="æ•°æ®åŒ…æµè½¬è·Ÿè¸ª"><a href="#æ•°æ®åŒ…æµè½¬è·Ÿè¸ª" class="headerlink" title="æ•°æ®åŒ…æµè½¬è·Ÿè¸ª"></a>æ•°æ®åŒ…æµè½¬è·Ÿè¸ª</h4><p>ä½¿ç”¨dockerå¯åŠ¨äº†ä¸¤ä¸ªnginxï¼Œåˆ†åˆ«æ˜ å°„å®¿ä¸»æœºçš„8080ç«¯å£å’Œ8081ç«¯å£ï¼Œä¸‹é¢æ˜¯é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 08:45:59 2022</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [5:636]</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line">:POSTROUTING ACCEPT [1:64]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 80 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 80 -j LOG --log-prefix <span class="string">&quot;iptables-postrouting: &quot;</span></span><br><span class="line">-A POSTROUTING -s 172.17.0.3/32 -d 172.17.0.3/32 -p tcp -m tcp --dport 80 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8080 -j DNAT --to-destination 172.17.0.2:80</span><br><span class="line"></span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8081 -j LOG --log-prefix <span class="string">&quot;iptables-docker: &quot;</span></span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8081 -j DNAT --to-destination 172.17.0.3:80</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 08:45:59 2022</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 08:45:59 2022</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [59:6764]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -j REJECT --reject-with icmp-port-unreachable</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m tcp --dport 8080 -j DROP</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m multiport --dports 22,80 -j ACCEPT</span><br><span class="line">-A INPUT -j DROP</span><br><span class="line">-A FORWARD -j LOG --log-prefix <span class="string">&quot;iptables-forward: &quot;</span></span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -j DROP</span><br><span class="line">-A OUTPUT -o lo -j ACCEPT</span><br><span class="line">-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">-A DOCKER -d 172.17.0.3/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j LOG --log-prefix <span class="string">&quot;iptables-filter-docker: &quot;</span></span><br><span class="line">-A DOCKER -d 172.17.0.3/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j LOG --log-prefix <span class="string">&quot;iptables-docker-user: &quot;</span></span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 08:45:59 2022</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯è®¿é—®8081ç«¯å£ï¼Œiptablesçš„å®Œæ•´æ—¥å¿—</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20220918173848238.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Sep 18 09:33:28 server kernel: [ 9650.758973] iptables-docker: IN=ens33 OUT= MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=192.168.6.110 LEN=64 TOS=0x00 PREC=0x00 TTL=64 ID=0 DF PROTO=TCP SPT=56563 DPT=8081 WINDOW=65535 RES=0x00 SYN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.759027] iptables-forward: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=64 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=65535 RES=0x00 SYN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.759031] iptables-docker-user: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=64 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=65535 RES=0x00 SYN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.759036] iptables-filter-docker: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=64 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=65535 RES=0x00 SYN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.759082] iptables-forward: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=60 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=65160 RES=0x00 ACK SYN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.759084] iptables-docker-user: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=60 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=65160 RES=0x00 ACK SYN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.766202] iptables-forward: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2058 RES=0x00 ACK URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.766233] iptables-docker-user: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2058 RES=0x00 ACK URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.766920] iptables-forward: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=157 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2058 RES=0x00 ACK PSH URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.766943] iptables-docker-user: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=157 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2058 RES=0x00 ACK PSH URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.766983] iptables-forward: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=46071 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.766986] iptables-docker-user: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=46071 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.767108] iptables-forward: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=290 TOS=0x00 PREC=0x00 TTL=63 ID=46072 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK PSH URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.767111] iptables-docker-user: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=290 TOS=0x00 PREC=0x00 TTL=63 ID=46072 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK PSH URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.767237] iptables-forward: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=667 TOS=0x00 PREC=0x00 TTL=63 ID=46073 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK PSH URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.767239] iptables-docker-user: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=667 TOS=0x00 PREC=0x00 TTL=63 ID=46073 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK PSH URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.773906] iptables-forward: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2045 RES=0x00 ACK URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.773959] iptables-docker-user: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2045 RES=0x00 ACK URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.774877] iptables-forward: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2048 RES=0x00 ACK FIN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.774926] iptables-docker-user: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2048 RES=0x00 ACK FIN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.775065] iptables-forward: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=46074 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK FIN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.775069] iptables-docker-user: IN=docker0 OUT=ens33 PHYSIN=vethd96fc82 MAC=02:42:46:22:17:a8:02:42:ac:11:00:03:08:00 SRC=172.17.0.3 DST=192.168.6.150 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=46074 DF PROTO=TCP SPT=80 DPT=56563 WINDOW=509 RES=0x00 ACK FIN URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.780061] iptables-forward: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2048 RES=0x00 ACK URGP=0 </span><br><span class="line">Sep 18 09:33:28 server kernel: [ 9650.780108] iptables-docker-user: IN=ens33 OUT=docker0 MAC=00:0c:29:1c:8e:65:b0:be:83:49:90:a2:08:00 SRC=192.168.6.150 DST=172.17.0.3 LEN=52 TOS=0x00 PREC=0x00 TTL=63 ID=0 DF PROTO=TCP SPT=56563 DPT=80 WINDOW=2048 RES=0x00 ACK URGP=0</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20220918215811639-20220918220032983.png"></p><p>å› ä¸ºæºipä¸€ç›´ä¸ä¼šå˜åŒ–ï¼Œæ‰€ä»¥å¦‚æœè¦é™å®šæºipè®¿é—®ï¼Œç›´æ¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><p>è¿™ä¹Ÿæ˜¯å®˜æ–¹å»ºè®®çš„æ–¹å¼ï¼Œç¼–è¾‘DOCKER-USERé“¾</p><p><a href="https://docs.docker.com/network/iptables/">https://docs.docker.com/network/iptables/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¦æ­¢é™¤192.168.6.1 ä»¥å¤–çš„ä¸»æœºè®¿é—®dockerä¸Šçš„æœåŠ¡</span></span><br><span class="line">iptables -I DOCKER-USER ! -s 192.168.6.1 -j DROP</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœæˆ‘åªæƒ³ç¦æ­¢å¤–éƒ¨çš„ç«¯å£è®¿é—®ï¼Œåˆ™éœ€è¦æ“ä½œnatè¡¨ï¼Œåœ¨è¿›è¡Œåœ°å€è½¬æ¢å‰å°±è¿›è¡Œæ‹¦æˆª</p><p>åªè¦è®¿é—®ä¸»æœºdockerå¯åŠ¨çš„çš„8081ç«¯å£ï¼Œå°±ä¼šè¢«æ‹¦æˆª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¦æ­¢è®¿é—®8081ç«¯å£</span></span><br><span class="line">iptables -t nat -I DOCKER 1 -p tcp -m tcp --dport 8081 -j RETURN</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 14:08:01 2022</span></span><br><span class="line">*mangle</span><br><span class="line">:PREROUTING ACCEPT [4907:504306]</span><br><span class="line">:INPUT ACCEPT [4826:493232]</span><br><span class="line">:FORWARD ACCEPT [81:11074]</span><br><span class="line">:OUTPUT ACCEPT [2198:463332]</span><br><span class="line">:POSTROUTING ACCEPT [2279:474406]</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 14:08:01 2022</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 14:08:01 2022</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [1376:178830]</span><br><span class="line">:INPUT ACCEPT [2:264]</span><br><span class="line">:OUTPUT ACCEPT [3:216]</span><br><span class="line">:POSTROUTING ACCEPT [5:344]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 80 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.3/32 -d 172.17.0.3/32 -p tcp -m tcp --dport 80 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">-A DOCKER -p tcp -m tcp --dport 8081 -j RETURN</span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8080 -j DNAT --to-destination 172.17.0.2:80</span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8081 -j DNAT --to-destination 172.17.0.3:80</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 14:08:01 2022</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.8.4 on Sun Sep 18 14:08:01 2022</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [32:3760]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -j REJECT --reject-with icmp-port-unreachable</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m multiport --dports 22 -j ACCEPT</span><br><span class="line">-A INPUT -j DROP</span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -j DROP</span><br><span class="line">-A OUTPUT -o lo -j ACCEPT</span><br><span class="line">-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">-A DOCKER -d 172.17.0.3/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Sun Sep 18 14:08:01 2022</span></span><br></pre></td></tr></table></figure><h3 id="é¢å¤–"><a href="#é¢å¤–" class="headerlink" title="é¢å¤–"></a>é¢å¤–</h3><p>å¯¹äºdockeræœåŠ¡ï¼Œå¦‚æœå¯¹å¤–æ˜ å°„çš„ç«¯å£ä¸å®¹å™¨å†…éƒ¨ç«¯å£ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œé™åˆ¶ç™½åå•ipè®¿é—®æŒ‡å®šç«¯å£ï¼Œå¯ä»¥å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªèƒ½ä½¿ç”¨192.168.6.1è®¿é—®6379ç«¯å£ï¼Œå…¶ä½™ipå’Œç«¯å£å‡ä¸å¯ä»¥ï¼Œè¿™æ—¶6379ç«¯å£æ˜¯å®¹å™¨ç«¯å£</span></span><br><span class="line">iptables -I DOCKER-USER ! -s 192.168.6.1 ! -p tcp ! --dport 6379 -j DROP</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦é™åˆ¶å¤–éƒ¨èƒ½å¤Ÿè®¿é—®çš„dockeræœåŠ¡ï¼Œå³ä»…å¼€æ”¾æŒ‡å®šç«¯å£çš„æœåŠ¡ï¼ˆå®¿ä¸»æœºç«¯å£ï¼‰ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®</p><p>å¦‚æœåœ¨å®¿ä¸»æœºä¸Šå¯åŠ¨nginxï¼Œç›‘å¬8081ç«¯å£ï¼Œè¿™ç§æ–¹å¼ä¸ä¼šé˜»æ­¢è®¿é—®ï¼Œä¼šæ ¹æ®filterè¡¨çš„INPUTè§„åˆ™è¿›è¡Œåˆ¤æ–­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¦æ­¢è®¿é—®8081ç«¯å£</span></span><br><span class="line">iptables -t nat -I DOCKER 1 -p tcp -m tcp --dport 8081 -j RETURN</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹å¼ï¼Œé‡å¯dockeråå°±ä¼šæ¶ˆå¤±ï¼Œå¯¹DOCKERçš„ç¼–è¾‘æ— æ³•ä¿å­˜ï¼Œå¯¹DOCKER-USERçš„ç¼–è¾‘å¯ä»¥ä¿å­˜</p><p>ä¸è¿‡æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨natè¡¨çš„PREROUTINGé“¾å¢åŠ è§„åˆ™ï¼Œé‡å¯åå¯ä»¥ä¿å­˜ï¼Œä¹Ÿèƒ½è¾¾åˆ°æˆ‘ä»¬è¦çš„ç›®çš„</p><p>è¿™ç§æ–¹å¼éœ€è¦é…åˆINPUTé“¾ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿INPUTé“¾ä¸­ä¹Ÿç¦æ­¢è®¿é—®8081ç«¯å£æ‰ä¼šç”Ÿæ•ˆ</p><p>å¦‚æœINPUTä¸­å…è®¸8081ç«¯å£æ˜¯ACCEPTï¼Œæ•°æ®åŒ…ä¹Ÿä¼šæ­£å¸¸åˆ°è¾¾ï¼Œåªä¸è¿‡æ­¤æ—¶è™½ç„¶åŒ…ä¸­çš„åŸIPè¿˜æ˜¯å®¢æˆ·ç«¯IPï¼Œä½†åœ¨nginxä¸­çœ‹åˆ°çš„è®¿é—®ipæ˜¯docker0è¿™ä¸ªæ¥å£çš„ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¦æ­¢è®¿é—®8081ç«¯å£</span></span><br><span class="line">iptables -t nat -I PREROUTING -p tcp -m tcp --dport 8081 -j RETURN</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼ŒæŒ‰è¿™ä¸ªæ€è·¯ï¼Œå¦‚æœè¦å…è®¸ä»…192.168.6.0ç½‘æ®µå¯ä»¥è®¿é—®5000ç«¯å£ï¼ˆå®¹å™¨å†…å¤–ç«¯å£ç›¸åŒï¼‰ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§é…ç½®æ–¹å¼ï¼š</p><ol><li><p>ä½¿ç”¨docker-useré“¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I DOCKER-USER ! -s 192.168.6.0/24 -p tcp -m tcp --dport 5000 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨natè¡¨preroutingé“¾ï¼Œæ­¤æ—¶éœ€è¦ç¡®ä¿filterè¡¨çš„inputé“¾ç¦æ­¢è®¿é—®5000ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -I PREROUTING -p tcp -m tpc --dport 5000 -j RETURN</span><br></pre></td></tr></table></figure></li></ol><p>å¦‚æœå®¹å™¨å†…å¤–æ˜ å°„çš„ç«¯å£ä¸åŒï¼Œåˆ™ä½¿ç”¨natè¡¨çš„preroutingé“¾å®ç°ï¼Œå¯ä»¥æŒä¹…åŒ–ã€‚</p><p>æˆ–è€…ä½¿ç”¨natè¡¨çš„DOCKERé“¾å®ç°ï¼Œä¸èƒ½æŒä¹…åŒ–ï¼Œdockeré‡å¯åè§„åˆ™ä¼šæ¶ˆå¤±</p><h2 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h2><ul><li>é‡æ–°æ•´ç†æ–‡æ¡£é€»è¾‘</li><li>docker swarmæ¨¡å¼ä¸‹ï¼Œå¯¹ç«¯å£æˆ–ipçš„é™åˆ¶</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://www.cnblogs.com/ggjucheng/archive/2012/08/19/2646466.html">https://www.cnblogs.com/ggjucheng/archive/2012/08/19/2646466.html</a> â€“ iptablesç®€ä»‹</li><li><a href="https://blog.csdn.net/wsclinux/article/details/53256494">https://blog.csdn.net/wsclinux/article/details/53256494</a> â€“ returnè¯­å¥</li><li><a href="https://blog.csdn.net/stonesharp/article/details/26495667">https://blog.csdn.net/stonesharp/article/details/26495667</a> â€“è¡¨çš„ä¼˜å…ˆçº§</li><li><a href="https://blog.csdn.net/beeworkshop/article/details/114278379">https://blog.csdn.net/beeworkshop/article/details/114278379</a> â€“æ—¥å¿—é…ç½®(ubuntu20 åœ¨&#x2F;etc&#x2F;sysctl.dä¸‹æ–°å»ºæ–‡ä»¶ï¼Œä½¿ç”¨systemctl restart syslogä½¿é…ç½®ç”Ÿæ•ˆ)</li><li><a href="https://docs.docker.com/network/iptables/">https://docs.docker.com/network/iptables/</a> â€“dockerå®˜ç½‘è¯´æ˜</li><li><a href="https://www.jianshu.com/p/586da7c8fd42">https://www.jianshu.com/p/586da7c8fd42</a> â€“iptableså¸¸ç”¨å‚æ•°</li></ol>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MacOS M1 Python ä½¿ç”¨Oracleæ•°æ®åº“ï½œå®‰è£…Oracle å®¢æˆ·ç«¯ï½œå®‰è£…cx_oracleåŒ…</title>
      <link href="/2022/88b111d7/"/>
      <url>/2022/88b111d7/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…rosetta2ï¼ˆå¯é€‰ï¼‰"><a href="#å®‰è£…rosetta2ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="å®‰è£…rosetta2ï¼ˆå¯é€‰ï¼‰"></a>å®‰è£…rosetta2ï¼ˆå¯é€‰ï¼‰</h2><p>è¿™æ˜¯ä¸€ä¸ªå°†x86ç¨‹åºç¿»è¯‘è‡³m1çš„è½¯ä»¶</p><p>ç›´æ¥å®‰è£…å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/softwareupdate --install-rosetta</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…x86-64-brewï¼ˆå¯é€‰ï¼‰"><a href="#å®‰è£…x86-64-brewï¼ˆå¯é€‰ï¼‰" class="headerlink" title="å®‰è£…x86_64 brewï¼ˆå¯é€‰ï¼‰"></a>å®‰è£…x86_64 brewï¼ˆå¯é€‰ï¼‰</h2><blockquote><p>ä¸ºäº†å®‰è£…å…¶ä»–x86æ¶æ„çš„è½¯ä»¶æ–¹ä¾¿ï¼Œæ­¤æ¬¡ä¸å®‰è£…ä¹Ÿå¯ä»¥</p></blockquote><h3 id="ARMç‰ˆbrewå®‰è£…"><a href="#ARMç‰ˆbrewå®‰è£…" class="headerlink" title="ARMç‰ˆbrewå®‰è£…"></a>ARMç‰ˆbrewå®‰è£…</h3><ul><li><p>è®¿é—®å®˜ç½‘ï¼š<a href="https://brew.sh/index_zh-cn">https://brew.sh/index_zh-cn</a></p></li><li><p>ä½¿ç”¨å‘½ä»¤å®‰è£…å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;</span><br></pre></td></tr></table></figure></li></ul><h3 id="X86ç‰ˆæœ¬-brew"><a href="#X86ç‰ˆæœ¬-brew" class="headerlink" title="X86ç‰ˆæœ¬ brew"></a>X86ç‰ˆæœ¬ brew</h3><p>åœ¨å‘½ä»¤å‰å¢åŠ <code>arch -x86_64</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch -x86_64 /bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;</span><br></pre></td></tr></table></figure><h3 id="å¤šç‰ˆæœ¬å…±å­˜"><a href="#å¤šç‰ˆæœ¬å…±å­˜" class="headerlink" title="å¤šç‰ˆæœ¬å…±å­˜"></a>å¤šç‰ˆæœ¬å…±å­˜</h3><p>åœ¨ <code>~/.zprofile</code>æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> abrew=<span class="string">&#x27;arch -arm64 /opt/homebrew/bin/brew&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> ibrew=<span class="string">&#x27;arch -x86_64 /usr/local/bin/brew&#x27;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>abrew</code>å’Œ<code>ibrew</code>è¿™ä¸¤ä¸ªåå­—å¯å˜ï¼Œè¿™æ ·ä¸€ä¸ªæ˜¯è¿è¡Œarmç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯è¿è¡Œx86ç‰ˆæœ¬</p><p>æ‰§è¡Œ<code>source ~/.zprofile</code>åœ¨å½“å‰ç»ˆç«¯ä¸­ç”Ÿæ•ˆ</p><h2 id="å®‰è£…x86-64-Anaconda"><a href="#å®‰è£…x86-64-Anaconda" class="headerlink" title="å®‰è£…x86_64 Anaconda"></a>å®‰è£…x86_64 Anaconda</h2><p>å¤šç‰ˆæœ¬çš„anacondaå…±å­˜<strong>åˆæ­¥å°è¯•</strong>åä¼šæœ‰é—®é¢˜ï¼Œå¦‚æœä¹‹å‰å®‰è£…è¿‡armç‰ˆæœ¬çš„anacondaï¼Œå¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œæœ€å¥½å¸è½½ï¼Œç›´æ¥å®‰è£…x86ç‰ˆæœ¬ã€‚</p><p><strong>å¦‚æœä¹‹å‰é…ç½®è¿‡å¤æ‚çš„pythonç¯å¢ƒï¼Œè°¨æ…æ“ä½œ</strong></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul><li><p>è®¿é—®å®˜ç½‘ï¼š<a href="https://www.anaconda.com/">https://www.anaconda.com/</a></p></li><li><p>ä¸‹è½½x86ç‰ˆæœ¬çš„å®‰è£…æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -o https://repo.anaconda.com/archive/Anaconda3-2022.05-MacOSX-x86_64.sh</span><br></pre></td></tr></table></figure></li><li><p>ç›´æ¥å®‰è£…ï¼Œå®‰è£…å¼€å§‹çš„æ—¶å€™ä¼šæœ‰æé†’å®‰è£…çš„æ˜¯x86ç‰ˆæœ¬ï¼Œç›´æ¥ç¡®è®¤å³å¯</p></li></ul><h3 id="åˆ›å»ºpythonç¯å¢ƒ"><a href="#åˆ›å»ºpythonç¯å¢ƒ" class="headerlink" title="åˆ›å»ºpythonç¯å¢ƒ"></a>åˆ›å»ºpythonç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n py37_x86 python=3.7</span><br></pre></td></tr></table></figure><p>armç‰ˆæœ¬èƒ½å¤Ÿå®‰è£…çš„pythonç‰ˆæœ¬æœ€ä½æ˜¯3.8</p><p>åªè¦èƒ½åˆ›å»º3.7çš„ç¯å¢ƒå°±è¯´æ˜å®‰è£…åº”è¯¥æ²¡é—®é¢˜</p><h2 id="å®‰è£…cx-oracleåŠoracle-client"><a href="#å®‰è£…cx-oracleåŠoracle-client" class="headerlink" title="å®‰è£…cx_oracleåŠoracle client"></a>å®‰è£…cx_oracleåŠoracle client</h2><h3 id="å®‰è£…cx-oracle"><a href="#å®‰è£…cx-oracle" class="headerlink" title="å®‰è£…cx_oracle"></a>å®‰è£…cx_oracle</h3><ul><li><p>æ¿€æ´»pythonç¯å¢ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate py37_x86</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨pipå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install cx_oracle</span><br></pre></td></tr></table></figure></li></ul><p>å®‰è£…åæ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦ä¸‹è½½oracleå®˜ç½‘ä¸Šçš„ä¸€äº›å®‰è£…åŒ…</p><h3 id="å®‰è£…oracle-client"><a href="#å®‰è£…oracle-client" class="headerlink" title="å®‰è£…oracle client"></a>å®‰è£…oracle client</h3><ul><li><p>è®¿é—®ä¸‹è½½é¡µï¼š<a href="https://www.oracle.com/database/technologies/instant-client/macos-intel-x86-downloads.html">https://www.oracle.com/database/technologies/instant-client/macos-intel-x86-downloads.html</a></p></li><li><p>ä¸‹è½½Basic Package (ZIP)ã€SQL*Plus Package (ZIP)ã€SDK Package (ZIP)ä¸‰ä¸ªåŒ…</p></li><li><p>å°†è¿™ä¸‰ä¸ªåŒ…è§£å‹è‡³ç›¸åŒè·¯å¾„ï¼Œè§£å‹å®Œæˆåå°±æ˜¯è¿™äº›æ–‡ä»¶</p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20220910112749749.png" alt="image-20220910112749749" style="zoom: 33%;" /></li><li><p>é…ç½®ç¯å¢ƒå˜é‡ï¼Œç¼–è¾‘<code>~/.zprofile</code>ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹è‡ªå·±çš„è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/Users/halfcoke/oracle_client/instantclient_19_8:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=/Users/halfcoke/oracle_client/instantclient_19_8</span><br><span class="line"><span class="built_in">export</span> DYLD_LIBRARY_PATH=/Users/halfcoke/oracle_client/instantclient_19_8</span><br><span class="line"><span class="built_in">export</span> OCI_LIB_DIR=/Users/halfcoke/oracle_client/instantclient_19_8</span><br><span class="line"><span class="built_in">export</span> OCI_INC_DIR=/Users/halfcoke/oracle_client/instantclient_19_8/sdk/include</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨è¿™ä¹‹åå°±å¯ä»¥åœ¨pythonä¸­å¯¼å…¥cx_oracleä½¿ç”¨äº†ï¼Œé¦–æ¬¡è¿è¡Œä¼šå¼¹å‡ºâ€œmacOS æ— æ³•éªŒè¯æ­¤appâ€çš„é—®é¢˜</p><p>æ‰“å¼€<strong>ç³»ç»Ÿåå¥½è®¾ç½®&gt;å®‰å…¨æ€§ä¸éšç§&gt;é€šç”¨</strong>ï¼Œè¿™æ—¶å€™ä¼šæœ‰â€œä»ç„¶å…è®¸â€çš„æŒ‰é’®ï¼Œç‚¹å‡»å³å¯ï¼Œåº”è¯¥ä¼šæœ‰å¤šä¸ªï¼Œå¤šç‚¹å‡ æ¬¡å°±å¯ä»¥äº†ï¼Œä¸‹æ¬¡è¿è¡Œä¸ä¼šå†å‡ºç°äº†ã€‚</p><p>å›¾ç‰‡æ˜¯åœ¨ç½‘ä¸Šæ‰¾çš„å›¾ï¼Œåº”ç”¨åç§°å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œç”¨ä½œç¤ºæ„ã€‚</p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21oc3N6bQ==,size_16,color_FFFFFF,t_70.jpeg" alt="img" style="zoom:33%;" /><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://developers.ascendcorp.com/how-to-install-oracle-instant-client-on-apple-silicon-m1-24b67f2dc743">https://developers.ascendcorp.com/how-to-install-oracle-instant-client-on-apple-silicon-m1-24b67f2dc743</a></li><li><a href="https://zhuanlan.zhihu.com/p/341831809">https://zhuanlan.zhihu.com/p/341831809</a></li><li><a href="https://www.macjb.com/article/229012.html">https://www.macjb.com/article/229012.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¯å¢ƒéƒ¨ç½² </category>
          
          <category> mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¯å¢ƒéƒ¨ç½² </tag>
            
            <tag> mac </tag>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESXié•œåƒè‡ªå®šä¹‰(é›†æˆç½‘å¡é©±åŠ¨)åŠç¡¬ç›˜åˆ†åŒº</title>
      <link href="/2021/ef096570/"/>
      <url>/2021/ef096570/</url>
      
        <content type="html"><![CDATA[<h1 id="ESXié•œåƒè‡ªå®šä¹‰-é›†æˆç½‘å¡é©±åŠ¨-åŠç¡¬ç›˜åˆ†åŒº"><a href="#ESXié•œåƒè‡ªå®šä¹‰-é›†æˆç½‘å¡é©±åŠ¨-åŠç¡¬ç›˜åˆ†åŒº" class="headerlink" title="ESXié•œåƒè‡ªå®šä¹‰(é›†æˆç½‘å¡é©±åŠ¨)åŠç¡¬ç›˜åˆ†åŒº"></a>ESXié•œåƒè‡ªå®šä¹‰(é›†æˆç½‘å¡é©±åŠ¨)åŠç¡¬ç›˜åˆ†åŒº</h1><p>å®‰è£…ESXiè‡³ç‰©ç†æœºæ—¶ï¼Œéœ€è¦æå‰æŸ¥çœ‹ç¡¬ä»¶å…¼å®¹åˆ—è¡¨ï¼Œæ­¤æ¬¡å®‰è£…æ—¶å‘ç°ESXiåŸç”Ÿæ²¡æœ‰RTL-r8168ç½‘å¡é©±åŠ¨ï¼Œéœ€è¦å°†ç½‘å¡é©±åŠ¨æ‰“åŒ…è‡³ESXié•œåƒä¸­ã€‚</p><p>ç›®å‰(2021-11-20)å°è¯•è¿‡åï¼ŒESXi7.0æš‚æ— æ³•ä½¿ç”¨è¯¥ç½‘å¡(r8168)</p><h2 id="ESXié•œåƒè‡ªå®šä¹‰"><a href="#ESXié•œåƒè‡ªå®šä¹‰" class="headerlink" title="ESXié•œåƒè‡ªå®šä¹‰"></a>ESXié•œåƒè‡ªå®šä¹‰</h2><p>ESXié•œåƒè‡ªå®šä¹‰æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ä½¿ç”¨Powershellè„šæœ¬å®‰è£…ï¼Œå¦ä¸€ç§æ˜¯è‡ªå·±ä½¿ç”¨å‘½ä»¤æ‰“åŒ…é•œåƒã€‚</p><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><h4 id="PowerCLIå®‰è£…"><a href="#PowerCLIå®‰è£…" class="headerlink" title="PowerCLIå®‰è£…"></a>PowerCLIå®‰è£…</h4><p>å½“å‰ç‰ˆæœ¬VMware Power CLIå®‰è£…è¾ƒä¸ºå®¹æ˜“ï¼Œå®˜ç½‘é“¾æ¥ï¼š<a href="https://developer.vmware.com/powercli">https://developer.vmware.com/powercli</a></p><p><strong>step1ï¼š</strong> ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershell</p><p><strong>step2ï¼š</strong>ç²˜è´´<code>Install-Module -Name VMware.PowerCLI</code>ç„¶åå›è½¦</p><h4 id="ESXiå®˜æ–¹é•œåƒæ–‡ä»¶å‡†å¤‡ï¼ˆè„šæœ¬å®‰è£…æ—¶å¯é€‰ï¼‰"><a href="#ESXiå®˜æ–¹é•œåƒæ–‡ä»¶å‡†å¤‡ï¼ˆè„šæœ¬å®‰è£…æ—¶å¯é€‰ï¼‰" class="headerlink" title="ESXiå®˜æ–¹é•œåƒæ–‡ä»¶å‡†å¤‡ï¼ˆè„šæœ¬å®‰è£…æ—¶å¯é€‰ï¼‰"></a>ESXiå®˜æ–¹é•œåƒæ–‡ä»¶å‡†å¤‡ï¼ˆè„šæœ¬å®‰è£…æ—¶å¯é€‰ï¼‰</h4><p>è‡ªå®šä¹‰ESXié•œåƒæ—¶ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨isoæ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨<strong>Offline Bundle</strong>æ–‡ä»¶ï¼Œç‚¹å‡»<a href="https://customerconnect.vmware.com/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7">å®˜æ–¹ä¸‹è½½é“¾æ¥</a>ï¼Œæˆ–è€…è®¿é—®æˆ‘çš„<a href="https://github.com/HalfCoke/custom-vmware-exsi/raw/main/esxi/ESXi670-201912001.zip">ä¸‹è½½é“¾æ¥</a></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117820.png"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117696.png"></p><h4 id="ç½‘å¡é©±åŠ¨å‡†å¤‡-ä»¥r8168ä¸ºä¾‹"><a href="#ç½‘å¡é©±åŠ¨å‡†å¤‡-ä»¥r8168ä¸ºä¾‹" class="headerlink" title="ç½‘å¡é©±åŠ¨å‡†å¤‡(ä»¥r8168ä¸ºä¾‹)"></a>ç½‘å¡é©±åŠ¨å‡†å¤‡(ä»¥r8168ä¸ºä¾‹)</h4><p><a href="https://vibsdepot.v-front.de/wiki/index.php/Net55-r8168">ä¸‹è½½</a>ç½‘å¡é©±åŠ¨ï¼Œvibæ ¼å¼åœ¨ä½¿ç”¨è„šæœ¬æ‰“åŒ…çš„æ—¶å€™ä¼šç”¨åˆ°ï¼ŒOffline Bundleæ ¼å¼åœ¨ä½¿ç”¨å‘½ä»¤è¡Œæ‰“åŒ…æ—¶ä¼šç”¨åˆ°</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117630.png"></p><p>åœ¨å½“å‰è·¯å¾„æ–°å»ºæ–‡ä»¶å¤¹<code>drivers</code>ï¼Œå°†vibæ ¼å¼çš„ç½‘å¡é©±åŠ¨ç§»åŠ¨è¿›æ–‡ä»¶å¤¹</p><p>è‡³æ­¤ï¼Œç¯å¢ƒå‡†å¤‡å·¥ä½œå®Œæˆ</p><h3 id="è‡ªå®šä¹‰é•œåƒæ‰“åŒ…"><a href="#è‡ªå®šä¹‰é•œåƒæ‰“åŒ…" class="headerlink" title="è‡ªå®šä¹‰é•œåƒæ‰“åŒ…"></a>è‡ªå®šä¹‰é•œåƒæ‰“åŒ…</h3><h4 id="ä½¿ç”¨è„šæœ¬æ–¹å¼æ‰“åŒ…"><a href="#ä½¿ç”¨è„šæœ¬æ–¹å¼æ‰“åŒ…" class="headerlink" title="ä½¿ç”¨è„šæœ¬æ–¹å¼æ‰“åŒ…"></a>ä½¿ç”¨è„šæœ¬æ–¹å¼æ‰“åŒ…</h4><ol><li><p>çº¯ç¦»çº¿æ–¹å¼ï¼ˆæ¨èï¼‰</p><p> <strong>Step1ï¼š</strong> åœ¨<code>https://github.com/VFrontDe/ESXi-Customizer-PS</code>ä¸‹è½½æœ€æ–°çš„releaseç‰ˆæœ¬çš„è„šæœ¬(ps1æ–‡ä»¶å°±æ˜¯powershellè„šæœ¬)ï¼Œå¹¶å°†è„šæœ¬æ”¾å…¥ESXié•œåƒæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</p><p> <strong>Step2ï¼š</strong>è¿è¡Œè„šæœ¬</p> <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\ESXi<span class="literal">-Customizer-PS</span>.ps1 <span class="literal">-izip</span> ESXi670<span class="literal">-201912001</span>.zip <span class="literal">-pkgDir</span> .\drivers\</span><br></pre></td></tr></table></figure></li><li><p>åœ¨çº¿æ–¹å¼</p><p><strong>Step1ï¼š</strong> åœ¨<code>https://github.com/VFrontDe/ESXi-Customizer-PS</code>ä¸‹è½½æœ€æ–°çš„releaseç‰ˆæœ¬çš„è„šæœ¬(ps1æ–‡ä»¶å°±æ˜¯powershellè„šæœ¬)</p><p><strong>Step2ï¼š</strong>ç›´æ¥è¿è¡Œ<code>.\ESXi-Customizer-PS.ps1 -v67 -vft -load net55-r8168</code></p><p>è¿™ç§æ–¹å¼ç†è®ºä¸Šåº”è¯¥æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å®é™…æ‰§è¡Œæ—¶æ€»ä¼šå‡ºç°é”™è¯¯ï¼Œä½¿ç”¨ç¬¬ä¸€ç§ç¦»çº¿æ–¹å¼æ‰“åŒ…æˆåŠŸäº†</p></li></ol><h4 id="å‘½ä»¤è¡Œè‡ªè¡Œæ‰“åŒ…"><a href="#å‘½ä»¤è¡Œè‡ªè¡Œæ‰“åŒ…" class="headerlink" title="å‘½ä»¤è¡Œè‡ªè¡Œæ‰“åŒ…"></a>å‘½ä»¤è¡Œè‡ªè¡Œæ‰“åŒ…</h4><p><strong>Step1ï¼š</strong>å°†ä¹‹å‰ä¸‹è½½çš„zipæ–‡ä»¶æ·»åŠ åˆ°å·¥ä½œç©ºé—´ä¸­ï¼Œæ‰§è¡Œ<code>add-esxsoftwaredepot .\ESXi670-201912001.zip</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117070.png"></p><p><strong>Step2ï¼š</strong>æ£€æŸ¥å½“å‰çš„<code>Acceptance Level</code>ï¼Œæ‰§è¡Œ<code>get-esximageprofile</code>ï¼Œæ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹<code>Acceptance Level</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117003.png"></p><p><strong>Step3ï¼š</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">new-esximageprofile</span> <span class="literal">-cloneprofile</span> <span class="string">&quot;ESXi-6.7.0-20191204001-standard&quot;</span> <span class="literal">-name</span> <span class="string">&quot;ESXi-6.7.0-custom&quot;</span> <span class="literal">-vendor</span> <span class="string">&quot;VMware-cus&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117892.png"></p><p><strong>Step4ï¼š</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set-esximageprofile</span> <span class="literal">-ImageProfile</span> <span class="string">&quot;ESXi-6.7.0-custom&quot;</span> <span class="literal">-acceptancelevel</span> <span class="string">&quot;CommunitySupported&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117762.png" alt="image-20211121193658977"></p><p><strong>Step4ï¼š</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add-esxsoftwaredepot</span> net55<span class="literal">-r8168-8</span>.<span class="number">045</span>a<span class="literal">-napi-offline_bundle</span>.zip</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310117785.png"></p><p><strong>Step5ï¼š</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add-esxsoftwarepackage</span> <span class="literal">-ImageProfile</span> <span class="string">&quot;ESXi-6.7.0-custom&quot;</span> <span class="literal">-SoftwarePackage</span> <span class="string">&quot;net55-r8168&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310118007.png"></p><p><strong>Step6ï¼š</strong>æ£€æŸ¥æ˜¯å¦åŠ å…¥æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(get-esximageprofile ESXi-6.7.0-custom).viblist</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310118647.png"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310118228.png"></p><p><strong>Step7ï¼š</strong>å¯¼å‡ºæ–‡ä»¶</p><ul><li>ZIP (Bundle)ï¼š</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export-esximageprofile</span> <span class="literal">-imageprofile</span> ESXi<span class="literal">-6</span>.<span class="number">7.0</span><span class="literal">-custom</span> <span class="literal">-exporttobundle</span>  <span class="literal">-filepath</span> .\ESXi<span class="literal">-6</span>.<span class="number">7.0</span><span class="literal">-custom</span>.zip  <span class="literal">-nosignaturecheck</span>  <span class="literal">-Force</span></span><br></pre></td></tr></table></figure><ul><li>ISO (Installable)ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export-esximageprofile -imageprofile ESXi-6.7.0-custom -exporttoiso  -filepath .\ESXi-6.7.0-custom.iso  -nosignaturecheck  -Force</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310118913.png"></p><h2 id="å¾—åˆ°ISOæ–‡ä»¶ä¹‹å"><a href="#å¾—åˆ°ISOæ–‡ä»¶ä¹‹å" class="headerlink" title="å¾—åˆ°ISOæ–‡ä»¶ä¹‹å"></a>å¾—åˆ°ISOæ–‡ä»¶ä¹‹å</h2><p>æ‹¿åˆ°isoæ–‡ä»¶åå°±å¯ä»¥åƒæ­£å¸¸è£…ç³»ç»Ÿä¸€æ ·å†™å…¥åˆ°uç›˜ä¸­å»å®‰è£…äº†</p><p>å®‰è£…æ•™ç¨‹æœ‰å¾ˆå¤šï¼Œéšä¾¿æœæœå°±è¡Œäº†</p><h2 id="ç¡¬ç›˜åˆ†åŒºåŠæ•°æ®å­˜å‚¨"><a href="#ç¡¬ç›˜åˆ†åŒºåŠæ•°æ®å­˜å‚¨" class="headerlink" title="ç¡¬ç›˜åˆ†åŒºåŠæ•°æ®å­˜å‚¨"></a>ç¡¬ç›˜åˆ†åŒºåŠæ•°æ®å­˜å‚¨</h2><p>ä¸€èˆ¬é€šè¿‡webé¡µé¢å³å¯åˆ›å»ºï¼Œä½†æœ‰æ—¶ä¹Ÿéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ¥è§£å†³é—®é¢˜ï¼Œæ‰‹åŠ¨åˆ†åŒºåŠåˆ›å»ºå­˜å‚¨æ–¹å¼å¦‚ä¸‹</p><h3 id="ç¡¬ç›˜åˆ†åŒº"><a href="#ç¡¬ç›˜åˆ†åŒº" class="headerlink" title="ç¡¬ç›˜åˆ†åŒº"></a>ç¡¬ç›˜åˆ†åŒº</h3><p>åœ¨ESXiä¸­è¿›è¡Œåˆ†åŒºéœ€è¦ä½¿ç”¨<code>partedUtil</code>å·¥å…·</p><ul><li><p>æŸ¥çœ‹ç¡¬ç›˜åˆ—è¡¨ï¼Œä¸Šé¢æ¡†èµ·æ¥çš„å°±æ˜¯å®é™…çš„ç¡¬ç›˜ä»¥åŠåˆ†åŒºï¼Œåé¢æœ‰æ•°å­—çš„è¡¨ç¤ºåˆ†åŒºï¼Œæ²¡æœ‰æ•°å­—çš„è¡¨ç¤ºç¡¬ç›˜æœ¬èº«</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /vmfs/devices/disks/</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310118644.png"></p></li><li><p>æŸ¥çœ‹åˆ†åŒºè¡¨</p><p>æŸ¥çœ‹ç¡¬ç›˜<code>t10.ATA_____Lenovo_X800_SATA_256G_SSD_______________8S16010501X03403263_</code>å®ä¾‹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">partedUtil getptbl <span class="string">&quot;/vmfs/devices/disks/t10.ATA_____Lenovo_X800_SATA_256G_SSD_______________8S16010501X03403263_&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/image-20211121195405778.png" alt="image-20211121195405778"></p><p>ç¬¬ä¸€è¡Œæ˜¯åˆ†åŒºæ ¼å¼gpt</p><p>ç¬¬äºŒè¡Œæ˜¯ç¡¬ç›˜çš„æ€»ä½“ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310118376.png"></p><p>ç¬¬ä¸‰è¡Œä¹‹åæ˜¯åˆ†åŒºä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310118009.png"></p></li><li><p>åˆ›å»ºåˆ†åŒº</p><p>åœ¨åˆ›å»ºåˆ†åŒºæ—¶è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»å®Œæ•´çš„è¾“å…¥åˆ†åŒºè¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">partedUtil setptbl <span class="string">&quot;/vmfs/devices/disks/t10.ATA_____Lenovo_X800_SATA_256G_SSD_______________8S16010501X03403263_&quot;</span> gpt <span class="string">&quot;1 64 8191 C12A7328F81F11D2BA4B00A0C93EC93B 128&quot;</span> <span class="string">&quot;5 8224 520191 EBD0A0A2B9E5443387C068B6B72699C7  0&quot;</span> <span class="string">&quot;6 520224 1032191 EBD0A0A2B9E5443387C068B6B72699C7  0&quot;</span> <span class="string">&quot;7 1032224 1257471 9D27538040AD11DBBF97000C2911D1B8  0&quot;</span> <span class="string">&quot;8 1257504 1843199 EBD0A0A2B9E5443387C068B6B72699C7  0&quot;</span> <span class="string">&quot;9 1843200 7086079 9D27538040AD11DBBF97000C2911D1B8  0&quot;</span> <span class="string">&quot;2 7086080 15472639 EBD0A0A2B9E5443387C068B6B72699C7  0&quot;</span> <span class="string">&quot;3 15472640 500118158 AA31E02A400F11DB9590000C2911D1B8  0&quot;</span></span><br></pre></td></tr></table></figure><p>ESXi&#x2F;ESX å¸¸ç”¨çš„åˆ†åŒºç±»å‹åŒ…æ‹¬ï¼š</p><table><thead><tr><th><strong>åˆ†åŒº</strong></th><th><strong>GUID</strong></th><th><strong>ç±»å‹ï¼ˆåå…­è¿›åˆ¶ï¼‰</strong></th><th><strong>ç±»å‹ï¼ˆåè¿›åˆ¶ï¼‰</strong></th></tr></thead><tbody><tr><td>VMFS æ•°æ®å­˜å‚¨</td><td>AA31E02A400F11DB9590000C2911D1B8</td><td>0xFB</td><td>251</td></tr><tr><td>VMKCore è¯Šæ–­</td><td>9D27538040AD11DBBF97000C2911D1B8</td><td>0xFC</td><td>252</td></tr><tr><td>VMware é¢„ç•™</td><td>9198EFFC31C011DB8F78000C2911D1B8</td><td></td><td></td></tr><tr><td>åŸºæœ¬æ•°æ®</td><td>EBD0A0A2B9E5443387C068B6B72699C7</td><td>0x83</td><td>131</td></tr><tr><td>Linux Swap</td><td>0657FD6DA4AB43C484E50933C84B4F4F</td><td>0x82</td><td>130</td></tr><tr><td>Linux LVM</td><td>E6D6D379F50744C2A23C238F2A3DF928</td><td>0x8E</td><td>142</td></tr><tr><td>Linux RAID</td><td>A19D880F05FC4D3BA006743F0F84911E</td><td>0xFD</td><td>253</td></tr><tr><td>EFi ç³»ç»Ÿ</td><td>C12A7328F81F11D2BA4B00A0C93EC93B</td><td>0xEF</td><td>239</td></tr><tr><td>Microsoft é¢„ç•™</td><td>E3C9E3160B5C4DB8817DF92DF00215AE</td><td></td><td></td></tr><tr><td>æœªä½¿ç”¨æ¡ç›®</td><td>00000000000000000000000000000000</td><td></td><td></td></tr></tbody></table></li></ul><h3 id="åˆ›å»ºæ•°æ®å­˜å‚¨"><a href="#åˆ›å»ºæ•°æ®å­˜å‚¨" class="headerlink" title="åˆ›å»ºæ•°æ®å­˜å‚¨"></a>åˆ›å»ºæ•°æ®å­˜å‚¨</h3><p>åˆ›å»ºæ•°æ®å­˜å‚¨éœ€è¦ä½¿ç”¨<code> vmkfstools</code>å‘½ä»¤</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmkfstools -C vmfs6 -S NewDatastore /vmfs/devices/disks/t10.ATA_____Lenovo_X800_SATA_256G_SSD_______________8S16010501X03403263_:3</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨webé¡µé¢çœ‹åˆ°ç›¸å…³çš„å­˜å‚¨ä¿¡æ¯äº†</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1 VMware Front Experienceï¼š<a href="https://www.v-front.de/">https://www.v-front.de/</a></p><p>2 Download VMware vSphereï¼š<a href="https://customerconnect.vmware.com/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7">https://customerconnect.vmware.com/downloads/info/slug/datacenter_cloud_infrastructure&#x2F;vmware_vsphere&#x2F;6_7</a></p><p>3 ä½¿ç”¨è„šæœ¬æ·»åŠ ç½‘å¡é©±åŠ¨ï¼š<a href="http://woshub.com/add-drivers-vmware-esxi-iso-image/">http://woshub.com/add-drivers-vmware-esxi-iso-image/</a></p><p>4 ä½¿ç”¨å‘½ä»¤è¡Œæ‰“åŒ…é•œåƒï¼š<a href="https://communities.vmware.com/t5/ESXi-Discussions/Pink-Screen-ESXi-6-5-Failed-Install-Unable-to-Verify-Acceptance/m-p/504351#M42504">https://communities.vmware.com/t5/ESXi-Discussions/Pink-Screen-ESXi-6-5-Failed-Install-Unable-to-Verify-Acceptance/m-p/504351#M42504</a></p><p>5 ESXiç¡¬ç›˜åˆ†åŒºï¼š<a href="https://kb.vmware.com/s/article/1036609?lang=zh_CN">https://kb.vmware.com/s/article/1036609?lang=zh_CN</a></p><p>6 ESXiåˆ›å»ºæ•°æ®å­˜å‚¨ï¼š<a href="https://kb.vmware.com/s/article/1009829?lang=zh_CN">https://kb.vmware.com/s/article/1009829?lang=zh_CN</a></p>]]></content>
      
      
      <categories>
          
          <category> è™šæ‹ŸåŒ–æŠ€æœ¯ </category>
          
          <category> ESXi </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è™šæ‹ŸåŒ– </tag>
            
            <tag> ESXi </tag>
            
            <tag> VMware </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Dockeræ­å»ºNextcloudä¸ªäººå·¥ä½œä¸­å¿ƒ</title>
      <link href="/2021/b6c7e144/"/>
      <url>/2021/b6c7e144/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨Dockeræ­å»ºNextcloudä¸ªäººå·¥ä½œä¸­å¿ƒ-åŒæ­¥ç›˜-ç¦»çº¿ä¸‹è½½-ã€‚ã€‚ã€‚-å®Œæ•´ç‰ˆ"><a href="#ä½¿ç”¨Dockeræ­å»ºNextcloudä¸ªäººå·¥ä½œä¸­å¿ƒ-åŒæ­¥ç›˜-ç¦»çº¿ä¸‹è½½-ã€‚ã€‚ã€‚-å®Œæ•´ç‰ˆ" class="headerlink" title="ä½¿ç”¨Dockeræ­å»ºNextcloudä¸ªäººå·¥ä½œä¸­å¿ƒ(åŒæ­¥ç›˜+ç¦»çº¿ä¸‹è½½+ã€‚ã€‚ã€‚)(å®Œæ•´ç‰ˆ)"></a>ä½¿ç”¨Dockeræ­å»ºNextcloudä¸ªäººå·¥ä½œä¸­å¿ƒ(åŒæ­¥ç›˜+ç¦»çº¿ä¸‹è½½+ã€‚ã€‚ã€‚)(å®Œæ•´ç‰ˆ)</h1><p>è¿™çœŸæ˜¯ï¼Œè¿„ä»Šä¸ºæ­¢æœ€ä¸ºæŠ˜è…¾çš„ä¸€ä¸ªéƒ¨ç½²å·¥ä½œäº†ï¼Œå·¥ä½œçš„èµ·å› æ˜¯è‡ªå·±çš„onedriveæ•™è‚²ç‰ˆåˆæŒ‚äº†ã€‚ã€‚ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯ï¼Œåˆ°åº•æœ‰æ²¡æœ‰ä½¿ç”¨ç½‘ç›˜çš„éœ€æ±‚ï¼Œå¦‚æœä½ ç»å¸¸å…±äº«æ–‡ä»¶ï¼Œæˆ–è€…éœ€è¦å¤‡ä»½è‡ªå·±çš„èµ„æ–™ï¼Œæˆ–è€…ä½ æœ‰å¤šä¸ªç»ˆç«¯ï¼Œæˆ–è€…ä½ éœ€è¦ç§»åŠ¨åŠå…¬ã€‚ã€‚ã€‚ç­‰ç­‰</p><p>å¦‚æœä½ ç¡®å®æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œæˆ–è€…ä½ æ­£åœ¨ä½¿ç”¨å¸‚é¢ä¸Šçš„ç½‘ç›˜ï¼Œè‡ªå·±å†å–œæ¬¢åŠ¨åŠ¨æ‰‹ï¼Œæˆ–è€…éœ€è¦ä¿å­˜ä¸€äº›å°ç§˜å¯†ï¼Œé‚£ä¹ˆç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><h3 id="é€‰å‹"><a href="#é€‰å‹" class="headerlink" title="é€‰å‹"></a>é€‰å‹</h3><p>ç½‘ç›˜åˆåˆ†ä¸ºå¤‡ä»½ç›˜å’ŒåŒæ­¥ç›˜ã€‚é¡¾åæ€ä¹‰ï¼Œå¤‡ä»½ç›˜ä¸»è¦æ˜¯ç”¨æ¥å­˜å‚¨æ–‡ä»¶ï¼Œæ¯”å¦‚ç™¾åº¦ç½‘ç›˜(é™¤å·¥ä½œç©ºé—´åŠŸèƒ½)ã€é˜¿é‡Œäº‘ç›˜ã€å¾®äº‘ã€å¤©ç¿¼äº‘ç›˜ã€115ç½‘ç›˜ç­‰ç­‰ï¼Œéƒ½ç®—æ˜¯å¤‡ä»½ç›˜ï¼Œæˆ–è€…å¤§å®¶ä¸»è¦ä½¿ç”¨çš„åŠŸèƒ½éƒ½æ˜¯å¤‡ä»½ç›˜çš„åŠŸèƒ½ã€‚è€ŒåŒæ­¥ç›˜åˆ™ä¸»è¦æœ‰åšæœäº‘ã€Onedriveç­‰(å›½å¤–çš„äº†è§£çš„ä¸å¤š)ï¼Œå…¶ä¸­ç™¾åº¦ç½‘ç›˜ã€å¤©ç¿¼äº‘ç›˜ã€å¾®äº‘ï¼Œä¹Ÿéƒ½æœ‰åŒæ­¥ç›˜çš„åŠŸèƒ½ã€‚</p><p>æˆ‘ä¹‹å‰ä¸€ç›´ç”¨çš„æ˜¯Onedriveï¼ŒæœŸé—´å°è¯•è¿‡ä¸Šè¿°çš„å„ç§ç›˜ï¼Œä½†æ˜¯æ•ˆæœå‡ä¸å°½äººæ„ï¼Œç®—æ˜¯å„æœ‰å„çš„ç¼ºç‚¹å§ã€‚æˆ‘çš„åœºæ™¯ä¸»è¦æ˜¯ç”¨æ¥åŒæ­¥å…¨ç›˜çš„æ•°æ®ï¼Œè¿™æ ·åšæœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å¦‚æœæˆ‘é‡åšç³»ç»Ÿï¼Œæˆ–è€…æ¢è®¾å¤‡äº†ï¼Œä¸ç”¨æ¥å›å€’æ•°æ®ï¼Œè€Œä¸”åŒæ­¥ç›˜ä¸€èˆ¬ä¹Ÿéƒ½æ”¯æŒæ–‡ä»¶ç‰ˆæœ¬çš„åŠŸèƒ½ï¼Œå†™wordæ–‡æ¡£æˆ–è€…ç”»å›¾çš„æ—¶å€™ï¼Œå¦‚æœå¿˜è®°ä¿å­˜å‰¯æœ¬å°±æ˜¯ä¸ªå¾ˆéš¾åŠçš„äº‹æƒ…ï¼Œæ€»ä¸èƒ½æ‰€æœ‰çš„å†…å®¹éƒ½ç”¨gitç®¡ç†ï¼Œä¹Ÿä¸æ–¹ä¾¿ï¼Œè¿™ä¸ªæ—¶å€™åŒæ­¥ç›˜çš„ä¼˜åŠ¿å°±å‡ºæ¥äº†ã€‚è¿™æ ·çš„åœºæ™¯ä¹Ÿå¯¼è‡´äº†ï¼Œæˆ‘è¿™é‡Œä¼šæœ‰å¤§é‡çš„å°æ–‡ä»¶å’Œéƒ¨åˆ†å¤§æ–‡ä»¶ï¼Œå°æ–‡ä»¶çš„æ•°é‡å¯èƒ½æœ‰å‡ åä¸‡(åŒ…å«ç€ä¸€äº›å¼€æºé¡¹ç›®çš„æºç )ã€‚æ‰€ä»¥æˆ‘è¿™ä¸ªåœºæ™¯å¯¹åŒæ­¥ç›˜çš„é€‰æ‹©å°±å¾ˆè‹›åˆ»ã€‚</p><p>ä¸‹é¢åˆ—ä¸€ä¸‹æˆ‘ç”¨è¿‡è¿™äº›ç›˜ä¹‹åçš„æ„Ÿå—ã€‚</p><p>åšæœäº‘ï¼šåŒæ­¥åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œé€Ÿåº¦ä¹Ÿå¿«ï¼Œä½†æ˜¯å®¹é‡å¤ªå°ï¼ŒèŠ±é’±ä¹°ä¹Ÿä¸å¤šã€‚</p><p>ç™¾åº¦ç½‘ç›˜ã€å¾®äº‘ã€å¤©ç¿¼äº‘ç›˜ï¼Œå®¢æˆ·ç«¯çš„æ ¡éªŒé€Ÿåº¦å’Œç¨³å®šæ€§å‡ä¸å¦‚Onedriveï¼ŒåŠ¨ä¸åŠ¨å°±æœ‰å†²çªã€‚</p><p>Onedriveæœ¬èº«åŠŸèƒ½æ²¡å•¥æ¯›ç—…ï¼Œä½†æ˜¯ç½‘ç»œæƒ…å†µä¸ç¨³å®šï¼Œå°±ç®—è¿™ä¸ªä¸ç¨³å®šæˆ‘ä¹Ÿå¿äº†ï¼Œä½†æ˜¯æ•™è‚²ç‰ˆåˆç»å¸¸å’Œå­¦æ ¡çš„ç®¡ç†æœ‰å…³ï¼Œæ€»æ˜¯æŠ½é£ï¼Œç½‘é¡µç«¯éƒ½æ‰“ä¸å¼€ï¼Œè¿™å·²ç»ç¬¬äºŒæ¬¡äº†ï¼Œæ¯æ¬¡éƒ½è¦æŒç»­å‡ å¤©ï¼Œè¿™æ¬¡å¤±æ•ˆæˆªæ­¢ç›®å‰ä¹Ÿå¿«ä¸€å‘¨äº†ï¼Œè¿˜æ²¡æœ‰ä¿®å¤å¥½ï¼Œæƒ³ç€ç´¢æ€§è‡ªå·±æ­å»ºä¸€ä¸ªæœåŠ¡ã€‚</p><p>ä¸ªäººäº‘ç›˜æ­å»ºä¹Ÿæœ‰å¤šç§é€‰æ‹©Nextcloudã€seafileç­‰ç­‰ï¼Œè¿˜æœ‰filerunã€å¯é“äº‘ç­‰ï¼Œåœ¨è¿™é‡Œçš„é€‰å‹ä¸»è¦é€‰å•†ä¸šåŒ–ä¸æ˜¯ç‰¹åˆ«ä¸¥é‡çš„ï¼Œä¹Ÿå°±æ˜¯å¼€æºç‰ˆæœ¬åŠŸèƒ½æ²¡è¢«é˜‰å‰²å¤ªå¤šçš„ï¼Œè€Œä¸”æ€§èƒ½è¿˜ç®—è¿‡å¾—å»çš„ã€‚</p><p>å®é™…å¤§å®¶è¿‡ç¨‹ä¸­æ­å»ºäº†Nextcloudå’Œseafileï¼Œæœ€ç»ˆæ˜¯é€‰æ‹©äº†Nextcloudï¼Œè™½ç„¶nextcloudçš„æ€§èƒ½æœ‰äº›é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥å¯¹æ€§èƒ½ä¼˜åŒ–ä¸€äº›ï¼Œè€ŒSeafileçš„åŠŸèƒ½æ„Ÿè§‰è¢«é˜‰å‰²ä¸å°‘ï¼Œè€Œä¸”æ–‡ä»¶ç®¡ç†è¿˜å¾—é€šè¿‡å®¢æˆ·ç«¯ï¼Œä¸æ–‡ä»¶ç®¡ç†å™¨é›†æˆçš„ä¸åˆ°ä½ã€‚åæ¥å‘ç°Nextcloudçš„è™šæ‹Ÿæ–‡ä»¶æ”¯æŒä¸€ç”¨å°±å´©æºƒï¼Œä¸è¿‡è€ƒè™‘Nextcloudçš„å•†åº—é‡Œæ’ä»¶å¾ˆå¤šï¼ŒåŠŸèƒ½å¯æ‰©å±•ï¼Œå°±è¿˜æ˜¯é€‰è¿™ä¸ªäº†ã€‚</p><p>å¥½äº†ï¼ŒåºŸè¯è¯´äº†ä¸€å †ï¼Œä¸‹é¢å¼€å§‹è¯´æ­£å¼çš„æ­å»ºè¿‡ç¨‹ã€‚</p><h2 id="ç¯å¢ƒè¯´æ˜ä¸å‡†å¤‡å·¥ä½œ"><a href="#ç¯å¢ƒè¯´æ˜ä¸å‡†å¤‡å·¥ä½œ" class="headerlink" title="ç¯å¢ƒè¯´æ˜ä¸å‡†å¤‡å·¥ä½œ"></a>ç¯å¢ƒè¯´æ˜ä¸å‡†å¤‡å·¥ä½œ</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>æœ¬åœ°ä¸€å°å°å¼æœºåšNextcloudæœåŠ¡ç«¯</p><p>å…¬ç½‘æœåŠ¡å™¨ç”¨æ¥è¿›è¡Œå…¬ç½‘è®¿é—®</p><p>è·¯ç”±å™¨ç”¨æ¥è¿›è¡ŒDNSåŠ«æŒ</p><h3 id="è½¯ä»¶å‡†å¤‡"><a href="#è½¯ä»¶å‡†å¤‡" class="headerlink" title="è½¯ä»¶å‡†å¤‡"></a>è½¯ä»¶å‡†å¤‡</h3><ul><li>docker</li><li>docker-compose</li></ul><p>å®‰è£…Dockerå’ŒDocker-composeçš„æ•™ç¨‹å¾ˆå¤šï¼Œæ¯”å¦‚<a href="https://www.runoob.com/docker/ubuntu-docker-install.html">https://www.runoob.com/docker/ubuntu-docker-install.html</a>ã€‚è¿™é‡Œä¸å±•å¼€è¯´dockerå®‰è£…è¿‡ç¨‹ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©dockerå®‰è£…ï¼Œæ˜¯å¯ä»¥ä¿è¯ä¸åœ¨ç¯å¢ƒä¸Šå‡ºç°è¿‡å¤šçš„å·®å¼‚ï¼Œè€Œä¸”åç»­å¦‚æœè¦è¿ç§»æ•°æ®ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><h2 id="Nextcloudæœ¬åœ°æ­å»º-Nextcloud-Redis-Mysql"><a href="#Nextcloudæœ¬åœ°æ­å»º-Nextcloud-Redis-Mysql" class="headerlink" title="Nextcloudæœ¬åœ°æ­å»º(Nextcloud+Redis+Mysql)"></a>Nextcloudæœ¬åœ°æ­å»º(Nextcloud+Redis+Mysql)</h2><p>Nextcloudçš„å•ç‹¬æ­å»ºå…¶å®å¾ˆç®€å•ï¼Œç›´æ¥<code>docker run nextcloud</code>å°±è¡Œäº†(å¤¸å¼ ä¸€ä¸‹ï¼Œå®é™…è¿˜å¾—è®¾ç½®æ•°æ®è·¯å¾„å’Œç«¯å£æ˜ å°„)ï¼Œä½†æ˜¯å¹¶ä¸æ¨èè¿™ä¹ˆæ‰§è¡Œï¼Œå®é™…è¿è¡Œçš„æ€§èƒ½æ¯”è¾ƒå·®ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨rediså’Œmysqlæ­å»ºã€‚</p><p>ä¸è¿‡å¾—ç›ŠäºDocker-composeï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘çš„è¿™ä¸ª<code>docker-compose.yml</code>ï¼Œå…¶ä¸­nextcloudä½¿ç”¨äº†è‡ªå®šä¹‰çš„é•œåƒï¼Œé›†æˆäº†ç¦»çº¿ä¸‹è½½çš„aria2å’Œç³»ç»Ÿå®šæ—¶å·¥å…·cronã€‚</p><p>ï¼ˆåœ¨ä¸‹é¢åŒæ ·é™„ä¸Šäº†Dockerfileæ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰ï¼Œå¦‚æœè‡ªå·±æ‡’å¾—buildé•œåƒï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒå³å¯ã€‚ï¼‰</p><p><code>Dockerfile</code>ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nextcloud:fpm</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update &amp;&amp; apt install -y aria2 libmagickcore-6.q16-6-extra cron&amp;&amp; apt clean</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> -p /var/www/aria2</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/www/aria2</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">touch</span> aria2.session</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &#123; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;dir=/Downloads&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;enable-rpc=true&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;rpc-allow-origin-all=true&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;rpc-listen-all=true&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;continue=true&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;input-file=/var/www/aria2/aria2.session&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;save-session=/var/www/aria2/aria2.session&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;max-concurrent-downloads=20&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;save-session-interval=120&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;connect-timeout=120&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;max-connection-per-server=10&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;min-split-size=10M&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;split=10&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;check-certificate=false&#x27;</span>; \</span></span><br><span class="line"><span class="language-bash">&#125; &gt; aria2.conf; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">chown</span> -R www-data:root /var/www/aria2; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">chmod</span> -R g=u /var/www/aria2</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/var/www/aria2&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed =i <span class="string">&#x27;194 i service cron start&#x27;</span> /entrypoint.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;194 i su -s /bin/bash -c &quot;aria2c --conf-path=/var/www/aria2/aria2.conf -D&quot; www-data&#x27;</span> /entrypoint.sh</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/www/html</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/entrypoint.sh&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;php-fpm&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><code>docker-compose.yml</code>ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.9&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nextcloud-mysql</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--skip-log-bin</span> <span class="string">--innodb_buffer_pool_size=2048M</span> <span class="string">--innodb_flush_method=O_DIRECT</span> <span class="string">--innodb_write_io_threads=16</span></span><br><span class="line">    <span class="comment"># å†…å­˜é…ç½®æ ¹æ®å®é™…æƒ…å†µæ¥</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=nextcloud</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=db_dev</span>  <span class="comment"># è®¾ç½®mysqlçš„rootç”¨æˆ·çš„å¯†ç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_LOG_CONSOLE=true</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span>  <span class="comment"># å¿…é¡»ã€‚è®¾ç½®æ•°æ®åº“æ•°æ®è·¯å¾„çš„æ˜ å°„ï¼Œæ•°æ®æŒä¹…åŒ–ä¿å­˜</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">db-data</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nextcloud-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">memcached:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nextcloud-memcached</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--requirepass</span> <span class="string">cached_dev</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># è®¾ç½®redisæ•°æ®è·¯å¾„çš„æ˜ å°„ï¼Œæ ¹æ®è‡ªå·±çš„é…ç½®çœ‹è¦ä¸è¦æ˜ å°„å‡ºæ¥å§ï¼Œéšæ„ã€‚</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">cache-data</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nextcloud-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nextcloud:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/env_halfcoke/nextcloud</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nextcloud-fpm</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">nextcloud-data</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/var/www/html</span> <span class="comment"># nextcloud æ•°æ®ç›®å½•ï¼Œå¿…é¡»ï¼Œæ•°æ®æŒä¹…åŒ–ä¿å­˜</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">nextcloud-aria2</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/var/www/aria2</span> <span class="comment"># nextcloud æ•°æ®ç›®å½•ï¼Œå»ºè®®</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">nextcloud-conf</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/usr/local/etc/php-fpm.d</span> <span class="comment"># nextcloudä½¿ç”¨çš„php-fpm é…ç½®ç›®å½•ï¼Œå»ºè®®</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PHP_UPLOAD_LIMIT=16G</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PHP_MEMORY_LIMIT=4G</span>    <span class="comment"># å†…å­˜é…ç½®æ ¹æ®å®é™…æƒ…å†µæ¥</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=nextcloud</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=db_dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_HOST=db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOST=memcached</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOST_PORT=6379</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOST_PASSWORD=cached_dev</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">memcached</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nextcloud-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nextcloud-server</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">443</span><span class="string">:443</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">nextcloud-data</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/var/www/html</span> <span class="comment"># nextcloud æ•°æ®ç›®å½•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">nginx-conf</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/etc/nginx/conf.d</span> <span class="comment"># nginx é…ç½®</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">nginx-ssl</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/etc/nginx/ssl_certs</span> <span class="comment"># nginx è¯ä¹¦</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nextcloud</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nextcloud-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">driver_opts:</span> </span><br><span class="line">      <span class="attr">type:</span> <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&#x27;bind&#x27;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&#x27;/data/db-data&#x27;</span></span><br><span class="line">  <span class="attr">cache-data:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">driver_opts:</span> </span><br><span class="line">      <span class="attr">type:</span> <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&#x27;bind&#x27;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&#x27;/data/cache-data&#x27;</span></span><br><span class="line">  <span class="attr">nextcloud-data:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">driver_opts:</span> </span><br><span class="line">      <span class="attr">type:</span> <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&#x27;bind&#x27;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&#x27;/data/nextcloud-data&#x27;</span></span><br><span class="line">  <span class="attr">nextcloud-aria2:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">driver_opts:</span> </span><br><span class="line">      <span class="attr">type:</span> <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&#x27;bind&#x27;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&#x27;/data/nextcloud-aria2&#x27;</span></span><br><span class="line">  <span class="attr">nextcloud-conf:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">driver_opts:</span> </span><br><span class="line">      <span class="attr">type:</span> <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&#x27;bind&#x27;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&#x27;/data/nextcloud-conf&#x27;</span></span><br><span class="line">  <span class="attr">nginx-conf:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">driver_opts:</span> </span><br><span class="line">      <span class="attr">type:</span> <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&#x27;bind&#x27;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&#x27;/data/server/conf&#x27;</span></span><br><span class="line">  <span class="attr">nginx-ssl:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">    <span class="attr">driver_opts:</span> </span><br><span class="line">      <span class="attr">type:</span> <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&#x27;bind&#x27;</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&#x27;/data/server/ssl_certs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">nextcloud-net:</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œ</span></span><br><span class="line">vim docker-compose.yml</span><br><span class="line"><span class="comment"># å°†ä¸Šé¢æ–‡ä»¶çš„docker-compose.ymlå†…å®¹å¤åˆ¶è¿›å»,ä¿å­˜é€€å‡º</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨docker composeå¯åŠ¨</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ¬¡å¯åŠ¨æ˜¯ä¸ºäº†æŠŠç›¸å…³æ•°æ®ç›®å½•çš„è·¯å¾„éƒ½å»ºç«‹å‡ºæ¥</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦æ‰€æœ‰å®¹å™¨éƒ½æ­£å¸¸å¯åŠ¨</span></span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œéœ€è¦å¯¹nginxè¿›è¡Œé…ç½®</p><p>nginxé…ç½®æ–‡ä»¶è·¯å¾„åœ¨ï¼š<code>/data/server/conf</code>ï¼Œè¿™ä¸ªæ˜¯åœ¨docker-composeæ–‡ä»¶ä¸­é…ç½®çš„ï¼Œç°åœ¨è¿™ä¸ªè·¯å¾„åº”è¯¥æ˜¯ç©ºçš„(æ˜¯ä¸æ˜¯ç©ºçš„éƒ½æ— æ‰€è°“)ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>nextcloud.conf</code>æ–‡ä»¶ã€‚</p><p>æ–‡ä»¶ååªè¦æ˜¯ä»¥confç»“å°¾å³å¯ï¼Œè¿™é‡Œå‘½åä¸º<code>nextcloud.conf</code></p><p>å®˜æ–¹å®é™…ä¸Šæ˜¯æä¾›äº†<a href="https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html#nextcloud-in-the-webroot-of-nginx">nginxé…ç½®æ–‡ä»¶</a>çš„(<a href="https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html#nextcloud-in-the-webroot-of-nginx)%EF%BC%8C%E4%BD%86%E6%98%AF%E9%87%8C%E9%9D%A2%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE%EF%BC%8C%E6%B3%A8%E6%84%8F%E4%B8%AD%E6%96%87%E6%B3%A8%E9%87%8A%E3%80%82">https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html#nextcloud-in-the-webroot-of-nginx)ï¼Œä½†æ˜¯é‡Œé¢éœ€è¦ä¿®æ”¹ä¸€äº›é…ç½®ï¼Œæ³¨æ„ä¸­æ–‡æ³¨é‡Šã€‚</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> php-handler &#123;</span><br><span class="line">    <span class="attribute">server</span> nextcloud:<span class="number">9000</span>; <span class="comment"># è¿™é‡Œå› ä¸ºå’±ä»¬æ˜¯dockeréƒ¨ç½²ï¼Œéœ€è¦æ›´æ”¹ä¸ºæœåŠ¡å</span></span><br><span class="line">    <span class="comment">#server unix:/var/run/php/php7.4-fpm.sock;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> cloud.example.com; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹ä¸»æœºå</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Enforce HTTPS</span></span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span>      ssl http2;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> cloud.example.com; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹ä¸»æœºå</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Use Mozilla&#x27;s guidelines for SSL/TLS settings</span></span><br><span class="line">    <span class="comment"># https://mozilla.github.io/server-side-tls/ssl-config-generator/</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span>     /etc/ssl/nginx/cloud.example.com.crt; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/ssl/nginx/cloud.example.com.key;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HSTS settings</span></span><br><span class="line">    <span class="comment"># WARNING: Only add the preload option once you read about</span></span><br><span class="line">    <span class="comment"># the consequences in https://hstspreload.org/. This option</span></span><br><span class="line">    <span class="comment"># will add the domain to a hardcoded list that is shipped</span></span><br><span class="line">    <span class="comment"># in all major browsers and getting removed from this list</span></span><br><span class="line">    <span class="comment"># could take several months.</span></span><br><span class="line">    <span class="comment">#add_header Strict-Transport-Security &quot;max-age=15768000; includeSubDomains; preload;&quot; always;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># set max upload size</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">16G</span>; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹å¤§å°ï¼Œè¿™ä¸ªå…³ç³»åˆ°èƒ½å¤Ÿä¸Šä¼ çš„æœ€å¤§æ–‡ä»¶å¤§å°</span></span><br><span class="line">    <span class="attribute">fastcgi_buffers</span> <span class="number">64</span> <span class="number">4K</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Enable gzip but do not remove ETag headers</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">4</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">256</span>;</span><br><span class="line">    <span class="attribute">gzip_proxied</span> expired <span class="literal">no</span>-cache <span class="literal">no</span>-store private no_last_modified no_etag auth;</span><br><span class="line">    <span class="attribute">gzip_types</span> application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pagespeed is not supported by Nextcloud, so if your server is built</span></span><br><span class="line">    <span class="comment"># with the `ngx_pagespeed` module, uncomment this line to disable it.</span></span><br><span class="line">    <span class="comment">#pagespeed off;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP response headers borrowed from Nextcloud `.htaccess`</span></span><br><span class="line">    <span class="attribute">add_header</span> Referrer-Policy                      <span class="string">&quot;no-referrer&quot;</span>   always;</span><br><span class="line">    <span class="attribute">add_header</span> X-Content-Type-Options               <span class="string">&quot;nosniff&quot;</span>       always;</span><br><span class="line">    <span class="attribute">add_header</span> X-Download-Options                   <span class="string">&quot;noopen&quot;</span>        always;</span><br><span class="line">    <span class="attribute">add_header</span> X-Frame-Options                      <span class="string">&quot;SAMEORIGIN&quot;</span>    always;</span><br><span class="line">    <span class="attribute">add_header</span> X-Permitted-Cross-Domain-Policies    <span class="string">&quot;none&quot;</span>          always;</span><br><span class="line">    <span class="attribute">add_header</span> X-Robots-Tag                         <span class="string">&quot;none&quot;</span>          always;</span><br><span class="line">    <span class="attribute">add_header</span> X-XSS-Protection                     <span class="string">&quot;1; mode=block&quot;</span> always;</span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security  <span class="number">15552000</span>; <span class="comment"># è¡¥å……è¿™æ¡é…ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Remove X-Powered-By, which is an information leak</span></span><br><span class="line">    <span class="attribute">fastcgi_hide_header</span> X-Powered-By;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Path to the root of your installation</span></span><br><span class="line">    <span class="attribute">root</span> /var/www/nextcloud;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Specify how to handle directories -- specifying `/index.php$request_uri`</span></span><br><span class="line">    <span class="comment"># here as the fallback means that Nginx always exhibits the desired behaviour</span></span><br><span class="line">    <span class="comment"># when a client requests a path that corresponds to a directory that exists</span></span><br><span class="line">    <span class="comment"># on the server. In particular, if that directory contains an index.php file,</span></span><br><span class="line">    <span class="comment"># that file is correctly served; if it doesn&#x27;t, then the request is passed to</span></span><br><span class="line">    <span class="comment"># the front-end controller. This consistent behaviour means that we don&#x27;t need</span></span><br><span class="line">    <span class="comment"># to specify custom rules for certain paths (e.g. images and other assets,</span></span><br><span class="line">    <span class="comment"># `/updater`, `/ocm-provider`, `/ocs-provider`), and thus</span></span><br><span class="line">    <span class="comment"># `try_files $uri $uri/ /index.php$request_uri`</span></span><br><span class="line">    <span class="comment"># always provides the desired behaviour.</span></span><br><span class="line">    <span class="attribute">index</span> index.php index.html /index.php<span class="variable">$request_uri</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Rule borrowed from `.htaccess` to handle Microsoft DAV clients</span></span><br><span class="line">    <span class="section">location</span> = / &#123;</span><br><span class="line">        <span class="attribute">if</span> ( <span class="variable">$http_user_agent</span> <span class="regexp">~ ^DavClnt</span> ) &#123;</span><br><span class="line">            <span class="attribute">return</span> <span class="number">302</span> /remote.php/webdav/<span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> = /robots.txt &#123;</span><br><span class="line">        <span class="attribute">allow</span> all;</span><br><span class="line">        <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Make a regex exception for `/.well-known` so that clients can still</span></span><br><span class="line">    <span class="comment"># access it despite the existence of the regex rule</span></span><br><span class="line">    <span class="comment"># `location ~ /(\.|autotest|...)` which would otherwise handle requests</span></span><br><span class="line">    <span class="comment"># for `/.well-known`.</span></span><br><span class="line">    <span class="section">location</span><span class="regexp"> ^~</span> /.well-known &#123;</span><br><span class="line">        <span class="comment"># The rules in this block are an adaptation of the rules</span></span><br><span class="line">        <span class="comment"># in `.htaccess` that concern `/.well-known`.</span></span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> = /.well-known/carddav &#123; <span class="attribute">return</span> <span class="number">301</span> /remote.php/dav/; &#125;</span><br><span class="line">        <span class="section">location</span> = /.well-known/caldav  &#123; <span class="attribute">return</span> <span class="number">301</span> /remote.php/dav/; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> /.well-known/acme-challenge    &#123; <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>; &#125;</span><br><span class="line">        <span class="section">location</span> /.well-known/pki-validation    &#123; <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Let Nextcloud&#x27;s API for `/.well-known` URIs handle all other</span></span><br><span class="line">        <span class="comment"># requests by passing them to the front-end controller.</span></span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> /index.php<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Rules borrowed from `.htaccess` to hide certain paths from clients</span></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ ^/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)</span>  &#123; <span class="attribute">return</span> <span class="number">404</span>; &#125;</span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ ^/(?:\.|autotest|occ|issue|indie|db_|console)</span>                &#123; <span class="attribute">return</span> <span class="number">404</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Ensure this block, which passes PHP files to the PHP process, is above the blocks</span></span><br><span class="line">    <span class="comment"># which handle static assets (as seen below). If this block is not declared first,</span></span><br><span class="line">    <span class="comment"># then Nginx will encounter an infinite rewriting loop when it prepends `/index.php`</span></span><br><span class="line">    <span class="comment"># to the URI, resulting in a HTTP 500 error response.</span></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php(?:$|/)</span> &#123;</span><br><span class="line">        <span class="comment"># Required for legacy support</span></span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/(?!index|remote|public|cron|core\/ajax\/update|status|ocs\/v[12]|updater\/.+|oc[ms]-provider\/.+|.+\/richdocumentscode\/proxy)</span> /index.php<span class="variable">$request_uri</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+?\.php)(/.*)$</span>;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$path_info</span> <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$fastcgi_script_name</span> =<span class="number">404</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> PATH_INFO <span class="variable">$path_info</span>;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> HTTPS <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">fastcgi_param</span> modHeadersAvailable <span class="literal">true</span>;         <span class="comment"># Avoid sending the security headers twice</span></span><br><span class="line">        <span class="attribute">fastcgi_param</span> front_controller_active <span class="literal">true</span>;     <span class="comment"># Enable pretty urls</span></span><br><span class="line">        <span class="attribute">fastcgi_pass</span> php-handler;</span><br><span class="line">        <span class="attribute">fastcgi_read_timeout</span> <span class="number">18000</span>; <span class="comment"># è¡¥å……è¿™æ¡é…ç½®</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">fastcgi_intercept_errors</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">fastcgi_request_buffering</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.(?:css|js|svg|gif|png|jpg|ico)$</span> &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> /index.php<span class="variable">$request_uri</span>;</span><br><span class="line">        <span class="attribute">expires</span> <span class="number">6M</span>;         <span class="comment"># Cache-Control policy borrowed from `.htaccess`</span></span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;     <span class="comment"># Optional: Don&#x27;t log access to assets</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.woff2?$</span> &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> /index.php<span class="variable">$request_uri</span>;</span><br><span class="line">        <span class="attribute">expires</span> <span class="number">7d</span>;         <span class="comment"># Cache-Control policy borrowed from `.htaccess`</span></span><br><span class="line">        <span class="attribute">access_log</span> <span class="literal">off</span>;     <span class="comment"># Optional: Don&#x27;t log access to assets</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Rule borrowed from `.htaccess`</span></span><br><span class="line">    <span class="section">location</span> /remote &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> /remote.php<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php<span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œè®¿é—®æœ¬æœºçš„<code>https://localhost</code>åº”è¯¥å¯ä»¥æ‰“å¼€nextcloudäº†</p><p>å¯ä»¥è¿›è¡Œä¸€äº›é…ç½®ï¼Œå¤§ä½“ä¸Šå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310125240.png"></p><p>åŒæ ·å¯ä»¥é€šè¿‡æ‰‹æœºç«¯ã€ç”µè„‘ç«¯å¯¹å…¶è¿›è¡Œè®¿é—®(æ¥å…¥åŒä¸€ä¸ªå±€åŸŸç½‘)</p><h2 id="Nextcloudå…¬ç½‘è®¿é—®ï¼ˆå¯é€‰ï¼‰"><a href="#Nextcloudå…¬ç½‘è®¿é—®ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="Nextcloudå…¬ç½‘è®¿é—®ï¼ˆå¯é€‰ï¼‰"></a>Nextcloudå…¬ç½‘è®¿é—®ï¼ˆå¯é€‰ï¼‰</h2><p>ä»…èƒ½å±€åŸŸç½‘è®¿é—®å¾ˆå¤šæ—¶å€™ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè€Œä¸”ç‰¹åˆ«ä¸æ–¹ä¾¿ï¼Œä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨å…¬ç½‘æœåŠ¡å™¨è¿›è¡Œè½¬å‘ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å…¬ç½‘æœåŠ¡å™¨è®¿é—®äº†ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘æ˜¯ç›´æ¥è½¬å‘äº†æœ¬æœºçš„443ç«¯å£ï¼Œåˆ°å…¬ç½‘æœåŠ¡å™¨çš„8002ç«¯å£ã€‚</p><p>è½¬å‘ç«¯å£ç”¨åˆ°çš„å·¥å…·å¯ä»¥çœ‹æˆ‘ä»¬çš„è¿™ç¯‡æ–‡ç« <a href="https://halfcoke.github.io/2021/f282203b/">ã€ŠFRPç«¯å£è½¬å‘å·¥å…·ã€‹</a>ï¼Œå¯¹Frpå·¥å…·è¿›è¡Œäº†ä»‹ç»ã€‚</p><p>å› ä¸ºæˆ‘åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†å¾ˆå¤šæœåŠ¡ï¼Œå› æ­¤åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šä¹Ÿæ˜¯é€šè¿‡nginxè¿›è¡Œä»£ç†ã€‚</p><p>nginxé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">   <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">   <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line">   <span class="attribute">server_name</span> cloud.example.com; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹ä¸»æœºå</span></span><br><span class="line">   <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">   <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">   <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">   <span class="attribute">server_name</span> cloud.example.com; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹ä¸»æœºå</span></span><br><span class="line"></span><br><span class="line">   <span class="attribute">ssl_certificate</span> /etc/ssl/nginx/cloud.example.com.crt; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line">   <span class="attribute">ssl_certificate_key</span> /etc/ssl/nginx/cloud.example.com.crt; <span class="comment"># è¿™é‡Œæ ¹æ®è‡ªå·±å®é™…æƒ…å†µä¿®æ”¹è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line">   <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">   <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">   <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">   <span class="attribute">client_max_body_size</span> <span class="number">16G</span>;</span><br><span class="line">   <span class="section">location</span> <span class="regexp">~* /.*</span> &#123; <span class="comment"># è½¬å‘æ‰€æœ‰è¯·æ±‚</span></span><br><span class="line">   <span class="attribute">proxy_pass</span> https://172.20.0.1:8002<span class="variable">$request_uri</span>; <span class="comment"># è¿™é‡Œè¿™ä¸ªipæ˜¯å…¬ç½‘æœåŠ¡å™¨çš„å®¿ä¸»IPï¼ˆå› ä¸ºæˆ‘ä¹Ÿéƒ¨ç½²äº†dockerï¼‰</span></span><br><span class="line">   <span class="attribute">proxy_set_header</span>   Host             <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">   <span class="attribute">proxy_set_header</span>   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">   <span class="attribute">proxy_set_header</span>   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç›´æ¥è®¿é—®å…¬ç½‘çš„ipå°±å¯ä»¥ç›´æ¥è®¿é—®åˆ°è‡ªå·±çš„nextcloudäº†ã€‚</p><p>å¼ºçƒˆå»ºè®®æ³¨å†Œä¸€ä¸ªåŸŸåï¼Œé€šè¿‡åŸŸåå¯¹è‡ªå·±çš„æœåŠ¡è¿›è¡Œè®¿é—®ï¼Œè¿™æ ·httpsæ˜¾ç¤ºå°±æ­£å¸¸äº†ã€‚</p><h2 id="ä½¿ç”¨åŒä¸€åŸŸåè§£æè‡³å…¬ç½‘æˆ–å†…ç½‘IPï¼ˆå¯é€‰ï¼‰"><a href="#ä½¿ç”¨åŒä¸€åŸŸåè§£æè‡³å…¬ç½‘æˆ–å†…ç½‘IPï¼ˆå¯é€‰ï¼‰" class="headerlink" title="ä½¿ç”¨åŒä¸€åŸŸåè§£æè‡³å…¬ç½‘æˆ–å†…ç½‘IPï¼ˆå¯é€‰ï¼‰"></a>ä½¿ç”¨åŒä¸€åŸŸåè§£æè‡³å…¬ç½‘æˆ–å†…ç½‘IPï¼ˆå¯é€‰ï¼‰</h2><p><em>æ³¨ï¼šè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†è¿›è¡ŒåŸŸååŠ«æŒï¼Œå¦‚æœæ‰€ç”¨è·¯ç”±å™¨æœ‰ç›¸å…³çš„åŠŸèƒ½ï¼Œç›´æ¥è®¾ç½®å³å¯ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ã€‚</em></p><p>æ¥ä¸‹æ¥æä¸€ä¸ªéªšæ“ä½œ</p><p>å›é¡¾ä¸€ä¸‹ä½¿ç”¨åœºæ™¯</p><p>æˆ‘çš„å®¢æˆ·ç«¯ç”µè„‘æ˜¯ç¬”è®°æœ¬ï¼ŒæœåŠ¡ç«¯ç”µè„‘æ˜¯å°å¼æœºï¼Œæˆ‘æ˜¯æƒ³åŒæ­¥æˆ‘ç¬”è®°ä¸Šçš„æ‰€æœ‰çš„æ•°æ®ã€‚å°å¼æœºæ˜¯æ”¾é‚£ä¸åŠ¨çš„ï¼Œè€Œç¬”è®°æœ¬æˆ‘ç»å¸¸è¦æ‹¿èµ°ã€‚</p><p>å› ä¸ºå…¬ç½‘æœåŠ¡å™¨çš„å¸¦å®½å¾ˆä½ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å…¬ç½‘IPè¿›è¡Œåˆå§‹åŒæ­¥ä¸å¤ªç°å®ï¼Œé€Ÿåº¦å¤ªæ…¢äº†ã€‚è€Œæˆ‘å®é™…ä¸Šæ˜¯å¯ä»¥æŠŠç¬”è®°æœ¬å’Œå°å¼æœºæ¥åœ¨ä¸€ä¸ªå±€åŸŸç½‘é‡Œçš„ã€‚</p><p>ç„¶è€Œï¼Œæˆ‘çœ‹äº†çœ‹è‡ªå·±çš„è·¯ç”±å™¨ï¼Œå¹¶æ²¡æœ‰DNSçš„åŠŸèƒ½ï¼Œæœ€å¤šæˆ‘åªèƒ½è®¾ç½®ä¸€ä¸ªDNSæœåŠ¡å™¨ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘çš„å°å¼æœºæ”¾åœ¨é‚£å°±å¯ä»¥æ­ä¸€ä¸ªDNSæœåŠ¡ï¼Œè¿™æ ·æˆ‘è‡ªå·±åŠ«æŒä¸€ä¸‹DNSï¼Œåœ¨å†…ç½‘çš„æ—¶å€™ç›´æ¥æŠŠæˆ‘çš„åŸŸååŠ«æŒåˆ°å±€åŸŸç½‘IPå°±å¯ä»¥äº†ï¼Œè¯´æå°±æã€‚</p><h3 id="DNSæœåŠ¡æ­å»º"><a href="#DNSæœåŠ¡æ­å»º" class="headerlink" title="DNSæœåŠ¡æ­å»º"></a>DNSæœåŠ¡æ­å»º</h3><p>åœ¨ubuntu 18 ä¸Šæ­å»ºDNSæœåŠ¡æ—¶ï¼Œéœ€è¦å…ˆå…³é—­systemd-resloveæœåŠ¡ï¼Œé‡Šæ”¾53ç«¯å£ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ<code>docker pull sameersbn/bind</code>æŠŠé•œåƒæ‹‰ä¸‹æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop systemd-reslove</span><br><span class="line">sudo systemctl disable systemd-reslove</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘<code>/etc/systemd/resolved.conf</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Resolve]</span><br><span class="line">DNS=127.0.0.1</span><br><span class="line">#FallbackDNS=</span><br><span class="line">#Domains=</span><br><span class="line">LLMNR=no</span><br><span class="line">#MulticastDNS=no</span><br><span class="line">#DNSSEC=no</span><br><span class="line">#Cache=yes</span><br><span class="line">DNSStubListener=no</span><br></pre></td></tr></table></figure><p>é‡å¯ç”µè„‘</p><p>DNSæœåŠ¡æ­å»ºï¼Œä¹Ÿä½¿ç”¨docker-composeéƒ¨ç½²äº†ï¼Œå†™ä¸ªé…ç½®æ–‡ä»¶æ¯”è¾ƒæ–¹ä¾¿ã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">dns_server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sameersbn/bind</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dns_server</span></span><br><span class="line">    <span class="attr">environment:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">WEBMIN_ENABLED=true</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;53:53/udp&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;53:53/tcp&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10000</span><span class="string">:10000</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/dns_server:/data</span></span><br></pre></td></tr></table></figure><p>è®¿é—®<a href="https://localhost:10000/">https://localhost:10000</a></p><p>è´¦å·root å¯†ç password</p><p>è®¾ç½®ä¸­æ–‡åæ‰“å¼€bind dns serveré¡µé¢</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310125393.png"></p><p>è¿›è¡Œè½¬å‘å’Œä¼ è¾“è®¾ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126745.png"></p><p>è¿›è¡Œè®¿é—®æ§åˆ¶åˆ—è¡¨è®¾ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126310.png"></p><p>åœ¨è¿™é‡Œåˆ›å»ºæ–°çš„ä¸»åŒºåŸŸ</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126888.png"></p><p>è¿™é‡Œæ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µå»å¡«ï¼ŒEmailåœ°å€éšä¾¿å†™</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126311.png"></p><p>ç‚¹å‡»æ–°å»ºä»¥åï¼Œç‚¹å‡»åœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126055.png"></p><p>æŒ‰ç…§å¦‚ä¸‹å¡«å†™å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126147.png"></p><p>ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ŒæŠŠè·¯ç”±å™¨çš„DNSæœåŠ¡å™¨è®¾ç½®ä¸ºå°å¼æœºï¼Œç„¶åé“¾æ¥åˆ°è·¯ç”±å™¨çš„å±€åŸŸç½‘é‡Œï¼Œå°±å¯ä»¥ä½¿ç”¨<code>host example.cn</code>æ¥æŸ¥çœ‹åœ°å€ï¼Œå¦‚æœå¯ä»¥å®šä½åˆ°å°å¼æœºï¼Œå°±æ²¡é—®é¢˜äº†ã€‚</p><h2 id="å…¶ä»–é‡è¦çš„è¡¥å……å·¥ä½œ"><a href="#å…¶ä»–é‡è¦çš„è¡¥å……å·¥ä½œ" class="headerlink" title="å…¶ä»–é‡è¦çš„è¡¥å……å·¥ä½œ"></a>å…¶ä»–é‡è¦çš„è¡¥å……å·¥ä½œ</h2><h3 id="ä½¿ç”¨Demo"><a href="#ä½¿ç”¨Demo" class="headerlink" title="ä½¿ç”¨Demo"></a>ä½¿ç”¨Demo</h3><h4 id="Webé¡µé¢"><a href="#Webé¡µé¢" class="headerlink" title="Webé¡µé¢"></a>Webé¡µé¢</h4><p>ä¸»é¡µé¢åŸºæœ¬å°±æ˜¯è¿™ä¸ªæ ·å­ï¼Œå¾ˆç®€æ´ï¼Œåœ¨å³ä¾§å¯ä»¥è¿›è¡Œä¸€äº›è®¾ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126125.png"></p><p>åœ¨æ–‡ä»¶é¡µé¢æ˜¯è¿™ä¸ªæ ·å­ï¼Œæœ‰æ–‡ä»¶ç‰ˆæœ¬è®°å½•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126992.png"></p><p>åœ¨æœ¬åœ°åˆ é™¤çš„æ–‡ä»¶ï¼Œäº‘ç«¯ä¹Ÿä¼šæœ‰è®°å½•ï¼Œå¯ä»¥è¿›è¡Œæ–‡ä»¶æ¢å¤</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310127302.png"></p><h4 id="Windowså®¢æˆ·ç«¯"><a href="#Windowså®¢æˆ·ç«¯" class="headerlink" title="Windowså®¢æˆ·ç«¯"></a>Windowså®¢æˆ·ç«¯</h4><p>Windowså®¢æˆ·ç«¯å¯ä»¥è®¾ç½®å¿½ç•¥åŒæ­¥çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„åœ°æ–¹ï¼Œæ¯”å¦‚<code>node_modules</code>ç»ˆäºä¸éœ€è¦åŒæ­¥äº†ï¼ˆä¹‹å‰onedriveä¸æ”¯æŒè¿›è¡Œè¿™æ ·çš„è®¾ç½®ï¼‰ã€‚æ€»ä½“çš„ä½¿ç”¨ä¹Ÿæ˜¯æ¯”è¾ƒæ–¹ä¾¿æ˜“æ‡‚çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126836.png"></p><p>åŒæ­¥æ–‡ä»¶å¤¹ä¹Ÿå¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œæˆ‘ç›´æ¥ç”¨ä¹‹å‰Onedriveåˆ›å»ºçš„æ–‡ä»¶å¤¹äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126771.png"></p><p>åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­çœ‹åŸºæœ¬ä¸Šæ˜¯è¿™ä¸ªæ ·å­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126674.png"></p><p>nextcloudæœ‰è™šæ‹Ÿæ–‡ä»¶æ”¯æŒï¼Œå°±æ˜¯ç±»ä¼¼onedriveçš„æ–‡ä»¶éšé€‰ã€‚ä½†æ˜¯æˆ‘è¿™è¾¹ä¸€å¼€å¯å°±å®¹æ˜“å¡æ­»ï¼Œå…³é—­åå°±ä¸€ç›´æ­£å¸¸ã€‚</p><h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><p>æŒ‰ç…§ä¸Šè¿°çš„æ­å»ºè¿‡ç¨‹åï¼Œå·²ç»è¿›è¡Œäº†åˆæ­¥çš„æ€§èƒ½ä¼˜åŒ–ï¼Œåœ¨å¯åŠ¨MySQLæ—¶ï¼Œå·²ç»å¢åŠ äº†ç›¸å…³å‚æ•°æ¥æé«˜MySQLåœ¨å½“å‰ä½¿ç”¨ç¯å¢ƒä¸‹çš„æ€§èƒ½ã€‚</p><h4 id="PHP-fpm"><a href="#PHP-fpm" class="headerlink" title="PHP-fpm"></a>PHP-fpm</h4><p>ä¸‹é¢ç»™å‡ºå¯¹Nextcloudä½¿ç”¨çš„PHP-fpmçš„ä¼˜åŒ–å‚æ•°ã€‚<a href="https://docs.nextcloud.com/server/latest/admin_manual/installation/server_tuning.html#tune-php-fpm">å®˜ç½‘</a>æä¾›äº†ä¸€ä¸ªè°ƒä¼˜å·¥å…·<a href="https://spot13.com/pmcalculator/">PHP-FPM Process Calculator</a>çš„é“¾æ¥ã€‚</p><p>ä½†æ˜¯å¯¹äºä¸ç†Ÿæ‚‰PHP-FPMçš„äººæ‰¾è¿™ä¸ªé…ç½®æ–‡ä»¶æ—¶å€™è¿˜èŠ±äº†ä¸€ç•ªåŠŸå¤«ã€‚</p><p>åœ¨å‰æ–‡ä¸­ï¼Œå·²ç»æŠŠç›¸å…³é…ç½®æ–‡ä»¶æš´éœ²åœ¨äº†<code>/data/nextcloud-conf</code>è·¯å¾„ä¸‹</p><p>ç›´æ¥ç¼–è¾‘è·¯å¾„ä¸‹çš„<code>www.conf</code>æ–‡ä»¶å³å¯ï¼Œæ‰¾åˆ°<code>pm.max_children</code>ã€<code>pm.start_servers</code>ã€<code>pm.min_spare_servers</code>ã€<code>pm.max_spare_servers</code>è¿™å‡ ä¸ªå‚æ•°ï¼ŒæŒ‰ç…§ä¸Šé¢å·¥å…·è¾“å‡ºçš„å‚æ•°è¿›è¡Œä¿®æ”¹å³å¯ã€‚</p><h3 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h3><p>æ’ä»¶å®‰è£…æ—¶ï¼Œå¦‚æœåœ¨çº¿å®‰è£…åˆ™æœåŠ¡å™¨éœ€è¦èƒ½è®¿é—®å¤–ç½‘ï¼Œæˆ–è€…å¯ä»¥é€šè¿‡ç¦»çº¿å®‰è£…çš„æ–¹å¼è¿›è¡Œã€‚</p><h4 id="åœ¨çº¿å®‰è£…ï¼š"><a href="#åœ¨çº¿å®‰è£…ï¼š" class="headerlink" title="åœ¨çº¿å®‰è£…ï¼š"></a>åœ¨çº¿å®‰è£…ï¼š</h4><p>ç‚¹å‡»åº”ç”¨ï¼Œç„¶åé€‰æ‹©ä½ éœ€è¦å®‰è£…çš„æ’ä»¶ï¼Œä¸‹è½½å¹¶å¯ç”¨å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126709.png"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126703.png"></p><h4 id="ç¦»çº¿å®‰è£…ï¼š"><a href="#ç¦»çº¿å®‰è£…ï¼š" class="headerlink" title="ç¦»çº¿å®‰è£…ï¼š"></a>ç¦»çº¿å®‰è£…ï¼š</h4><p>è®¿é—®nextcloudå®˜æ–¹æ’ä»¶å•†åº—<a href="https://apps.nextcloud.com/">https://apps.nextcloud.com/</a>ï¼Œé€‰æ‹©æƒ³è¦çš„æ’ä»¶ï¼Œå¹¶ä¸‹è½½æŒ‡å®šç‰ˆæœ¬ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126139.png"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126318.png"></p><p>å°†æ’ä»¶å‹ç¼©åŒ…ï¼Œæ”¾å…¥<code>/data/nextcloud-data/custom_apps</code>ä¸­è§£å‹å³å¯ã€‚</p><p>è¿”å›ä½ è‡ªå·±çš„nextcloudï¼Œåœ¨åº”ç”¨é¡µé¢ä¼šå‘ç°æ”¾å…¥çš„æ’ä»¶ï¼Œå¯ç”¨å³å¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126973.png"></p><p>åˆšå®‰è£…å¥½çš„è¯åº”è¯¥æ˜¯ä¸æ”¯æŒç”¨æˆ·æ³¨å†Œçš„ï¼Œå¯ä»¥å®‰è£…ä¸€ä¸ªæ³¨å†Œæ’ä»¶ï¼Œæ–¹ä¾¿æœ‹å‹ä¸´æ—¶ç”¨ä¸€ä¸‹ã€‚</p><h3 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h3><h4 id="å®‰å…¨è®¾ç½®è­¦å‘Š"><a href="#å®‰å…¨è®¾ç½®è­¦å‘Š" class="headerlink" title="å®‰å…¨è®¾ç½®è­¦å‘Š"></a>å®‰å…¨è®¾ç½®è­¦å‘Š</h4><p>ä½¿ç”¨æˆ‘æä¾›çš„dockeré•œåƒå’Œnginxé…ç½®æ–‡ä»¶ï¼Œåº”è¯¥å¯ä»¥é€šè¿‡æ‰€æœ‰æ£€æŸ¥ã€‚ä½¿ç”¨å®˜æ–¹é»˜è®¤çš„dockeré•œåƒï¼Œéœ€è¦åœ¨dockerå†…éƒ¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ¥æ¶ˆé™¤å‡ ä¸ªé”™è¯¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install -y libmagickcore-6.q16-6-extra <span class="comment">#æ”¯æŒsvg</span></span><br><span class="line">apt install -y cron <span class="comment"># æ‰§è¡Œå®šæ—¶ä»»åŠ¡</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310126080.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> æŠ˜è…¾ </category>
          
          <category> Nextcloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
            <tag> Nextcloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FRPç«¯å£è½¬å‘å·¥å…·</title>
      <link href="/2021/f282203b/"/>
      <url>/2021/f282203b/</url>
      
        <content type="html"><![CDATA[<h1 id="FRPç«¯å£è½¬å‘å·¥å…·åŠéƒ¨ç½²æ–¹å¼è¯¦è§£-win-linux"><a href="#FRPç«¯å£è½¬å‘å·¥å…·åŠéƒ¨ç½²æ–¹å¼è¯¦è§£-win-linux" class="headerlink" title="FRPç«¯å£è½¬å‘å·¥å…·åŠéƒ¨ç½²æ–¹å¼è¯¦è§£(win+linux)"></a>FRPç«¯å£è½¬å‘å·¥å…·åŠéƒ¨ç½²æ–¹å¼è¯¦è§£(win+linux)</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨æ­¤å‰çš„<a href="https://halfcoke.github.io/2021/cac946/">æ–‡ç« </a>ä¸­ï¼Œä»‹ç»äº†ä½¿ç”¨sshå‘½ä»¤è¿›è¡Œç«¯å£è½¬å‘ã€‚</p><p>ä½¿ç”¨sshè¿›è¡Œç«¯å£è½¬å‘æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå…¶ä¼˜ç‚¹ä¸»è¦åœ¨ä½¿ç”¨æ–¹ä¾¿ï¼ŒæœåŠ¡å™¨ä¸ŠåŸºæœ¬éƒ½å®‰è£…äº†sshæœåŠ¡ç”¨æ¥è¿›è¡Œè¿œç¨‹ç™»å½•ï¼Œå› æ­¤åªè¦æœ‰sshå‘½ä»¤å°±èƒ½å®ç°ç«¯å£è½¬å‘çš„åŠŸèƒ½ã€‚ä½†å…¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¸»è¦åœ¨äºè¿œç¨‹è½¬å‘ã€æœ¬åœ°è½¬å‘ã€åŠ¨æ€è½¬å‘ç­‰é…ç½®å‚æ•°è®©ä½¿ç”¨è€…å¸¸å¸¸æ··æ·†ï¼Œä½¿ç”¨é¢‘ç‡ä¸é«˜æ—¶ä¹Ÿè®°ä¸ä½è¿™äº›å‚æ•°ã€‚å¦‚æœå¿˜è®°è®¾ç½®sshä¿æ´»æˆ–å‡ºç°ç½‘ç»œæ³¢åŠ¨å¯¼è‡´é“¾æ¥æ–­å¼€ä¹Ÿä¸æ–¹ä¾¿è‡ªåŠ¨é‡è¿ï¼Œå¸¸å¸¸éœ€è¦ç”¨æˆ·è‡ªå·±å†å†™è„šæœ¬æ¥ç»´æŠ¤ï¼Œè¿™ä¹Ÿå¢åŠ äº†å¤æ‚æ€§ã€‚</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ä½¿ç”¨sshæ¥è¿›è¡Œä¸´æ—¶çš„ç«¯å£è½¬å‘æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³å»ºç«‹ä¸€ä¸ªé•¿æœŸçš„è½¬å‘é“¾æ¥çš„æ—¶å€™(æ¯”å¦‚è½¬å‘Windowsçš„è¿œç¨‹è®¿é—®ç«¯å£ï¼Œå¯ä»¥éšæ—¶è¿œç¨‹è®¿é—®æ”¾åœ¨å›ºå®šä½ç½®çš„ç”µè„‘)ï¼Œåœ¨ä½¿ç”¨sshå°±å¯èƒ½è¦è‡ªå·±é€ ä¸€äº›è½®å­ã€‚</p><p>ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæ›´æ¨èä½¿ç”¨frpå·¥å…·è¿›è¡Œç«¯å£è½¬å‘ã€‚</p><h2 id="frpå·¥å…·ä»‹ç»"><a href="#frpå·¥å…·ä»‹ç»" class="headerlink" title="frpå·¥å…·ä»‹ç»"></a>frpå·¥å…·ä»‹ç»</h2><p>frp æ˜¯ä¸€ä¸ªä¸“æ³¨äºå†…ç½‘ç©¿é€çš„é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œæ”¯æŒ TCPã€UDPã€HTTPã€HTTPS ç­‰å¤šç§åè®®ã€‚å¯ä»¥å°†å†…ç½‘æœåŠ¡ä»¥å®‰å…¨ã€ä¾¿æ·çš„æ–¹å¼é€šè¿‡å…·æœ‰å…¬ç½‘ IP èŠ‚ç‚¹çš„ä¸­è½¬æš´éœ²åˆ°å…¬ç½‘ã€‚</p><p>frpæ˜¯é‡‡ç”¨goè¯­è¨€ç¼–å†™çš„å¼€æºå·¥å…·ï¼Œgoä¿è¯äº†é«˜æ•ˆç‡ï¼Œå¼€æºä¿è¯äº†å·¥å…·æ²¡æœ‰å¤¹å¸¦ç§è´§ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p><p>é¦–å…ˆé™„ä¸Šfrpå·¥å…·çš„ä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/fatedier/frp/releases">https://github.com/fatedier/frp/releases</a></p><p>frpå·¥å…·æœ‰å¾ˆå¤šç§åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­ä»‹ç»æœ€åŸºæœ¬çš„ç«¯å£è½¬å‘éƒ¨åˆ†çš„åŠŸèƒ½ã€‚</p><p>frpé‡‡ç”¨CSæ¨¡å¼ï¼Œéœ€è¦åœ¨å…·æœ‰å…¬ç½‘IPçš„èŠ‚ç‚¹ä¸Šè®¾ç½®æœåŠ¡ç«¯ï¼Œåœ¨éœ€è¦è¿›è¡Œè½¬å‘çš„æœºå™¨ä¸Šè®¾ç½®å®¢æˆ·ç«¯ã€‚</p><p>å·¥å…·çš„å®‰è£…éƒ¨ç½²ä¹Ÿæä¸ºä¾¿æ·ï¼Œç›´æ¥è§£å‹å‹ç¼©åŒ…ä¾¿å¯ä»¥è·å¾—å¦‚ä¸‹æ–‡ä»¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310127255.png" alt="image-20210908224239220"></p><p>æ–‡ä»¶éå¸¸æ¸…æ™°ï¼Œ<code>frpc</code>è¡¨ç¤ºå®¢æˆ·ç«¯ï¼Œ<code>frpc.ini</code>è¡¨ç¤ºå®¢æˆ·ç«¯é…ç½®ï¼›<code>frps</code>è¡¨ç¤ºæœåŠ¡ç«¯ï¼Œ<code>frps.ini</code>è¡¨ç¤ºæœåŠ¡ç«¯é…ç½®ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ç”¨äºç«¯å£è½¬å‘çš„æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„é…ç½®é¡¹ã€‚</p><h3 id="frpæœåŠ¡ç«¯é…ç½®"><a href="#frpæœåŠ¡ç«¯é…ç½®" class="headerlink" title="frpæœåŠ¡ç«¯é…ç½®"></a>frpæœåŠ¡ç«¯é…ç½®</h3><p>æœåŠ¡ç«¯é…ç½®daemoå¦‚ä¸‹ï¼Œå®ç°åŸºæœ¬åŠŸèƒ½éœ€è¦é…ç½®çš„å†…å®¹éå¸¸å°‘ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="attr">authentication_method</span> = token</span><br><span class="line"><span class="attr">authenticate_heartbeats</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">authenticate_new_work_conns</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">token</span> = ^EJSNkz4MLMJC6W!TyLhmNwJ3k3Hk833cmzBNU2ZasD3dja4*Bf</span><br><span class="line"></span><br><span class="line"><span class="attr">log_file</span> = /opt/frp_0.<span class="number">37.0</span>_linux_amd64/log/frps.log</span><br><span class="line"><span class="attr">log_level</span> = debug</span><br><span class="line"><span class="attr">log_max_days</span> = <span class="number">7</span></span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘çš„é…ç½®æ–‡ä»¶ä¸­ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>åŸºæœ¬é…ç½®</p><p>åœ¨è¿™é¡¹é…ç½®ä¸­ï¼Œé…ç½®**<code>frp</code>æœåŠ¡ç«¯ç›‘å¬çš„ç«¯å£**ï¼Œè¿™ä¸ªç«¯å£æ˜¯ç”¨æ¥ä¸frpå®¢æˆ·ç«¯è¿›è¡Œé“¾æ¥çš„ï¼Œä¸æˆ‘ä»¬åç»­è¦è½¬å‘çš„æœåŠ¡æ— å…³ã€‚è¿™ä¸€é¡¹ä¸€å®šè¦æœ‰ï¼Œä¸ç„¶å®¢æˆ·ç«¯ä¹Ÿä¸çŸ¥é“é“¾æ¥è°ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bind_port</span> = <span class="number">1234</span></span><br></pre></td></tr></table></figure></li><li><p>å®‰å…¨é…ç½®</p><p>è¿™ä¸€é¡¹é…ç½®ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½†æ˜¯æ¨èé…ç½®ã€‚æ¯•ç«Ÿä½ ä¹Ÿä¸æƒ³é‚£è‡ªå·±çš„æœåŠ¡å™¨å»åšæ…ˆå–„ï¼Œä¸»è¦ä»¥é˜²ä¸‡ä¸€ä½ çš„æœåŠ¡ç«¯frpæ³„éœ²ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">authentication_method</span> = token</span><br><span class="line"><span class="attr">authenticate_heartbeats</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">authenticate_new_work_conns</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">token</span> = ^EJSNkz4MLMJC6W!TyLhmNwJ3k3Hk833cmzBNU2ZasD3dja4*Bf</span><br></pre></td></tr></table></figure><p>å…¶ä¸­tokenæ¢æˆè‡ªå·±ç”Ÿæˆçš„ï¼Œå…¶ä½™ä¸‰é¡¹é…ç½®ä¸æˆ‘ç›¸åŒå³å¯ï¼Œé…ç½®é¡¹çš„æ„æ€å°±æ˜¯è‹±æ–‡çš„æ„æ€ï¼Œä¸ç”¨è¿‡å¤šè§£é‡Šäº†ã€‚</p></li><li><p>æ—¥å¿—é…ç½®</p><p>æ—¥å¿—é…ç½®æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œé…ç½®å³å¯ï¼Œä¹Ÿå¯ä»¥ä¸é…ç½®ï¼Œä¸»è¦ç”¨æ¥æŸ¥çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å¼‚å¸¸çš„é“¾æ¥æˆ–æŸ¥çœ‹bugç­‰æƒ…å†µä½¿ç”¨ã€‚</p><p><code>log_file</code>é»˜è®¤æ˜¯<code>./frps.log</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log_file</span> = /opt/frp_0.<span class="number">37.0</span>_linux_amd64/log/frps.log</span><br><span class="line"><span class="attr">log_level</span> = debug</span><br><span class="line"><span class="attr">log_max_days</span> = <span class="number">7</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="frpå®¢æˆ·ç«¯é…ç½®"><a href="#frpå®¢æˆ·ç«¯é…ç½®" class="headerlink" title="frpå®¢æˆ·ç«¯é…ç½®"></a>frpå®¢æˆ·ç«¯é…ç½®</h3><p>å®¢æˆ·ç«¯çš„é…ç½®å†…å®¹ç¨å¾®å¤šä¸€ç‚¹ï¼Œå› ä¸ºæ¶‰åŠåˆ°æˆ‘ä»¬è¦è½¬å‘çš„æœåŠ¡çš„é…ç½®ã€‚æœåŠ¡ç«¯çš„é…ç½®daemonå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = test.cn</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="attr">token</span> = ^EJSNkz4MLMJC6W!TyLhmNwJ3k3Hk833cmzBNU2ZasD3dja4*Bf</span><br><span class="line"><span class="attr">authentication_method</span> = token</span><br><span class="line"><span class="attr">authenticate_heartbeats</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">authenticate_new_work_conns</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">user</span> = my_computer</span><br><span class="line"></span><br><span class="line"><span class="attr">log_file</span> = ./log/frpc.log</span><br><span class="line"><span class="attr">log_level</span> = debug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">[rdp]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">3389</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">3389</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥åˆ†ä¸º5ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>åŸºæœ¬é…ç½®</p><p>åœ¨åŸºæœ¬é…ç½®ä¸­ï¼Œéœ€è¦é…ç½®<code>frp</code>æœåŠ¡ç«¯çš„ipåœ°å€å’Œç«¯å£ï¼Œç«¯å£éœ€è¦ä¸æœåŠ¡ç«¯é…ç½®ä¸­<code>bind_port</code>ç›¸åŒã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server_addr</span> = test.cn</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">1234</span></span><br></pre></td></tr></table></figure></li><li><p>å®‰å…¨é…ç½®</p><p>å®‰å…¨é…ç½®éœ€è¦ä¸æœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½åº”ç›¸åŒã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">token</span> = ^EJSNkz4MLMJC6W!TyLhmNwJ3k3Hk833cmzBNU2ZasD3dja4*Bf</span><br><span class="line"><span class="attr">authentication_method</span> = token</span><br><span class="line"><span class="attr">authenticate_heartbeats</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">authenticate_new_work_conns</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><p>ç”¨æˆ·åé…ç½®</p><p>è¿™æ¡é…ç½®ä¿¡æ¯å…¶å®æ˜¯ç»™å¾…è½¬å‘ç«¯å£çš„æœåŠ¡åå¢åŠ äº†å‰ç¼€ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªå®¢æˆ·ç«¯å…±ç”¨åŒä¸€ä¸ªæœåŠ¡ç«¯çš„æƒ…å†µï¼Œé¿å…æœåŠ¡åç§°å†²çªã€‚</p><p>æ¯”å¦‚åœ¨æˆ‘ä»¬çš„é…ç½®ä¸­ï¼Œè¦è½¬å‘çš„<code>rdp</code>æœåŠ¡çš„å®Œæ•´æœåŠ¡åä¼šè‡ªåŠ¨æ‹¼æ¥ä¸º<code>my_computer.rdp</code>ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user</span> = my_computer</span><br></pre></td></tr></table></figure></li><li><p>æ—¥å¿—é…ç½®</p><p>æ—¥å¿—é…ç½®ä¸æœåŠ¡ç«¯çš„ä½œç”¨ç›¸åŒï¼Œæ ¹æ®éœ€è¦é€‰æ‹©é…ç½®å³å¯ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log_file</span> = ./log/frpc.log</span><br><span class="line"><span class="attr">log_level</span> = debug</span><br></pre></td></tr></table></figure></li><li><p>æœåŠ¡é…ç½®</p><p>éœ€è¦è½¬å‘çš„æœåŠ¡åœ¨è¿™é‡Œé…ç½®ï¼Œå…¶ä¸­<code>[rdp]</code>ä¸ºæœåŠ¡åï¼Œä¸­æ‹¬å·åŒ…èµ·æ¥çš„éƒ¨åˆ†å¯ä»¥è‡ªå®šä¹‰</p><p><code>type</code>è¡¨ç¤ºæœåŠ¡çš„é“¾æ¥ç±»å‹ï¼Œæˆ‘ä»¬ç”¨äºè½¬å‘è¿œç¨‹æ¡Œé¢æˆ–sshç«¯å£æ˜¯ä½¿ç”¨<code>tcp</code>ï¼Œå®Œæ•´çš„é€‰é¡¹å¯ä»¥å‚è€ƒ<a href="https://gofrp.org/docs/reference/proxy/#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">å®˜ç½‘è¯´æ˜</a>ã€‚</p><p><code>use_compression</code>è¡¨ç¤ºæ˜¯å¦å¯¹æ•°æ®è¿›è¡Œå‹ç¼©</p><p><code>local_ip</code>å’Œ<code>local_port</code>è¡¨ç¤ºè¿è¡Œ<code>frp</code>å®¢æˆ·ç«¯çš„æœºå™¨èƒ½å¤Ÿç›´æ¥è®¿é—®åˆ°çš„åœ°å€ï¼Œæ¯”å¦‚æˆ‘è¦è½¬å‘æœ¬æœºçš„è¿œç¨‹æ¡Œé¢ç«¯å£ï¼Œå°±æ˜¯å¦‚ä¸‹çš„é…ç½®ã€‚å¦‚æœæˆ‘è¦è½¬å‘æœ¬åœ°å±€åŸŸç½‘å†…çš„å…¶ä»–æœåŠ¡ï¼ŒæŒ‰ç…§å½“å‰æœºå™¨è®¿é—®æœåŠ¡çš„åœ°å€å’Œç«¯å£å¡«å†™å³å¯ã€‚</p><p><code>remote_port</code>è¡¨ç¤ºåœ¨**<code>frp</code>æœåŠ¡ç«¯<strong>ä¸Šç›‘å¬çš„ç«¯å£(ç”¨æ¥è®¿é—®å½“å‰æœåŠ¡ä½¿ç”¨)ã€‚åœ¨æˆ‘çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè®¿é—®<code>test.cn:2345</code>ä¹Ÿå°±ç›¸å½“äºè®¿é—®äº†</strong><code>frp</code>å®¢æˆ·ç«¯**çš„3389ç«¯å£ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[rdp]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">3389</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">2345</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="éƒ¨ç½²æ–¹å¼"><a href="#éƒ¨ç½²æ–¹å¼" class="headerlink" title="éƒ¨ç½²æ–¹å¼"></a>éƒ¨ç½²æ–¹å¼</h2><p>æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹åœ¨Windowsä¸Šä¸Linuxä¸Šå°†frpéƒ¨ç½²çš„æ–¹å¼ã€‚</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul><li><p>æ–¹å¼ä¸€</p><p>å¯ä»¥ç›´æ¥è¿è¡Œ<code>frpc.exe</code>ï¼Œä½†æ˜¯è¿™æ ·æ— æ³•åšåˆ°åå°è¿è¡Œï¼Œè€Œä¸”é‡å¯ä»¥åå°±æ²¡åŠæ³•è‡ªåŠ¨å¯åŠ¨ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨æ–¹å¼äºŒï¼Œå°†<code>frpc</code>ä½œä¸ºæœåŠ¡éƒ¨ç½²</p></li><li><p>æ–¹å¼äºŒ</p><p>ä¸ºäº†å°†<code>frpc.exe</code>ä½œä¸ºæœåŠ¡éƒ¨ç½²ï¼Œéœ€è¦å€ŸåŠ©<a href="https://github.com/winsw/winsw"><code>WinSW</code>å·¥å…·</a>ã€‚è¿™ä¸€å·¥å…·ä»…éœ€è¦ç®€å•çš„é…ç½®ä¾¿å¯ä»¥å°†è‡ªå·±çš„åº”ç”¨ä½œä¸ºwindowsæœåŠ¡ã€‚</p><p>å¯ä»¥ä»<a href="https://github.com/winsw/winsw/releases">https://github.com/winsw/winsw/releases</a>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„è½¯ä»¶(32ä½æˆ–64ä½)ã€‚</p><p><code>WinSW-x64.exe</code>æˆ–<code>WinSW-x32.exe</code>ä¸‹è½½å¥½ä»¥åï¼Œå°†è¯¥æ–‡ä»¶å‘½åæˆä½ å–œæ¬¢çš„åå­—ï¼Œæ¯”å¦‚<code>myapp.exe</code>ï¼ŒåŒæ—¶æ–°å»ºä¸€ä¸ªåŒåçš„xmlæ–‡ä»¶<code>myapp.xml</code>ã€‚</p><p>ç»§ç»­æœ¬æ–‡çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¤åˆ¶ä¸€ä¸‹å†…å®¹åˆ°xmlæ–‡ä»¶ä¸­ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- ID of the service. It should be unique across the Windows system--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>rdpforward<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Display name of the service --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>RDP Port Forward <span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Service description --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Forward Windows RDP Port<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Path to the executable, which should be started --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executable</span>&gt;</span>frp_0.37.0_windows_amd64\frpc.exe<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">arguments</span>&gt;</span>-c &quot;frp_0.37.0_windows_amd64\frpc.ini&quot;  <span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">startmode</span>&gt;</span>Automatic<span class="tag">&lt;/<span class="name">startmode</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;10 sec&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log</span> <span class="attr">mode</span>=<span class="string">&quot;reset&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­:</p><ul><li><p><code>&lt;id&gt;</code>åº”è¯¥ä¸ºç³»ç»ŸèŒƒå›´å†…ç‹¬ä¸€æ— äºŒçš„æ ‡è¯†ã€‚è‡ªå·±ç›´æ¥å†™å°±è¡Œï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šå’Œç³»ç»Ÿé‡Œçš„é‡å¤ã€‚</p></li><li><p><code>&lt;name&gt;</code>ä¸ºæœåŠ¡æ˜¾ç¤ºçš„åç§°ï¼Œæ¯”å¦‚åœ¨ä¸‹å›¾ä¸­æ˜¾ç¤ºå‡ºäº†æˆ‘è¿™ä¸ªæœåŠ¡çš„åç§°ã€‚</p></li><li><p><code>&lt;description&gt;</code>ä¸ºæœåŠ¡çš„æè¿°ï¼Œå’Œåç§°ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç»™è‡ªå·±çœ‹çš„ã€‚</p></li><li><p><code>&lt;executable&gt;</code>è¦æ‰§è¡Œç¨‹åºçš„è·¯å¾„ï¼Œè¿™é‡Œæˆ‘å†™çš„æ˜¯ç›¸å¯¹è·¯å¾„ã€‚</p></li><li><p><code>&lt;arguments&gt;</code>æ‰§è¡Œç¨‹åºçš„å‚æ•°ï¼Œå¯¹frpcæ¥è¯´ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸‹é…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚</p></li><li><p><code>&lt;startmode&gt;</code>å¯åŠ¨æ¨¡å¼ï¼Œæ˜¯å¦æ˜¯å¼€æœºè‡ªåŠ¨è¿è¡Œã€‚</p></li><li><p><code>&lt;onfailure&gt;</code>æœåŠ¡å¯åŠ¨å¤±è´¥æ—¶çš„åŠ¨ä½œã€‚</p></li><li><p><code>&lt;log&gt;</code>è®°å½•æ—¥å¿—çš„æ¨¡å¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310127247.png" alt="image-20210908232555264"></p></li></ul><p>é…ç½®å®Œæˆåï¼Œåœ¨<code>myapp.exe</code>æ‰€åœ¨çš„ç›®å½•ç›´æ¥è¾“å…¥<code>cmd .</code>ï¼ˆæ³¨æ„æœ‰ä¸ªç©ºæ ¼ å’Œç‚¹ï¼‰ç›´æ¥æ‰“å¼€cmdçª—å£ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310127398.png" alt="image-20210908233045415"></p><p>ç„¶åæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myapp.exe install</span><br><span class="line">myapp.exe start</span><br><span class="line"><span class="comment"># å¦‚æœæƒ³åˆ é™¤åˆ™æ˜¯</span></span><br><span class="line">myapp.exe stop</span><br><span class="line">myapp.exe uninstall</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒWindowsä¸ŠæœåŠ¡éƒ¨ç½²å®Œæˆã€‚</p></li></ul><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>åœ¨Linuxä¸Šéƒ¨ç½²æœåŠ¡é€šå¸¸æ˜¯frpæœåŠ¡ç«¯ï¼Œä¸‹é¢ä»¥éƒ¨ç½²æœåŠ¡ç«¯ä¸ºä¾‹è¯´æ˜ï¼Œå®¢æˆ·ç«¯åŒç†ã€‚</p><p><code>frp</code>å·¥å…·éå¸¸è´´å¿ƒçš„å·²ç»å¸¦äº†æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼ˆä½äº<code>frp</code>çš„<code>systemd</code>æ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼Œæˆ‘ä»¬ä»…éœ€è¦åšä¸€äº›ä¿®æ”¹å°±å¥½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Frp Server Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=nobody</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5s</span><br><span class="line">ExecStart=/usr/bin/frps -c /etc/frp/frps.ini</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>å°†å…¶ä¸­çš„<code>ExecStart</code>çš„å†…å®¹æŒ‰ç…§å®é™…æ”¾ç½®çš„ä½ç½®å¡«å†™å°±å¥½ã€‚</p><p><code>User</code>æ ¹æ®å®é™…æƒ…å†µå†™ï¼Œä¹Ÿå¯ä»¥ä¸å†™ã€‚</p><p>æˆ‘çš„é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Frp server daemon</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">WorkingDirectory=/opt/frp_0.37.0_linux_amd64</span><br><span class="line">ExecStart=/opt/frp_0.37.0_linux_amd64/frps -c /opt/frp_0.37.0_linux_amd64/frps.ini</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>ç„¶åå°†æ–‡ä»¶å‘½åä¸º<code>frps.service</code>ï¼Œæ‰©å±•åä¸ºserviceå³å¯ã€‚</p><p>ç„¶åå°†æ–‡ä»¶copyè‡³<code>/etc/systemd/system/</code>ä¸­ã€‚</p><p>è¿è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">systemctl start frps</span><br><span class="line"><span class="comment"># å¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl <span class="built_in">enable</span> frps</span><br><span class="line"><span class="comment"># å–æ¶ˆå¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl <span class="built_in">disable</span> frps</span><br><span class="line"><span class="comment"># åœæ­¢æœåŠ¡</span></span><br><span class="line">systemctl stop frps</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://gofrp.org/">frpä¸­æ–‡å®˜ç½‘</a></li><li><a href="https://github.com/winsw/winsw">WinSW</a></li></ul><p>å¥½äº†ï¼Œå‰©ä¸‹çš„åŠŸèƒ½å¤§å®¶å¯ä»¥è‡ªè¡Œæ¢ç´¢ï¼Œåˆ«å¹²ä»€ä¹ˆè§¦ç¢°é«˜å‹çº¿çš„äº‹å°±è¡Œå“ˆ</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SSH </tag>
            
            <tag> è½¬å‘ </tag>
            
            <tag> éš§é“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¸¸ç”¨å·¥å…·ç±»æ€»ç»“(æŒç»­æ›´æ–°)</title>
      <link href="/2021/828bfc98/"/>
      <url>/2021/828bfc98/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Java SPIæœºåˆ¶ç®€å•ä»‹ç»</title>
      <link href="/2021/3ee22ef9/"/>
      <url>/2021/3ee22ef9/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-SPIæœºåˆ¶ç®€å•ä»‹ç»"><a href="#Java-SPIæœºåˆ¶ç®€å•ä»‹ç»" class="headerlink" title="Java SPIæœºåˆ¶ç®€å•ä»‹ç»"></a>Java SPIæœºåˆ¶ç®€å•ä»‹ç»</h1>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Java </tag>
            
            <tag> SPI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ClickHouseåˆ†å¸ƒå¼è¡¨ä»‹ç»</title>
      <link href="/2021/e20ce22c/"/>
      <url>/2021/e20ce22c/</url>
      
        <content type="html"><![CDATA[<h1 id="ClickHouseåˆ†å¸ƒå¼è¡¨ä»‹ç»"><a href="#ClickHouseåˆ†å¸ƒå¼è¡¨ä»‹ç»" class="headerlink" title="ClickHouseåˆ†å¸ƒå¼è¡¨ä»‹ç»"></a>ClickHouseåˆ†å¸ƒå¼è¡¨ä»‹ç»</h1><p>ClickHouseä¸­çš„åˆ†å¸ƒå¼è¡¨ï¼Œæœ¬èº«å¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯è¦ä¾èµ–ä¸€äº›æœ¬åœ°è¡¨</p><p>åœ¨è¿›è¡Œåˆ†å¸ƒå¼è¡¨åˆ›å»ºæ—¶å…¶å®æ˜¯æŒ‡å®šçš„åˆ›å»ºè¡¨çš„å¼•æ“ä¸ºDistributed</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> events <span class="keyword">ON</span> CLUSTER test_cluster</span><br><span class="line"><span class="keyword">AS</span> events</span><br><span class="line">ENGINE <span class="operator">=</span> Distributed(test_cluster,test,events_local,rand());</span><br></pre></td></tr></table></figure><p>Distributedå¼•æ“éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š</p><ul><li>é›†ç¾¤æ ‡è¯†ç¬¦<br> æ³¨æ„ä¸æ˜¯å¤åˆ¶è¡¨å®ä¸­çš„æ ‡è¯†ç¬¦ï¼Œè€Œæ˜¯<remote_servers>ä¸­æŒ‡å®šçš„é‚£ä¸ªã€‚</li><li>æœ¬åœ°è¡¨æ‰€åœ¨çš„æ•°æ®åº“åç§°</li><li>æœ¬åœ°è¡¨åç§°</li><li>ï¼ˆå¯é€‰çš„ï¼‰åˆ†ç‰‡é”®ï¼ˆsharding keyï¼‰<br> è¯¥é”®ä¸config.xmlä¸­é…ç½®çš„åˆ†ç‰‡æƒé‡ï¼ˆweightï¼‰ä¸€åŒå†³å®šå†™å…¥åˆ†å¸ƒå¼è¡¨æ—¶çš„è·¯ç”±ï¼Œå³æ•°æ®æœ€ç»ˆè½åˆ°å“ªä¸ªç‰©ç†è¡¨ä¸Šã€‚å®ƒå¯ä»¥æ˜¯è¡¨ä¸­ä¸€åˆ—çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œå¦‚ä¸Šé¢çš„SQLè¯­å¥é‡‡ç”¨äº†éšæœºå€¼<code>rand()</code>ã€‚æ³¨æ„è¯¥é”®è¦å°½é‡ä¿è¯æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Œå¦å¤–ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œæ˜¯é‡‡ç”¨åŒºåˆ†åº¦è¾ƒé«˜çš„åˆ—çš„å“ˆå¸Œå€¼ã€‚</li></ul><p>åœ¨åˆ†å¸ƒå¼è¡¨ä¸Šæ‰§è¡ŒæŸ¥è¯¢çš„æµç¨‹ç®€å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚å‘å‡ºæŸ¥è¯¢åï¼Œå„ä¸ªå®ä¾‹ä¹‹é—´ä¼šäº¤æ¢è‡ªå·±æŒæœ‰çš„åˆ†ç‰‡çš„è¡¨æ•°æ®ï¼Œæœ€ç»ˆæ±‡æ€»åˆ°åŒä¸€ä¸ªå®ä¾‹ä¸Šè¿”å›ç»™ç”¨æˆ·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310129328.webp" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> ClickHouse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> ClickHouse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MongoDBæ•°æ®åº“å‰¯æœ¬é›†åŠåˆ†ç‰‡é›†ç¾¤ä»‹ç»</title>
      <link href="/2021/e385259a/"/>
      <url>/2021/e385259a/</url>
      
        <content type="html"><![CDATA[<h1 id="MongoDBæ•°æ®åº“å‰¯æœ¬é›†åŠåˆ†ç‰‡é›†ç¾¤ä»‹ç»"><a href="#MongoDBæ•°æ®åº“å‰¯æœ¬é›†åŠåˆ†ç‰‡é›†ç¾¤ä»‹ç»" class="headerlink" title="MongoDBæ•°æ®åº“å‰¯æœ¬é›†åŠåˆ†ç‰‡é›†ç¾¤ä»‹ç»"></a>MongoDBæ•°æ®åº“å‰¯æœ¬é›†åŠåˆ†ç‰‡é›†ç¾¤ä»‹ç»</h1><h2 id="MongoDBæ ¸å¿ƒæ¦‚å¿µ"><a href="#MongoDBæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="MongoDBæ ¸å¿ƒæ¦‚å¿µ"></a>MongoDBæ ¸å¿ƒæ¦‚å¿µ</h2><ul><li><p><a href="https://docs.mongodb.com/manual/introduction/#document-database">Document</a>ï¼š</p><p>MongoDBä¸­çš„æ•°æ®è®°å½•å°±æ˜¯ä¸€ä¸ªDocumentï¼ŒDocumentçš„ç»“æ„ä¸JSONæ¯”è¾ƒç±»ä¼¼ï¼›</p><p>documentå¯ä»¥åµŒå¥—</p><p><img src="https://docs.mongodb.com/manual/images/crud-annotated-document.bakedsvg.svg"></p></li><li><p><a href="https://docs.mongodb.com/manual/core/databases-and-collections/#collections">Collection</a>:</p><p>MongoDBçš„Documentå­˜å‚¨åœ¨collectionä¸­ï¼Œcollectionçš„æ¦‚å¿µä¸å…³ç³»å‹æ•°æ®åº“ä¸­è¡¨çš„æ¦‚å¿µç›¸å¯¹åº”</p><p><img src="https://docs.mongodb.com/manual/images/crud-annotated-collection.bakedsvg.svg"></p></li><li><p><a href="https://docs.mongodb.com/manual/core/databases-and-collections/#databases">Database</a>ï¼š</p><p>Databaseå¯ä»¥åŒ…å«å¤šä¸ªcollection</p></li></ul><h2 id="å‰¯æœ¬é›†Replica-Set"><a href="#å‰¯æœ¬é›†Replica-Set" class="headerlink" title="å‰¯æœ¬é›†Replica Set"></a>å‰¯æœ¬é›†Replica Set</h2><p>å‰¯æœ¬é›†ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ç€ç›¸åŒçš„æ•°æ®ï¼Œå‰¯æœ¬é›†çš„å­˜åœ¨æ˜¯ä¸ºäº†æä¾›æ•°æ®å†—ä½™ï¼Œæä¾›é«˜å¯ç”¨</p><p>å‰¯æœ¬é›†åŒ…å«å¤šä¸ªæ•°æ®æ‰¿è½½èŠ‚ç‚¹å’Œä¸€ä¸ªå¯é€‰çš„ä»²è£èŠ‚ç‚¹ï¼›åœ¨æ•°æ®æ‰¿è½½èŠ‚ç‚¹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹è¢«è§†ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–çš„æ•°æ®æ‰¿è½½èŠ‚ç‚¹è¢«è§†ä¸ºå¤‡ä»½èŠ‚ç‚¹</p><p>ä¸»èŠ‚ç‚¹æ¥æ”¶æ‰€æœ‰å†™æ“ä½œï¼Œä¸»èŠ‚ç‚¹è®°å½•æ‰€æœ‰å¯¹æ•°æ®é›†çš„æ›´æ”¹ï¼Œå°†å…¶ä½œä¸ºoplogã€‚</p><p><img src="https://docs.mongodb.com/manual/images/replica-set-read-write-operations-primary.bakedsvg.svg"></p><p>å¤‡ä»½èŠ‚ç‚¹é‡å¤ä¸»èŠ‚ç‚¹çš„oplogï¼Œå¹¶å°†å…¶ä¸­çš„æ“ä½œåº”ç”¨åœ¨å¤‡ä»½èŠ‚ç‚¹çš„æ•°æ®ä¸­ï¼Œä»è€Œä¸ä¸»èŠ‚ç‚¹ä¹‹é—´å½¢æˆåŒæ­¥ã€‚å¦‚æœä¸»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œæœ‰èµ„æ ¼çš„å¤‡ä»½èŠ‚ç‚¹å°†ä¼šé€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</p><h2 id="åˆ†ç‰‡é›†ç¾¤"><a href="#åˆ†ç‰‡é›†ç¾¤" class="headerlink" title="åˆ†ç‰‡é›†ç¾¤"></a>åˆ†ç‰‡é›†ç¾¤</h2><p>åˆ†ç‰‡çš„ä½œç”¨æ˜¯å°†æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªæœºå™¨ä¸Šï¼ŒMongoDBä½¿ç”¨åˆ†ç‰‡æ”¯æŒéƒ¨ç½²è¶…å¤§è§„æ¨¡çš„æ•°æ®ï¼Œå¹¶æä¾›é«˜ååã€‚</p><p>MongoDBçš„åˆ†ç‰‡é›†ç¾¤åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li><p><a href="https://docs.mongodb.com/manual/core/sharded-cluster-shards/">åˆ†ç‰‡shard</a></p><p>æ¯ä¸ªåˆ†ç‰‡æ˜¯åˆ†ç‰‡æ•°æ®çš„è‡ªå·±ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½å¯ä»¥éƒ¨ç½²ä¸ºä¸€ä¸ªreplica set</p></li><li><p><a href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/">è·¯ç”±mongos</a></p><p><code>mongos</code>ä½œä¸ºä¸€ä¸ªæŸ¥è¯¢çš„è·¯ç”±ï¼Œä½œä¸ºç”¨æˆ·æŸ¥è¯¢MongoDBåˆ†ç‰‡é›†ç¾¤çš„å…¥å£</p></li><li><p><a href="https://docs.mongodb.com/manual/core/sharded-cluster-config-servers/">é…ç½®æœåŠ¡å™¨config servers</a></p><p>é…ç½®æœåŠ¡å™¨å­˜æ”¾äº†é›†ç¾¤çš„å…ƒæ•°æ®å’Œé…ç½®è®¾ç½®</p></li></ul><p><img src="https://docs.mongodb.com/manual/images/sharded-cluster-production-architecture.bakedsvg.svg"></p><p>MongoDBçš„å°†æ•°æ®åœ¨collectionçº§åˆ«åˆ†ç‰‡ï¼Œ å°†collectionæ•°æ®åˆ†å¸ƒåœ¨é›†ç¾¤çš„shardsä¹‹é—´ã€‚</p><p>ç”¨æˆ·åœ¨ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤ä¸éåˆ†ç‰‡é›†ç¾¤çš„MongoDBæ—¶ï¼Œåœ¨ä½¿ç”¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œé€šè¿‡å®¢æˆ·ç«¯å’Œmongouriå³å¯è®¿é—®ï¼›</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MongoDB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MongoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºDebeziumçš„Flink-MySQL-CDCæºç åˆ†æ</title>
      <link href="/2021/102c449e/"/>
      <url>/2021/102c449e/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºäºDebeziumçš„Flink-MySQL-CDCæºç åˆ†æ"><a href="#åŸºäºDebeziumçš„Flink-MySQL-CDCæºç åˆ†æ" class="headerlink" title="åŸºäºDebeziumçš„Flink-MySQL-CDCæºç åˆ†æ"></a>åŸºäºDebeziumçš„Flink-MySQL-CDCæºç åˆ†æ</h1>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
          <category> æµå¤„ç† </category>
          
          <category> Flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flink </tag>
            
            <tag> æµå¤„ç† </tag>
            
            <tag> å¤§æ•°æ® </tag>
            
            <tag> æºç  </tag>
            
            <tag> CDC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flink HiveSinkæºç åˆ†æ</title>
      <link href="/2021/26c0fffa/"/>
      <url>/2021/26c0fffa/</url>
      
        <content type="html"><![CDATA[<h1 id="Flink-HiveSinkæºç åˆ†æ"><a href="#Flink-HiveSinkæºç åˆ†æ" class="headerlink" title="Flink HiveSinkæºç åˆ†æ"></a>Flink HiveSinkæºç åˆ†æ</h1>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
          <category> æµå¤„ç† </category>
          
          <category> Flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flink </tag>
            
            <tag> æµå¤„ç† </tag>
            
            <tag> å¤§æ•°æ® </tag>
            
            <tag> æºç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flink StreamingFileSinkæºç åˆ†æ</title>
      <link href="/2021/6a92d281/"/>
      <url>/2021/6a92d281/</url>
      
        <content type="html"><![CDATA[<h1 id="Flink-StreamingFileSinkæºç åˆ†æ"><a href="#Flink-StreamingFileSinkæºç åˆ†æ" class="headerlink" title="Flink StreamingFileSinkæºç åˆ†æ"></a>Flink StreamingFileSinkæºç åˆ†æ</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><code>org.apache.flink.streaming.api.functions.sink.filesystem.StreamingFileSink</code></p><p>Flinkä¸­çš„<code>StreamingFileSink</code>æ˜¯ç”¨æ¥å°†æµå¼æ•°æ®å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„Sinkã€‚åœ¨<code>StreamingFileSink</code>ä¸­ä¼šå°†æ•°æ®é¦–å…ˆå‘é€åˆ°bucketä¸­ï¼Œbucketä¸å­˜å‚¨ç›®å½•ç›¸å…³ï¼Œç„¶åä¸Checkpointæœºåˆ¶é…åˆæ¥è¾¾åˆ°ç²¾å‡†ä¸€æ¬¡çš„è¯­ä¹‰ã€‚</p><p>å…¶ä¸­<code>BucketAssigner</code>ç”¨æ¥å®šä¹‰å¦‚ä½•å°†å…ƒç´ å†™å…¥å“ªäº›ç›®å½•ä¸­ï¼Œé»˜è®¤çš„BucketAssignerå®ç°æ˜¯DataTimeBucketAssignerï¼Œæ¯ä¸ªå°æ—¶ä¼šåˆ›å»ºä¸€ä¸ªbucketã€‚</p><p>åœ¨å†™å…¥æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶æœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>in-progress</code>ï¼Œ<code>pending</code>ï¼Œ<code>finished</code>ï¼Œè¿™æ˜¯ä¸ºäº†æä¾›å¯¹ç²¾å‡†ä¸€æ¬¡è¯­ä¹‰çš„ä¿è¯ï¼Œæ–°æ¥çš„æ•°æ®ä¼šé¦–å…ˆå†™å…¥åˆ°<code>in-progress</code>æ–‡ä»¶ä¸­ï¼Œå½“é€šè¿‡ç”¨æˆ·å®šä¹‰çš„RollingPolicyè§¦å‘äº†æ–‡ä»¶çš„å…³é—­æ¡ä»¶æ—¶(æ¯”å¦‚æ–‡ä»¶å¤§å°)ï¼Œä¼šå…³é—­in-progressæ–‡ä»¶ï¼Œå¹¶å‘ä¸€ä¸ªæ–°çš„<code>in-progress</code>æ–‡ä»¶ä¸­ç»§ç»­å†™æ•°æ®ã€‚ç›´åˆ°æ”¶åˆ°CheckpointæˆåŠŸçš„ä¿¡æ¯æ—¶ï¼Œä¼šå°†<code>pending</code>çš„æ–‡ä»¶è½¬æ¢ä¸º<code>finished</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131203.png"></p><h2 id="æºç åˆ†æ-Base-Flink-1-12-3"><a href="#æºç åˆ†æ-Base-Flink-1-12-3" class="headerlink" title="æºç åˆ†æ(Base Flink-1.12.3)"></a>æºç åˆ†æ(Base Flink-1.12.3)</h2><h3 id="StreamingFileSinkå·¥ä½œæµç¨‹"><a href="#StreamingFileSinkå·¥ä½œæµç¨‹" class="headerlink" title="StreamingFileSinkå·¥ä½œæµç¨‹"></a>StreamingFileSinkå·¥ä½œæµç¨‹</h3><h4 id="å®ä¾‹åˆ›å»º"><a href="#å®ä¾‹åˆ›å»º" class="headerlink" title="å®ä¾‹åˆ›å»º"></a>å®ä¾‹åˆ›å»º</h4><p>é¦–å…ˆåˆ†æ<code>StreamingFileSink</code>æ•´ä½“å·¥ä½œæµç¨‹ï¼Œä¸‹æ–‡æ‘˜å½•ä¸»è¦æºç è¿›è¡Œè¯´æ˜ã€‚</p><p><code>StreamingFileSink</code>ç»§æ‰¿è‡ª<code>RichSinkFunction</code>ï¼Œå¹¶ä¸”å®ç°äº†ä¸checkpointç›¸å…³çš„ä¸¤ä¸ªæ¥å£(ä¸Checkpointæœ‰å…³çš„åŠŸèƒ½åœ¨ä¸‹é¢é€æ­¥æåŠ)ã€‚</p><p>æ„é€ å‡½æ•°æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamingFileSink</span>&lt;IN&gt; <span class="keyword">extends</span> <span class="title class_">RichSinkFunction</span>&lt;IN&gt; <span class="keyword">implements</span> <span class="title class_">CheckpointedFunction</span>, CheckpointListener&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">     <span class="comment">// StreamingFileSinkæ„é€ å‡½æ•°</span></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new &#123;<span class="doctag">@code</span> StreamingFileSink&#125; that writes files to the given base directory with</span></span><br><span class="line"><span class="comment">     * the give buckets properties.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">StreamingFileSink</span><span class="params">(BucketsBuilder&lt;IN, ?, ? extends BucketsBuilder&lt;IN, ?, ?&gt;&gt; bucketsBuilder,</span></span><br><span class="line"><span class="params">            <span class="type">long</span> bucketCheckInterval)</span> &#123;</span><br><span class="line">        Preconditions.checkArgument(bucketCheckInterval &gt; <span class="number">0L</span>);</span><br><span class="line">        <span class="built_in">this</span>.bucketsBuilder = Preconditions.checkNotNull(bucketsBuilder);</span><br><span class="line">        <span class="built_in">this</span>.bucketCheckInterval = bucketCheckInterval;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p><code>StreamingFileSink</code>çš„æ„é€ å‡½æ•°çš„è®¿é—®ä¿®é¥°ç¬¦æ˜¯<code>protected</code>ï¼Œéœ€è¦é€šè¿‡ä¸¤ä¸ªBuilderæ–¹æ³•æ–°å»ºå®ä¾‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131546.png" alt="image-20210704233834035"></p><p>è€Œä¸”è¿™ä¸¤ä¸ªBuilderå‡ç»§æ‰¿è‡ª<code>StreamingFileSink</code>çš„å†…éƒ¨æŠ½è±¡ç±»<code>BucketsBuilder</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131650.png" alt="image-20210705000231492"></p><p>è¿™ä¸¤ä¸ªç±»çš„å®ä¾‹åŒ–æ˜¯é€šè¿‡<code>StreamingFileSink</code>ä¸­çš„ä¸¤ä¸ªé™æ€æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates the builder for a &#123;<span class="doctag">@link</span> StreamingFileSink&#125; with row-encoding format.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> basePath the base path where all the buckets are going to be created as</span></span><br><span class="line"><span class="comment"> *     sub-directories.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> encoder the &#123;<span class="doctag">@link</span> Encoder&#125; to be used when writing elements in the buckets.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;IN&gt; the type of incoming elements</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The builder where the remaining of the configuration parameters for the sink can be</span></span><br><span class="line"><span class="comment"> *     configured. In order to instantiate the sink, call &#123;<span class="doctag">@link</span> RowFormatBuilder#build()&#125; after</span></span><br><span class="line"><span class="comment"> *     specifying the desired parameters.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;IN&gt; StreamingFileSink.DefaultRowFormatBuilder&lt;IN&gt; <span class="title function_">forRowFormat</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="keyword">final</span> Path basePath, <span class="keyword">final</span> Encoder&lt;IN&gt; encoder)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultRowFormatBuilder</span>&lt;&gt;(basePath, encoder, <span class="keyword">new</span> <span class="title class_">DateTimeBucketAssigner</span>&lt;&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates the builder for a &#123;<span class="doctag">@link</span> StreamingFileSink&#125; with bulk-encoding format.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> basePath the base path where all the buckets are going to be created as</span></span><br><span class="line"><span class="comment"> *     sub-directories.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> writerFactory the &#123;<span class="doctag">@link</span> BulkWriter.Factory&#125; to be used when writing elements in the</span></span><br><span class="line"><span class="comment"> *     buckets.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;IN&gt; the type of incoming elements</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The builder where the remaining of the configuration parameters for the sink can be</span></span><br><span class="line"><span class="comment"> *     configured. In order to instantiate the sink, call &#123;<span class="doctag">@link</span> BulkFormatBuilder#build()&#125;</span></span><br><span class="line"><span class="comment"> *     after specifying the desired parameters.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;IN&gt; StreamingFileSink.DefaultBulkFormatBuilder&lt;IN&gt; <span class="title function_">forBulkFormat</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="keyword">final</span> Path basePath, <span class="keyword">final</span> BulkWriter.Factory&lt;IN&gt; writerFactory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StreamingFileSink</span>.DefaultBulkFormatBuilder&lt;&gt;(</span><br><span class="line">            basePath, writerFactory, <span class="keyword">new</span> <span class="title class_">DateTimeBucketAssigner</span>&lt;&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="çŠ¶æ€åˆå§‹åŒ–ä¸æ•°æ®æ¶ˆè´¹"><a href="#çŠ¶æ€åˆå§‹åŒ–ä¸æ•°æ®æ¶ˆè´¹" class="headerlink" title="çŠ¶æ€åˆå§‹åŒ–ä¸æ•°æ®æ¶ˆè´¹"></a>çŠ¶æ€åˆå§‹åŒ–ä¸æ•°æ®æ¶ˆè´¹</h4><p>çŠ¶æ€åˆå§‹åŒ–æ—¶ä¼šåˆ›å»º<code>StreamingFileSinkHelper</code>ï¼Œè¿™ä¸ª<code>StreamingFileSinkHelper</code>åŸºæœ¬ä¸ŠåŒ…å«äº†æ‰€æœ‰çš„çŠ¶æ€ã€æ•°æ®æ¶ˆè´¹çš„è¡Œä¸ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StreamingFileSinkä¸­å®ç°çš„ä¸sinkä»¥åŠcheckpointç›¸å…³çš„methods</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializeState</span><span class="params">(FunctionInitializationContext context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">this</span>.helper =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StreamingFileSinkHelper</span>&lt;&gt;(</span><br><span class="line">                        bucketsBuilder.createBuckets(getRuntimeContext().getIndexOfThisSubtask()),</span><br><span class="line">                        context.isRestored(),</span><br><span class="line">                        context.getOperatorStateStore(),</span><br><span class="line">                        ((StreamingRuntimeContext) getRuntimeContext()).getProcessingTimeService(),</span><br><span class="line">                        bucketCheckInterval);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyCheckpointComplete</span><span class="params">(<span class="type">long</span> checkpointId)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">this</span>.helper.commitUpToCheckpoint(checkpointId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyCheckpointAborted</span><span class="params">(<span class="type">long</span> checkpointId)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">snapshotState</span><span class="params">(FunctionSnapshotContext context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Preconditions.checkState(helper != <span class="literal">null</span>, <span class="string">&quot;sink has not been initialized&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.helper.snapshotState(context.getCheckpointId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(IN value, SinkFunction.Context context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">this</span>.helper.onElement(</span><br><span class="line">                value,</span><br><span class="line">                context.currentProcessingTime(),</span><br><span class="line">                context.timestamp(),</span><br><span class="line">                context.currentWatermark());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.helper != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.helper.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ•°æ®æ¶ˆè´¹çš„æ—¶åºå›¾åŠå…¶è¯´æ˜å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131187.png"></p><p>è¿›è¡Œæ•°æ®æ¶ˆè´¹æ—¶ï¼Œä¸»è¦çš„æ­¥éª¤æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li><p>ä¼šè°ƒç”¨<code>buckets</code>çš„<code>onElement</code>æ–¹æ³•æ¥è¿›è¡Œå†™æ•°æ®ä¹‹å‰çš„ä¸€äº›çŠ¶æ€æ›´æ–°å’Œ<code>bucket</code>çš„æ£€æŸ¥ï¼Œæ£€æŸ¥<code>bucket</code>æ‰€å¯¹åº”çš„ç›®å½•ï¼Œè¿™éƒ¨åˆ†çš„ä»£ç ä¸»è¦æ˜¯<code>org.apache.flink.streaming.api.functions.sink.filesystem.Buckets#getOrCreateBucketForBucketId</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Bucket&lt;IN, BucketID&gt; <span class="title function_">getOrCreateBucketForBucketId</span><span class="params">(<span class="keyword">final</span> BucketID bucketId)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    Bucket&lt;IN, BucketID&gt; bucket = activeBuckets.get(bucketId); <span class="comment">// æ ¹æ®bucketidæ£€æŸ¥ä¸€ä¸‹ä¹‹å‰æ˜¯å¦åˆ›å»ºè¿‡bucket</span></span><br><span class="line">    <span class="keyword">if</span> (bucket == <span class="literal">null</span>) &#123; <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„bucket</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Path</span> <span class="variable">bucketPath</span> <span class="operator">=</span> assembleBucketPath(bucketId);</span><br><span class="line">        bucket =</span><br><span class="line">                bucketFactory.getNewBucket(</span><br><span class="line">                        subtaskIndex,</span><br><span class="line">                        bucketId,</span><br><span class="line">                        bucketPath,</span><br><span class="line">                        maxPartCounter,</span><br><span class="line">                        bucketWriter,</span><br><span class="line">                        rollingPolicy,</span><br><span class="line">                        fileLifeCycleListener,</span><br><span class="line">                        outputFileConfig);</span><br><span class="line">        activeBuckets.put(bucketId, bucket);</span><br><span class="line">        notifyBucketCreate(bucket);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bucket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>bucket</code>æ£€æŸ¥å®Œæˆåè°ƒç”¨bucketçš„<code>write</code>æ–¹æ³•ï¼Œå³<code>org.apache.flink.streaming.api.functions.sink.filesystem.Bucket#write</code>ï¼Œåœ¨<code>write</code>æ–¹æ³•ä¸­ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦è§¦å‘äº†rollingçš„æ¡ä»¶ï¼Œå¦‚æœè§¦å‘äº†rollingåˆ™å…³é—­å½“å‰æ–‡ä»¶ï¼Œå†æ–°å»ºä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼›ç„¶åå°†æ•°æ®å†™å…¥æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">write</span><span class="params">(IN element, <span class="type">long</span> currentTime)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (inProgressPart == <span class="literal">null</span> || rollingPolicy.shouldRollOnEvent(inProgressPart, element)) &#123;<span class="comment">// æ£€æŸ¥æ˜¯å¦è§¦å‘äº†éœ€è¦rollingçš„æ¡ä»¶</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (LOG.isDebugEnabled()) &#123;</span><br><span class="line">            LOG.debug(</span><br><span class="line">                    <span class="string">&quot;Subtask &#123;&#125; closing in-progress part file for bucket id=&#123;&#125; due to element &#123;&#125;.&quot;</span>,</span><br><span class="line">                    subtaskIndex,</span><br><span class="line">                    bucketId,</span><br><span class="line">                    element);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        inProgressPart = rollPartFile(currentTime);</span><br><span class="line">    &#125;</span><br><span class="line">    inProgressPart.write(element, currentTime); <span class="comment">// å‘in-progressæ–‡ä»¶ä¸­å†™æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>org.apache.flink.streaming.api.functions.sink.filesystem.Bucket#rollPartFile</code>æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œçš„<code>org.apache.flink.streaming.api.functions.sink.filesystem.Bucket#closePartFile</code>æ–¹æ³•ï¼Œä¼šå°†å½“å‰å…³é—­çš„in-progressæ–‡ä»¶å­˜å…¥çŠ¶æ€ä¸­ï¼Œç­‰å¾…checkpointæ—¶ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> InProgressFileWriter.PendingFileRecoverable <span class="title function_">closePartFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    InProgressFileWriter.<span class="type">PendingFileRecoverable</span> <span class="variable">pendingFileRecoverable</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (inProgressPart != <span class="literal">null</span>) &#123;</span><br><span class="line">        pendingFileRecoverable = inProgressPart.closeForCommit();</span><br><span class="line">        <span class="comment">// å°†æ–‡ä»¶å…³é—­ã€‚å¤„äºå½“å‰checkpointidæ—¶ï¼Œè¯¥çŠ¶æ€ä¼šä¿å­˜æ‰€æœ‰å…³é—­çš„in-progressæ–‡ä»¶ï¼Œå®é™…ä¸Šæ­¤æ—¶æ–‡ä»¶é€»è¾‘çŠ¶æ€å·²ç»è½¬æ¢ä¸ºpendingã€‚</span></span><br><span class="line">        pendingFileRecoverablesForCurrentCheckpoint.add(pendingFileRecoverable); </span><br><span class="line">        inProgressPart = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pendingFileRecoverable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="æ–‡ä»¶çŠ¶æ€è½¬æ¢ä¸checkpoint"><a href="#æ–‡ä»¶çŠ¶æ€è½¬æ¢ä¸checkpoint" class="headerlink" title="æ–‡ä»¶çŠ¶æ€è½¬æ¢ä¸checkpoint"></a>æ–‡ä»¶çŠ¶æ€è½¬æ¢ä¸checkpoint</h4><p>åœ¨è§¦å‘checkpointæ—¶æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å¸¸è§„è§¦å‘checkpointæ—¶æ‰§è¡Œçš„<code>snapshotState</code>æ–¹æ³•ï¼Œå¦ä¸€ä¸ªæ˜¯checkpointå®Œæˆæ—¶æ‰§è¡Œçš„å›è°ƒ<code>notifyCheckpointComplete</code></p><p>å› ä¸ºåœ¨å†™æ–‡ä»¶æ—¶éœ€è¦ä¸€è‡´æ€§çš„ä¿è¯ï¼Œæ‰€ä»¥é‡‡ç”¨è¿™ç§ä¸¤é˜¶æ®µæäº¤çš„æ–¹å¼ï¼Œåœ¨æ‰§è¡Œ<code>notifyCheckpointComplete</code>æ–¹æ³•åæ‰ä¼šçœŸæ­£çš„æäº¤å®Œæˆã€‚</p><h5 id="æ‰§è¡Œcheckpointé€»è¾‘"><a href="#æ‰§è¡Œcheckpointé€»è¾‘" class="headerlink" title="æ‰§è¡Œcheckpointé€»è¾‘"></a>æ‰§è¡Œcheckpointé€»è¾‘</h5><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131060.png"></p><p>åœ¨<code>org.apache.flink.streaming.api.functions.sink.filesystem.Buckets#snapshotActiveBuckets</code>ä¸­ä¾æ¬¡å¯¹æ¯ä¸ªbucketè°ƒç”¨<code>org.apache.flink.streaming.api.functions.sink.filesystem.Bucket#onReceptionOfCheckpoint</code>ï¼Œç„¶åå†å°†<code>onReceptionOfCheckpoint</code>è¿”å›çš„çŠ¶æ€è¿›è¡Œåºåˆ—åŒ–ä¿å­˜</p><p>è¿™å…¶ä¸­çš„ä¸»è¦æ–¹æ³•æ˜¯<code>onReceptionOfCheckpoint</code>ï¼Œè¿™æ˜¯æ¯ä¸ª<code>bucket</code>æ‰§è¡Œ<code>checkpoint</code>çš„ä¸»è¦é€»è¾‘.</p><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯ä»¥ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸€æ˜¯å¤„ç†pendingçŠ¶æ€çš„æ–‡ä»¶ï¼Œå…¶äºŒæ˜¯å¤„ç†å½“å‰æ­£åœ¨å†™çš„in-progressæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">BucketState&lt;BucketID&gt; <span class="title function_">onReceptionOfCheckpoint</span><span class="params">(<span class="type">long</span> checkpointId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    prepareBucketForCheckpointing(checkpointId);  <span class="comment">// å¤„ç†pendingçŠ¶æ€çš„æ–‡ä»¶ï¼Œå°†pendingçš„æ–‡ä»¶çš„çŠ¶æ€è¿›è¡Œä¿å­˜</span></span><br><span class="line"></span><br><span class="line">    InProgressFileWriter.<span class="type">InProgressFileRecoverable</span> <span class="variable">inProgressFileRecoverable</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">inProgressFileCreationTime</span> <span class="operator">=</span> Long.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æ­£åœ¨å†™çš„æ–‡ä»¶ä¸ä¸ºç©ºï¼Œéœ€è¦å¤„ç†å½“å‰æ­£åœ¨å†™çš„æ–‡ä»¶ï¼Œè®°å½•ç›¸å…³ä¿¡æ¯åˆ°çŠ¶æ€ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (inProgressPart != <span class="literal">null</span>) &#123;</span><br><span class="line">        inProgressFileRecoverable = inProgressPart.persist();</span><br><span class="line">        inProgressFileCreationTime = inProgressPart.getCreationTime();</span><br><span class="line">        <span class="built_in">this</span>.inProgressFileRecoverablesPerCheckpoint.put(</span><br><span class="line">                checkpointId, inProgressFileRecoverable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BucketState</span>&lt;&gt;(</span><br><span class="line">            bucketId,</span><br><span class="line">            bucketPath,</span><br><span class="line">            inProgressFileCreationTime,</span><br><span class="line">            inProgressFileRecoverable,</span><br><span class="line">            pendingFileRecoverablesPerCheckpoint);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¤„ç†pendingæ–‡ä»¶çš„çŠ¶æ€ä¸»è¦æ˜¯ä»¥ä¸‹æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">prepareBucketForCheckpointing</span><span class="params">(<span class="type">long</span> checkpointId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (inProgressPart != <span class="literal">null</span> &amp;&amp; rollingPolicy.shouldRollOnCheckpoint(inProgressPart)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (LOG.isDebugEnabled()) &#123;</span><br><span class="line">            LOG.debug(</span><br><span class="line">                    <span class="string">&quot;Subtask &#123;&#125; closing in-progress part file for bucket id=&#123;&#125; on checkpoint.&quot;</span>,</span><br><span class="line">                    subtaskIndex,</span><br><span class="line">                    bucketId);</span><br><span class="line">        &#125;</span><br><span class="line">        closePartFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!pendingFileRecoverablesForCurrentCheckpoint.isEmpty()) &#123;<span class="comment">// å°†å­˜å‚¨åœ¨å½“å‰checkpointä¸­çš„pendingæ–‡ä»¶æ”¾åˆ°æ‰€æœ‰checkpointçš„é›†åˆçš„çŠ¶æ€ä¸­</span></span><br><span class="line">        pendingFileRecoverablesPerCheckpoint.put(</span><br><span class="line">                checkpointId, pendingFileRecoverablesForCurrentCheckpoint);</span><br><span class="line">        pendingFileRecoverablesForCurrentCheckpoint = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å¤„ç†å½“å‰æ­£åœ¨å†™çš„in-progressæ–‡ä»¶çš„çŠ¶æ€ä¸»è¦æ˜¯è¿™ä¸ªä»£ç æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">BucketState&lt;BucketID&gt; <span class="title function_">onReceptionOfCheckpoint</span><span class="params">(<span class="type">long</span> checkpointId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æ­£åœ¨å†™çš„æ–‡ä»¶ä¸ä¸ºç©ºï¼Œéœ€è¦å¤„ç†å½“å‰æ­£åœ¨å†™çš„æ–‡ä»¶ï¼Œè®°å½•ç›¸å…³ä¿¡æ¯åˆ°çŠ¶æ€ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (inProgressPart != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// persist()ä¸»è¦æ˜¯ç”¨æ¥ä¿å­˜å½“å‰çŠ¶æ€å†™å…¥çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å†™å…¥åç§»é‡ï¼Œ</span></span><br><span class="line">        inProgressFileRecoverable = inProgressPart.persist();</span><br><span class="line">        inProgressFileCreationTime = inProgressPart.getCreationTime();</span><br><span class="line">        <span class="built_in">this</span>.inProgressFileRecoverablesPerCheckpoint.put(</span><br><span class="line">                checkpointId, inProgressFileRecoverable);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="checkpointå®Œæˆæ—¶"><a href="#checkpointå®Œæˆæ—¶" class="headerlink" title="checkpointå®Œæˆæ—¶"></a>checkpointå®Œæˆæ—¶</h5><p><code>org.apache.flink.streaming.api.functions.sink.filesystem.StreamingFileSink#notifyCheckpointComplete</code>æ–¹æ³•ç”¨æ¥æ‰§è¡Œcheckpointå®Œæˆæ—¶çš„é€»è¾‘</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131350.png"></p><p>è¿™å…¶ä¸­æœ€ç»ˆè°ƒç”¨çš„æ–¹æ³•æ˜¯<code>org.apache.flink.streaming.api.functions.sink.filesystem.Bucket#onSuccessfulCompletionOfCheckpoint</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">onSuccessfulCompletionOfCheckpoint</span><span class="params">(<span class="type">long</span> checkpointId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    checkNotNull(bucketWriter);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰çš„pendingæ–‡ä»¶</span></span><br><span class="line">    Iterator&lt;Map.Entry&lt;Long, List&lt;InProgressFileWriter.PendingFileRecoverable&gt;&gt;&gt; it =</span><br><span class="line">            pendingFileRecoverablesPerCheckpoint</span><br><span class="line">                    .headMap(checkpointId, <span class="literal">true</span>)</span><br><span class="line">                    .entrySet()</span><br><span class="line">                    .iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">        Map.Entry&lt;Long, List&lt;InProgressFileWriter.PendingFileRecoverable&gt;&gt; entry = it.next();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (InProgressFileWriter.PendingFileRecoverable pendingFileRecoverable :</span><br><span class="line">                entry.getValue()) &#123;</span><br><span class="line">            <span class="comment">// å¯¹æ‰€æœ‰çš„pendingæ–‡ä»¶è¿›è¡Œæäº¤ï¼Œå°†æ–‡ä»¶é€»è¾‘çš„çŠ¶æ€è½¬æ¢ä¸ºfinishedï¼Œå¯ä¾›ä¸‹æ¸¸ä½¿ç”¨äº†</span></span><br><span class="line">            bucketWriter.recoverPendingFile(pendingFileRecoverable).commit();</span><br><span class="line">        &#125;</span><br><span class="line">        it.remove();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¯¹å½“å‰çš„in-progressæ–‡ä»¶è¿›è¡Œå¤„ç†</span></span><br><span class="line">    cleanupInProgressFileRecoverables(checkpointId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è‡³æ­¤ï¼ŒStreamingFileSinkå¯¹æ•°æ®çš„å¤„ç†æµç¨‹åŸºæœ¬å®Œæˆã€‚</strong></p><p>é™„ï¼š</p><p>å†™æ•°æ®æ—¶çš„inprogressæ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131121.png" alt="image-20210705161008160"></p><p>finishedæ–‡ä»¶ï¼Œå¯ä¾›ä¸‹æ¸¸ä½¿ç”¨</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310132279.png" alt="image-20210705161125002"></p><h2 id="StreamingFileSinkå¯¹Failoverçš„å¤„ç†"><a href="#StreamingFileSinkå¯¹Failoverçš„å¤„ç†" class="headerlink" title="StreamingFileSinkå¯¹Failoverçš„å¤„ç†"></a>StreamingFileSinkå¯¹Failoverçš„å¤„ç†</h2><p>StreamingFileSinkåœ¨æ¢å¤çŠ¶æ€æ—¶ï¼Œä¼šæ¢å¤æ¯ä¸ªbucketä¸­çš„è®¡æ•°ä¿¡æ¯ã€æ­£åœ¨å†™çš„in-progressã€pendingçš„ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310132932.png" alt="image-20210705171020224"></p><p>å½“Failoverå‡ºç°åœ¨ä¸åŒçš„é˜¶æ®µï¼š</p><p><img src="https://gitee.com/halfcoke/blog_img_2021/raw/master/20210705172516.png" alt="ç„¡æ¨™é¡Œ-2021-07-05-1613"></p>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
          <category> æµå¤„ç† </category>
          
          <category> Flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flink </tag>
            
            <tag> æµå¤„ç† </tag>
            
            <tag> å¤§æ•°æ® </tag>
            
            <tag> æºç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cygwinï¼šç”¨æ¥æ‰§è¡Œlinuxå‘½ä»¤çš„å·¥å…·</title>
      <link href="/2021/8d1f253e/"/>
      <url>/2021/8d1f253e/</url>
      
        <content type="html"><![CDATA[<h1 id="Cygwinï¼šåœ¨Windowsä¸Šæ‰§è¡Œlinuxå‘½ä»¤çš„å·¥å…·"><a href="#Cygwinï¼šåœ¨Windowsä¸Šæ‰§è¡Œlinuxå‘½ä»¤çš„å·¥å…·" class="headerlink" title="Cygwinï¼šåœ¨Windowsä¸Šæ‰§è¡Œlinuxå‘½ä»¤çš„å·¥å…·"></a>Cygwinï¼šåœ¨Windowsä¸Šæ‰§è¡Œlinuxå‘½ä»¤çš„å·¥å…·</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>å®˜ç½‘é“¾æ¥ï¼š<a href="https://cygwin.com/index.html">https://cygwin.com/index.html</a></p><p>ç»´åŸºç™¾ç§‘ï¼š<a href="https://zh.wikipedia.org/wiki/Cygwin">https://zh.wikipedia.org/wiki/Cygwin</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ç›´æ¥<a href="https://cygwin.com/setup-x86_64.exe">ç‚¹å‡»é“¾æ¥</a>ä¸‹è½½64ä½ç‰ˆæœ¬çš„Cygwinï¼Œå®‰è£…è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä¸€ç›´ä¸‹ä¸€æ­¥å³å¯ï¼Œå»ºè®®ä¿ç•™æ­¤å®‰è£…åŒ…ï¼Œåç»­åœ¨Cygwinä¸­å®‰è£…è½¯ä»¶è¿˜ä¼šéœ€è¦ã€‚</p><h2 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h2><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><p>å®‰è£…è½¯ä»¶éœ€è¦è¿è¡ŒCygwinå®‰è£…åŒ…ï¼Œä¸€ç›´ç‚¹å‡»ä¸‹ä¸€æ­¥åˆ°å¦‚ä¸‹é¡µé¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108820.png" alt="image-20210509160734409"></p><p>æ¯”å¦‚è¦å®‰è£…wgetï¼Œåˆ™åœ¨æœç´¢æ¡†ä¸­è¾“å…¥<code>wget</code>ï¼Œviewé€‰æ‹©Fullã€‚ç„¶åé€‰æ‹©è½¯ä»¶ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œå·²ç»å®‰è£…è¿‡äº†ï¼Œæ‰€ä»¥ä¼šæœ‰<code>keep</code>å’Œ<code>reinstall</code>é€‰é¡¹ã€‚ç„¶åå†ä¸€ç›´ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108541.png" alt="image-20210509160832027"></p><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><p>ä½¿ç”¨<code>apt-cyg</code>å¯¹è½¯ä»¶è¿›è¡Œå®‰è£…ï¼Œé¦–å…ˆéœ€è¦ä¸‹è½½å®‰è£…<code>apt-cyg</code>ã€‚åœ¨<a href="%5Bhttps://github.com/transcode-open/apt-cyg%5D(https://github.com/transcode-open/apt-cyg)">é“¾æ¥</a>ä¸­ä¸‹è½½<code>apt-cyg</code>ï¼Œç„¶åcopyåˆ°<code>C:\cygwin64\bin</code>ç›®å½•ä¸‹ï¼Œè¿™é‡Œ<code>C:\cygwin64\</code>æ˜¯æˆ‘çš„cygwinçš„å®‰è£…ç›®å½•ï¼Œæ ¹æ®æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚</p><p>è¿™æ—¶å¯åŠ¨cygwinç»ˆç«¯å·²ç»å¯ä»¥ä½¿ç”¨<code>apt-cyg</code>å‘½ä»¤äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108268.png" alt="image-20210509161847316"></p><h2 id="å…¶ä»–è¯´æ˜"><a href="#å…¶ä»–è¯´æ˜" class="headerlink" title="å…¶ä»–è¯´æ˜"></a>å…¶ä»–è¯´æ˜</h2><h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p>å¦‚æœwindowsæœ¬èº«å®‰è£…äº†sshï¼Œéœ€è¦å¸æ‰åŸæ¥çš„sshå®¢æˆ·ç«¯ï¼Œé¿å…ä¸<code>cygwin</code>ä¸­çš„å†²çªï¼Œå†²çªçš„æƒ…å†µä¸‹ä¼šæ— æ³•ä½¿ç”¨<code>rsync</code>å‘½ä»¤</p><h3 id="Cygwinä½¿ç”¨rsyncæŠ¥é”™è§£å†³"><a href="#Cygwinä½¿ç”¨rsyncæŠ¥é”™è§£å†³" class="headerlink" title="Cygwinä½¿ç”¨rsyncæŠ¥é”™è§£å†³"></a>Cygwinä½¿ç”¨rsyncæŠ¥é”™è§£å†³</h3><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/110217604">https://zhuanlan.zhihu.com/p/110217604</a></p><p>åˆ é™¤windowsçš„sshå³å¯</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> ç³»ç»Ÿå·¥å…· </category>
          
          <category> cygwin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç³»ç»Ÿå·¥å…· </tag>
            
            <tag> cygwin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mavenéƒ¨åˆ†é…ç½®é¡¹è§£é‡Š</title>
      <link href="/2021/4346098d/"/>
      <url>/2021/4346098d/</url>
      
        <content type="html"><![CDATA[<h1 id="Mavenéƒ¨åˆ†é…ç½®é¡¹è§£é‡Š"><a href="#Mavenéƒ¨åˆ†é…ç½®é¡¹è§£é‡Š" class="headerlink" title="Mavenéƒ¨åˆ†é…ç½®é¡¹è§£é‡Š"></a>Mavenéƒ¨åˆ†é…ç½®é¡¹è§£é‡Š</h1><p>é¦–å…ˆæ¥çœ‹æˆ‘å½“å‰çš„<code>pom.xml</code>æ–‡ä»¶ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ä½ çš„id<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ä½ çš„id<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build.target.pathname</span>&gt;</span>ä½ çš„è·¯å¾„å<span class="tag">&lt;/<span class="name">build.target.pathname</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build.target.dir</span>&gt;</span>$&#123;project.basedir&#125;/$&#123;build.target.pathname&#125;<span class="tag">&lt;/<span class="name">build.target.dir</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--åˆ é™¤ç”Ÿæˆçš„ç›®æ ‡ç›®å½•--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-clean-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filesets</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--åœ¨è¿™é‡ŒæŒ‡å®šå“ªäº›æ–‡ä»¶å¤¹ä¹Ÿéœ€è¦åˆ é™¤ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;build.target.pathname&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fileset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filesets</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å°†ä¾èµ–æ”¾å…¥libæ–‡ä»¶å¤¹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- åœ¨è¿™é‡Œå°†ä¾èµ–çš„jaråŒ…(ä½ ç¨‹åºçš„ä¾èµ–),copyè¿›å“ªä¸ªæ–‡ä»¶å¤¹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;build.target.dir&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ’é™¤æ‰“å…¥jaråŒ…çš„æ–‡ä»¶è·¯å¾„--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- åœ¨è¿™é‡Œæ˜¯æŒ‡å°†ç¼–è¯‘å¥½çš„jaråŒ…(ä½ è‡ªå·±çš„ç¨‹åº),copyè¿›å“ªä¸ªæ–‡ä»¶å¤¹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">$&#123;build.target.dir&#125;/lib</span><br><span class="line"><span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--è¿™ä¸ªé€‰é¡¹æ˜¯åœ¨æ–‡ä»¶ä¸­ç”Ÿæˆclasspathï¼Œè¿™æ ·åªé€šè¿‡&quot;java -cp jarname mainclass&quot;æ‰§è¡Œè‡ªå·±çš„jaråŒ…å°±å¯ä»¥äº†--&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">classpathLayoutType</span>&gt;</span>custom<span class="tag">&lt;/<span class="name">classpathLayoutType</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">customClasspathLayout</span>&gt;</span>$$&#123;artifact.artifactId&#125;-$$&#123;artifact.version&#125;$$&#123;dashClassifier?&#125;.$$&#123;artifact.extension&#125;<span class="tag">&lt;/<span class="name">customClasspathLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--åœ¨è¿™é‡Œè¡¨ç¤ºï¼Œä¼šæ’é™¤staticè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸ä¼šæ‰“å…¥jaråŒ…ä¸­ï¼Œè¿™ä¸ªè·¯å¾„éœ€è¦æ˜¯classesç›®å½•çš„ç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="comment">https://maven.apache.org/plugins/maven-jar-plugin/examples/include-exclude.html</span></span><br><span class="line"><span class="comment">å®é™…å°±æ˜¯resourcesä¸‹çš„è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œstaticæ–‡ä»¶å¤¹å°±ä½äºresourcesä¸‹</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclude</span>&gt;</span>static/**<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;plugin&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;version&gt;3.0.0&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;descriptorRefs&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/descriptorRefs&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;outputDirectory&gt;$&#123;build.target.dir&#125;/lib&lt;/outputDirectory&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/configuration&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;executions&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;id&gt;make-assembly&lt;/id&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;phase&gt;package&lt;/phase&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;goal&gt;single&lt;/goal&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/goals&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/execution&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/executions&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/plugin&gt;--&gt;</span>         </span><br><span class="line">            <span class="comment">&lt;!--ç”¨æ¥æŒ‡å®šå°†å“ªäº›æ–‡ä»¶å¤åˆ¶åˆ°å“ªé‡Œå»--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--å¤åˆ¶çš„ç›®æ ‡åœ°å€ï¼Œè¿™ä¸ªå˜é‡æ˜¯æˆ‘è‡ªå®šä¹‰çš„--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;build.target.dir&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!--èµ„æºåœ°å€--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span></span><br><span class="line">$&#123;project.basedir&#125;/src/main/resources/static/</span><br><span class="line"><span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.63.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>pomæ–‡ä»¶çš„æ•´ä½“è¯´æ˜å¦‚ä¸Šï¼Œæ¥ä¸‹æ¥å…·ä½“ä»‹ç»ä¸€ä¸‹pomæ–‡ä»¶ä¸­çš„ä¸åŒå†…å®¹ã€‚</p><h3 id="Mavenå†…ç½®å˜é‡"><a href="#Mavenå†…ç½®å˜é‡" class="headerlink" title="Mavenå†…ç½®å˜é‡"></a>Mavenå†…ç½®å˜é‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.build.sourceDirectory&#125;:é¡¹ç›®çš„ä¸»æºç ç›®å½•ï¼Œé»˜è®¤ä¸ºsrc/main/java/.</span>   </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.build.testSourceDirectory&#125;:é¡¹ç›®çš„æµ‹è¯•æºç ç›®å½•ï¼Œé»˜è®¤ä¸º/src/test/java/.</span>  </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.build.directory&#125;:é¡¹ç›®æ„å»ºè¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä¸ºtarget/.</span>         </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.build.outputDirectory&#125;:é¡¹ç›®ä¸»ä»£ç ç¼–è¯‘è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä¸ºtarget/classes/.</span>    </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.build.testOutputDirectory&#125;:é¡¹ç›®æµ‹è¯•ä»£ç ç¼–è¯‘è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä¸ºtarget/testclasses/.</span>     </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.groupId&#125;:é¡¹ç›®çš„groupId.</span>    </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.artifactId&#125;:é¡¹ç›®çš„artifactId.</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.version&#125;:é¡¹ç›®çš„version,ç­‰åŒäº<span class="variable">$&#123;version&#125;</span></span>               </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;project.build.finalName&#125;:é¡¹ç›®æ‰“åŒ…è¾“å‡ºæ–‡ä»¶çš„åç§°ï¼Œé»˜è®¤ä¸º<span class="variable">$&#123;project.artifactId&#125;</span><span class="variable">$&#123;project.version&#125;</span>.</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/fly910905/article/details/79119349">https://blog.csdn.net/fly910905/article/details/79119349</a></p><p><a href="https://www.cnblogs.com/willvi624/p/9456239.html">https://www.cnblogs.com/willvi624/p/9456239.html</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> å¼€å‘å·¥å…· </category>
          
          <category> maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘å·¥å…· </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu Server 20.04 Legacy install imageå®‰è£…è¿‡ç¨‹</title>
      <link href="/2021/83723065/"/>
      <url>/2021/83723065/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu-Server-20-04-Legacy-install-imageå®‰è£…è¿‡ç¨‹"><a href="#Ubuntu-Server-20-04-Legacy-install-imageå®‰è£…è¿‡ç¨‹" class="headerlink" title="Ubuntu Server 20.04 Legacy install imageå®‰è£…è¿‡ç¨‹"></a>Ubuntu Server 20.04 Legacy install imageå®‰è£…è¿‡ç¨‹</h1><h2 id="å‡†å¤‡å®‰è£…"><a href="#å‡†å¤‡å®‰è£…" class="headerlink" title="å‡†å¤‡å®‰è£…"></a>å‡†å¤‡å®‰è£…</h2><p>ä½¿ç”¨Ubuntuå®˜ç½‘ä¸»é¡µçš„ä¸‹è½½çš„é•œåƒå®‰è£…èµ·æ¥ä¼šå‡ºé”™ï¼Œåæ¥æŸ¥è¯¢èµ„æ–™å¾—çŸ¥ï¼Œå¯ä»¥ä½¿ç”¨ä¼ ç»Ÿå®‰è£…é•œåƒï¼Œå…·ä½“åŸå› æ²¡æœ‰æ·±ç©¶ï¼Œè®°å½•æœ¬æ¬¡å®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼ŒåŒ…å«äº†æ¯ä¸€ä¸ªæ­¥éª¤ã€‚</p><p>é•œåƒä¸‹è½½ç½‘é¡µï¼š<a href="http://cdimage.ubuntu.com/ubuntu-legacy-server/releases/20.04/release/">http://cdimage.ubuntu.com/ubuntu-legacy-server/releases/20.04/release/</a></p><p>é•œåƒä¸‹è½½åœ°å€ï¼š<a href="http://cdimage.ubuntu.com/ubuntu-legacy-server/releases/20.04/release/ubuntu-20.04.1-legacy-server-amd64.iso">http://cdimage.ubuntu.com/ubuntu-legacy-server/releases/20.04/release/ubuntu-20.04.1-legacy-server-amd64.iso</a></p><h2 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h2><p>åªåšå¯åŠ¨ç›˜ç­‰å·¥å…·çš„è¿‡ç¨‹ç•¥</p><ol><li><p>ä»é•œåƒå¯åŠ¨å®‰è£…ç¨‹åºï¼Œæ­¤å¤„å¯ä»¥ç›´æ¥é€‰ä¸­æ–‡ï¼Œæ–¹å‘é”®åˆ‡æ¢ï¼Œå›è½¦é”®ç¡®è®¤ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136553.png" alt="image-20210318142402884"></p></li><li><p>å®‰è£… UbuntuæœåŠ¡å™¨ç‰ˆï¼Œå¯èƒ½ä¼šå¡é¡¿ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136887.png" alt="image-20210318142453839"></p></li><li><p>é€‰æ‹©è¯­è¨€ï¼Œç›´æ¥yeså°±è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136530.png" alt="image-20210318142655508"></p></li><li><p>æ£€æµ‹é”®ç›˜å¸ƒå±€ï¼Œé€‰å¦ï¼Œä¸€ä¼šè‡ªå·±æ‰‹åŠ¨é€‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136416.png" alt="image-20210318142725215"></p></li><li><p>é€‰Englis(us)</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136449.png" alt="image-20210318142801389"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136965.png" alt="image-20210318142819409"></p></li><li><p>ç­‰ä¸€ä¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136540.png" alt="image-20210318142952977"></p></li><li><p>é€‰æ‹©ç½‘ç»œæ¥å£</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136802.png" alt="image-20210318143456635"></p></li><li><p>é…ç½®é™æ€ip</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136699.png" alt="image-20210318143851952"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136636.png" alt="image-20210318143902464"></p><p>æ¥ä¸‹æ¥çš„ä¸€äº›ä¿¡æ¯æ ¹æ®ä¸ªäººæƒ…å†µå¡«å†™ï¼Œä¸»è¦å°±æ˜¯ä¸»æœºåã€ç”¨æˆ·åã€ipï¼Œç½‘å…³ç­‰</p></li><li><p>è¿›è¡Œç£ç›˜åˆ†åŒºï¼Œè¿™é‡Œé€‰æ‰‹åŠ¨åˆ†åŒºï¼Œå› ä¸ºå’±ä»¬éœ€è¦ä¸º&#x2F;bootç›®å½•åˆ›å»ºä¸€ä¸ªåˆ†åŒºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136708.png" alt="image-20210318144237167"></p></li><li><p>å…ˆæŠŠä¹‹å‰æ—§çš„ä¿¡æ¯æ¸…ç†æ‰ï¼Œå…ˆé€‰æ‹©é…ç½®é€»è¾‘å·ç®¡ç†å™¨ï¼Œå¦‚æœæœ‰å¼¹çª—å°±é€‰â€˜æ˜¯â€™</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136111.png" alt="image-20210318144323051"></p></li><li><p>åˆ é™¤åŸæ¥çš„é€»è¾‘å·ï¼Œæœ‰å‡ ä¸ªåˆ é™¤å‡ ä¸ªï¼Œå¯èƒ½ä¼šå¡é¡¿ï¼Œç­‰ä¸€ä¼šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136941.png"></p></li><li><p>é€»è¾‘å·éƒ½åˆ é™¤å®Œäº†ä»¥åè¦åˆ é™¤å·ç»„ï¼Œç„¶åå®Œæˆï¼Œè¿”å›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137055.png" alt="image-20210318144618435"></p></li><li><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€‰ä¸­è¦å®‰è£…ç³»ç»Ÿçš„ssdï¼Œæ•²ä¸€ä¸‹å›è½¦ï¼Œå†™å…¥ç©ºçš„åˆ†åŒºè¡¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137723.png" alt="image-20210318144718509"></p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/20210318144749.png" alt="image-20210318144749522"></p></li><li><p>åˆ›å»ºåˆ†åŒºï¼Œå…‰æ ‡æ”¾åœ¨è¿™ä¸€è¡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137549.png" alt="image-20210318150852362"></p><p>åˆ›å»ºæ–°åˆ†åŒº</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137417.png" alt="image-20210318150924747"></p><p>å…ˆå»ºç«‹ä¸€ä¸ª1GBå¤§å°çš„åˆ†åŒºï¼Œç”¨æ¥æŒ‚è½½<code>/boot</code>ç›®å½•ï¼Œé€‰æ‹©<code>ä¸»åˆ†åŒº</code>ï¼Œåˆ†åŒºçš„ä½ç½®é€‰<code>å¼€å§‹</code>ã€‚è¿™é‡Œé€‰æ‹©ä¸‹å›¾è¿™æ ·çš„é…ç½®ï¼Œç„¶ååˆ†åŒºè®¾å®šç»“æŸã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137234.png" alt="image-20210318151106480"></p></li><li><p>ç„¶åå†é…ç½®é€»è¾‘å·ï¼Œå¼¹å‡ºçš„çª—å£è¿˜æ˜¯é€‰æ‹©æ˜¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137222.png" alt="image-20210318151249883"></p><p>åˆ›å»ºå·ç»„ï¼Œå·ç»„åå°±<code>ubuntu</code>å°±å¯ä»¥</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137612.png" alt="image-20210318151310165"></p><p>è®¾å¤‡é€‰æ‹©æœ‰<code>free</code>æ ‡è®°çš„é‚£é‡Œï¼ŒæŒ‰ç©ºæ ¼é€‰æ‹©ï¼ŒæŒ‰å›è½¦ç¡®è®¤ï¼Œç„¶åç»§ç»­é€‰æ‹©æ˜¯</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/20210318151343.png" alt="image-20210318151343523"></p><p>åˆ›å»ºä¸¤ä¸ªé€»è¾‘å·ï¼Œä¸€ä¸ªå‘½åä¸ºswapï¼Œç©ºé—´ä¸º2GBï¼Œä¸€ä¸ªå‘½åä¸ºrootï¼Œå‰©ä½™ç©ºé—´éƒ½ç»™è¿‡å»ã€‚é…ç½®è¯¦æƒ…å¦‚ä¸‹ï¼Œç„¶åå®Œæˆè¿”å›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137645.png" alt="image-20210318151742323"></p></li><li><p>è®¾ç½®æŒ‚è½½è·¯å¾„å’Œæ–‡ä»¶ç³»ç»Ÿæ ¼å¼</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137073.png" alt="image-20210318151848705"></p><p>å…¶ä¸­rooté‚£ä¸ªè®¾ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137603.png" alt="image-20210318151923289"></p><p>swapé‚£ä¸ªè®¾ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/20210318151952.png" alt="image-20210318151952830"></p><p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼Œç„¶åé€‰æ‹©<code>ç»“æŸåˆ†åŒºè®¾å®šå¹¶å°†ä¿®æ”¹å†™å…¥ç£ç›˜</code>ï¼Œç„¶åé€‰<code>æ˜¯</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137160.png" alt="image-20210318152009023"></p></li><li><p>httpä»£ç†ä¸éœ€è¦è®¾ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137615.png" alt="image-20210318153101142"></p></li><li><p>ä¸ç”¨è‡ªåŠ¨å®‰è£…æ›´æ–°</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/20210318153214.png" alt="image-20210318153214470"></p></li><li><p>å®‰è£…opensshæœåŠ¡</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137130.png" alt="image-20210318153238318"></p></li><li><p>å®‰è£…å¼•å¯¼ï¼Œæ³¨æ„é€‰æ‹©è®¾å¤‡</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137570.png" alt="image-20210318155100368"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310137425.png" alt="image-20210318155118729"></p></li><li><p>å®‰è£…å®Œæˆåé‡å¯å³å¯ã€‚</p></li></ol><h2 id="å®‰è£…åé…ç½®"><a href="#å®‰è£…åé…ç½®" class="headerlink" title="å®‰è£…åé…ç½®"></a>å®‰è£…åé…ç½®</h2><h3 id="æ›´æ”¹rootå¯†ç "><a href="#æ›´æ”¹rootå¯†ç " class="headerlink" title="æ›´æ”¹rootå¯†ç "></a>æ›´æ”¹rootå¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd</span><br></pre></td></tr></table></figure><h3 id="é™æ€ip"><a href="#é™æ€ip" class="headerlink" title="é™æ€ip"></a>é™æ€ip</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@slave3:  vi /etc/netplan/01-*.yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ­¤å¤„æ³¨æ„yamlæ–‡ä»¶æ ¼å¼</strong>ï¼Œ<code>:</code>åè¦æœ‰ç©ºæ ¼ï¼Œç¼©è¿›è‡³å°‘ä¸¤ä¸ªç©ºæ ¼ï¼ŒåŒçº§ç¼©è¿›ä¿æŒä¸€è‡´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: NetworkManager</span><br><span class="line">  ethernets:</span><br><span class="line">    eno1:   <span class="comment"># ç½‘å¡åç§°</span></span><br><span class="line">      dhcp4: no     <span class="comment"># å…³é—­dhcp</span></span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [10.254.13.19/24]  <span class="comment"># é™æ€ip,æ ¹æ®å®é™…æƒ…å†µé…ç½®</span></span><br><span class="line">      gateway4: 10.254.13.254    <span class="comment"># ç½‘å…³</span></span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.5.5.5, 114.114.114.114]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@slave3:  netplan apply</span><br></pre></td></tr></table></figure><h3 id="sshæœåŠ¡"><a href="#sshæœåŠ¡" class="headerlink" title="sshæœåŠ¡"></a>sshæœåŠ¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@slave3: vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ç«¯å£ï¼Œç¦ç”¨rootå¯†ç ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯sshdæœåŠ¡</span></span><br><span class="line">root@slave3: systemctl restart sshd</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„åœ¨å½“å‰ç”¨æˆ·å’Œrootç”¨æˆ·æ‰§è¡Œä¸€éä¸‹é¢çš„å‘½ä»¤</strong>ï¼Œä¸€è·¯æ•²å›è½¦å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@slave3: ssh-keygen</span><br><span class="line">user@slave3: ssh-keygen</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> ç³»ç»Ÿå®‰è£… </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¦‚ä½•åœ¨LVMä¸­ç§»é™¤PV</title>
      <link href="/2021/2d54e946/"/>
      <url>/2021/2d54e946/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxå¦‚ä½•åœ¨LVMä¸­ç§»é™¤PV"><a href="#Linuxå¦‚ä½•åœ¨LVMä¸­ç§»é™¤PV" class="headerlink" title="Linuxå¦‚ä½•åœ¨LVMä¸­ç§»é™¤PV"></a>Linuxå¦‚ä½•åœ¨LVMä¸­ç§»é™¤PV</h1><p>ç½‘ä¸Šå¾ˆå¤šäººéƒ½åœ¨è®²å¦‚ä½•ç›´æ¥ç§»é™¤PVï¼Œä½†æ˜¯å®é™…è¿‡ç¨‹ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½æˆ‘ä»¬çš„PVè¿˜æ²¡æœ‰ç©ºé—²ç©ºé—´ï¼Œè¿™æ ·ä¹Ÿå°±æ²¡åŠæ³•ç›´æ¥ç”¨<code>pvmove</code>æŒ‡ä»¤ã€‚</p><p>æˆ‘ä»¬å…ˆä»‹ç»å¦‚ä½•å°†pvç©ºé—²å‡ºæ¥ã€‚</p><h2 id="ç§»é™¤PVå‡†å¤‡å·¥ä½œ"><a href="#ç§»é™¤PVå‡†å¤‡å·¥ä½œ" class="headerlink" title="ç§»é™¤PVå‡†å¤‡å·¥ä½œ"></a>ç§»é™¤PVå‡†å¤‡å·¥ä½œ</h2><p>é€šè¿‡<code>lsblk</code>å‘½ä»¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰æ ¹ç›®å½•çš„<code>LVM</code>æ˜¯ç”¨äº†ä¸¤ä¸ªç›˜çš„ï¼Œå³<code>sda</code>å’Œ<code>sdb</code>ã€‚æˆ‘ä»¬æƒ³å°†<code>sda</code>ä»<code>LVM</code>ä¸­æ‹¿å‡ºæ¥ï¼Œè¿™æ ·<code>sda</code>å°±å¯ä»¥ç”¨æ¥åšåˆ«çš„äº‹æƒ…äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134687.png" alt="image-20210318100540412"></p><p>ä½¿ç”¨<code>df -hT</code>æŸ¥çœ‹å½“å‰åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•åªç”¨äº†72Gï¼Œ<code>/home</code>ç›®å½•ç©ºé—²æœ‰249Gï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å°†<code>/home</code>ä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´æ‹¿å‡ºæ¥ï¼Œæœ€å¥½ç©ºé—²ç›´æ¥å¤§äº72Gï¼Œä¿è¯èƒ½è£…å¾—ä¸‹ã€‚å¦‚æœå°äº72Gçš„æ—¶å€™ä¸ç¡®å®šèƒ½ä¸èƒ½è£…å¾—ä¸‹ï¼Œè¿™éƒ¨åˆ†éœ€è¦è‡ªå·±è¯•ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134104.png" alt="image-20210318101352606"></p><p>æˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹<code>lvdisplay</code>ï¼ŒæŸ¥çœ‹ä¸€ä¸‹lvçš„ä¿¡æ¯ï¼Œä¸‹å›¾åˆ—å‡ºäº†éƒ¨åˆ†å†…å®¹ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/20210318101759.png" alt="image-20210318101759476"></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ‰§è¡Œ<code>lvreduce -L 150G /dev/cl/home</code>å‘½ä»¤ï¼Œè¿™æ¡å‘½ä»¤ç›¸å½“äºå°†<code>/home</code>è·¯å¾„çš„ç©ºé—´ç›´æ¥ç¼©å°åˆ°150Gï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä¸Šé¢é€šè¿‡<code>df -hT</code>çœ‹åˆ°äº†<code>/home</code>ç›®å½•åªç”¨äº†144Gã€‚</p><p>è¿™æ ·æˆ‘ä»¬ç›¸å½“äºå·²ç»æœ‰ç©ºé—´ç”¨æ¥å­˜æ”¾æ ¹ç›®å½•çš„æ•°æ®äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ‰§è¡Œç§»é™¤PVçš„ç›¸å…³æ“ä½œ</p><h2 id="ç§»é™¤PV"><a href="#ç§»é™¤PV" class="headerlink" title="ç§»é™¤PV"></a>ç§»é™¤PV</h2><p>æˆ‘ä»¬æ‰§è¡Œ<code>pvs -o+pv_used</code>ï¼Œåªè¦<code>/dev/sda1</code>çš„<code>used</code>çš„æ˜¯0å°±å¯ä»¥äº†ã€‚ä¸‹é¢è¿™ä¸ªå›¾å¿˜è®°æˆªäº†ï¼Œæ”¾ä¸€ä¸ªä¹‹å‰çš„æ•°æ®çš„å›¾ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/20210318103700.png" alt="image-20210318103700432"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè½¬ç§»PVä¸­çš„æ•°æ®</span></span><br><span class="line">pvmove /dev/sda1</span><br><span class="line"><span class="comment"># ç„¶åä»vgä¸­ç§»é™¤pv</span></span><br><span class="line">vgreduce &#123;vgç»„å&#125; /dev/sda1</span><br><span class="line">å³ï¼švgreduce cl /dev/sda1</span><br><span class="line"><span class="comment"># ç„¶åç§»é™¤PV</span></span><br><span class="line">pvremove /dev/sda1</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ‰€æœ‰æ­¥éª¤å®Œæˆã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p>[1] <a href="https://www.2daygeek.com/linux-remove-delete-physical-volume-pv-from-volume-group-vg-in-lvm/">How to Remove Physical Volume from a Volume Group in LVM</a></p><p>[2] <a href="https://www.cnblogs.com/sparkdev/p/10213655.html">LVM : ç¼©å‡æ–‡ä»¶ç³»ç»Ÿçš„å®¹é‡</a></p><p>[3] <a href="https://halfcoke.github.io/2020/189b3b4/">Linuxå¦‚ä½•ä½¿ç”¨LVMè¿›è¡Œç£ç›˜æ‰©å®¹</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> LVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> LVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GoLangè¿œç¨‹å¼€å‘é…ç½®</title>
      <link href="/2021/e1ea5816/"/>
      <url>/2021/e1ea5816/</url>
      
        <content type="html"><![CDATA[<h1 id="GoLangè¿œç¨‹å¼€å‘é…ç½®"><a href="#GoLangè¿œç¨‹å¼€å‘é…ç½®" class="headerlink" title="GoLangè¿œç¨‹å¼€å‘é…ç½®"></a>GoLangè¿œç¨‹å¼€å‘é…ç½®</h1><p><strong>æœ¬æ–‡ä»‹ç»å¦‚ä½•é…ç½®GoLangå¦‚ä½•åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œè°ƒè¯•å¼€å‘</strong></p><p>é™„ä¸Šå®˜ç½‘è¯´æ˜:</p><p><a href="https://www.jetbrains.com/help/go/attach-to-running-go-processes-with-debugger.html#step-2-run-delve-on-the-host-machine">https://www.jetbrains.com/help/go/attach-to-running-go-processes-with-debugger.html#step-2-run-delve-on-the-host-machine</a></p><p>è¿œç¨‹ç¯å¢ƒä¸æœ¬åœ°ç¯å¢ƒç‰ˆæœ¬æœ€å¥½ç›¸åŒï¼Œé¿å…ç„å­¦é”™è¯¯</p><h2 id="è¿œç¨‹ç¯å¢ƒ"><a href="#è¿œç¨‹ç¯å¢ƒ" class="headerlink" title="è¿œç¨‹ç¯å¢ƒ"></a>è¿œç¨‹ç¯å¢ƒ</h2><p>è¿œç¨‹ä½¿ç”¨Ubuntu18</p><p>Goè¯­è¨€linuxç‰ˆä¸‹è½½é“¾æ¥ï¼š<a href="https://golang.org/dl/go1.16.linux-amd64.tar.gz">go1.16.linux-amd64.tar.gz</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨å‘½ä»¤è§£å‹å‹ç¼©åŒ…</span></span><br><span class="line">tar -C ./env/go -zxf go1.16.linux-amd64.tar.gz</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># åœ¨æœ€ä¸‹é¢åŠ ä¸Šè¿™å‡ è¡Œ</span></span><br><span class="line"><span class="comment"># &gt;&gt;&gt; go env &gt;&gt;&gt;</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=~/.go</span><br><span class="line"><span class="built_in">export</span> GOROOT=~/env/go</span><br><span class="line"><span class="built_in">export</span> GOBIN=<span class="variable">$GOROOT</span>/bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$GOBIN</span>:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># &lt;&lt;&lt; go env &lt;&lt;&lt;</span></span><br><span class="line"><span class="comment"># ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment"># æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">go version</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šgo version go1.16 linux/amd64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…è¿œç¨‹è°ƒè¯•å·¥å…·  </span></span><br><span class="line"><span class="comment"># githubï¼šhttps://github.com/go-delve/delve</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">go install github.com/go-delve/delve/cmd/dlv@latest</span><br><span class="line"><span class="comment"># å®‰è£…å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š</span></span><br><span class="line">dlv version</span><br><span class="line"></span><br><span class="line">Delve Debugger</span><br><span class="line">Version: 1.6.0</span><br><span class="line">Build: <span class="variable">$Id</span>: 8cc9751909843dd55a46e8ea2a561544f70db34d $</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡³æ­¤è¿œç¨‹ç¯å¢ƒé…ç½®å®Œæˆ</span></span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°ç¯å¢ƒ"><a href="#æœ¬åœ°ç¯å¢ƒ" class="headerlink" title="æœ¬åœ°ç¯å¢ƒ"></a>æœ¬åœ°ç¯å¢ƒ</h2><p>æœ¬åœ°ä½¿ç”¨GoLandè¿›è¡Œå¼€å‘</p><p>åœ¨æœ¬åœ°æ–°å»º<code>Hello.go</code>æ–‡ä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;run&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;finish&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç„¶ååˆ›å»ºGo.modæ–‡ä»¶</strong></p><p>ï¼ï¼ï¼å¾ˆé‡è¦ï¼Œä¸ç„¶æ— æ³•æ–­ç‚¹è°ƒè¯•</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310132304.png" alt="image-20210306120910761"></p><p>åœ¨GoLandé…ç½®<code>Deployment</code>ï¼Œå°†æœ¬åœ°æ–‡ä»¶åŒæ­¥åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¦‚ä½•é…ç½®Deploymentå‚è€ƒç½‘ç»œä¸Šå…¶ä»–æ•™ç¨‹ï¼Œè®²è¿™éƒ¨åˆ†å†…å®¹çš„å¾ˆå¤šï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹æˆªå›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310132358.png" alt="image-20210306103624938"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310132513.png" alt="image-20210306103717312"></p><p>ç‚¹å‡»è¿™é‡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133594.png" alt="image-20210306103925994"></p><p>æ–°å»ºä¸€ä¸ªGo Remoteé…ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133462.png" alt="image-20210306103951739"></p><p>æ ¹æ®è‡ªå·±çš„æƒ…å†µè®¾ç½®IPå’Œç«¯å£</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133240.png" alt="image-20210306104039977"></p><p>åœ¨<strong>è¿œç¨‹ç¯å¢ƒ</strong>çš„ç»ˆç«¯ä¸Šè¿›å…¥åˆšåˆšçš„é¡¹ç›®è·¯å¾„ï¼ˆæ¯”å¦‚æˆ‘çš„æ˜¯<code>/tmp/go_practice/2021-03-06</code>ï¼‰ï¼Œç„¶åé€‰æ‹©æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ main.goç›®å½•ä¸‹æ‰§è¡Œ </span><br><span class="line">dlv debug --headless --listen=:2345 --api-version=2</span><br></pre></td></tr></table></figure><p>ç„¶åå›åˆ°Golandç‚¹å‡»è°ƒè¯•å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133618.png" alt="image-20210306121101391"></p><p>ç›´æ¥åœ¨GoLandä¸­è¿›è¡Œè¿œç¨‹è°ƒè¯•å°±å¾ˆæ–¹ä¾¿äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133606.png" alt="image-20210306121931106"></p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
          <category> Goè¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Goè¯­è¨€ </tag>
            
            <tag> è¿œç¨‹å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue ElementUIä¸­çš„BackTopç»„ä»¶ä½¿ç”¨</title>
      <link href="/2021/e15cc6f/"/>
      <url>/2021/e15cc6f/</url>
      
        <content type="html"><![CDATA[<h1 id="vue-ElementUIä¸­çš„BackTopç»„ä»¶ä½¿ç”¨"><a href="#vue-ElementUIä¸­çš„BackTopç»„ä»¶ä½¿ç”¨" class="headerlink" title="vue ElementUIä¸­çš„BackTopç»„ä»¶ä½¿ç”¨"></a>vue ElementUIä¸­çš„BackTopç»„ä»¶ä½¿ç”¨</h1><p><a href="https://element.eleme.cn/2.15/#/zh-CN/component/backtop">å®˜æ–¹æ–‡æ¡£</a>ä¸­å…³äºBackTopç»„ä»¶çš„ä½¿ç”¨è¯´æ˜æœ‰å‘ï¼Œå®é™…ä¸Šè¯¥ç»„ä»¶çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œè§å¦‚ä¸‹ä»£ç ï¼Œè®°å¾—æŠŠä»£ç æ”¾åœ¨æœ€å¤–å±‚çš„divé‡Œçš„ç¬¬ä¸€ä¸ªï¼Œä¸è¦æ”¾åœ¨å°¾éƒ¨ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-backtop</span> <span class="attr">:bottom</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;back_top&quot;</span>&gt;</span></span><br><span class="line">UP</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-backtop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h2><p>[1]<a href="https://www.cnblogs.com/xyann/p/12739515.html">https://www.cnblogs.com/xyann/p/12739515.html</a></p>]]></content>
      
      
      <categories>
          
          <category> WEB </category>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> ElementUI </tag>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¬è½½â€”â€”è·¨åŸŸèµ„æºå…±äº«CORSæµ…æåŠä¾¿æ·è§£å†³æ–¹æ¡ˆ</title>
      <link href="/2021/7a010a2b/"/>
      <url>/2021/7a010a2b/</url>
      
        <content type="html"><![CDATA[<h1 id="è½¬è½½â€”â€”è·¨åŸŸèµ„æºå…±äº«CORSæµ…æåŠä¾¿æ·è§£å†³æ–¹æ¡ˆ"><a href="#è½¬è½½â€”â€”è·¨åŸŸèµ„æºå…±äº«CORSæµ…æåŠä¾¿æ·è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è½¬è½½â€”â€”è·¨åŸŸèµ„æºå…±äº«CORSæµ…æåŠä¾¿æ·è§£å†³æ–¹æ¡ˆ"></a>è½¬è½½â€”â€”è·¨åŸŸèµ„æºå…±äº«CORSæµ…æåŠä¾¿æ·è§£å†³æ–¹æ¡ˆ</h1><blockquote><p>è·¨æºèµ„æºå…±äº« (CORS) ï¼ˆæˆ–é€šä¿—åœ°è¯‘ä¸ºè·¨åŸŸèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ç§åŸºäºHTTP å¤´çš„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶é€šè¿‡å…è®¸æœåŠ¡å™¨æ ‡ç¤ºé™¤äº†å®ƒè‡ªå·±ä»¥å¤–çš„å…¶å®ƒoriginï¼ˆåŸŸï¼Œåè®®å’Œç«¯å£ï¼‰ï¼Œè¿™æ ·æµè§ˆå™¨å¯ä»¥è®¿é—®åŠ è½½è¿™äº›èµ„æºã€‚è·¨æºèµ„æºå…±äº«è¿˜é€šè¿‡ä¸€ç§æœºåˆ¶æ¥æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦ä¼šå…è®¸è¦å‘é€çš„çœŸå®è¯·æ±‚ï¼Œè¯¥æœºåˆ¶é€šè¿‡æµè§ˆå™¨å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨æ‰˜ç®¡çš„è·¨æºèµ„æºçš„â€é¢„æ£€â€è¯·æ±‚ã€‚åœ¨é¢„æ£€ä¸­ï¼Œæµè§ˆå™¨å‘é€çš„å¤´ä¸­æ ‡ç¤ºæœ‰HTTPæ–¹æ³•å’ŒçœŸå®è¯·æ±‚ä¸­ä¼šç”¨åˆ°çš„å¤´ã€‚</p></blockquote><blockquote><p>è·¨æºHTTPè¯·æ±‚çš„ä¸€ä¸ªä¾‹å­ï¼šè¿è¡Œåœ¨ <a href="http://domain-a.com/">http://domain-a.com</a> çš„JavaScriptä»£ç ä½¿ç”¨XMLHttpRequestæ¥å‘èµ·ä¸€ä¸ªåˆ° <a href="https://domain-b.com/data.json">https://domain-b.com/data.json</a> çš„è¯·æ±‚ã€‚</p></blockquote><blockquote><p>å‡ºäºå®‰å…¨æ€§ï¼Œæµè§ˆå™¨é™åˆ¶è„šæœ¬å†…å‘èµ·çš„è·¨æºHTTPè¯·æ±‚ã€‚ ä¾‹å¦‚ï¼ŒXMLHttpRequestå’ŒFetch APIéµå¾ªåŒæºç­–ç•¥ã€‚ è¿™æ„å‘³ç€ä½¿ç”¨è¿™äº›APIçš„Webåº”ç”¨ç¨‹åºåªèƒ½ä»åŠ è½½åº”ç”¨ç¨‹åºçš„åŒä¸€ä¸ªåŸŸè¯·æ±‚HTTPèµ„æºï¼Œé™¤éå“åº”æŠ¥æ–‡åŒ…å«äº†æ­£ç¡®CORSå“åº”å¤´ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102308378.jpeg"></p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œå½“æˆ‘ä»¬è®¿é—®<code>domain-a.com</code>çš„é¡µé¢ï¼Œè¿™å…¶ä¸­è“è‰²çš„imageæ˜¯ä»<code>domain-a.com</code>è¯·æ±‚çš„ï¼Œè¿™å±äºåŒæºè¯·æ±‚ï¼Œæ˜¯è¢«å…è®¸çš„ã€‚çº¢è‰²çš„imageæ˜¯ä» <code>domain-b.com</code>è¯·æ±‚çš„ï¼Œéœ€è¦æ”¶åˆ°CORSæœºåˆ¶çš„æ§åˆ¶</p><blockquote><p>è·¨æºåŸŸèµ„æºå…±äº«ï¼ˆ CORS ï¼‰æœºåˆ¶å…è®¸ Web åº”ç”¨æœåŠ¡å™¨è¿›è¡Œè·¨æºè®¿é—®æ§åˆ¶ï¼Œä»è€Œä½¿è·¨æºæ•°æ®ä¼ è¾“å¾—ä»¥å®‰å…¨è¿›è¡Œã€‚ç°ä»£æµè§ˆå™¨æ”¯æŒåœ¨ API å®¹å™¨ä¸­ï¼ˆä¾‹å¦‚ XMLHttpRequest æˆ– Fetch ï¼‰ä½¿ç”¨ CORSï¼Œä»¥é™ä½è·¨æº HTTP è¯·æ±‚æ‰€å¸¦æ¥çš„é£é™©ã€‚</p></blockquote><h2 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h2><blockquote><p>æ¯”å¦‚è¯´ï¼Œå‡å¦‚ç«™ç‚¹ <a href="http://foo.example/">http://foo.example</a> çš„ç½‘é¡µåº”ç”¨æƒ³è¦è®¿é—® <a href="http://bar.other/">http://bar.other</a> çš„èµ„æºã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102308566.jpeg"></p><p>åˆ†åˆ«æŸ¥çœ‹è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /resources/public-data/ HTTP/1.1</span><br><span class="line">Host: bar.other</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-us,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Referer: http://foo.example/examples/access-control/simpleXSInvocation.html</span><br><span class="line">Origin: http://foo.example</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 00:23:53 GMT</span><br><span class="line">Server: Apache/2.0.61</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Keep-Alive: timeout=2, max=100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Content-Type: application/xml</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬ 1~10 è¡Œæ˜¯è¯·æ±‚é¦–éƒ¨ã€‚ç¬¬10è¡Œ çš„è¯·æ±‚é¦–éƒ¨å­—æ®µ Origin è¡¨æ˜è¯¥è¯·æ±‚æ¥æºäº <a href="http://foo.example/">http://foo.example</a>ã€‚<br>ç¬¬ 13~22 è¡Œæ˜¯æ¥è‡ªäº <a href="http://bar.other/">http://bar.other</a> çš„æœåŠ¡ç«¯å“åº”ã€‚å“åº”ä¸­æºå¸¦äº†å“åº”é¦–éƒ¨å­—æ®µ Access-Control-Allow-Originï¼ˆç¬¬ 16 è¡Œï¼‰ã€‚ä½¿ç”¨ Origin å’Œ Access-Control-Allow-Origin å°±èƒ½å®Œæˆæœ€ç®€å•çš„è®¿é—®æ§åˆ¶ã€‚æœ¬ä¾‹ä¸­ï¼ŒæœåŠ¡ç«¯è¿”å›çš„ Access-Control-Allow-Origin: * è¡¨æ˜ï¼Œè¯¥èµ„æºå¯ä»¥è¢«ä»»æ„å¤–åŸŸè®¿é—®ã€‚å¦‚æœæœåŠ¡ç«¯ä»…å…è®¸æ¥è‡ª <a href="http://foo.example/">http://foo.example</a> çš„è®¿é—®ï¼Œè¯¥é¦–éƒ¨å­—æ®µçš„å†…å®¹å¦‚ä¸‹ï¼š<br>Access-Control-Allow-Origin: <a href="http://foo.example/">http://foo.example</a><br>ç°åœ¨ï¼Œé™¤äº† <a href="http://foo.example/">http://foo.example</a>ï¼Œå…¶å®ƒå¤–åŸŸå‡ä¸èƒ½è®¿é—®è¯¥èµ„æºï¼ˆè¯¥ç­–ç•¥ç”±è¯·æ±‚é¦–éƒ¨ä¸­çš„ ORIGIN å­—æ®µå®šä¹‰ï¼Œè§ç¬¬10è¡Œï¼‰ã€‚Access-Control-Allow-Origin åº”å½“ä¸º * æˆ–è€…åŒ…å«ç”± Origin é¦–éƒ¨å­—æ®µæ‰€æŒ‡æ˜çš„åŸŸåã€‚</p></blockquote><h2 id="é¢„æ£€è¯·æ±‚"><a href="#é¢„æ£€è¯·æ±‚" class="headerlink" title="é¢„æ£€è¯·æ±‚"></a>é¢„æ£€è¯·æ±‚</h2><blockquote><p>ä¸å‰è¿°ç®€å•è¯·æ±‚ä¸åŒï¼Œâ€œéœ€é¢„æ£€çš„è¯·æ±‚â€è¦æ±‚å¿…é¡»é¦–å…ˆä½¿ç”¨ OPTIONS æ–¹æ³•å‘èµ·ä¸€ä¸ªé¢„æ£€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œä»¥è·çŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯¥å®é™…è¯·æ±‚ã€‚â€é¢„æ£€è¯·æ±‚â€œçš„ä½¿ç”¨ï¼Œå¯ä»¥é¿å…è·¨åŸŸè¯·æ±‚å¯¹æœåŠ¡å™¨çš„ç”¨æˆ·æ•°æ®äº§ç”Ÿæœªé¢„æœŸçš„å½±å“ã€‚<br>å¦‚ä¸‹æ˜¯ä¸€ä¸ªéœ€è¦æ‰§è¡Œé¢„æ£€è¯·æ±‚çš„ HTTP è¯·æ±‚ï¼š</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> invocation = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://bar.other/resources/post-here/&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> body = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&lt;person&gt;&lt;name&gt;Arun&lt;/name&gt;&lt;/person&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">callOtherDomain</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(invocation)</span><br><span class="line">    &#123;</span><br><span class="line">      invocation.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">      invocation.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;X-PINGOTHER&#x27;</span>, <span class="string">&#x27;pingpong&#x27;</span>);</span><br><span class="line">      invocation.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/xml&#x27;</span>);</span><br><span class="line">      invocation.<span class="property">onreadystatechange</span> = handler;</span><br><span class="line">      invocation.<span class="title function_">send</span>(body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨ POST è¯·æ±‚å‘é€ä¸€ä¸ª XML æ–‡æ¡£ï¼Œè¯¥è¯·æ±‚åŒ…å«äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„è¯·æ±‚é¦–éƒ¨å­—æ®µï¼ˆX-PINGOTHER: pingpongï¼‰ã€‚å¦å¤–ï¼Œè¯¥è¯·æ±‚çš„ Content-Type ä¸º application&#x2F;xmlã€‚å› æ­¤ï¼Œè¯¥è¯·æ±‚éœ€è¦é¦–å…ˆå‘èµ·â€œé¢„æ£€è¯·æ±‚â€ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102308507.png"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /resources/post-here/ HTTP/1.1</span><br><span class="line">Host: bar.other</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-us,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Origin: http://foo.example</span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: X-PINGOTHER, Content-Type</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line">Server: Apache/2.0.61 (Unix)</span><br><span class="line">Access-Control-Allow-Origin: http://foo.example</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, OPTIONS</span><br><span class="line">Access-Control-Allow-Headers: X-PINGOTHER, Content-Type</span><br><span class="line">Access-Control-Max-Age: 86400</span><br><span class="line">Vary: Accept-Encoding, Origin</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: 0</span><br><span class="line">Keep-Alive: timeout=2, max=100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Content-Type: text/plain</span><br></pre></td></tr></table></figure><p>é¢„æ£€è¯·æ±‚å®Œæˆä¹‹åï¼Œå‘é€å®é™…è¯·æ±‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST /resources/post-here/ HTTP/1.1</span><br><span class="line">Host: bar.other</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081130 Minefield/3.1b3pre</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-us,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7</span><br><span class="line">Connection: keep-alive</span><br><span class="line">X-PINGOTHER: pingpong</span><br><span class="line">Content-Type: text/xml; charset=UTF-8</span><br><span class="line">Referer: http://foo.example/examples/preflightInvocation.html</span><br><span class="line">Content-Length: 55</span><br><span class="line">Origin: http://foo.example</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><span class="tag">&lt;<span class="name">person</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>Arun<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 01:15:40 GMT</span><br><span class="line">Server: Apache/2.0.61 (Unix)</span><br><span class="line">Access-Control-Allow-Origin: http://foo.example</span><br><span class="line">Vary: Accept-Encoding, Origin</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: 235</span><br><span class="line">Keep-Alive: timeout=2, max=99</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">[Some GZIP&#x27;d payload]</span><br></pre></td></tr></table></figure><blockquote><p>æµè§ˆå™¨æ£€æµ‹åˆ°ï¼Œä» JavaScript ä¸­å‘èµ·çš„è¯·æ±‚éœ€è¦è¢«é¢„æ£€ã€‚ä»ä¸Šé¢çš„æŠ¥æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œç¬¬ 1~12 è¡Œå‘é€äº†ä¸€ä¸ªä½¿ç”¨ OPTIONS æ–¹æ³•çš„â€œé¢„æ£€è¯·æ±‚â€ã€‚ OPTIONS æ˜¯ HTTP&#x2F;1.1 åè®®ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨ä»¥ä»æœåŠ¡å™¨è·å–æ›´å¤šä¿¡æ¯ã€‚è¯¥æ–¹æ³•ä¸ä¼šå¯¹æœåŠ¡å™¨èµ„æºäº§ç”Ÿå½±å“ã€‚ é¢„æ£€è¯·æ±‚ä¸­åŒæ—¶æºå¸¦äº†ä¸‹é¢ä¸¤ä¸ªé¦–éƒ¨å­—æ®µï¼š</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: X-PINGOTHER, Content-Type</span><br></pre></td></tr></table></figure><blockquote><p>é¦–éƒ¨å­—æ®µ Access-Control-Request-Method å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®é™…è¯·æ±‚å°†ä½¿ç”¨ POST æ–¹æ³•ã€‚é¦–éƒ¨å­—æ®µ Access-Control-Request-Headers å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®é™…è¯·æ±‚å°†æºå¸¦ä¸¤ä¸ªè‡ªå®šä¹‰è¯·æ±‚é¦–éƒ¨å­—æ®µï¼šX-PINGOTHER ä¸ Content-Typeã€‚æœåŠ¡å™¨æ®æ­¤å†³å®šï¼Œè¯¥å®é™…è¯·æ±‚æ˜¯å¦è¢«å…è®¸ã€‚<br>ç¬¬14~26 è¡Œä¸ºé¢„æ£€è¯·æ±‚çš„å“åº”ï¼Œè¡¨æ˜æœåŠ¡å™¨å°†æ¥å—åç»­çš„å®é™…è¯·æ±‚ã€‚é‡ç‚¹çœ‹ç¬¬ 17~20 è¡Œï¼š</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http://foo.example</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, OPTIONS</span><br><span class="line">Access-Control-Allow-Headers: X-PINGOTHER, Content-Type</span><br><span class="line">Access-Control-Max-Age: 86400</span><br></pre></td></tr></table></figure><blockquote><p>é¦–éƒ¨å­—æ®µ Access-Control-Allow-Methods è¡¨æ˜æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨ POST, GET å’Œ OPTIONS æ–¹æ³•å‘èµ·è¯·æ±‚ã€‚è¯¥å­—æ®µä¸ HTTP&#x2F;1.1 Allow: response header ç±»ä¼¼ï¼Œä½†ä»…é™äºåœ¨éœ€è¦è®¿é—®æ§åˆ¶çš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚<br>é¦–éƒ¨å­—æ®µ Access-Control-Allow-Headers è¡¨æ˜æœåŠ¡å™¨å…è®¸è¯·æ±‚ä¸­æºå¸¦å­—æ®µ X-PINGOTHER ä¸ Content-Typeã€‚ä¸ Access-Control-Allow-Methods ä¸€æ ·ï¼ŒAccess-Control-Allow-Headers çš„å€¼ä¸ºé€—å·åˆ†å‰²çš„åˆ—è¡¨ã€‚<br>æœ€åï¼Œé¦–éƒ¨å­—æ®µ Access-Control-Max-Age è¡¨æ˜è¯¥å“åº”çš„æœ‰æ•ˆæ—¶é—´ä¸º 86400 ç§’ï¼Œä¹Ÿå°±æ˜¯ 24 å°æ—¶ã€‚åœ¨æœ‰æ•ˆæ—¶é—´å†…ï¼Œæµè§ˆå™¨æ— é¡»ä¸ºåŒä¸€è¯·æ±‚å†æ¬¡å‘èµ·é¢„æ£€è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œæµè§ˆå™¨è‡ªèº«ç»´æŠ¤äº†ä¸€ä¸ªæœ€å¤§æœ‰æ•ˆæ—¶é—´ï¼Œå¦‚æœè¯¥é¦–éƒ¨å­—æ®µçš„å€¼è¶…è¿‡äº†æœ€å¤§æœ‰æ•ˆæ—¶é—´ï¼Œå°†ä¸ä¼šç”Ÿæ•ˆã€‚</p></blockquote><h2 id="ä¾¿æ·è·¨åŸŸè§£å†³æ–¹æ¡ˆ"><a href="#ä¾¿æ·è·¨åŸŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¾¿æ·è·¨åŸŸè§£å†³æ–¹æ¡ˆ"></a>ä¾¿æ·è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h2><ul><li>Fork githubé¡¹ç›® <a href="https://github.com/Rob--W/cors-anywhere.git">https://github.com/Rob--W/cors-anywhere.git</a></li><li>åœ¨<a href="http://heroku.com/">heroku.com</a>æ³¨å†Œä¸€ä¸ªè´¦å·</li><li>åœ¨<a href="http://heroku.com/">heroku.com</a>ä¸Šåˆ›å»ºä¸€ä¸ªapp</li></ul><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102308258.png"></p><ul><li>appåå­—å”¯ä¸€ï¼Œåç»­è®¿é—®æ—¶ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚æˆ‘çš„å°±æ˜¯halfcoke1</li><li>é€‰æ‹©GitHubï¼Œè¾“å…¥åˆšåˆšForkçš„ä»“åº“ï¼Œç‚¹å‡»connect</li></ul><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102308021.png"></p><ul><li>ç‚¹å‡»è¿™ä¸¤ä¸ªä½ç½®ï¼Œç„¶åç­‰å¾…å®Œæˆ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102308207.png"></p><ul><li>æ¥ä¸‹æ¥ä¾¿å¯ä»¥é€šè¿‡ [<code>https://halfcoke1.herokuapp.com/](https://halfcoke1.herokuapp.com/)&lt;url&gt;</code>çš„æ–¹å¼è¿›è¡Œè®¿é—®ï¼Œæ¯”å¦‚è®¿é—® <a href="https://halfcoke.herokuapp.com/https://github.com/login/oauth/access_token"><code>https://halfcoke1.herokuapp.com/https://github.com/login/oauth/access_token</code></a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1.<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰</a></p><p>2.<a href="https://segmentfault.com/a/1190000011145364">https://segmentfault.com/a/1190000011145364</a></p><p><a href="https://segmentfault.com/a/1190000011145364">å‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆå…¨ï¼‰</a></p><p>3.Coverå›¾ç‰‡æ¥è‡ª<a href="https://chorer.github.io/2019/11/07/F-AJAX%E4%B8%8E%E8%B7%A8%E5%9F%9F%E9%80%9A%E4%BF%A1%EF%BC%88%E4%BA%8C%EF%BC%89/">AJAX ä¸è·¨åŸŸé€šä¿¡ï¼ˆäºŒï¼‰ï¼šè·¨åŸŸè§£å†³æ–¹æ¡ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> è½¬è½½ </category>
          
          <category> WEBæŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEBæŠ€æœ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¬è½½â€”â€”Ubuntu xRDPä¸€é”®éƒ¨ç½²è„šæœ¬</title>
      <link href="/2021/fbd067d7/"/>
      <url>/2021/fbd067d7/</url>
      
        <content type="html"><![CDATA[<h1 id="è½¬è½½â€”â€”Ubuntu-xRDPä¸€é”®éƒ¨ç½²è„šæœ¬"><a href="#è½¬è½½â€”â€”Ubuntu-xRDPä¸€é”®éƒ¨ç½²è„šæœ¬" class="headerlink" title="è½¬è½½â€”â€”Ubuntu xRDPä¸€é”®éƒ¨ç½²è„šæœ¬"></a>è½¬è½½â€”â€”Ubuntu xRDPä¸€é”®éƒ¨ç½²è„šæœ¬</h1><p><strong>åŸæ–‡é“¾æ¥ï¼š<a href="https://c-nergy.be/blog/?p=15978">https://c-nergy.be/blog/?p=15978</a></strong></p><h2 id="åŸæ–‡æ ‡é¢˜ï¼šxRDP-â€“åœ¨Ubuntu-16-04ã€18-04ã€20-04ã€20-10ï¼ˆè„šæœ¬ç‰ˆæœ¬1-2-2ï¼‰ä¸Šè½»æ¾å®‰è£…xRDP"><a href="#åŸæ–‡æ ‡é¢˜ï¼šxRDP-â€“åœ¨Ubuntu-16-04ã€18-04ã€20-04ã€20-10ï¼ˆè„šæœ¬ç‰ˆæœ¬1-2-2ï¼‰ä¸Šè½»æ¾å®‰è£…xRDP" class="headerlink" title="åŸæ–‡æ ‡é¢˜ï¼šxRDP â€“åœ¨Ubuntu 16.04ã€18.04ã€20.04ã€20.10ï¼ˆè„šæœ¬ç‰ˆæœ¬1.2.2ï¼‰ä¸Šè½»æ¾å®‰è£…xRDP"></a>åŸæ–‡æ ‡é¢˜ï¼šxRDP â€“åœ¨Ubuntu 16.04ã€18.04ã€20.04ã€20.10ï¼ˆè„šæœ¬ç‰ˆæœ¬1.2.2ï¼‰ä¸Šè½»æ¾å®‰è£…xRDP</h2><p>ä½ å¥½ï¼Œä¸–ç•Œï¼Œ </p><p>åŸºäºç”¨æˆ·çš„åé¦ˆï¼Œæ„è§å’Œå»ºè®®ï¼Œæˆ‘ä»¬å°†å‘å¸ƒä¸€ä¸ª<strong>æ–°ç‰ˆæœ¬</strong>çš„çš„<strong>è‘—åXRDPçš„å®‰è£…ç¨‹åºè„šæœ¬</strong>ã€‚æ­¤æ–°ç‰ˆæœ¬åŸºæœ¬ä¸Šä¿®å¤äº†æ­¤ç‰ˆæœ¬ä¸­è§£å†³çš„ä¸€äº›<strong>å°é”™è¯¯</strong>ï¼Œå¹¶æä¾›äº†ä¸€äº›æ›´å¥½çš„ä»£ç é€»è¾‘ã€‚æˆ‘ä»¬æ²¡æœ‰æ—¶é—´è¿›è¡ŒçœŸæ­£çš„å¹¿æ³›æµ‹è¯•ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¿™äº›å°çš„æ›´æ”¹ä¸ä¼šç ´åè„šæœ¬ã€‚ </p><p>æˆ‘ä»¬è‘—åçš„xrdpå®‰è£…è„šæœ¬çš„æ–°ç‰ˆæœ¬å°†è®¾ç½®ä¸º <strong>1.2.2</strong> ï¼ˆå³ <strong>xrdp-installer-1.2.2.sh</strong>ï¼‰ã€‚è¯¥è„šæœ¬æ›¿æ¢äº†æ‰€æœ‰ä»¥å‰çš„ç‰ˆæœ¬ã€‚  </p><p>æ‰€ä»¥ï¼Œèµ°å§ï¼ </p><h3 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h3><p>è¯¥ <strong>xrdp-installer-1.2.2.sh</strong> è„šæœ¬ <strong>ç¼“è§£</strong> ä¹‹ä¸ŠXRDPçš„å®‰è£…åçš„é…ç½®æ“ä½œ <strong>çš„Ubuntu</strong> æ“ä½œç³»ç»Ÿã€‚è¯¥ç‰ˆæœ¬æ˜¯è¯¥è„šæœ¬çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…æ‹¬å¯¹Ubuntu 20.10ï¼ˆæœ€è¿‘äº2020å¹´10æœˆå‘å¸ƒï¼‰çš„æ”¯æŒã€‚ </p><h4 id="è„šæœ¬ç‰ˆæœ¬å’Œå—æ”¯æŒçš„Ubuntuç‰ˆæœ¬"><a href="#è„šæœ¬ç‰ˆæœ¬å’Œå—æ”¯æŒçš„Ubuntuç‰ˆæœ¬" class="headerlink" title="è„šæœ¬ç‰ˆæœ¬å’Œå—æ”¯æŒçš„Ubuntuç‰ˆæœ¬"></a>è„šæœ¬ç‰ˆæœ¬å’Œå—æ”¯æŒçš„Ubuntuç‰ˆæœ¬</h4><p>è„šæœ¬ç‰ˆæœ¬å°†è®¾ç½®ä¸º <strong>1.2.2ã€‚</strong>è¯¥ <strong>xrdp-installer-1.2.2.sh</strong> è„šæœ¬å°†æ”¯æŒä»¥ä¸‹Ubuntuæ“ä½œç³»ç»Ÿç‰ˆæœ¬ </p><ul><li>Ubuntu 16.04.x </li><li>Ubuntu 18.04.x</li><li>Ubuntu 20.04.x</li><li>Ubuntu 20.10</li></ul><h4 id="å…ˆå†³æ¡ä»¶å’Œå‡è®¾"><a href="#å…ˆå†³æ¡ä»¶å’Œå‡è®¾" class="headerlink" title="å…ˆå†³æ¡ä»¶å’Œå‡è®¾"></a>å…ˆå†³æ¡ä»¶å’Œå‡è®¾</h4><p>ä¸ºäº†åœ¨ä½¿ç”¨è„šæœ¬æ—¶è·å¾—æœ€ä½³æ•ˆæœï¼Œåº”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p><ul><li>æˆ‘ä»¬å‡è®¾æ‚¨çš„è®¡ç®—æœºåœ¨æ‰§è¡Œå®‰è£…æ—¶å·²è¿æ¥åˆ°Internetã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºéœ€è¦åœ¨Ubuntuæœºå™¨ä¸Šä¸‹è½½å¹¶å®‰è£…å…¶ä»–è½¯ä»¶åŒ…å’Œè½¯ä»¶ã€‚</li><li>è¯¥è„šæœ¬å¯åœ¨å—æ”¯æŒçš„æ“ä½œç³»ç»Ÿï¼ˆUbuntu 16.04.xï¼ŒUbuntu 18.04.xï¼ŒUbuntu 20.04ï¼ŒUbuntu 20.10ï¼‰ä¸Šè¿è¡Œ</li><li>éœ€è¦ä½¿ç”¨å®˜æ–¹çš„Ubuntuå‘è¡Œç‰ˆï¼ˆ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ <strong>ä¸æ”¯æŒ</strong>å…¶ä»–Ubuntuç‰ˆæœ¬!! â€“å°†æ¥å¯èƒ½ä¼šæ”¹å˜ï¼‰ </li><li>æ— éœ€ä½¿ç”¨å…¶ä»–æ¡Œé¢ç•Œé¢ï¼ˆå¦‚æœè¿è¡ŒUbuntu 16.04ï¼ŒxRDPä¼šè¯å°†æ˜¾ç¤ºå¸¦æœ‰Dockèœå•æˆ–Unityçš„Ubuntu Gnome Desktopï¼‰</li><li>å¦‚æœè¿˜å¯ä»¥ä½¿ç”¨å£°éŸ³åŠŸèƒ½ï¼Œåˆ™è®¡ç®—æœºä¸Šå…·æœ‰å£°éŸ³åŠŸèƒ½</li></ul><h4 id="æ­¤ç‰ˆæœ¬æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Ÿ"><a href="#æ­¤ç‰ˆæœ¬æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Ÿ" class="headerlink" title="æ­¤ç‰ˆæœ¬æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Ÿ"></a>æ­¤ç‰ˆæœ¬æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Ÿ</h4><p>å¦‚ä¸Šæ‰€è¿°ï¼Œè„šæœ¬å¹¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œä»…å¼•å…¥äº†ä¸€äº›å°çš„å˜åŒ–ã€‚å®ƒä¸»è¦åŒ…æ‹¬ç¾è§‚æ›´æ”¹å’Œè¾ƒå°çš„é”™è¯¯ä¿®å¤ï¼Œä»¥åŠå°†ç”¨æˆ·åé¦ˆå»ºè®®åŒ…æ‹¬åˆ°è„šæœ¬ä¸­ã€‚å› æ­¤ï¼Œç‰ˆæœ¬1.2.2è§£å†³äº†ä»¥ä¸‹é—®é¢˜ </p><ul><li>æŒ‡å‘é€šç”¨çš„ubuntuå­˜æ¡£ï¼ˆarchive.ubuntu.comï¼‰è€Œä¸æ˜¯ä½¿ç”¨æœ¬åœ°åŒ–çš„å­˜æ¡£ï¼ˆbe.archive.ubuntu.comï¼‰â€“<strong>æ„Ÿè°¢Thomas</strong></li><li>ä»githubè‡ªåŠ¨è·å–xrdpå’Œxorgxrdpè½¯ä»¶åŒ…ï¼Œå¹¶åœ¨ä½¿ç”¨è‡ªå®šä¹‰å®‰è£…æ¨¡å¼æ—¶ä½¿ç”¨æ­¤ä¿¡æ¯æ¥æ„å»ºè½¯ä»¶åŒ…ï¼ˆ<strong>æ„Ÿè°¢Hiero</strong>ï¼‰</li><li>é€‰æ‹©åˆ é™¤é€‰é¡¹æ—¶å¼ºåˆ¶åˆ é™¤xrdp-installer-check.logæ–‡ä»¶ï¼Œä»¥ç¡®ä¿ç›¸åº”åœ°åˆ é™¤äº†xrdpæ–‡ä»¶å¤¹ï¼ˆ<strong>æ„Ÿè°¢Hiero</strong>ï¼‰</li><li>è‡ªåŠ¨åŒ–è„šæœ¬ç‰ˆæœ¬æ§åˆ¶</li></ul><p><strong>ä¸€ä¸ªè„šæœ¬çš„ä¸‹è½½ç‰ˆæœ¬å¯åœ¨æ–‡ç« åº•éƒ¨</strong></p><h3 id="å¦‚ä½•ä½¿ç”¨è„šæœ¬"><a href="#å¦‚ä½•ä½¿ç”¨è„šæœ¬" class="headerlink" title="å¦‚ä½•ä½¿ç”¨è„šæœ¬"></a>å¦‚ä½•ä½¿ç”¨è„šæœ¬</h3><p>è¯¥<strong>XRDPçš„å®‰è£…ç¨‹åº-1.2.2</strong>è„šæœ¬ä¼šä»¥ç±»ä¼¼çš„æ–¹å¼ä¸ä»¥å‰çš„ç‰ˆæœ¬å·¥ä½œã€‚ä¸‹ä¸€èŠ‚å°†è¯´æ˜å¦‚ä½•ä½¿ç”¨è„šæœ¬ä¸‹è½½ï¼Œæå–ï¼Œè®¾ç½®å¯æ‰§è¡Œæ¨¡å¼ä»¥åŠæ‰§è¡Œå®‰è£…ã€‚è¯¥è„šæœ¬æä¾›äº†ä¸€äº›å¯ç”¨äºè‡ªå®šä¹‰å®‰è£…è¿‡ç¨‹çš„å¼€å…³ã€‚</p><p>å› æ­¤ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿™å°†å¦‚ä½•å·¥ä½œâ€¦</p><h4 id="å…è´£å£°æ˜"><a href="#å…è´£å£°æ˜" class="headerlink" title="å…è´£å£°æ˜"></a>å…è´£å£°æ˜</h4><p>è¯¥è„šæœ¬æŒ‰<strong>åŸæ ·</strong>æä¾›ã€‚ä½¿ç”¨å®ƒéœ€è¦<strong>æ‚¨è‡ªæ‹…é£é™©</strong>ï¼ </p><h4 id="æ­¥éª¤1-â€“ä¸‹è½½è„šæœ¬"><a href="#æ­¥éª¤1-â€“ä¸‹è½½è„šæœ¬" class="headerlink" title="æ­¥éª¤1 â€“ä¸‹è½½è„šæœ¬"></a>æ­¥éª¤1 â€“ä¸‹è½½è„šæœ¬</h4><p>è¦ä¸‹è½½è„šæœ¬ï¼Œæ‚¨æœ‰å¤šä¸ªé€‰æ‹©ã€‚æ‚¨å¯ä»¥ä»ç»ˆç«¯å‘å‡ºä»¥ä¸‹å‘½ä»¤ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.c-nergy.be/downloads/xrdp-installer-1.2.2.zip</span><br></pre></td></tr></table></figure><p>æ‚¨ä¹Ÿå¯ä»¥åªä½¿ç”¨æµè§ˆå™¨ï¼Œç„¶åå•å‡»é“¾æ¥æ¥ä¸‹è½½è„šæœ¬ï¼š  </p><ul><li><a href="http://www.c-nergy.be/downloads/xrdp-installer-1.2.2.zip">xrdp-installer-1.2.2.zip</a></li></ul><p><strong>ä¸ºé˜²æ­¢æ–‡ä»¶ä¸¢å¤±ï¼Œå›½å†…ç”¨æˆ·å¯ä½¿ç”¨è¿™ä¸ªé“¾æ¥<a href="https://gitee.com/halfcoke/storage/blob/master/xrdp-installer-1.2.2.zip">xrdp-installer-1.2.2.zip</a></strong></p><h4 id="æ­¥éª¤2-â€“è§£å‹ç¼©æ–‡ä»¶"><a href="#æ­¥éª¤2-â€“è§£å‹ç¼©æ–‡ä»¶" class="headerlink" title="æ­¥éª¤2 â€“è§£å‹ç¼©æ–‡ä»¶"></a>æ­¥éª¤2 â€“è§£å‹ç¼©æ–‡ä»¶</h4><p>ä¸‹è½½åŒ…å«æ–‡ä»¶çš„zipè½¯ä»¶åŒ…åï¼Œæ‚¨éœ€è¦å…ˆå°†å…¶è§£å‹ç¼©ã€‚è¦è§£å‹ç¼©è½¯ä»¶åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ç»ˆç«¯æ§åˆ¶å°å¹¶å‘å‡ºä»¥ä¸‹å‘½ä»¤ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è§£å‹ç¼©xrdp-installer-1.2.2.zip </span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨GUIå’ŒNautilusæ–‡ä»¶ç®¡ç†å™¨é€‰æ‹©ä¸‹è½½çš„è½¯ä»¶åŒ…ï¼Œå³é”®å•å‡»å®ƒå¹¶é€‰æ‹©é€‰é¡¹â€œ <strong>æå–æ­¤å¤„â€ã€‚</strong></p><h4 id="æ­¥éª¤3-â€“åœ¨è„šæœ¬ä¸Šè®¾ç½®â€œæ‰§è¡Œæƒâ€"><a href="#æ­¥éª¤3-â€“åœ¨è„šæœ¬ä¸Šè®¾ç½®â€œæ‰§è¡Œæƒâ€" class="headerlink" title="æ­¥éª¤3 â€“åœ¨è„šæœ¬ä¸Šè®¾ç½®â€œæ‰§è¡Œæƒâ€"></a>æ­¥éª¤3 â€“åœ¨è„šæœ¬ä¸Šè®¾ç½®â€œæ‰§è¡Œæƒâ€</h4><p>å°†<strong>xrdp-installer-1.2.2.sh</strong> è„šæœ¬ä¸‹è½½åˆ°æ‚¨çš„ç³»ç»Ÿï¼Œæå–å†…å®¹å¹¶å°†å…¶æ ‡è®°ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸ºæ­¤ï¼Œè¯·åœ¨ç»ˆç«¯æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod + xã€œ/ Downloads / xrdp-installer-1.2.2.sh</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šè°ƒæ•´<strong>xrdp-Installer-1.2.2.sh</strong>è„šæœ¬çš„è·¯å¾„ ä»¥åæ˜ æ‚¨çš„</em> <em>ç¯å¢ƒ</em></p><h4 id="æ­¥éª¤4-â€“ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ"><a href="#æ­¥éª¤4-â€“ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ" class="headerlink" title="æ­¥éª¤4 â€“ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ"></a>æ­¥éª¤4 â€“ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ</h4><p>è¯¥è„šæœ¬<strong>éœ€è¦</strong>ä»¥<strong>æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œ</strong>ã€‚è¯¥è„šæœ¬å°†å¼€å§‹è¿è¡Œï¼Œå¹¶åœ¨å¯åŠ¨sudoæ“ä½œæ—¶æç¤ºæ‚¨è¾“å…¥å¯†ç ã€‚å¦‚æœæ‚¨ä»¥rootèº«ä»½æˆ–ä½¿ç”¨sudoå‘½ä»¤è¿è¡Œè„šæœ¬ï¼Œåˆ™rootç”¨æˆ·ä¸å­˜åœ¨Downloadæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”è„šæœ¬æ— æ³•æŒ‰é¢„æœŸè¿è¡Œã€‚ä¸ºäº†å…‹æœè¿™ç§æƒ…å†µï¼Œè„šæœ¬è¿˜æ£€æŸ¥å“ªä¸ªç”¨æˆ·æ­£åœ¨æ‰§è¡Œè„šæœ¬ã€‚å¦‚æœè„šæœ¬åœ¨sudoæˆ–rootå¸æˆ·ä¸‹è¿è¡Œï¼Œå°†æ˜¾ç¤ºè­¦å‘Šæ¶ˆæ¯ï¼Œå¹¶ä¸”è„šæœ¬ä¸ä¼šæ‰§è¡Œ</p><h4 id="æ­¥éª¤5-â€“å¼€å…³å’Œå‚æ•°"><a href="#æ­¥éª¤5-â€“å¼€å…³å’Œå‚æ•°" class="headerlink" title="æ­¥éª¤5 â€“å¼€å…³å’Œå‚æ•°"></a>æ­¥éª¤5 â€“å¼€å…³å’Œå‚æ•°</h4><p>è¯¥<strong>xrdp-installer-1.2.2.sh</strong>è„šæœ¬å¯ä»¥æ‰§è¡Œä¸ºæ˜¯ï¼ˆ<strong>ä¸å¸¦å‚æ•°æˆ–å¼€å…³</strong>ï¼‰ã€‚è¿™å°†æ‰§è¡ŒxRDPçš„æ ‡å‡†ï¼ˆå’ŒåŸºæœ¬ï¼‰å®‰è£…ã€‚æ²¡æœ‰å£°éŸ³æˆ–è‡ªå®šä¹‰xrdpç™»å½•è„šæœ¬å°†å¯ç”¨ã€‚ä½†æ˜¯ï¼Œæ­¤å®‰è£…æ¨¡å¼å°†æä¾›è¿œç¨‹æ¡Œé¢ï¼Œé©±åŠ¨å™¨é‡å®šå‘å’Œå‰ªè´´æ¿é‡å®šå‘ã€‚ </p><p>è¯¥<strong>xrdp-installer-1.2.2.sh</strong>è„šæœ¬ä¹Ÿæ¥å—ä¸€äº›é¢å¤–çš„å‚æ•°ï¼Œè¿™å°†æœ‰åŠ©äºå®šåˆ¶XRDPå®‰è£…å¹¶å¯ç”¨å…¶ä»–åŠŸèƒ½ã€‚è¯¥è„šæœ¬æä¾›ä»¥ä¸‹å‚æ•° </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--helpæˆ–-h =&gt;å°†æ˜¾ç¤ºåŸºæœ¬çš„å¸®åŠ©èœå•</span><br><span class="line">--soundæˆ–-s =&gt;å°†å¯ç”¨å£°éŸ³é‡å®šå‘ </span><br><span class="line">--loginscreenæˆ–-l =&gt;å°†è‡ªå®šä¹‰xRDPç™»å½•å±å¹• </span><br><span class="line">--removeæˆ–-r =&gt;å°†åˆ é™¤xrdpè½¯ä»¶åŒ… </span><br><span class="line">--customæˆ–-c =&gt;å°†æ‰§è¡Œè‡ªå®šä¹‰å®‰è£…ï¼ˆå³ä»æºä»£ç ç¼–è¯‘ï¼‰</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤6-â€“ä½¿ç”¨è„šæœ¬æ‰§è¡ŒxRDPå®‰è£…"><a href="#æ­¥éª¤6-â€“ä½¿ç”¨è„šæœ¬æ‰§è¡ŒxRDPå®‰è£…" class="headerlink" title="æ­¥éª¤6 â€“ä½¿ç”¨è„šæœ¬æ‰§è¡ŒxRDPå®‰è£…"></a>æ­¥éª¤6 â€“ä½¿ç”¨è„šæœ¬æ‰§è¡ŒxRDPå®‰è£…</h4><p>ä»¥ä¸‹å„èŠ‚å°†æä¾›ä¸€äº›æœ‰å…³å¦‚ä½•ä½¿ç”¨è„šæœ¬çš„ç¤ºä¾‹å’Œæ–¹æ¡ˆã€‚ </p><h5 id="æ ‡å‡†å®‰è£…â€“æ— å‚æ•°"><a href="#æ ‡å‡†å®‰è£…â€“æ— å‚æ•°" class="headerlink" title="æ ‡å‡†å®‰è£…â€“æ— å‚æ•°"></a>æ ‡å‡†å®‰è£…â€“æ— å‚æ•°</h5><p>å¦‚ä¸Šæ‰€è¿°ï¼Œæ‚¨å¯ä»¥å†³å®šä½¿ç”¨Ubuntuå­˜å‚¨åº“ä¸­å¯ç”¨çš„é»˜è®¤xrdpè½¯ä»¶åŒ…ï¼Œå¹¶æ‰§è¡ŒåŸºæœ¬å®‰è£…ï¼Œè¿™å°†ä¸ºæ‚¨æä¾›è¿œç¨‹æ¡Œé¢åŠŸèƒ½å¹¶è‡ªå®šä¹‰è¿œç¨‹ä¼šè¯ã€‚è¯¥è„šæœ¬å°†ç¡®ä¿å½“ç”¨æˆ·æœ¬åœ°æˆ–è¿œç¨‹ç™»å½•æ—¶ï¼Œå°†ä¿æŒç›¸åŒçš„å¤–è§‚ã€‚ </p><p>è¦æ‰§è¡Œ <strong>æ ‡å‡†å®‰è£…</strong>ï¼Œè¯·<strong>ä¸å¸¦å‚æ•°</strong>æ‰§è¡Œè„šæœ¬ ã€‚æ‰“å¼€ <strong>ç»ˆç«¯æ§åˆ¶å°</strong>ï¼Œæµè§ˆåˆ°è„šæœ¬å·²ä¸‹è½½çš„ä½ç½®ï¼Œç„¶åå‘å‡ºä»¥ä¸‹å‘½ä»¤ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xrdp-installer-1.2.2.sh</span><br></pre></td></tr></table></figure><p>xrdpå®‰è£…è½¯ä»¶åŒ…å°†å¯åŠ¨æ—¶ï¼Œè¦æ±‚æ‚¨ <strong>è¾“å…¥å¯†ç ã€‚</strong> æä¾›å¯†ç å¹¶ç»§ç»­å®‰è£…ã€‚ç­‰å¾…è„šæœ¬å®Œæˆã€‚å®Œæˆåï¼Œæœºå™¨ <strong>å°†ä¸ä¼šè‡ªåŠ¨é‡å¯</strong> ï¼Œå› æ­¤æ‚¨å¯ä»¥æŸ¥çœ‹è„šæœ¬æ‰§è¡Œçš„æ“ä½œâ€¦ã€‚</p><p><em><strong>é‡è¦ç¬”è®°</strong></em></p><p><em>å¦‚æœæ‚¨åœ¨<strong>Ubuntu 16.04.x</strong>ä¸Š<strong>è¿è¡Œè„šæœ¬</strong>ï¼Œå³ä½¿æœªæŒ‡å®šä»»ä½•å‚æ•°ï¼Œä¹Ÿ<strong>å°†å§‹ç»ˆæ‰§è¡Œ</strong>è‡ªå®šä¹‰å®‰è£…ã€‚è¿™æ˜¯å› ä¸ºUbuntu 16.04.xé™„å¸¦äº†ä¸€ä¸ªéå¸¸è€çš„xrdpè½¯ä»¶åŒ…ï¼ˆ0.6ç‰ˆï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›æ‰€æœ‰å¿…éœ€çš„åŠŸèƒ½ã€‚å®šåˆ¶å®‰è£…æä¾›é©±åŠ¨å™¨é‡å®šå‘ï¼Œå‰ªè´´æ¿å’Œå¯¹Unity Desktopçš„è®¿é—®</em></p><h5 id="å¸¦å‚æ•°çš„æ ‡å‡†å®‰è£…"><a href="#å¸¦å‚æ•°çš„æ ‡å‡†å®‰è£…" class="headerlink" title="å¸¦å‚æ•°çš„æ ‡å‡†å®‰è£…"></a>å¸¦å‚æ•°çš„æ ‡å‡†å®‰è£…</h5><p>è¯¥è„šæœ¬å¯ç”¨äºæ‰§è¡Œæ ‡å‡†å®‰è£…ï¼Œå¹¶ä¸”ä»ç„¶ä¼ é€’ä¸€äº›å‚æ•°ä»¥è·å–å¤§å¤šæ•°xRDPè½¯ä»¶åŒ…åŠå…¶åŠŸèƒ½ã€‚å¯¹äºæ‰€æœ‰Ubuntuç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°ç»„åˆ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./xrdp-installer-1.2.2.sh -s       ï¼ˆè¿™å°†å¯ç”¨å£°éŸ³é‡å®šå‘ï¼‰ </span><br><span class="line">./xrdp-installer-1.2.2.sh -l      ï¼ˆè¿™å°†è‡ªå®šä¹‰xrdpç™»å½•å±å¹•-è¯·å‚è§æ­¤å¤„ï¼‰</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œæ‚¨å¯ä»¥ç»„åˆå¼€å…³ï¼ˆä»»æ„é¡ºåºï¼‰ä»¥å¯ç”¨æ›´å¤šåŠŸèƒ½ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xrdp-installer-1.2.2.sh -s -l       ï¼ˆè¿™å°†å¯ç”¨å£°éŸ³é‡å®šå‘å¹¶è‡ªå®šä¹‰xrdpç™»å½•å±å¹•ï¼‰</span><br></pre></td></tr></table></figure><p><em><strong>é‡è¦ç¬”è®°</strong></em></p><p><em>è¯¥è„šæœ¬<strong>å¯ä»¥</strong>åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šå¤šæ¬¡<strong>è¿è¡Œ</strong>ã€‚å¦‚æœæœ€åˆè¿è¡Œçš„è„šæœ¬æ²¡æœ‰å‚æ•°ï¼Œä½†æ˜¯ä¹‹åå†³å®šå¯ç”¨å…¶ä»–åŠŸèƒ½ï¼Œåˆ™å¯ä»¥é‡æ–°æ‰§è¡Œè„šæœ¬å¹¶å¯ç”¨å…¶ä»–åŠŸèƒ½ã€‚</em> </p><h5 id="è‡ªå®šä¹‰å®‰è£…â€“é»˜è®¤å®‰è£…"><a href="#è‡ªå®šä¹‰å®‰è£…â€“é»˜è®¤å®‰è£…" class="headerlink" title="è‡ªå®šä¹‰å®‰è£…â€“é»˜è®¤å®‰è£…"></a>è‡ªå®šä¹‰å®‰è£…â€“é»˜è®¤å®‰è£…</h5><p>è‡ªå®šä¹‰å®‰è£…è„šæœ¬éå¸¸çµæ´»ã€‚å®šåˆ¶å®‰è£…æ„å‘³ç€è„šæœ¬å°†ä»æºäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ç¼–è¯‘xrdpè½¯ä»¶åŒ…ã€‚å®šåˆ¶å®‰è£…è„šæœ¬å§‹ç»ˆä½¿ç”¨å¯ç”¨çš„æœ€æ–°xrdpè½¯ä»¶åŒ…ç‰ˆæœ¬ </p><p>è¦æ‰§è¡Œ<strong>è‡ªå®šä¹‰å®‰è£…</strong>ï¼Œæ‚¨è‡³å°‘éœ€è¦ä¼ é€’<strong>ä¸€ä¸ªå‚æ•°</strong>ã€‚ä»¥ä¸‹å‘½ä»¤è¡Œæ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œè‡ªå®šä¹‰å®‰è£… </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xrdp-installer-1.2.2.sh -c      ï¼ˆè¿™å°†æ‰§è¡Œè‡ªå®šä¹‰å®‰è£…ï¼Œä½†ä¸ä¼šå¯ç”¨å£°éŸ³é‡å®šå‘æˆ–è‡ªå®šä¹‰ç™»å½•å±å¹•ä¹‹ç±»çš„advåŠŸèƒ½ï¼‰</span><br></pre></td></tr></table></figure><p><em><strong>é‡è¦ç¬”è®°</strong></em></p><p><em>å¦‚æœæ‚¨åœ¨<strong>Ubuntu 16.04.x</strong>ä¸Š<strong>è¿è¡Œè„šæœ¬</strong>ï¼Œåˆ™-cå¼€å…³å°†è¢«å¿½ç•¥ï¼Œå¹¶å°†æ‰§è¡Œè‡ªå®šä¹‰å®‰è£…è¿‡ç¨‹ã€‚**è¿™æ˜¯å› ä¸ºUbuntu 16.04.xé™„å¸¦äº†ä¸€ä¸ªéå¸¸è€çš„xrdpè½¯ä»¶åŒ…ï¼ˆ0.6ç‰ˆï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›æ‰€æœ‰å¿…éœ€çš„åŠŸèƒ½ã€‚å®šåˆ¶å®‰è£…æä¾›é©±åŠ¨å™¨é‡å®šå‘ï¼Œå‰ªè´´æ¿å’Œå¯¹Unity Desktopçš„è®¿é—®</em></p><h5 id="å®šåˆ¶å®‰è£…â€“å…¶ä»–é€‰é¡¹"><a href="#å®šåˆ¶å®‰è£…â€“å…¶ä»–é€‰é¡¹" class="headerlink" title="å®šåˆ¶å®‰è£…â€“å…¶ä»–é€‰é¡¹"></a>å®šåˆ¶å®‰è£…â€“å…¶ä»–é€‰é¡¹</h5><p>å¦‚æœç”¨æˆ·è¦å¯ç”¨å…¶ä»–åŠŸèƒ½ï¼Œåˆ™å°†ä¼ é€’ä¸€äº›å…¶ä»–å‚æ•°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./xrdp-installer-1.2.2.sh -c -s      ï¼ˆå°†æ‰§è¡Œè‡ªå®šä¹‰å®‰è£…å¹¶å¯ç”¨å£°éŸ³é‡å®šå‘ï¼‰</span><br><span class="line">./xrdp-installer-1.2.2.sh -c -l      ï¼ˆå°†æ‰§è¡Œè‡ªå®šä¹‰å®‰è£…å¹¶å®šåˆ¶XRDPç™»å½•å±å¹•ï¼‰</span><br><span class="line">./xrdp-installer-1.2.2.sh -C -l -S   ï¼ˆè¿™ä¼šæ‰§è¡Œè‡ªå®šä¹‰å®‰è£…ï¼Œå¯ç”¨å£°éŸ³å’Œè‡ªå®šä¹‰ç™»å½•å±å¹•ï¼‰</span><br></pre></td></tr></table></figure><p><em><strong>é‡è¦ç¬”è®°</strong></em></p><p><em>è¯¥è„šæœ¬<strong>å¯ä»¥</strong>åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šå¤šæ¬¡<strong>è¿è¡Œ</strong>ã€‚å¦‚æœæœ€åˆè¿è¡Œçš„è„šæœ¬æ²¡æœ‰å‚æ•°ï¼Œä½†æ˜¯ä¹‹åå†³å®šå¯ç”¨å…¶ä»–åŠŸèƒ½ï¼Œåˆ™å¯ä»¥é‡æ–°æ‰§è¡Œè„šæœ¬å¹¶å¯ç”¨å…¶ä»–åŠŸèƒ½ã€‚</em> </p><h5 id="åˆ é™¤å®‰è£…é€‰é¡¹"><a href="#åˆ é™¤å®‰è£…é€‰é¡¹" class="headerlink" title="åˆ é™¤å®‰è£…é€‰é¡¹"></a>åˆ é™¤å®‰è£…é€‰é¡¹</h5><p>æ­¤ç‰ˆæœ¬çš„è„šæœ¬è¿˜é™„å¸¦åˆ é™¤xRDPè½¯ä»¶åŒ…çš„é€‰é¡¹ã€‚ä»…å½“æ‚¨ä½¿ç”¨æ­¤è„šæœ¬çš„æ­¤ç‰ˆæœ¬æ‰§è¡Œå®‰è£…æ—¶ï¼Œæ‰åº”ä½¿ç”¨åˆ é™¤é€‰é¡¹ã€‚è¦åˆ é™¤xrdpè½¯ä»¶åŒ…ï¼Œæ‚¨åªéœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xrdp-installer-1.2.2.sh -r      ï¼ˆåˆ é™¤xrdpè½¯ä»¶åŒ…ï¼‰</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤5-â€“æµ‹è¯•æ‚¨çš„é…ç½®"><a href="#æ­¥éª¤5-â€“æµ‹è¯•æ‚¨çš„é…ç½®" class="headerlink" title="æ­¥éª¤5 â€“æµ‹è¯•æ‚¨çš„é…ç½®"></a>æ­¥éª¤5 â€“æµ‹è¯•æ‚¨çš„é…ç½®</h4><p>åœ¨è„šæœ¬è¿è¡Œä¹‹åï¼Œä»¥åŠåœ¨é‡æ–°å¯åŠ¨&#x2F;å…³é—­å’Œå¯åŠ¨è¿‡ç¨‹ä¹‹åï¼Œå°±è¯¥è¿›è¡Œæµ‹è¯•äº†ï¼Œçœ‹çœ‹æ‚¨æ˜¯å¦ç¡®å®å¯ä»¥ä¸Ubuntuè®¡ç®—æœºè¿›è¡Œå¹³æ»‘çš„è¿œç¨‹è¿æ¥ã€‚è¯·è®°ä½ï¼Œä½¿ç”¨xRDPè§£å†³æ–¹æ¡ˆæ—¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨è®¡ç®—æœº<strong>ä¸Šæœ¬åœ°****ç™»å½•</strong>æˆ–<strong>è¿œç¨‹ç™»å½•</strong>ã€‚å¦‚æœæ‰§è¡Œè¿œç¨‹è¿æ¥çš„ç”¨æˆ·æœ¬åœ°ç™»å½•åˆ°ç³»ç»Ÿï¼Œåˆ™è¿œç¨‹è¿æ¥å°†å¯åŠ¨ï¼Œä½†å°†ç«‹å³ç»ˆæ­¢ã€‚è¿™å°±æ˜¯å¦‚ä»Šçš„å·¥ä½œæ–¹å¼ã€‚ </p><p>å› æ­¤ï¼Œè¯·ç¡®ä¿æ‰§è¡Œæµ‹è¯•çš„ç”¨æˆ·æœªåœ¨æœ¬åœ°ç™»å½•ï¼Œè¯·å¯åŠ¨æ‚¨å–œæ¬¢çš„è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯å¹¶æ‰§è¡Œè¿æ¥ã€‚æ ¹æ®æ‚¨çš„é€‰æ‹©ï¼Œå°†ä¸ºæ‚¨æ˜¾ç¤ºç»¿è‰²çš„xrdpç™»å½•å±å¹•æˆ–è‡ªå®šä¹‰ç™»å½•å±å¹•ï¼ˆç´«è‰²èƒŒæ™¯ï¼‰ã€‚åªéœ€è¾“å…¥æ‚¨çš„å‡­æ®å¹¶å¼€å§‹æµ‹è¯•å®‰è£…ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼çš„æ¡Œé¢ç•Œé¢ï¼Œå…¶ä¸­ä½¿ç”¨äº†Gnome Desktopï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°Dockã€‚ </p><h3 id="å·²çŸ¥é—®é¢˜å’Œå±€é™æ€§"><a href="#å·²çŸ¥é—®é¢˜å’Œå±€é™æ€§" class="headerlink" title="å·²çŸ¥é—®é¢˜å’Œå±€é™æ€§"></a>å·²çŸ¥é—®é¢˜å’Œå±€é™æ€§</h3><h4 id="å·²çŸ¥çš„é—®é¢˜"><a href="#å·²çŸ¥çš„é—®é¢˜" class="headerlink" title="å·²çŸ¥çš„é—®é¢˜"></a>å·²çŸ¥çš„é—®é¢˜</h4><h5 id="å£°éŸ³é‡å®šå‘é—®é¢˜"><a href="#å£°éŸ³é‡å®šå‘é—®é¢˜" class="headerlink" title="å£°éŸ³é‡å®šå‘é—®é¢˜"></a>å£°éŸ³é‡å®šå‘é—®é¢˜</h5><p>å¦‚æœé€‰æ‹©äº†<strong>å£°éŸ³é‡å®šå‘</strong>é€‰é¡¹ï¼Œåˆ™é‡å¯Ubuntuç³»ç»Ÿæ˜¯ä¸å¤Ÿçš„ï¼Œå£°éŸ³é‡å®šå‘å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚å¦‚æœé€‰æ‹©äº†å£°éŸ³é‡å®šå‘é€‰é¡¹ï¼Œåˆ™å¿…é¡»<strong>å…³é—­</strong>Ubuntuè®¡ç®—æœºï¼Œç„¶åå†æ¬¡å¯åŠ¨å®ƒï¼Œä»¥ç¡®ä¿å£°éŸ³é‡å®šå‘åŠŸèƒ½èƒ½å¤ŸæŒ‰é¢„æœŸå·¥ä½œã€‚ </p><p><strong>å£°éŸ³é‡å®šå‘****åœ¨Ubuntu 19.10åŠæ›´é«˜ç‰ˆæœ¬ä¸Š</strong>æ— æ³•<strong>æ­£å¸¸å·¥ä½œ</strong> ã€‚æ¨¡å—å·²åˆ›å»ºå¹¶å¤åˆ¶åˆ°æ­£ç¡®çš„ä½ç½®ã€‚ä½†æ˜¯ï¼Œxrdpæ¥æ”¶å™¨æ¨¡å—æ°¸è¿œä¸ä¼šåŠ è½½åˆ°è¿œç¨‹ä¼šè¯ä¸­ï¼Œä¹Ÿä¸ä¼šéšæœºåŠ è½½åˆ°è¿œç¨‹ä¼šè¯ä¸­ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨åªéœ€è¦åœ¨è¿œç¨‹ä¼šè¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå£°éŸ³å°±ä¼šå¼€å§‹èµ·ä½œç”¨ </p><h5 id="é©±åŠ¨å™¨é‡å®šå‘"><a href="#é©±åŠ¨å™¨é‡å®šå‘" class="headerlink" title="é©±åŠ¨å™¨é‡å®šå‘"></a>é©±åŠ¨å™¨é‡å®šå‘</h5><p>è¦å°†é©±åŠ¨å™¨é‡å®šå‘åˆ°xrdpè¿œç¨‹ä¼šè¯ï¼Œå¿…é¡» <strong>ç¡®ä¿åœ¨â€œæœ¬åœ°èµ„æºâ€é€‰é¡¹å¡ä¸­é€‰æ‹©çš„å”¯ä¸€é€‰é¡¹æ˜¯â€œå‰ªè´´æ¿â€é€‰é¡¹å’Œâ€œé©±åŠ¨å™¨â€é€‰é¡¹ã€‚</strong>æ£€æŸ¥ä»¥ä¸‹å±å¹•æˆªå›¾ï¼Œå¹¶ç¡®ä¿æ‚¨å…·æœ‰ç›¸åŒçš„è®¾ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102309471.png"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102309501.png"></p><p>ç›¸åº”åœ°è®¾ç½®äº†è¿™äº›è®¾ç½®åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°thin clientæ–‡ä»¶å¤¹ä¸­è£…æœ‰æ¥è‡ªWindowsè®¡ç®—æœºçš„é‡å®šå‘é©±åŠ¨å™¨ã€‚</p><h4 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h4><h5 id="æ¯ä¸ªç”¨æˆ·é™åˆ¶ä¸€ä¸ªä¼šè¯"><a href="#æ¯ä¸ªç”¨æˆ·é™åˆ¶ä¸€ä¸ªä¼šè¯" class="headerlink" title="æ¯ä¸ªç”¨æˆ·é™åˆ¶ä¸€ä¸ªä¼šè¯"></a>æ¯ä¸ªç”¨æˆ·é™åˆ¶ä¸€ä¸ªä¼šè¯</h5><p>æ¯ä¸ªç”¨æˆ·åªå…è®¸ä¸€ä¸ªä¼šè¯ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœç”¨æˆ·åœ¨Ubuntuè®¡ç®—æœºä¸Šæœ¬åœ°ç™»å½•ï¼Œåˆ™è¯¥ç”¨æˆ·å°†æ— æ³•æ‰§è¡Œè¿œç¨‹ä¼šè¯ï¼ˆxRDPè¿æ¥å°†å¯åŠ¨ï¼Œä½†å°†ç«‹å³ç»ˆæ­¢ï¼‰ã€‚å¦‚æœç”¨æˆ·åœ¨ç³»ç»Ÿä¸Šè¿œç¨‹ç™»å½•ï¼Œå°†æ— æ³•åœ¨æœ¬åœ°ç™»å½•ï¼ˆå¦‚æœç”¨æˆ·å°è¯•åœ¨æœ¬åœ°ç™»å½•ï¼Œåˆ™ç™»å½•å±å¹•å°†å¾ªç¯æ’­æ”¾ï¼Œå¹¶ä¸”å°†å†æ¬¡å‘ç”¨æˆ·æ˜¾ç¤ºç™»å½•å±å¹•ï¼‰ </p><h5 id="åœ¨æ ‡å‡†å’Œè‡ªå®šä¹‰å®‰è£…ä¹‹é—´åˆ‡æ¢"><a href="#åœ¨æ ‡å‡†å’Œè‡ªå®šä¹‰å®‰è£…ä¹‹é—´åˆ‡æ¢" class="headerlink" title="åœ¨æ ‡å‡†å’Œè‡ªå®šä¹‰å®‰è£…ä¹‹é—´åˆ‡æ¢"></a>åœ¨æ ‡å‡†å’Œè‡ªå®šä¹‰å®‰è£…ä¹‹é—´åˆ‡æ¢</h5><p>æ­¤ç‰ˆæœ¬çš„è„šæœ¬å¯ä»¥åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šå¤šæ¬¡è¿è¡Œã€‚ä½†æ˜¯ï¼Œç”±äºè¿™ç§æ–°è¡Œä¸ºï¼Œæ‚¨æ— æ³•æ‰§è¡Œæ ‡å‡†å®‰è£…ï¼Œç„¶åå†³å®šæ‰§è¡Œè‡ªå®šä¹‰å®‰è£…ã€‚ä¸€æ—¦é€‰æ‹©äº†å®‰è£…æ¨¡å¼ï¼Œå°±å¿…é¡»åšæŒä¸‹å»ã€‚è¿™æ˜¯ç”±è„šæœ¬æ£€æŸ¥çš„ã€‚ </p><p>å› æ­¤ï¼Œå¦‚æœæ‚¨æ‰§è¡Œäº†æ ‡å‡†å®‰è£…ï¼Œä½†ä¹‹åå¯èƒ½è¦ä½¿ç”¨è‡ªå®šä¹‰å®‰è£…é€‰é¡¹ï¼Œåˆ™è„šæœ¬å°†å¿½ç•¥è¯¥è¯·æ±‚ã€‚å¦‚æœè¦ä»æ ‡å‡†å®‰è£…æ¨¡å¼è½¬æ¢ä¸ºè‡ªå®šä¹‰æ¨¡å¼ï¼ˆåä¹‹äº¦ç„¶ï¼‰ï¼Œåˆ™æ­£ç¡®çš„è¿‡ç¨‹æ˜¯ </p><ul><li>åˆ é™¤xrdpï¼ˆä½¿ç”¨xrdp-installer-1.2.2.sh -ré€‰é¡¹ï¼‰ </li><li>ä½¿ç”¨æ‚¨é€‰æ‹©çš„å®‰è£…æ¨¡å¼ï¼ˆæ ‡å‡†æˆ–è‡ªå®šä¹‰å®‰è£…æ¨¡å¼ï¼‰æ‰§è¡Œæ–°å®‰è£…</li></ul><h3 id="ä¸‹è½½è„šæœ¬"><a href="#ä¸‹è½½è„šæœ¬" class="headerlink" title="ä¸‹è½½è„šæœ¬"></a>ä¸‹è½½è„šæœ¬</h3><p>è¯¥è„šæœ¬å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®ä¸‹è½½ï¼š  <a href="http://www.c-nergy.be/downloads/xrdp-installer-1.2.2.zip">xrdp-installer-1.2.2.zip</a> </p><p><em>æ³¨æ„ï¼š**æ‰€æœ‰xrdpè„šæœ¬éƒ½å¯ä»¥åœ¨<a href="https://c-nergy.be/products.html">https://www.c-nergy.be/products.html</a>ä¸Šæ‰¾åˆ°</em></p><h3 id="æœ€åè¯´æ˜"><a href="#æœ€åè¯´æ˜" class="headerlink" title="æœ€åè¯´æ˜"></a>æœ€åè¯´æ˜</h3><p>è¿™æ˜¯è¿™ä¸ªèŒä½ï¼ </p><p>å¦‚æœæ‚¨æœ‰æ—¶é—´æˆ–æƒ³è¦å¸®åŠ©æˆ‘ä»¬åˆ›å»º<strong>æœ€ä½³çš„xrdpå®‰è£…ç¨‹åºè„šæœ¬</strong>ï¼Œè¯·ä¸‹è½½è¯¥è„šæœ¬ï¼Œå¯¹å…¶è¿›è¡Œæµ‹è¯•å¹¶æä¾›å»ºè®¾æ€§çš„åé¦ˆã€‚å¦‚æœæ‚¨å‘ç°è„šæœ¬æœ‰é”™è¯¯æˆ–é—®é¢˜ï¼Œä¹Ÿè¯·å‘ŠçŸ¥æˆ‘ä»¬ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯¹å…¶è¿›è¡Œä¿®å¤ã€‚ </p><p>ç›´åˆ°ä¸‹ä¸€æ¬¡</p>]]></content>
      
      
      <categories>
          
          <category> è½¬è½½ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> xrdp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSHç«¯å£è½¬å‘è¯¦è§£</title>
      <link href="/2021/cac946/"/>
      <url>/2021/cac946/</url>
      
        <content type="html"><![CDATA[<h1 id="SSHç«¯å£è½¬å‘è¯¦è§£"><a href="#SSHç«¯å£è½¬å‘è¯¦è§£" class="headerlink" title="SSHç«¯å£è½¬å‘è¯¦è§£"></a>SSHç«¯å£è½¬å‘è¯¦è§£</h1><p>SSHç«¯å£è½¬å‘(éš§é“)å¯ä»¥å»ºç«‹SSHé€šé“ï¼Œå¹¶å°†TCPé“¾æ¥æ”¾åˆ°è¿™ä¸ªé€šé“ä¸­ã€‚</p><h2 id="man-ssh"><a href="#man-ssh" class="headerlink" title="man ssh"></a>man ssh</h2><h3 id="é€‰é¡¹åŠå‚æ•°è§£é‡Š"><a href="#é€‰é¡¹åŠå‚æ•°è§£é‡Š" class="headerlink" title="é€‰é¡¹åŠå‚æ•°è§£é‡Š"></a>é€‰é¡¹åŠå‚æ•°è§£é‡Š</h3><p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡<code>man</code>å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹sshå…³äºè½¬å‘éƒ¨åˆ†çš„è¯´æ˜ï¼Œç„¶åå†è¯¦ç»†è®²è§£ä¸åŒçš„è½¬å‘æ–¹å¼æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><ol><li>æœ¬åœ°è½¬å‘</li></ol><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310135914.png" alt="image-20210110224549253"></p><p>æœ¬åœ°è½¬å‘é€šè¿‡<code>-L</code>é€‰é¡¹æŒ‡å®š</p><p><code>-L</code>é€‰é¡¹åå¯è·Ÿå¤šç§å½¢å¼çš„å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-L [ç»‘å®šåœ°å€:]ç«¯å£:ä¸»æœº:ä¸»æœºç«¯å£</span><br><span class="line">-L [ç»‘å®šåœ°å€:]ç«¯å£:è¿œç«¯Socket</span><br><span class="line">-L æœ¬åœ°Socket:ä¸»æœº:ä¸»æœºç«¯å£</span><br><span class="line">-L æœ¬åœ°socket:è¿œç«¯socket</span><br></pre></td></tr></table></figure><blockquote><p>é“¾æ¥åˆ°<strong>æœ¬åœ°(sshå®¢æˆ·ç«¯)ä¸»æœº</strong>ä¸Šçš„ç»™å®šçš„TCPç«¯å£(unix socket)å°†è¢«è½¬å‘åˆ°**è¿œç«¯çš„ç»™å®šçš„ä¸»æœºå’Œç«¯å£(unix socket)**ã€‚è¿™ä¸€è¿‡ç¨‹æŒ‡å®šäº†æœ¬åœ°è¿™ä¸€ä¾§çš„TCPç«¯å£(åŒæ—¶å¯ä»¥æŒ‡å®šç»‘å®šçš„åœ°å€)ï¼Œæˆ–unix socketã€‚</p></blockquote><p>â€‹(è¯‘æ³¨ï¼šå°±æ˜¯æŒ‡å®š<code>[ç»‘å®šåœ°å€:]ç«¯å£</code>è¿™ä¸ªå‚æ•°ï¼Œè¦ä¹ˆåªæä¾›ç«¯å£ï¼Œè¦ä¹ˆæ—¢æä¾›åœ°å€ä¹Ÿæä¾›ç«¯å£)</p><blockquote><p>ä¸€æ—¦æœ‰è¿æ¥åˆ°æœ¬åœ°ç«¯å£æˆ–socketçš„é“¾æ¥ï¼Œè¿™ä¸ªé“¾æ¥å°±ä¼šé€šè¿‡å®‰å…¨çš„é€šé“è¿›è¡Œè½¬å‘ï¼Œç›¸å½“äºä½œç”¨åœ¨è¿œç«¯ä¸»æœºå¯¹åº”çš„ç«¯å£æˆ–socketä¸Šã€‚</p></blockquote><p>â€‹(è¯‘æ³¨ï¼šå‰ä¸¤ä¸ªå‚æ•°(<code> [ç»‘å®šåœ°å€:]ç«¯å£</code>)æŒ‡å®šæœ¬åœ°çš„åœ°å€å’Œç«¯å£ï¼Œåä¸¤ä¸ªå‚æ•°æŒ‡å®šè¿œç«¯çš„åœ°å€å’Œç«¯å£(<code>ä¸»æœº:ä¸»æœºç«¯å£</code>)ï¼Œå¯¹æœ¬åœ°è¿™ä¸ªç«¯å£çš„è®¿é—®ï¼Œç›¸å½“äºä½œç”¨åœ¨äº†è¿œç«¯çš„ç›¸åº”çš„ç«¯å£ä¸Š)</p><blockquote><p>ç«¯å£è½¬å‘åŒæ ·ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šã€‚åªæœ‰è¶…çº§ç”¨æˆ·å¯ä»¥è½¬å‘ç‰¹æƒç«¯å£ã€‚IPv6åœ°å€å¯ä»¥ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥æŒ‡å®šã€‚</p></blockquote><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åœ°ç«¯å£æŒ‰ç…§<code>GatewayPorts</code>è®¾ç½®è¿›è¡Œç»‘å®šã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨æ˜¾ç¤ºçš„<code>ç»‘å®šåœ°å€</code>å°†é“¾æ¥ç»‘å®šåˆ°ç‰¹å®šçš„åœ°å€ã€‚ä½¿ç”¨<code>localhost</code>è¿™ä¸ª<code>ç»‘å®šåœ°å€</code>è¡¨ç¤ºç›‘å¬çš„ç«¯å£ä»…èƒ½æœ¬åœ°ä½¿ç”¨ï¼Œè€Œä¸æŒ‡å®šåœ°å€æˆ–ä½¿ç”¨<code>*</code>åˆ™è¡¨ç¤ºç›‘å¬çš„ç«¯å£å¯ä»¥è¢«æ‰€æœ‰æ¥å£æ‰€è®¿é—®ã€‚</p></blockquote><p>â€‹(è¯‘æ³¨ï¼šä½¿ç”¨<code>localhost</code>ä»…èƒ½æœ¬åœ°è®¿é—®ï¼Œç›¸å½“äº<code>127.0.0.1</code>ï¼Œä¸æŒ‡å®šæˆ–ä½¿ç”¨<code>*</code>ï¼Œåˆ™ç›¸å½“äº<code>0.0.0.0</code>)</p><ol start="2"><li><p>è¿œç¨‹è½¬å‘</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310135083.png" alt="image-20210110224639362"></p><p>è¿œç¨‹è½¬å‘é€šè¿‡<code>-R</code>é€‰é¡¹æŒ‡å®š</p><p><code>-R</code>é€‰é¡¹åå¯æ¥å¤šç§å½¢å¼çš„å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-R [ç»‘å®šåœ°å€:]ç«¯å£:ä¸»æœº:ä¸»æœºç«¯å£</span><br><span class="line">-R [ç»‘å®šåœ°å€:]ç«¯å£:æœ¬åœ°socket</span><br><span class="line">-R è¿œç«¯socket:ä¸»æœº:ä¸»æœºç«¯å£</span><br><span class="line">-R è¿œç«¯socket:æœ¬åœ°socket</span><br><span class="line">-R [ç»‘å®šåœ°å€:]ç«¯å£</span><br></pre></td></tr></table></figure><blockquote><p>è¿æ¥åˆ°<strong>è¿œç«¯(æœåŠ¡ç«¯)ä¸»æœº</strong>ä¸Šç»™å®šTCPç«¯å£çš„é“¾æ¥ä¼šæœ¬è½¬å‘åˆ°<strong>æœ¬åœ°è¿™ä¸€ä¾§</strong>ã€‚è¿™ä¸€è¿‡ç¨‹åˆ†é…äº†ä¸€ä¸ªsocketæ¥åœ¨è¿œç«¯ç›‘å¬ç»™å®šçš„TCP<code>ç«¯å£</code>æˆ–unix socketã€‚ä¸€æ—¦æœ‰è®¿é—®è¿™ä¸ª<code>ç«¯å£</code>çš„é“¾æ¥ï¼Œè¿™ä¸ªé“¾æ¥ä¾¿ä¼šé€šè¿‡å®‰å…¨é€šé“è¿›è¡Œè½¬å‘è‡³æœ¬åœ°è¿™ä¸€ä¾§ï¼Œæœ¬åœ°è¿™ä¸€ä¾§å¯ä»¥æ˜¾ç¤ºçš„æŒ‡å®š<code>ä¸»æœº</code>åŠ<code>ä¸»æœºç«¯å£</code>æˆ–æœ¬åœ°socketï¼Œæˆ–è€…<em>å¦‚æœæ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šæœ¬åœ°è¿™ä¸€ä¾§çš„ä¸»æœºçš„è¯ï¼Œsshå°†å……å½“<code>socks 4/5</code>ä»£ç†ï¼Œå¹¶å°†é“¾æ¥è½¬å‘åˆ°è¿œç¨‹sockså®¢æˆ·æœºè¯·æ±‚çš„ç›®çš„åœ°å€</em></p></blockquote><p>â€‹ï¼ˆè¯‘æ³¨ï¼šæœ€åä¸€å¥è¯å¦‚ä½•ä½¿ç”¨æš‚ä¸è§£é‡Šï¼‰ã€‚</p><blockquote><p>ç«¯å£è½¬å‘åŒæ ·å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šã€‚ç‰¹æƒç«¯å£åªèƒ½ç™»å½•è¿œç«¯æœºå™¨çš„rootç”¨æˆ·è¿›è¡Œè½¬å‘ã€‚IPv6åœ°å€å¯ä»¥ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥æŒ‡å®šã€‚</p></blockquote><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒTCPä»…ç›‘å¬æœ¬åœ°ç¯å›æ¥å£çš„socketsã€‚è¿™ä¸€æƒ…å†µå¯ä»¥é€šè¿‡<code>ç»‘å®šåœ°å€</code>æ¥è¿›è¡Œè¦†ç›–ï¼Œç©ºçš„<code>ç»‘å®šåœ°å€</code>æˆ–<code>*</code>ï¼Œè¡¨ç¤ºè¿œç«¯socketåº”è¯¥ç›‘å¬æ‰€æœ‰æ¥å£ã€‚åªæœ‰è¿œç«¯æœåŠ¡çš„<code>GatewayPorts</code>é€‰é¡¹æ‰“å¼€ï¼Œæ‰å¯ä»¥æŒ‡å®šè¿œç«¯çš„<code>ç»‘å®šåœ°å€</code>ã€‚</p></blockquote><blockquote><p>å¦‚æœ<code>ç«¯å£</code>å‚æ•°æ˜¯<code>0</code>ï¼Œå°†ä¼šåœ¨æœåŠ¡ç«¯åŠ¨æ€åˆ†é…ç›‘å¬çš„ç«¯å£ï¼Œç„¶åå°†ç«¯å£è¿”å›å®¢æˆ·ç«¯ã€‚å¦‚æœåŒæ—¶ä½¿ç”¨<code>-O</code>é€‰é¡¹ï¼Œè¿”å›åˆ†é…çš„ç«¯å£å°†ä¼šè¾“å‡ºåœ¨æ ‡å‡†è¾“å‡ºã€‚</p></blockquote></li><li><p>åŠ¨æ€è½¬å‘</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310135778.png" alt="image-20210111144331152"></p><p>åŠ¨æ€è½¬å‘é€šè¿‡ <code>-D</code>é€‰é¡¹æŒ‡å®š</p><p><code>-D</code>é€‰é¡¹åå¯è·Ÿå¦‚ä¸‹å½¢å¼çš„å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-D [ç»‘å®šåœ°å€:]ç«¯å£</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬åœ°åŠ¨æ€åº”ç”¨çº§ç«¯å£è½¬å‘ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šåˆ†é…ä¸€ä¸ªsocketæ¥ç›‘å¬æœ¬åœ°ä¾§çš„<code>ç«¯å£</code>ï¼Œå¯é€‰æ˜¯å¦æŒ‡å®š<code>ç»‘å®šåœ°å€</code>ã€‚ä¸€æ—¦æœ‰é“¾æ¥è®¿é—®è¿™ä¸ªç«¯å£ï¼Œè¿™ä¸ªé“¾æ¥å°†ä¼šé€šè¿‡å®‰å…¨é€šé“è¿›è¡Œè½¬å‘ï¼Œå¹¶ä¸”åº”ç”¨åè®®å†³å®šäº†éšåè®¿é—®è¿œç«¯æœºå™¨çš„å“ªä¸ªç«¯å£ã€‚ç›®å‰æ”¯æŒ<code>SOCKS4</code> å’Œ<code>SOCKS5</code>ï¼Œå¹¶ä¸”sshå°†ä½œä¸º<code>SOCKS</code>æœåŠ¡ç«¯ã€‚</p></blockquote><blockquote><p>åªæœ‰rootç”¨æˆ·å¯ä»¥è½¬å‘ç‰¹æƒç«¯å£ã€‚åŠ¨æ€ç«¯å£è½¬å‘å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šã€‚</p></blockquote><blockquote><p>IPv6åœ°å€å¯ä»¥ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥æŒ‡å®šã€‚åªæœ‰è¶…çº§ç”¨æˆ·å¯ä»¥è½¬å‘ç‰¹æƒç«¯å£ã€‚</p></blockquote><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åœ°ç«¯å£å—é™äº<code>GatewayPorts</code>çš„è®¾ç½®ã€‚ä½†æ˜¯æ˜¾ç¤ºçš„æŒ‡å®š<code>ç»‘å®šåœ°å€</code>å¯ä»¥ç”¨æ¥æŒ‡å®šå…·ä½“çš„åœ°å€ã€‚ä½¿ç”¨<code>localhost</code>è¿™ä¸ª<code>ç»‘å®šåœ°å€</code>è¡¨ç¤ºç›‘å¬çš„ç«¯å£ä»…èƒ½æœ¬åœ°ä½¿ç”¨ï¼Œè€Œä¸æŒ‡å®šåœ°å€æˆ–ä½¿ç”¨<code>*</code>åˆ™è¡¨ç¤ºç›‘å¬çš„ç«¯å£å¯ä»¥è¢«æ‰€æœ‰æ¥å£æ‰€è®¿é—®ã€‚</p></blockquote></li></ol><h3 id="TCP-FORWARDING"><a href="#TCP-FORWARDING" class="headerlink" title="TCP FORWARDING"></a>TCP FORWARDING</h3><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310135967.png" alt="image-20210111145707861"></p><blockquote><p>å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–é…ç½®æ–‡ä»¶é€šè¿‡å®‰å…¨é€šé“è½¬å‘ä»»æ„TCPé“¾æ¥ã€‚ä¸€ä¸ªå¯èƒ½çš„TCPè½¬å‘åº”ç”¨åœºæ™¯æ˜¯é€šè¿‡å®‰å…¨é“¾æ¥è®¿é—®é‚®ä»¶æœåŠ¡æˆ–ç©¿é€é˜²ç«å¢™ã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹IRCå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„åŠ å¯†é€šä¿¡ï¼Œå³ä¾¿IRCæœåŠ¡å™¨ä¸ç›´æ¥æ”¯æŒåŠ å¯†é€šä¿¡ã€‚</p><p>è¿™ä¸€å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼šç”¨æˆ·é€šè¿‡sshæŒ‡å®šäº†ä¸€ä¸ªç«¯å£ç”¨æ¥è½¬å‘é“¾æ¥åˆ°è¿œç¨‹ä¸»æœºï¼Œéšåï¼Œåœ¨å®¢æˆ·ç«¯æœºå™¨å¼€å¯äº†ä¸€ä¸ªè¢«åŠ å¯†çš„æœåŠ¡ï¼Œé“¾æ¥åˆ°ç›¸åŒçš„æœ¬åœ°ç«¯å£(è¯‘æ³¨ï¼šè¿™ä¸ªæœ¬åœ°ç«¯å£å°±æ˜¯ä¸Šä¸€å¥è¯æåˆ°çš„<code>é€šè¿‡sshæŒ‡å®šäº†ä¸€ä¸ªç«¯å£</code>)ï¼Œsshå°†ä¼šåŠ å¯†å¹¶è½¬å‘é“¾æ¥</p><p>è¿™ä¸ªä¾‹å­å°†ä»æœ¬åœ°æœºå™¨(<code>127.0.0.1</code>)åˆ°è¿œç¨‹æœåŠ¡å™¨(<code>server.example.com</code>)çš„IRCä¼šè¯è£…å…¥éš§é“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -f -L 1234:localhost:6667 server.example.com <span class="built_in">sleep</span> 10</span><br><span class="line">$ irc -c <span class="string">&#x27;#users&#x27;</span> -p 1234 <span class="built_in">pinky</span> 127.0.0.1</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªéš§é“è¿æ¥åˆ°IRCæœåŠ¡å™¨â€œserver.example.comâ€ï¼ŒåŠ å…¥é€šé“â€œ#usersâ€ï¼Œæ˜µç§°â€œpinkyâ€ï¼Œä½¿ç”¨ç«¯å£1234ã€‚ä½¿ç”¨å“ªä¸ªç«¯å£æ— æ‰€è°“ï¼Œåªè¦å¤§äº1023(åªæœ‰rootç”¨æˆ·å¯ä»¥ä½¿ç”¨ç‰¹æƒç«¯å£)ï¼Œå¹¶ä¸”ä¸èƒ½å’Œå…¶ä»–å·²ç”¨çš„ç«¯å£å†²çªã€‚è¿™ä¸ªé“¾æ¥è¢«è½¬å‘åˆ°è¿œç¨‹æœåŠ¡å™¨çš„6667ç«¯å£ï¼Œè¿™æ˜¯IRCæœåŠ¡çš„æ ‡å‡†ç«¯å£</p><p><code>-f</code>é€‰é¡¹åœ¨åå°è¿è¡Œsshï¼Œå¹¶ä¸”è¿œç«¯æ‰§è¡Œå‘½ä»¤<code>sleep 10</code>æŒ‡å®šäº†è¢«è£…å…¥éš§é“ä¸­çš„æœåŠ¡å¼€å¯çš„æ—¶é—´ã€‚å¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰é“¾æ¥ï¼Œsshå°†ä¼šé€€å‡ºã€‚</p></blockquote><h2 id="è‡ªå®šä¹‰ç”¨ä¾‹"><a href="#è‡ªå®šä¹‰ç”¨ä¾‹" class="headerlink" title="è‡ªå®šä¹‰ç”¨ä¾‹"></a>è‡ªå®šä¹‰ç”¨ä¾‹</h2><ol><li><p>æœ¬åœ°è½¬å‘</p><p>æœ¬åœ°è½¬å‘ç¤ºä¾‹å¦‚ä¸‹ã€‚</p><p><strong>åœºæ™¯1</strong></p><p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œ<code>ä¸»æœºA</code>éœ€è¦è®¿é—®<code>ä¸»æœºC</code>ä¸Šçš„ä¸€äº›æœåŠ¡ï¼Œä½†ç”±äºå®‰å…¨é—®é¢˜<code>ä¸»æœºC</code>ä»…å°†<code>ä¸»æœºB</code>çš„IPåŠ å…¥äº†ç™½åå•ä¸­ï¼Œè€Œè¿™æ—¶æˆ‘ä»¬åˆå·²çŸ¥å¯ä»¥åœ¨<code>ä¸»æœºA</code>ä¸Šé€šè¿‡sshé“¾æ¥åˆ°<code>ä¸»æœºB</code>ã€‚è¿™æ—¶æˆ‘ä»¬åœ¨<code>ä¸»æœºA</code>ä¸Šå¯ä»¥é€šè¿‡<code>ä¸»æœºB</code>å»è®¿é—®<code>ä¸»æœºC</code>ä¸Šçš„ä¸€äº›æœåŠ¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/20210111153613-20221025020642141.svg"></p><p>æˆ‘ä»¬åœ¨<code>ä¸»æœºA</code>ä¸Šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -L 12345:ip_c:service_port user@ip_b</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>ip_c</code>è¡¨ç¤º<code>ä¸»æœºC</code>çš„ipåœ°å€ï¼Œ<code>service_port</code>è¡¨ç¤ºåœ¨<code>ä¸»æœºC</code>ä¸Šè¿è¡Œçš„æœåŠ¡çš„è®¿é—®ç«¯å£ï¼Œ<code>user</code>è¡¨ç¤º<code>ä¸»æœºB</code>ä¸Šä½ ç”¨çš„ç”¨æˆ·åï¼Œ<code>ip_b</code>è¡¨ç¤º<code>ä¸»æœºB</code>çš„ipåœ°å€ï¼Œ<code>12345</code>è¡¨ç¤º<code>ä¸»æœºA</code>ä¸Šçš„ç«¯å£ã€‚è¿™æ—¶ï¼Œä½ è®¿é—®<code>ip_a:12345</code>ä¾¿ç›¸å½“äºè®¿é—®äº†<code>ip_c:service_port</code>ã€‚</p><p><strong>åœºæ™¯2</strong></p><p>å½“ç„¶ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½åªæ˜¯æƒ³ç©¿é€é˜²ç«å¢™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<code>ä¸»æœºB</code>çš„é˜²ç«å¢™ä»…æ‰“å¼€äº†22ç«¯å£ï¼Œä½†<code>ä¸»æœºB</code>ä¸Šè¿è¡Œç€è®¸å¤šæœåŠ¡ï¼Œåœ¨é˜²ç«å¢™å¤–çš„<code>ä¸»æœºA</code>æ— æ³•ç›´æ¥è®¿é—®ã€‚è¿™æ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æœ¬åœ°è½¬å‘çš„æ–¹å¼æ¥è®¿é—®<code>ä¸»æœºB</code>ä¸Šçš„ä¸€äº›æœåŠ¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/20210111155514-20221025020650588.svg"></p><p>åœ¨<code>ä¸»æœºA</code>ä¸Šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -L 12345:localhost:80 user@ip_b</span><br></pre></td></tr></table></figure><p>è¿™æ ·è®¿é—®<code>ä¸»æœºA</code>çš„12345ç«¯å£ï¼Œä¾¿ç›¸å½“äºè®¿é—®<code>ä¸»æœºB</code>çš„80ç«¯å£ï¼Œä»è€Œè¾¾åˆ°äº†ç©¿é€é˜²ç«å¢™çš„ç›®çš„ã€‚</p></li><li><p>è¿œç¨‹è½¬å‘</p><p>åœ¨ä½¿ç”¨è¿œç¨‹è½¬å‘æ—¶ï¼Œæˆ‘ä»¬è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œ<code>ä¸»æœºC</code>ä¸Šè¿è¡Œç€ä¸€ä¸ªæœåŠ¡ï¼Œä½†æ˜¯<code>ä¸»æœºC</code>æ²¡æœ‰å…¬ç½‘ipï¼Œ<code>ä¸»æœºA</code>æ— æ³•ç›´æ¥è®¿é—®æœåŠ¡ã€‚è€Œ<code>ä¸»æœºB</code>åˆ™æœ‰å…¬ç½‘IPï¼Œè¿™æ—¶åˆä¸æƒ³å°†<code>ä¸»æœºC</code>ä¸Šçš„æœåŠ¡è½¬ç§»åˆ°<code>ä¸»æœºB</code>ä¸Šã€‚è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿œç¨‹è½¬å‘ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/20210111175702.svg"></p></li></ol><p>æˆ‘ä»¬åœ¨**<code>ä¸»æœºC</code>**ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R [ip_b:]port_b:ip_c:port_c user@ip_b</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬ä»<code>ä¸»æœºA</code>è®¿é—®<code>ä¸»æœºB</code>çš„port_bç«¯å£ï¼Œå°±ç›¸å½“äºè®¿é—®äº†<code>ä¸»æœºC</code>çš„<code>port_c</code>ç«¯å£ã€‚</p><p>æ‰€ä»¥ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ä¹Ÿæ„å‘³ç€ï¼Œåªè¦ä½ æœ‰ä¸ªå…¬ç½‘ipçš„æœåŠ¡å™¨ï¼Œå¹¶ä¸ä¸€å®šè¦å°†æœåŠ¡éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šï¼Œåªè¦åšå¥½è½¬å‘ä½ å°±å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ã€‚</p><h2 id="å…¶ä»–é€‰é¡¹"><a href="#å…¶ä»–é€‰é¡¹" class="headerlink" title="å…¶ä»–é€‰é¡¹"></a>å…¶ä»–é€‰é¡¹</h2><h3 id="æŒä¹…åŒ–sshé“¾æ¥ï¼ˆsshä¿æ´»ï¼‰"><a href="#æŒä¹…åŒ–sshé“¾æ¥ï¼ˆsshä¿æ´»ï¼‰" class="headerlink" title="æŒä¹…åŒ–sshé“¾æ¥ï¼ˆsshä¿æ´»ï¼‰"></a>æŒä¹…åŒ–sshé“¾æ¥ï¼ˆsshä¿æ´»ï¼‰</h3><p>ä»¥ä¸‹ä¸¤ç§æ–¹å¼å‡å¯ï¼Œæ¨èä½¿ç”¨<code>å®¢æˆ·ç«¯é…ç½®</code>ã€‚</p><h4 id="æœåŠ¡ç«¯é…ç½®"><a href="#æœåŠ¡ç«¯é…ç½®" class="headerlink" title="æœåŠ¡ç«¯é…ç½®"></a>æœåŠ¡ç«¯é…ç½®</h4><p>ç¼–è¾‘æœåŠ¡å™¨ä¸Š<code>/etc/ssh/sshd_config</code>æ–‡ä»¶ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹ï¼Œè®¾ç½®å®Œæˆåéœ€è¦é‡å¯sshdæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡å™¨æ¯éš”60ç§’å‘é€ä¸€æ¬¡è¯·æ±‚ç»™å®¢æˆ·ç«¯ï¼Œå®ç°ä¿æ´»</span></span><br><span class="line">ClientAliveInterval 60</span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚åï¼Œå®¢æˆ·ç«¯å¦‚æœ3æ¬¡éƒ½æ²¡æœ‰å“åº”ï¼Œåˆ™è‡ªåŠ¨æ–­å¼€è¿æ¥</span></span><br><span class="line">ClientAliveCountMax 3</span><br></pre></td></tr></table></figure><h4 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h4><p>ç¼–è¾‘å®¢æˆ·ç«¯ä¸Šçš„<code>/etc/ssh/ssh_config</code>æ–‡ä»¶ï¼Œæ³¨æ„<strong>ä¸æœåŠ¡ç«¯ä¸æ˜¯åŒä¸€ä¸ªæ–‡ä»¶</strong>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯æ¯éš”60ç§’å‘é€ä¸€æ¬¡è¯·æ±‚ç»™æœåŠ¡ç«¯ï¼Œå®ç°ä¿æ´»</span></span><br><span class="line">ServerAliveInterval 60</span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œå¦‚æœæœåŠ¡ç«¯3æ¬¡éƒ½æ²¡æœ‰å“åº”ï¼Œåˆ™è‡ªåŠ¨æ–­å¼€è¿æ¥</span></span><br><span class="line">ServerAliveCountMax 3</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–å‚æ•°"><a href="#å…¶ä»–å‚æ•°" class="headerlink" title="å…¶ä»–å‚æ•°"></a>å…¶ä»–å‚æ•°</h3><ul><li><p><code>-N</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136858.png" alt="image-20210112202116993"></p><p>ä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œè¡¨ç¤ºä»…ç”¨æ¥è¿›è¡Œç«¯å£è½¬å‘ï¼Œå¸¸å¸¸ä¸<code>-T</code>ç»“åˆä½¿ç”¨</p></li><li><p><code>-T</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136963.png" alt="image-20210112202204575"></p><p>ä¸åˆ†é…ä¼ªç»ˆç«¯ï¼Œ</p></li><li><p><code>-f</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136544.png" alt="image-20210112202347594"></p><p>è¯·æ±‚sshåœ¨å‘½ä»¤æ‰§è¡Œä¹‹å‰è½¬åˆ°åå°ï¼Œå¦‚æœsshè¦æ±‚è¾“å…¥å¯†ç æˆ–å¯†ç çŸ­è¯­ï¼Œä½†ç”¨æˆ·å¸Œæœ›åœ¨åå°è¾“å…¥å¯†ç ï¼Œé‚£ä¹ˆè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚è¿™è¡¨ç¤º<code>-n</code>ï¼Œåœ¨è¿œç¨‹ç«™ç‚¹å¯åŠ¨X11ç¨‹åºçš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨ssh -f host xtermä¹‹ç±»çš„å·¥å…·ã€‚</p><p>å¦‚æœ<code>ExitOnForwardFailure</code>é€‰é¡¹è¢«è®¾ç½®æˆ<code>yes</code>ï¼Œä½¿ç”¨<code>-f</code>é€‰é¡¹å¼€å¯çš„å®¢æˆ·ç«¯ä¼šç­‰å¾…æ‰€æœ‰è¿œç¨‹ç«¯å£è½¬å‘æˆåŠŸå»ºç«‹é“¾æ¥ååœ¨å°†ç¨‹åºè½¬å…¥åå°ã€‚</p><p><strong>è¦å…³é—­è¿™ä¸ªåå°é“¾æ¥ï¼Œåªèƒ½ç”¨killå‘½ä»¤å»æ€æ‰ã€‚</strong></p></li><li><p><code>-C</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310136387.png" alt="image-20210112204811052"></p><p>è¯·æ±‚å‹ç¼©æ‰€æœ‰æ•°æ®ï¼Œå‹ç¼©ç®—æ³•å’Œ<code>gzip</code>ç›¸åŒï¼Œå‹ç¼©åœ¨è°ƒåˆ¶è§£è°ƒå™¨çº¿è·¯å’Œå…¶ä»–æ…¢é€Ÿè¿æ¥ä¸Šæ˜¯å¯å–çš„ï¼Œä½†åœ¨é«˜é€Ÿç½‘ç»œä¸Šåªä¼šå‡æ…¢é€Ÿåº¦ã€‚é»˜è®¤å€¼å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‰ä¸»æœºè®¾ç½®;è¯·å‚é˜…å‹ç¼©é€‰é¡¹ã€‚</p></li></ul><h3 id="åå°æŒä¹…åŒ–æ‰§è¡Œç«¯å£è½¬å‘"><a href="#åå°æŒä¹…åŒ–æ‰§è¡Œç«¯å£è½¬å‘" class="headerlink" title="åå°æŒä¹…åŒ–æ‰§è¡Œç«¯å£è½¬å‘"></a>åå°æŒä¹…åŒ–æ‰§è¡Œç«¯å£è½¬å‘</h3><ul><li><p>ä¿®æ”¹&#x2F;etc&#x2F;ssh_configæ–‡ä»¶ï¼Œè®¾ç½®ä¿æ´»æ—¶é—´</p></li><li><p>ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ‰§è¡Œç«¯å£è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥ä¸‹ipå’Œç«¯å£å‡ä¸ºç¤ºä¾‹</span></span><br><span class="line">$ ssh -f -NTC -L 12345:192.168.2.123:12345 user@192.168.1.10</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SSH </tag>
            
            <tag> è½¬å‘ </tag>
            
            <tag> éš§é“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flink å†…å­˜æ¨¡å‹</title>
      <link href="/2021/9367e715/"/>
      <url>/2021/9367e715/</url>
      
        <content type="html"><![CDATA[<h1 id="Flinkå†…å­˜æ¨¡å‹"><a href="#Flinkå†…å­˜æ¨¡å‹" class="headerlink" title="Flinkå†…å­˜æ¨¡å‹"></a>Flinkå†…å­˜æ¨¡å‹</h1><p>Flink1.12.0æ”¯æŒæ›´ä¸ºç»†ç²’åº¦çš„å†…å­˜é…ç½®ï¼Œæœ¬æ–‡åŸºäºFlink1.12å¯¹ç°è¡Œçš„Flinkå†…å­˜ç®¡ç†æœºåˆ¶è¿›è¡Œä»‹ç»ï¼Œä¸»è¦å†…å®¹æ¥è‡ª<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/deployment/memory/mem_setup.html">Flinkæ–‡æ¡£</a></p><h2 id="æ€»å†…å­˜è¯´æ˜"><a href="#æ€»å†…å­˜è¯´æ˜" class="headerlink" title="æ€»å†…å­˜è¯´æ˜"></a>æ€»å†…å­˜è¯´æ˜</h2><p>Flink JVM è¿›ç¨‹çš„<em>è¿›ç¨‹æ€»å†…å­˜ï¼ˆTotal Process Memoryï¼‰</em>åŒ…å«äº†ç”± Flink åº”ç”¨ä½¿ç”¨çš„å†…å­˜ï¼ˆ<em>Flink æ€»å†…å­˜</em>ï¼‰ä»¥åŠç”±è¿è¡Œ Flink çš„ JVM ä½¿ç”¨çš„å†…å­˜ã€‚ <em>Flink æ€»å†…å­˜ï¼ˆTotal Flink Memoryï¼‰</em>åŒ…æ‹¬ <em>JVM å †å†…å­˜ï¼ˆHeap Memoryï¼‰</em>å’Œ<em>å †å¤–å†…å­˜ï¼ˆOff-Heap Memoryï¼‰</em>ã€‚ å…¶ä¸­å †å¤–å†…å­˜åŒ…æ‹¬<em>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</em>å’Œ<em>æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰</em>ã€‚</p><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.12/fig/process_mem_model.svg" style="width:35%" /><p>é…ç½®Flinkå†…å­˜ä½¿ç”¨çš„ç®€å•æ–¹æ³•å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªé…ç½®é¡¹</p><table><thead><tr><th align="left"><strong>Component</strong></th><th align="left"><strong>Option for TaskManager</strong></th><th align="left"><strong>Option for JobManager</strong></th></tr></thead><tbody><tr><td align="left">Total Flink memory</td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/deployment/config.html#taskmanager-memory-flink-size"><code>taskmanager.memory.flink.size</code></a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/deployment/config.html#jobmanager-memory-flink-size"><code>jobmanager.memory.flink.size</code></a></td></tr><tr><td align="left">Total process memory</td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/deployment/config.html#taskmanager-memory-process-size"><code>taskmanager.memory.process.size</code></a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/deployment/config.html#jobmanager-memory-process-size"><code>jobmanager.memory.process.size</code></a></td></tr></tbody></table><p>Flinkä¼šæ ¹æ®é»˜è®¤å€¼æˆ–å…¶ä»–é…ç½®å‚æ•°æ¥è°ƒæ•´å‰©ä½™å†…å­˜éƒ¨åˆ†çš„å¤§å°ã€‚</p><ul><li><p>é…ç½®<code>Flink memory</code>å¯¹äº<code>standalone deployments</code>æ›´ä¸ºåˆé€‚ï¼Œè¯¥å‚æ•°å¯ä»¥å£°æ˜ä¸ºFlinkæœ¬èº«æä¾›å¤šå°‘å†…å­˜ï¼Œ<code>total Flink memory</code>è¢«åˆ’åˆ†ä¸º<code>JVM Heap</code>å’Œ<code>Off-heap</code>å†…å­˜ã€‚</p></li><li><p>é…ç½®<code>total process memory</code>å¯ä»¥å£°æ˜Flink JVMè¿›ç¨‹æ€»è®¡ä½¿ç”¨å¤šå°‘å†…å­˜ï¼Œå¯¹äºå®¹å™¨è¯éƒ¨ç½²æ¥è¯´ï¼Œè¿™æ¶‰åŠè¯·æ±‚å¤šå¤§çš„å®¹å™¨ã€‚</p></li><li><p>æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®<code>total Flink memory</code>ä¸­çš„ç‰¹å®šå†…éƒ¨ç»„æˆéƒ¨åˆ†æ¥è¿›è¡Œå†…å­˜é…ç½®ï¼ŒJMåŠTMæ‰€éœ€è¦è®¾ç½®çš„å†…å­˜ç»„æˆéƒ¨åˆ†æ˜¯ä¸ä¸€æ ·çš„ã€‚è¯¦æƒ…å‚è€ƒ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#configure-heap-and-managed-memory">TaskManager</a>å’Œ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_jobmanager.html#configure-jvm-heap">JobManager</a>æ–‡æ¡£ã€‚</p></li></ul><p>ç”¨æˆ·éœ€è¦é€‰æ‹©è‡³å°‘ä¸€ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œéœ€è¦ä»ä»¥ä¸‹æ— é»˜è®¤å€¼çš„é…ç½®å‚æ•°ï¼ˆå‚æ•°ç»„åˆä¸­ï¼‰é€‰æ‹©ä¸€ä¸ªç»™å‡ºæ˜ç¡®çš„é…ç½®ã€‚</p><table><thead><tr><th align="left"><strong>TaskManager:</strong></th><th align="left"><strong>JobManager:</strong></th></tr></thead><tbody><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-flink-size"><code>taskmanager.memory.flink.size</code></a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#jobmanager-memory-flink-size"><code>jobmanager.memory.flink.size</code></a></td></tr><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-process-size"><code>taskmanager.memory.process.size</code></a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#jobmanager-memory-process-size"><code>jobmanager.memory.process.size</code></a></td></tr><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-task-heap-size"><code>taskmanager.memory.task.heap.size</code></a> å’Œ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-managed-size"><code>taskmanager.memory.managed.size</code></a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#jobmanager-memory-heap-size"><code>jobmanager.memory.heap.size</code></a></td></tr></tbody></table><p>åŒæ—¶è¿›è¡Œ<code>total process memory</code>åŠ<code>total flink memory</code>é…ç½®æ—¶å¯èƒ½ä¼šé€ æˆé…ç½®å†²çª</p><p>Flink è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šæ ¹æ®é…ç½®çš„å’Œè‡ªåŠ¨æ¨å¯¼å‡ºçš„å„å†…å­˜éƒ¨åˆ†å¤§å°ï¼Œæ˜¾å¼åœ°è®¾ç½®ä»¥ä¸‹ JVM å‚æ•°ï¼š</p><table><thead><tr><th align="left"><strong>JVM å‚æ•°</strong></th><th align="left"><strong>TaskManager å–å€¼</strong></th><th align="left"><strong>JobManager å–å€¼</strong></th></tr></thead><tbody><tr><td align="left"><em>-Xmx</em> å’Œ <em>-Xms</em></td><td align="left">æ¡†æ¶å †å†…å­˜ + ä»»åŠ¡å †å†…å­˜</td><td align="left">JVM å †å†…å­˜ (*)</td></tr><tr><td align="left"><em>-XX:MaxDirectMemorySize</em> ï¼ˆTaskManager å§‹ç»ˆè®¾ç½®ï¼ŒJobManager è§æ³¨é‡Šï¼‰</td><td align="left">æ¡†æ¶å †å¤–å†…å­˜ + ä»»åŠ¡å †å¤–å†…å­˜(**) + ç½‘ç»œå†…å­˜</td><td align="left">å †å¤–å†…å­˜ (**) (***)</td></tr><tr><td align="left"><em>-XX:MaxMetaspaceSize</em></td><td align="left">JVM Metaspace</td><td align="left">JVM Metaspace</td></tr></tbody></table><p>(*) è¯·è®°ä½ï¼Œæ ¹æ®æ‰€ä½¿ç”¨çš„ GC ç®—æ³•ï¼Œä½ å¯èƒ½æ— æ³•ä½¿ç”¨åˆ°å…¨éƒ¨å †å†…å­˜ã€‚ä¸€äº› GC ç®—æ³•ä¼šä¸ºå®ƒä»¬è‡ªèº«åˆ†é…ä¸€å®šé‡çš„å †å†…å­˜ã€‚è¿™ä¼šå¯¼è‡´<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/metrics.html#memory">å †çš„æŒ‡æ ‡</a>è¿”å›ä¸€ä¸ªä¸åŒçš„æœ€å¤§å€¼ã€‚<br>(**) è¯·æ³¨æ„ï¼Œå †å¤–å†…å­˜ä¹ŸåŒ…æ‹¬äº†ç”¨æˆ·ä»£ç ä½¿ç”¨çš„æœ¬åœ°å†…å­˜ï¼ˆéç›´æ¥å†…å­˜ï¼‰ã€‚<br>(***) åªæœ‰åœ¨ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#jobmanager-memory-enable-jvm-direct-memory-limit"><code>jobmanager.memory.enable-jvm-direct-memory-limit</code></a> è®¾ç½®ä¸º <code>true</code> æ—¶ï¼ŒJobManager æ‰ä¼šè®¾ç½® <em>JVM ç›´æ¥å†…å­˜é™åˆ¶</em>ã€‚</p><h2 id="TaskManagerå†…å­˜æ¨¡å‹"><a href="#TaskManagerå†…å­˜æ¨¡å‹" class="headerlink" title="TaskManagerå†…å­˜æ¨¡å‹"></a>TaskManagerå†…å­˜æ¨¡å‹</h2><h3 id="é…ç½®å †å†…å­˜å’Œæ‰˜ç®¡å†…å­˜"><a href="#é…ç½®å †å†…å­˜å’Œæ‰˜ç®¡å†…å­˜" class="headerlink" title="é…ç½®å †å†…å­˜å’Œæ‰˜ç®¡å†…å­˜"></a>é…ç½®å †å†…å­˜å’Œæ‰˜ç®¡å†…å­˜</h3><p>å¦ä¸€ç§é…ç½® Flink å†…å­˜çš„æ–¹å¼æ˜¯åŒæ—¶è®¾ç½®<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#task-operator-heap-memory">ä»»åŠ¡å †å†…å­˜</a>å’Œ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#managed-memory">æ‰˜ç®¡å†…å­˜</a>ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥æ›´å¥½åœ°æŒæ§ç”¨äº Flink ä»»åŠ¡çš„ JVM å †å†…å­˜åŠ Flink çš„<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#managed-memory">æ‰˜ç®¡å†…å­˜</a>å¤§å°ã€‚</p><p>Flink ä¼šæ ¹æ®é»˜è®¤å€¼æˆ–å…¶ä»–é…ç½®å‚æ•°è‡ªåŠ¨è°ƒæ•´å‰©ä½™å†…å­˜éƒ¨åˆ†çš„å¤§å°ã€‚ å…³äºå„å†…å­˜éƒ¨åˆ†çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è€ƒ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#detailed-memory-model">ç›¸å…³æ–‡æ¡£</a>ã€‚</p><p><strong>æç¤º</strong> å¦‚æœå·²ç»æ˜ç¡®è®¾ç½®äº†ä»»åŠ¡å †å†…å­˜å’Œæ‰˜ç®¡å†…å­˜ï¼Œå»ºè®®ä¸è¦å†è®¾ç½®<em>è¿›ç¨‹æ€»å†…å­˜</em>æˆ– <em>Flink æ€»å†…å­˜</em>ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆå†…å­˜é…ç½®å†²çªã€‚</p><h4 id="ä»»åŠ¡-ç®—å­-å †å†…å­˜"><a href="#ä»»åŠ¡-ç®—å­-å †å†…å­˜" class="headerlink" title="ä»»åŠ¡(ç®—å­)å †å†…å­˜"></a>ä»»åŠ¡(ç®—å­)å †å†…å­˜</h4><p>å¦‚æœå¸Œæœ›ç¡®ä¿æŒ‡å®šå¤§å°çš„ JVM å †å†…å­˜ç»™ç”¨æˆ·ä»£ç ä½¿ç”¨ï¼Œå¯ä»¥æ˜ç¡®æŒ‡å®š<em>ä»»åŠ¡å †å†…å­˜</em>ï¼ˆ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-task-heap-size"><code>taskmanager.memory.task.heap.size</code></a>ï¼‰ã€‚ æŒ‡å®šçš„å†…å­˜å°†è¢«åŒ…å«åœ¨æ€»çš„ JVM å †ç©ºé—´ä¸­ï¼Œä¸“é—¨ç”¨äº Flink ç®—å­åŠç”¨æˆ·ä»£ç çš„æ‰§è¡Œã€‚</p><h4 id="æ‰˜ç®¡å†…å­˜"><a href="#æ‰˜ç®¡å†…å­˜" class="headerlink" title="æ‰˜ç®¡å†…å­˜"></a>æ‰˜ç®¡å†…å­˜</h4><p><em>æ‰˜ç®¡å†…å­˜</em>æ˜¯ç”± Flink è´Ÿè´£åˆ†é…å’Œç®¡ç†çš„æœ¬åœ°ï¼ˆå †å¤–ï¼‰å†…å­˜ã€‚ ä»¥ä¸‹åœºæ™¯éœ€è¦ä½¿ç”¨<em>æ‰˜ç®¡å†…å­˜</em>ï¼š</p><ul><li>æµå¤„ç†ä½œä¸šä¸­ç”¨äº <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/ops/state/state_backends.html#the-rocksdbstatebackend">RocksDB State Backend</a>ã€‚</li><li><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/batch/">æ‰¹å¤„ç†ä½œä¸š</a>ä¸­ç”¨äºæ’åºã€å“ˆå¸Œè¡¨åŠç¼“å­˜ä¸­é—´ç»“æœã€‚</li><li>æµå¤„ç†å’Œæ‰¹å¤„ç†ä½œä¸šä¸­ç”¨äº<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/python/table-api-users-guide/udfs/python_udfs.html">åœ¨ Python è¿›ç¨‹ä¸­æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</a>ã€‚</li></ul><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§èŒƒå¼æŒ‡å®š<em>æ‰˜ç®¡å†…å­˜</em>çš„å¤§å°ï¼š</p><ul><li>é€šè¿‡ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-managed-size"><code>taskmanager.memory.managed.size</code></a> æ˜ç¡®æŒ‡å®šå…¶å¤§å°ã€‚</li><li>é€šè¿‡ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-managed-fraction"><code>taskmanager.memory.managed.fraction</code></a> æŒ‡å®šåœ¨<em>Flink æ€»å†…å­˜</em>ä¸­çš„å æ¯”ã€‚</li></ul><p>å½“åŒæ—¶æŒ‡å®šäºŒè€…æ—¶ï¼Œä¼šä¼˜å…ˆé‡‡ç”¨æŒ‡å®šçš„å¤§å°ï¼ˆSizeï¼‰ã€‚ è‹¥äºŒè€…å‡æœªæŒ‡å®šï¼Œä¼šæ ¹æ®<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-managed-fraction">é»˜è®¤å æ¯”</a>è¿›è¡Œè®¡ç®—ã€‚</p><h4 id="æ¶ˆè´¹è€…æƒé‡"><a href="#æ¶ˆè´¹è€…æƒé‡" class="headerlink" title="æ¶ˆè´¹è€…æƒé‡"></a>æ¶ˆè´¹è€…æƒé‡</h4><p>å¯¹äºåŒ…å«ä¸åŒç§ç±»çš„æ‰˜ç®¡å†…å­˜æ¶ˆè´¹è€…çš„ä½œä¸šï¼Œå¯ä»¥è¿›ä¸€æ­¥æ§åˆ¶æ‰˜ç®¡å†…å­˜å¦‚ä½•åœ¨æ¶ˆè´¹è€…ä¹‹é—´åˆ†é…ã€‚ é€šè¿‡ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-managed-consumer-weights"><code>taskmanager.memory.managed.consumer-weights</code></a> å¯ä»¥ä¸ºæ¯ä¸€ç§ç±»å‹çš„æ¶ˆè´¹è€…æŒ‡å®šä¸€ä¸ªæƒé‡ï¼ŒFlink ä¼šæŒ‰ç…§æƒé‡çš„æ¯”ä¾‹è¿›è¡Œå†…å­˜åˆ†é…ã€‚ ç›®å‰æ”¯æŒçš„æ¶ˆè´¹è€…ç±»å‹åŒ…æ‹¬ï¼š</p><ul><li><code>DATAPROC</code>ï¼šç”¨äºæµå¤„ç†ä¸­çš„ RocksDB State Backend å’Œæ‰¹å¤„ç†ä¸­çš„å†…ç½®ç®—æ³•ã€‚</li><li><code>PYTHON</code>ï¼šç”¨æˆ· Python è¿›ç¨‹ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªæµå¤„ç†ä½œä¸šåŒæ—¶ä½¿ç”¨åˆ°äº† RocksDB State Backend å’Œ Python UDFï¼Œæ¶ˆè´¹è€…æƒé‡è®¾ç½®ä¸º <code>DATAPROC:70,PYTHON:30</code>ï¼Œé‚£ä¹ˆ Flink ä¼šå°† <code>70%</code> çš„æ‰˜ç®¡å†…å­˜ç”¨äº RocksDB State Backendï¼Œ<code>30%</code> ç•™ç»™ Python è¿›ç¨‹ã€‚</p><p><strong>æç¤º</strong> åªæœ‰ä½œä¸šä¸­åŒ…å«æŸç§ç±»å‹çš„æ¶ˆè´¹è€…æ—¶ï¼ŒFlink æ‰ä¼šä¸ºè¯¥ç±»å‹åˆ†é…æ‰˜ç®¡å†…å­˜ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªæµå¤„ç†ä½œä¸šä½¿ç”¨ Heap State Backend å’Œ Python UDFï¼Œæ¶ˆè´¹è€…æƒé‡è®¾ç½®ä¸º <code>DATAPROC:70,PYTHON:30</code>ï¼Œé‚£ä¹ˆ Flink ä¼šå°†å…¨éƒ¨æ‰˜ç®¡å†…å­˜ç”¨äº Python è¿›ç¨‹ï¼Œå› ä¸º Heap State Backend ä¸ä½¿ç”¨æ‰˜ç®¡å†…å­˜ã€‚</p><p><strong>æç¤º</strong> å¯¹äºæœªå‡ºç°åœ¨æ¶ˆè´¹è€…æƒé‡ä¸­çš„ç±»å‹ï¼ŒFlink å°†ä¸ä¼šä¸ºå…¶åˆ†é…æ‰˜ç®¡å†…å­˜ã€‚ å¦‚æœç¼ºå¤±çš„ç±»å‹æ˜¯ä½œä¸šè¿è¡Œæ‰€å¿…é¡»çš„ï¼Œåˆ™ä¼šå¼•å‘å†…å­˜åˆ†é…å¤±è´¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…æƒé‡ä¸­åŒ…å«äº†æ‰€æœ‰å¯èƒ½çš„æ¶ˆè´¹è€…ç±»å‹ã€‚ ä¸Šè¿°é—®é¢˜ä»…å¯èƒ½å‡ºç°åœ¨ç”¨æˆ·æ˜¾å¼åœ°é…ç½®äº†æ¶ˆè´¹è€…æƒé‡çš„æƒ…å†µä¸‹ã€‚</p><h3 id="é…ç½®å †å¤–å†…å­˜-ç›´æ¥å†…å­˜æˆ–æœ¬åœ°å†…å­˜"><a href="#é…ç½®å †å¤–å†…å­˜-ç›´æ¥å†…å­˜æˆ–æœ¬åœ°å†…å­˜" class="headerlink" title="é…ç½®å †å¤–å†…å­˜(ç›´æ¥å†…å­˜æˆ–æœ¬åœ°å†…å­˜)"></a>é…ç½®å †å¤–å†…å­˜(ç›´æ¥å†…å­˜æˆ–æœ¬åœ°å†…å­˜)</h3><p>ç”¨æˆ·ä»£ç ä¸­åˆ†é…çš„å †å¤–å†…å­˜è¢«å½’ä¸º<em>ä»»åŠ¡å †å¤–å†…å­˜ï¼ˆTask Off-heap Memoryï¼‰</em>ï¼Œå¯ä»¥é€šè¿‡ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-task-off-heap-size"><code>taskmanager.memory.task.off-heap.size</code></a> æŒ‡å®šã€‚</p><p><strong>æç¤º</strong> ä½ ä¹Ÿå¯ä»¥è°ƒæ•´<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#framework-memory">æ¡†æ¶å †å¤–å†…å­˜ï¼ˆFramework Off-heap Memoryï¼‰</a>ã€‚ è¿™æ˜¯ä¸€ä¸ªè¿›é˜¶é…ç½®ï¼Œå»ºè®®ä»…åœ¨ç¡®å®š Flink æ¡†æ¶éœ€è¦æ›´å¤šçš„å†…å­˜æ—¶è°ƒæ•´è¯¥é…ç½®ã€‚</p><p>Flink å°†<em>æ¡†æ¶å †å¤–å†…å­˜</em>å’Œ<em>ä»»åŠ¡å †å¤–å†…å­˜</em>éƒ½è®¡ç®—åœ¨ JVM çš„<em>ç›´æ¥å†…å­˜</em>é™åˆ¶ä¸­ï¼Œè¯·å‚è€ƒ <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html#jvm-parameters">JVM å‚æ•°</a>ã€‚</p><p><strong>æç¤º</strong> æœ¬åœ°å†…å­˜ï¼ˆéç›´æ¥å†…å­˜ï¼‰ä¹Ÿå¯ä»¥è¢«å½’åœ¨<em>æ¡†æ¶å †å¤–å†…å­˜</em>æˆ–<em>ä»»åŠ¡å †å¤–å†…å­˜</em>ä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ JVM çš„<em>ç›´æ¥å†…å­˜</em>é™åˆ¶å¯èƒ½ä¼šé«˜äºå®é™…éœ€æ±‚ã€‚</p><p><strong>æç¤º</strong> <em>ç½‘ç»œå†…å­˜ï¼ˆNetwork Memoryï¼‰</em>åŒæ ·è¢«è®¡ç®—åœ¨ JVM <em>ç›´æ¥å†…å­˜</em>ä¸­ã€‚ Flink ä¼šè´Ÿè´£ç®¡ç†ç½‘ç»œå†…å­˜ï¼Œä¿è¯å…¶å®é™…ç”¨é‡ä¸ä¼šè¶…è¿‡é…ç½®å¤§å°ã€‚ å› æ­¤ï¼Œè°ƒæ•´<em>ç½‘ç»œå†…å­˜</em>çš„å¤§å°ä¸ä¼šå¯¹å…¶ä»–å †å¤–å†…å­˜æœ‰å®è´¨ä¸Šçš„å½±å“ã€‚</p><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.12/fig/detailed-mem-model.svg" style="width:35%" /><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‹è¡¨ä¸­åˆ—å‡ºäº† Flink TaskManager å†…å­˜æ¨¡å‹çš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠå½±å“å…¶å¤§å°çš„ç›¸å…³é…ç½®å‚æ•°ã€‚</p><table><thead><tr><th align="left"><strong>ç»„æˆéƒ¨åˆ†</strong></th><th align="left"><strong>é…ç½®å‚æ•°</strong></th><th align="left"><strong>æè¿°</strong></th></tr></thead><tbody><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#framework-memory">æ¡†æ¶å †å†…å­˜ï¼ˆFramework Heap Memoryï¼‰</a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-framework-heap-size"><code>taskmanager.memory.framework.heap.size</code></a></td><td align="left">ç”¨äº Flink æ¡†æ¶çš„ JVM å †å†…å­˜ï¼ˆè¿›é˜¶é…ç½®ï¼‰ã€‚</td></tr><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#task-operator-heap-memory">ä»»åŠ¡å †å†…å­˜ï¼ˆTask Heap Memoryï¼‰</a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-task-heap-size"><code>taskmanager.memory.task.heap.size</code></a></td><td align="left">ç”¨äº Flink åº”ç”¨çš„ç®—å­åŠç”¨æˆ·ä»£ç çš„ JVM å †å†…å­˜ã€‚</td></tr><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#managed-memory">æ‰˜ç®¡å†…å­˜ï¼ˆManaged memoryï¼‰</a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-managed-size"><code>taskmanager.memory.managed.size</code></a> <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-managed-fraction"><code>taskmanager.memory.managed.fraction</code></a></td><td align="left">ç”± Flink ç®¡ç†çš„ç”¨äºæ’åºã€å“ˆå¸Œè¡¨ã€ç¼“å­˜ä¸­é—´ç»“æœåŠ RocksDB State Backend çš„æœ¬åœ°å†…å­˜ã€‚</td></tr><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#framework-memory">æ¡†æ¶å †å¤–å†…å­˜ï¼ˆFramework Off-heap Memoryï¼‰</a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-framework-off-heap-size"><code>taskmanager.memory.framework.off-heap.size</code></a></td><td align="left">ç”¨äº Flink æ¡†æ¶çš„<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#configure-off-heap-memory-direct-or-native">å †å¤–å†…å­˜ï¼ˆç›´æ¥å†…å­˜æˆ–æœ¬åœ°å†…å­˜ï¼‰</a>ï¼ˆè¿›é˜¶é…ç½®ï¼‰ã€‚</td></tr><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#configure-off-heap-memory-direct-or-native">ä»»åŠ¡å †å¤–å†…å­˜ï¼ˆTask Off-heap Memoryï¼‰</a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-task-off-heap-size"><code>taskmanager.memory.task.off-heap.size</code></a></td><td align="left">ç”¨äº Flink åº”ç”¨çš„ç®—å­åŠç”¨æˆ·ä»£ç çš„<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup_tm.html#configure-off-heap-memory-direct-or-native">å †å¤–å†…å­˜ï¼ˆç›´æ¥å†…å­˜æˆ–æœ¬åœ°å†…å­˜ï¼‰</a>ã€‚</td></tr><tr><td align="left">ç½‘ç»œå†…å­˜ï¼ˆNetwork Memoryï¼‰</td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-network-min"><code>taskmanager.memory.network.min</code></a> <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-network-max"><code>taskmanager.memory.network.max</code></a> <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-network-fraction"><code>taskmanager.memory.network.fraction</code></a></td><td align="left">ç”¨äºä»»åŠ¡ä¹‹é—´æ•°æ®ä¼ è¾“çš„ç›´æ¥å†…å­˜ï¼ˆä¾‹å¦‚ç½‘ç»œä¼ è¾“ç¼“å†²ï¼‰ã€‚è¯¥å†…å­˜éƒ¨åˆ†ä¸ºåŸºäº <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html#configure-total-memory">Flink æ€»å†…å­˜</a>çš„<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html#capped-fractionated-components">å—é™çš„ç­‰æ¯”å†…å­˜éƒ¨åˆ†</a>ã€‚</td></tr><tr><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html#jvm-parameters">JVM Metaspace</a></td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-jvm-metaspace-size"><code>taskmanager.memory.jvm-metaspace.size</code></a></td><td align="left">Flink JVM è¿›ç¨‹çš„ Metaspaceã€‚</td></tr><tr><td align="left">JVM å¼€é”€</td><td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-jvm-overhead-min"><code>taskmanager.memory.jvm-overhead.min</code></a> <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-jvm-overhead-max"><code>taskmanager.memory.jvm-overhead.max</code></a> <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/config.html#taskmanager-memory-jvm-overhead-fraction"><code>taskmanager.memory.jvm-overhead.fraction</code></a></td><td align="left">ç”¨äºå…¶ä»– JVM å¼€é”€çš„æœ¬åœ°å†…å­˜ï¼Œä¾‹å¦‚æ ˆç©ºé—´ã€åƒåœ¾å›æ”¶ç©ºé—´ç­‰ã€‚è¯¥å†…å­˜éƒ¨åˆ†ä¸ºåŸºäº<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html#configure-total-memory">è¿›ç¨‹æ€»å†…å­˜</a>çš„<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_setup.html#capped-fractionated-components">å—é™çš„ç­‰æ¯”å†…å­˜éƒ¨åˆ†</a>ã€‚</td></tr></tbody></table><h2 id="Web-UI-ç•Œé¢ä»‹ç»"><a href="#Web-UI-ç•Œé¢ä»‹ç»" class="headerlink" title="Web UI ç•Œé¢ä»‹ç»"></a>Web UI ç•Œé¢ä»‹ç»</h2><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/20210312150340.svg"></p><h3 id="å†…å­˜æ ¹æ®Slotæ•°é‡åˆ’åˆ†éƒ¨åˆ†æºç "><a href="#å†…å­˜æ ¹æ®Slotæ•°é‡åˆ’åˆ†éƒ¨åˆ†æºç " class="headerlink" title="å†…å­˜æ ¹æ®Slotæ•°é‡åˆ’åˆ†éƒ¨åˆ†æºç "></a>å†…å­˜æ ¹æ®Slotæ•°é‡åˆ’åˆ†éƒ¨åˆ†æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/resourcemanager/slotmanager/SlotManagerImpl.java</span></span><br><span class="line"><span class="meta">@VisibleForTesting</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ResourceProfile <span class="title function_">generateDefaultSlotResourceProfile</span><span class="params">(WorkerResourceSpec workerResourceSpec, <span class="type">int</span> numSlotsPerWorker)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResourceProfile.newBuilder()</span><br><span class="line">        .setCpuCores(workerResourceSpec.getCpuCores().divide(numSlotsPerWorker))</span><br><span class="line">        .setTaskHeapMemory(workerResourceSpec.getTaskHeapSize().divide(numSlotsPerWorker))</span><br><span class="line">        .setTaskOffHeapMemory(workerResourceSpec.getTaskOffHeapSize().divide(numSlotsPerWorker))</span><br><span class="line">        .setManagedMemory(workerResourceSpec.getManagedMemSize().divide(numSlotsPerWorker))</span><br><span class="line">        .setNetworkMemory(workerResourceSpec.getNetworkMemSize().divide(numSlotsPerWorker))</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è·å–å·²ç”¨Managedå†…å­˜æ ¸å¿ƒæºç "><a href="#è·å–å·²ç”¨Managedå†…å­˜æ ¸å¿ƒæºç " class="headerlink" title="è·å–å·²ç”¨Managedå†…å­˜æ ¸å¿ƒæºç "></a>è·å–å·²ç”¨Managedå†…å­˜æ ¸å¿ƒæºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/MetricUtils.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">getUsedManagedMemory</span><span class="params">(TaskSlotTable&lt;?&gt; taskSlotTable)</span> &#123;</span><br><span class="line">    Set&lt;AllocationID&gt; activeTaskAllocationIds = taskSlotTable.getActiveTaskSlotAllocationIds();</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">usedMemory</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">for</span> (AllocationID allocationID : activeTaskAllocationIds) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MemoryManager</span> <span class="variable">taskSlotMemoryManager</span> <span class="operator">=</span> taskSlotTable.getTaskMemoryManager(allocationID);</span><br><span class="line">            usedMemory += taskSlotMemoryManager.getMemorySize() - taskSlotMemoryManager.availableMemory();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SlotNotFoundException e) &#123;</span><br><span class="line">            LOG.debug(<span class="string">&quot;The task slot &#123;&#125; is not present anymore and will be ignored in calculating the amount of used memory.&quot;</span>, allocationID);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> usedMemory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Flinkæºç ä¿®æ”¹"><a href="#Flinkæºç ä¿®æ”¹" class="headerlink" title="Flinkæºç ä¿®æ”¹"></a>Flinkæºç ä¿®æ”¹</h3><ol><li><p>å¢åŠ æ˜¾ç¤ºç®—å­å®ä¾‹ä¸slotä¹‹é—´çš„å¯¹åº”å…³ç³»</p><p><code>è¯·æ±‚åœ°å€</code>ï¼š</p></li></ol><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210107211317.png" alt="image-20210107211317693"></p><p>â€‹<code>æ•°æ®æ ·ä¾‹</code>ï¼š</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210107211257.png" alt="image-20210107211257448"></p><ol start="2"><li>å¢åŠ Taskmanagerä¸­å¯¹slotsStatusçš„æ˜¾ç¤º</li></ol><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210107213354.png" alt="image-20210107213354649"></p>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
          <category> æµå¤„ç† </category>
          
          <category> Flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flink </tag>
            
            <tag> æµå¤„ç† </tag>
            
            <tag> å†…å­˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±åº¦å¼ºåŒ–å­¦ä¹ ç›¸å…³è°ƒç ”ç¬”è®°</title>
      <link href="/2020/b1d7d7b5/"/>
      <url>/2020/b1d7d7b5/</url>
      
        <content type="html"><![CDATA[<h1 id="è°ƒç ”ç¬”è®°"><a href="#è°ƒç ”ç¬”è®°" class="headerlink" title="è°ƒç ”ç¬”è®°"></a>è°ƒç ”ç¬”è®°</h1><h2 id="é©¬å°”ç§‘å¤«é“¾"><a href="#é©¬å°”ç§‘å¤«é“¾" class="headerlink" title="é©¬å°”ç§‘å¤«é“¾"></a>é©¬å°”ç§‘å¤«é“¾</h2><p><strong>é©¬å°”å¯å¤«é“¾</strong>ï¼ˆè‹±è¯­ï¼šMarkov chainï¼‰ï¼Œåˆç§°<strong>ç¦»æ•£æ—¶é—´é©¬å¯å¤«é“¾</strong>ï¼ˆdiscrete-time Markov chainï¼Œç¼©å†™ä¸º<strong>DTMC</strong>[<a href="https://zh.wikipedia.org/wiki/%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E9%93%BE#cite_note-1">1]</a>ï¼‰ï¼Œå› ä¿„å›½æ•°å­¦å®¶<a href="https://zh.wikipedia.org/wiki/%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB">å®‰å¾·çƒˆÂ·é©¬å°”å¯å¤«</a>å¾—åï¼Œä¸º<a href="https://zh.wikipedia.org/wiki/%E7%8B%80%E6%85%8B%E7%A9%BA%E9%96%93_(%E8%A8%88%E7%AE%97%E6%A9%9F%E7%A7%91%E5%AD%B8)">çŠ¶æ€ç©ºé—´</a>ä¸­ç»è¿‡ä»ä¸€ä¸ªçŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€çš„è½¬æ¢çš„<a href="https://zh.wikipedia.org/wiki/%E9%9A%8F%E6%9C%BA%E8%BF%87%E7%A8%8B">éšæœºè¿‡ç¨‹</a>ã€‚è¯¥è¿‡ç¨‹è¦æ±‚å…·å¤‡â€œæ— è®°å¿†â€çš„æ€§è´¨ï¼šä¸‹ä¸€çŠ¶æ€çš„æ¦‚ç‡åˆ†å¸ƒåªèƒ½ç”±å½“å‰çŠ¶æ€å†³å®šï¼Œåœ¨æ—¶é—´åºåˆ—ä¸­å®ƒå‰é¢çš„äº‹ä»¶å‡ä¸ä¹‹æ— å…³ã€‚è¿™ç§ç‰¹å®šç±»å‹çš„â€œæ— è®°å¿†æ€§â€ç§°ä½œ<a href="https://zh.wikipedia.org/wiki/%E9%A6%AC%E5%8F%AF%E5%A4%AB%E6%80%A7%E8%B3%AA">é©¬å¯å¤«æ€§è´¨</a>ã€‚é©¬å°”ç§‘å¤«é“¾ä½œä¸ºå®é™…è¿‡ç¨‹çš„ç»Ÿè®¡æ¨¡å‹å…·æœ‰è®¸å¤šåº”ç”¨ã€‚</p><h2 id="å¼ºåŒ–å­¦ä¹ "><a href="#å¼ºåŒ–å­¦ä¹ " class="headerlink" title="å¼ºåŒ–å­¦ä¹ "></a>å¼ºåŒ–å­¦ä¹ </h2><h3 id="1-1-å‡è®¾"><a href="#1-1-å‡è®¾" class="headerlink" title="1.1 å‡è®¾"></a>1.1 å‡è®¾</h3><ul><li>å¥–åŠ±å‡è®¾ï¼šå¼ºåŒ–å­¦ä¹ çš„ç›®çš„æ˜¯æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±çš„æœŸæœ›</li><li>Markovå‡è®¾ï¼šè½¬ç§»åªä¾èµ–å½“å‰çŠ¶æ€å’Œå½“å‰é€‰æ‹©çš„åŠ¨ä½œï¼Œä¸ä¹‹å‰çš„çŠ¶æ€å’ŒåŠ¨ä½œæ— å…³</li></ul><h4 id="1-2ç¯å¢ƒæ¨¡å‹çš„å®šä¹‰"><a href="#1-2ç¯å¢ƒæ¨¡å‹çš„å®šä¹‰" class="headerlink" title="1.2ç¯å¢ƒæ¨¡å‹çš„å®šä¹‰"></a>1.2ç¯å¢ƒæ¨¡å‹çš„å®šä¹‰</h4><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201230121418.png" alt="image-20201230121418162"></p><h3 id="1-3ç›®æ ‡"><a href="#1-3ç›®æ ‡" class="headerlink" title="1.3ç›®æ ‡"></a>1.3ç›®æ ‡</h3><p>æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ï¼Œå«åšå›æŠ¥(return)<br>$$<br>R:&#x3D;\sum^{T}_{t&#x3D;1}{r_t}<br>$$<br><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201230121848.png" alt="image-20201230121848541"></p><p>ã€1ã€‘<a href="https://zhuanlan.zhihu.com/p/72234324">ç°ä»£æ·±åº¦å¼ºåŒ–å­¦ä¹ ç®—æ³•ç»¼è¿°</a></p><p>ã€2ã€‘<a href="https://zhuanlan.zhihu.com/p/28549596">æ·±åº¦å¼ºåŒ–å­¦ä¹ â€”â€”ä»DQNåˆ°DDPG</a></p>]]></content>
      
      
      <categories>
          
          <category> æ™ºèƒ½é¢†åŸŸ </category>
          
          <category> æ·±åº¦å¼ºåŒ–å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±åº¦å¼ºåŒ–å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flink Metrics REST APIä½¿ç”¨</title>
      <link href="/2020/c73cf02/"/>
      <url>/2020/c73cf02/</url>
      
        <content type="html"><![CDATA[<h1 id="Flink-Metrics-REST-APIä½¿ç”¨"><a href="#Flink-Metrics-REST-APIä½¿ç”¨" class="headerlink" title="Flink Metrics REST APIä½¿ç”¨"></a>Flink Metrics REST APIä½¿ç”¨</h1><h2 id="Operator-Metricsé‡‡é›†"><a href="#Operator-Metricsé‡‡é›†" class="headerlink" title="Operator Metricsé‡‡é›†"></a>Operator Metricsé‡‡é›†</h2><ul><li>idletime</li><li>numRecords</li><li>queueLen</li></ul><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/ops/metrics.html#default-shuffle-service">https://ci.apache.org/projects/flink/flink-docs-release-1.12/ops/metrics.html#default-shuffle-service</a></p><h2 id="TaskManager-Metricsé‡‡é›†"><a href="#TaskManager-Metricsé‡‡é›†" class="headerlink" title="TaskManager Metricsé‡‡é›†"></a>TaskManager Metricsé‡‡é›†</h2><p>FlinkåŸºäºJVMè¿è¡Œï¼Œå¯¹TM Metricsçš„åˆ†æå®é™…ä¸Šå°±æ˜¯åœ¨è¿›ç¨‹åŠçº¿ç¨‹çº§åˆ«è¿›è¡Œåˆ†æã€‚</p><p>Flinké‡‡é›†TMçš„JVMæŒ‡æ ‡æ—¶ï¼Œæ˜¯é€šè¿‡javaè‡ªå·±çš„<code>OperatingSystemMXBean</code>æ¥è¿›è¡Œé‡‡é›†çš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><h4 id="JVM-CPUè´Ÿè½½æƒ…å†µ"><a href="#JVM-CPUè´Ÿè½½æƒ…å†µ" class="headerlink" title="JVM CPUè´Ÿè½½æƒ…å†µ"></a>JVM CPUè´Ÿè½½æƒ…å†µ</h4><p>Flinkéƒ¨åˆ†æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/MetricUtils.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">instantiateCPUMetrics</span><span class="params">(MetricGroup metrics)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> com.sun.management.<span class="type">OperatingSystemMXBean</span> <span class="variable">mxBean</span> <span class="operator">=</span> (com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();</span><br><span class="line"></span><br><span class="line">        metrics.&lt;Double, Gauge&lt;Double&gt;&gt;gauge(<span class="string">&quot;Load&quot;</span>, mxBean::getProcessCpuLoad);</span><br><span class="line">        metrics.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(<span class="string">&quot;Time&quot;</span>, mxBean::getProcessCpuTime);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        LOG.warn(<span class="string">&quot;Cannot access com.sun.management.OperatingSystemMXBean.getProcessCpuLoad()&quot;</span> +</span><br><span class="line">                 <span class="string">&quot; - CPU load metrics will not be available.&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>jvmæä¾›çš„<a href="https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getProcessCpuLoad()"><code>getProcessCpuLoad()</code>æ–¹æ³•</a>ï¼Œä»‹ç»å¦‚ä¸‹</p><blockquote><p>è¿”å›Javaè™šæ‹Ÿæœºè¿›ç¨‹çš„â€œæœ€è¿‘cpuä½¿ç”¨é‡â€ã€‚è¯¥å€¼æ˜¯[0.0,1.0]åŒºé—´å†…çš„ä¸€ä¸ªåŒç²¾åº¦å€¼ã€‚0.0çš„å€¼è¡¨ç¤ºåœ¨æœ€è¿‘è§‚å¯Ÿçš„æ—¶é—´æ®µå†…æ²¡æœ‰ä¸€ä¸ªcpuè¿è¡Œæ¥è‡ªJVMè¿›ç¨‹çš„çº¿ç¨‹ï¼Œè€Œ1.0çš„å€¼è¡¨ç¤ºåœ¨æœ€è¿‘è§‚å¯Ÿçš„æ—¶é—´æ®µå†…ï¼Œæ‰€æœ‰cpu 100%éƒ½åœ¨æ´»è·ƒåœ°è¿è¡Œæ¥è‡ªJVMè¿›ç¨‹çš„çº¿ç¨‹ã€‚æ¥è‡ªJVMçš„çº¿ç¨‹åŒ…æ‹¬åº”ç”¨ç¨‹åºçº¿ç¨‹å’ŒJVMå†…éƒ¨çº¿ç¨‹ã€‚æ ¹æ®JVMè¿›ç¨‹å’Œæ•´ä¸ªç³»ç»Ÿä¸­æ­£åœ¨è¿›è¡Œçš„æ´»åŠ¨ï¼Œ0.0åˆ°1.0ä¹‹é—´çš„æ‰€æœ‰å€¼éƒ½æ˜¯å¯èƒ½çš„ã€‚å¦‚æœJavaè™šæ‹Ÿæœºæœ€è¿‘çš„CPUå ç”¨ç‡ä¸å¯ç”¨ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚</p><p>Returns the â€œrecent cpu usageâ€ for the Java Virtual Machine process. This value is a double in the [0.0,1.0] interval. A value of 0.0 means that none of the CPUs were running threads from the JVM process during the recent period of time observed, while a value of 1.0 means that all CPUs were actively running threads from the JVM 100% of the time during the recent period being observed. Threads from the JVM include the application threads as well as the JVM internal threads. All values betweens 0.0 and 1.0 are possible depending of the activities going on in the JVM process and the whole system. If the Java Virtual Machine recent CPU usage is not available, the method returns a negative value.</p></blockquote><p>è¯¥æ–¹æ³•è¿”å›æ•´ä¸ªJVMçš„CPUä½¿ç”¨æƒ…å†µï¼Œè¦æƒ³è·å¾—è¿›ç¨‹çº§åˆ«çš„éœ€è¦è€ƒè™‘å…¶ä»–æ–¹æ³•ã€‚</p><ul><li>å¯ä»¥é€šè¿‡jpsè·å¾—TaskManagerçš„è¿›ç¨‹ID</li></ul><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131222.png" alt="image-20201224222950624"></p><ul><li>ç„¶åæ ¹æ®è¿›ç¨‹IDé€šè¿‡<code>top -H -p 23621</code>å¯ä»¥çœ‹åˆ°çº¿ç¨‹å¯¹CPUçš„ä½¿ç”¨æƒ…å†µï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªç®—å­éƒ½æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä½¿ç”¨ç¨‹åºå¯¼å‡ºæ—¶åº”è€ƒè™‘ä¸€ä¸‹å…¶ä»–å‘½ä»¤</li></ul><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131259.png" alt="image-20201224222919852"></p><h4 id="JVM-å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#JVM-å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="JVM å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>JVM å†…å­˜ä½¿ç”¨æƒ…å†µ</h4><h5 id="JVM-å†…å­˜ç±»å‹"><a href="#JVM-å†…å­˜ç±»å‹" class="headerlink" title="JVM å†…å­˜ç±»å‹"></a>JVM å†…å­˜ç±»å‹</h5><blockquote><p>å‚è€ƒ<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/management/MemoryMXBean.html">https://docs.oracle.com/javase/8/docs/api/java/lang/management/MemoryMXBean.html</a></p></blockquote><ol><li><p>Heap</p><blockquote><p>Javaè™šæ‹Ÿæœºæœ‰ä¸€ä¸ªå †ï¼Œå®ƒæ˜¯è¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œæ‰€æœ‰ç±»å®ä¾‹å’Œæ•°ç»„çš„å†…å­˜éƒ½ä»è¿™ä¸ªå †ä¸­åˆ†é…ã€‚å®ƒåœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚å¯¹è±¡çš„å †å†…å­˜ç”±è¢«ç§°ä¸ºåƒåœ¾æ”¶é›†å™¨çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿå›æ”¶ã€‚</p><p>å †çš„å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥æ‰©å±•æˆ–æ”¶ç¼©ã€‚å †çš„å†…å­˜ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚</p><p>The Java virtual machine has a <em>heap</em> that is the runtime data area from which memory for all class instances and arrays are allocated. It is created at the Java virtual machine start-up. Heap memory for objects is reclaimed by an automatic memory management system which is known as a <em>garbage collector</em>.</p><p>The heap may be of a fixed size or may be expanded and shrunk. The memory for the heap does not need to be contiguous.</p></blockquote></li><li><p>Non-Heap</p><blockquote><p>Javaè™šæ‹Ÿæœºç®¡ç†å †ä»¥å¤–çš„å†…å­˜(ç§°ä¸ºéå †å†…å­˜)ã€‚</p><p>Javaè™šæ‹Ÿæœºæœ‰ä¸€ä¸ªåœ¨æ‰€æœ‰çº¿ç¨‹ä¹‹é—´å…±äº«çš„æ–¹æ³•åŒºåŸŸã€‚æ–¹æ³•åŒºåŸŸå±äºéå †å†…å­˜ã€‚å®ƒå­˜å‚¨æ¯ä¸ªç±»çš„ç»“æ„ï¼Œæ¯”å¦‚è¿è¡Œæ—¶å¸¸é‡æ± ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ï¼Œä»¥åŠæ–¹æ³•å’Œæ„é€ å‡½æ•°çš„ä»£ç ã€‚å®ƒåœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚</p><p>æ–¹æ³•åŒºåŸŸåœ¨é€»è¾‘ä¸Šæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºå®ç°å¯ä»¥é€‰æ‹©ä¸è¿›è¡Œåƒåœ¾æ”¶é›†æˆ–å‹ç¼©å®ƒã€‚ä¸å †ç±»ä¼¼ï¼Œæ–¹æ³•åŒºåŸŸå¯ä»¥æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ‰©å±•æˆ–æ”¶ç¼©ã€‚æ–¹æ³•åŒºåŸŸçš„å†…å­˜ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚</p><p>é™¤äº†æ–¹æ³•åŒºåŸŸï¼ŒJavaè™šæ‹Ÿæœºå®ç°å¯èƒ½éœ€è¦å†…å­˜ç”¨äºå†…éƒ¨å¤„ç†æˆ–ä¼˜åŒ–ï¼Œè¿™äº›å†…å­˜ä¹Ÿå±äºéå †å†…å­˜ã€‚ä¾‹å¦‚ï¼ŒJITç¼–è¯‘å™¨éœ€è¦å†…å­˜æ¥å­˜å‚¨ä»Javaè™šæ‹Ÿæœºä»£ç è½¬æ¢è¿‡æ¥çš„æœ¬æœºæœºå™¨ä»£ç ï¼Œä»¥è·å¾—é«˜æ€§èƒ½ã€‚</p><p>The Java virtual machine manages memory other than the heap (referred as <em>non-heap memory</em>).</p><p>The Java virtual machine has a <em>method area</em> that is shared among all threads. The method area belongs to non-heap memory. It stores per-class structures such as a runtime constant pool, field and method data, and the code for methods and constructors. It is created at the Java virtual machine start-up.</p><p>The method area is logically part of the heap but a Java virtual machine implementation may choose not to either garbage collect or compact it. Similar to the heap, the method area may be of a fixed size or may be expanded and shrunk. The memory for the method area does not need to be contiguous.</p><p>In addition to the method area, a Java virtual machine implementation may require memory for internal processing or optimization which also belongs to non-heap memory. For example, the JIT compiler requires memory for storing the native machine code translated from the Java virtual machine code for high performance.</p></blockquote></li></ol><h5 id="MemoryUsage"><a href="#MemoryUsage" class="headerlink" title="MemoryUsage"></a>MemoryUsage</h5><p>MemoryUsageå¯¹è±¡åŒ…å«å››éƒ¨åˆ†</p><ul><li><p>init</p><p>è¡¨ç¤ºJavaè™šæ‹Ÿæœºåœ¨å¯åŠ¨æœŸé—´ä»æ“ä½œç³»ç»Ÿè¯·æ±‚å†…å­˜ç®¡ç†çš„åˆå§‹å†…å­˜é‡(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚Javaè™šæ‹Ÿæœºå¯èƒ½ä¼šå‘æ“ä½œç³»ç»Ÿè¯·æ±‚é¢å¤–çš„å†…å­˜ï¼Œä¹Ÿå¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»å‘ç³»ç»Ÿé‡Šæ”¾å†…å­˜ã€‚initçš„å€¼å¯èƒ½æ˜¯æœªå®šä¹‰çš„ã€‚</p></li><li><p>used</p><p>å½“å‰æ­£åœ¨ä½¿ç”¨çš„å†…å­˜é‡ï¼Œå­—èŠ‚æ•°</p></li><li><p>committed</p><p>è¡¨ç¤ºä¿è¯å¯ç”±Javaè™šæ‹Ÿæœºä½¿ç”¨çš„å†…å­˜é‡(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚æäº¤çš„å†…å­˜æ•°é‡å¯èƒ½ä¼šéšæ—¶é—´å˜åŒ–(å¢åŠ æˆ–å‡å°‘)ã€‚Javaè™šæ‹Ÿæœºå¯èƒ½é‡Šæ”¾å†…å­˜ç»™ç³»ç»Ÿï¼Œæäº¤çš„å†…å­˜å¯èƒ½å°äºinitã€‚committedæ€»æ˜¯å¤§äºæˆ–ç­‰äºusedã€‚</p></li><li><p>max</p><p>è¡¨ç¤ºå¯ç”¨äºå†…å­˜ç®¡ç†çš„æœ€å¤§å†…å­˜é‡(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚å®ƒçš„å€¼å¯èƒ½æ²¡æœ‰å®šä¹‰ã€‚å¦‚æœå®šä¹‰äº†æœ€å¤§å†…å­˜é‡ï¼Œåˆ™å¯èƒ½éšæ—¶é—´è€Œæ”¹å˜ã€‚å¦‚æœå®šä¹‰äº†maxï¼Œåˆ™å·²ä½¿ç”¨å’Œæäº¤çš„å†…å­˜æ€»é‡å°†å§‹ç»ˆå°äºæˆ–ç­‰äºmaxã€‚å¦‚æœè¯•å›¾å¢åŠ å·²ç”¨å†…å­˜ä½¿å…¶å¤§äºæäº¤å†…å­˜ï¼Œè¿™æ ·å³ä½¿used &lt;&#x3D; maxä»ç„¶ä¸ºtrue(ä¾‹å¦‚ï¼Œå½“ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ä¸è¶³æ—¶)ï¼Œé‚£ä¹ˆå†…å­˜åˆ†é…å¯èƒ½ä¼šå¤±è´¥ã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131803.png" alt="image-20201228104216053"></p><p>å¯¹jvmå†…å­˜çš„äº‹æƒ…æƒ…å†µé€šè¿‡ OpenJDKç®¡ç†å·¥å…·è·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/MetricUtils.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">instantiateMemoryUsageMetrics</span><span class="params">(<span class="keyword">final</span> MetricGroup metricGroup, <span class="keyword">final</span> Supplier&lt;MemoryUsage&gt; memoryUsageSupplier)</span> &#123;</span><br><span class="line">    metricGroup.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(MetricNames.MEMORY_USED, () -&gt; memoryUsageSupplier.get().getUsed());</span><br><span class="line">    metricGroup.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(MetricNames.MEMORY_COMMITTED, () -&gt; memoryUsageSupplier.get().getCommitted());</span><br><span class="line">    metricGroup.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(MetricNames.MEMORY_MAX, () -&gt; memoryUsageSupplier.get().getMax());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>å…³äºå †å†…å­˜ã€éå †å†…å­˜ç­‰å†…å­˜ç±»å‹å‚è€ƒJVMè™šæ‹Ÿæœºç›¸å…³å†…å®¹</strong></em></p><p>Status.Flink.Memoryæ˜¯<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-102%3A+Add+More+Metrics+to+TaskManager">Flink1.12.0</a>æ–°å¢åŠ çš„<a href="https://issues.apache.org/jira/browse/FLINK-14406">ç‰¹æ€§</a></p><p>åœ¨è·å–Flinkå·²ç”¨çš„å†…å­˜å¤§å°æ—¶ï¼Œæ˜¯ä¾æ¬¡è·å¾—æ¯ä¸ªSlotæ‰€ç”¨çš„å†…å­˜ã€‚</p><p>è·å¾—æ€»è®¡çš„Flinkç®¡ç†å†…å­˜æ—¶ï¼Œæ˜¯ç›´æ¥è·å–é…ç½®æ–‡ä»¶ä¸­çš„<code>taskmanager.memory.managed.size</code></p><blockquote><p>TaskExecutorç®¡ç†å†…å­˜å¤§å°ï¼Œæ˜¯ç”±memory managerç®¡ç†çš„éå †å†…å­˜å¤§å°ï¼Œä¸ºæ’åºã€å“ˆå¸Œè¡¨ã€ä¸­é—´ç»“æœç¼“å­˜ã€RocksDBçŠ¶æ€åç«¯æ‰€ä¿ç•™çš„å¤§å°ã€‚</p><p>å†…å­˜ä½¿ç”¨è€…å¯ä»¥ä»å†…å­˜ç®¡ç†å™¨ä¸­ä»¥MemorySegmentsçš„å½¢å¼åˆ†é…å†…å­˜ï¼Œä¹Ÿå¯ä»¥ä»å†…å­˜ç®¡ç†å™¨ä¸­ä¿ç•™å­—èŠ‚ï¼Œå¹¶å°†å…¶å†…å­˜ä½¿ç”¨ä¿æŒåœ¨è¯¥è¾¹ç•Œå†…ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™æ´¾ç”Ÿå®ƒï¼Œä»¥æ„æˆæ€»Flinkå†…å­˜çš„é…ç½®éƒ¨åˆ†ã€‚</p><p>Managed Memory size for TaskExecutors. This is the size of off-heap memory managed by the memory manager, reserved for sorting, hash tables, caching of intermediate results and RocksDB state backend. Memory consumers can either allocate memory from the memory manager in the form of MemorySegments, or reserve bytes from the memory manager and keep their memory usage within that boundary. If unspecified, it will be derived to make up the configured fraction of the Total Flink Memory.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/MetricUtils.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">getUsedManagedMemory</span><span class="params">(TaskSlotTable&lt;?&gt; taskSlotTable)</span> &#123;</span><br><span class="line">    Set&lt;AllocationID&gt; activeTaskAllocationIds = taskSlotTable.getActiveTaskSlotAllocationIds();</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">usedMemory</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">for</span> (AllocationID allocationID : activeTaskAllocationIds) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MemoryManager</span> <span class="variable">taskSlotMemoryManager</span> <span class="operator">=</span> taskSlotTable.getTaskMemoryManager(allocationID);</span><br><span class="line">            usedMemory += taskSlotMemoryManager.getMemorySize() - taskSlotMemoryManager.availableMemory();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SlotNotFoundException e) &#123;</span><br><span class="line">            LOG.debug(<span class="string">&quot;The task slot &#123;&#125; is not present anymore and will be ignored in calculating the amount of used memory.&quot;</span>, allocationID);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> usedMemory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JVMåƒåœ¾å›æ”¶æƒ…å†µ"><a href="#JVMåƒåœ¾å›æ”¶æƒ…å†µ" class="headerlink" title="JVMåƒåœ¾å›æ”¶æƒ…å†µ"></a>JVMåƒåœ¾å›æ”¶æƒ…å†µ</h4><p>åƒåœ¾å›æ”¶å¯ä»¥è·å¾—å›æ”¶çš„æ¬¡æ•°ä»¥åŠæ€»æ—¶é—´ï¼Œå…¶ä¸­<GarbageCollector>çš„åå­—æ˜¯é€šè¿‡Jvmç®¡ç†å·¥å…·çš„å¦‚ä¸‹æ–¹æ³•è·å¾—çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GarbageCollectorMXBean::getName</span><br></pre></td></tr></table></figure><h4 id="TMç½‘ç»œæƒ…å†µ"><a href="#TMç½‘ç»œæƒ…å†µ" class="headerlink" title="TMç½‘ç»œæƒ…å†µ"></a>TMç½‘ç»œæƒ…å†µ</h4><p>è¿™é‡Œä¼šé‡‡é›†TMæ‰€ç”¨çš„ç½‘ç»œå†…å­˜çš„ç›¸å…³ä¿¡æ¯<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/ops/metrics.html#default-shuffle-service">https://ci.apache.org/projects/flink/flink-docs-release-1.12/ops/metrics.html#default-shuffle-service</a></p><p>é€šè¿‡ä¸‹é¢çš„Flinkæºç å¢åŠ äº†ç›¸å…³çš„Metrics</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/io/network/metrics/NettyShuffleMetricFactory.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">internalRegisterShuffleMetrics</span><span class="params">(</span></span><br><span class="line"><span class="params">    MetricGroup parentMetricGroup,</span></span><br><span class="line"><span class="params">    NetworkBufferPool networkBufferPool)</span> &#123;</span><br><span class="line">    <span class="type">MetricGroup</span> <span class="variable">shuffleGroup</span> <span class="operator">=</span> parentMetricGroup.addGroup(METRIC_GROUP_SHUFFLE);</span><br><span class="line">    <span class="type">MetricGroup</span> <span class="variable">networkGroup</span> <span class="operator">=</span> shuffleGroup.addGroup(METRIC_GROUP_NETTY);</span><br><span class="line"></span><br><span class="line">    networkGroup.gauge(METRIC_TOTAL_MEMORY_SEGMENT,</span><br><span class="line">                       networkBufferPool::getTotalNumberOfMemorySegments);</span><br><span class="line">    networkGroup.gauge(METRIC_TOTAL_MEMORY,</span><br><span class="line">                       networkBufferPool::getTotalMemory);</span><br><span class="line"></span><br><span class="line">    networkGroup.gauge(METRIC_AVAILABLE_MEMORY_SEGMENT,</span><br><span class="line">                       networkBufferPool::getNumberOfAvailableMemorySegments);</span><br><span class="line">    networkGroup.gauge(METRIC_AVAILABLE_MEMORY,</span><br><span class="line">                       networkBufferPool::getAvailableMemory);</span><br><span class="line"></span><br><span class="line">    networkGroup.gauge(METRIC_USED_MEMORY_SEGMENT,</span><br><span class="line">                       networkBufferPool::getNumberOfUsedMemorySegments);</span><br><span class="line">    networkGroup.gauge(METRIC_USED_MEMORY,</span><br><span class="line">                       networkBufferPool::getUsedMemory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>getTotalNumberOfMemorySegments</code>ä¸<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/deployment/config.html#taskmanager-memory-network-min"><code>taskmanager.memory.network.min</code></a>é…ç½®é¡¹ç›¸å…³</p><blockquote><p>TaskExecutorsçš„æœ€å°ç½‘ç»œå†…å­˜å¤§å°ã€‚ç½‘ç»œå†…å­˜æ˜¯ä¸ºShuffleEnvironmenté¢„ç•™çš„å †å¤–å†…å­˜(ä¾‹å¦‚ï¼Œç½‘ç»œç¼“å†²åŒº)ã€‚ç½‘ç»œå†…å­˜å¤§å°æ˜¯ç”±æ€»é“¾æ¥å†…å­˜çš„é…ç½®éƒ¨åˆ†ç»„æˆçš„ã€‚å¦‚æœå¯¼å‡ºçš„å¤§å°å°äº&#x2F;å¤§äºé…ç½®çš„æœ€å°&#x2F;æœ€å¤§å¤§å°ï¼Œåˆ™ä½¿ç”¨æœ€å°&#x2F;æœ€å¤§å¤§å°ã€‚ç½‘ç»œå†…å­˜çš„ç¡®åˆ‡å¤§å°å¯ä»¥é€šè¿‡è®¾ç½®ç›¸åŒçš„æœ€å°&#x2F;æœ€å¤§å€¼æ¥æ˜¾å¼æŒ‡å®š</p><p>Min Network Memory size for TaskExecutors. Network Memory is off-heap memory reserved for ShuffleEnvironment (e.g., network buffers). Network Memory size is derived to make up the configured fraction of the Total Flink Memory. If the derived size is less&#x2F;greater than the configured min&#x2F;max size, the min&#x2F;max size will be used. The exact size of Network Memory can be explicitly specified by setting the min&#x2F;max to the same value.</p></blockquote><h4 id="Metrics-åˆ—è¡¨"><a href="#Metrics-åˆ—è¡¨" class="headerlink" title="Metrics åˆ—è¡¨"></a>Metrics åˆ—è¡¨</h4><h5 id="JVM-CPUæŒ‡æ ‡"><a href="#JVM-CPUæŒ‡æ ‡" class="headerlink" title="JVM CPUæŒ‡æ ‡"></a>JVM CPUæŒ‡æ ‡</h5><table><thead><tr><th align="center">Scope</th><th align="left">Infix</th><th align="left">Metrics</th><th align="left">Description</th><th align="left">Type</th></tr></thead><tbody><tr><td align="center"><strong>Job-&#x2F;TaskManager</strong></td><td align="left">Status.JVM.CPU</td><td align="left">Load</td><td align="left">The recent CPU usage of the JVM.</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Time</td><td align="left">The CPU time used by the JVM.</td><td align="left">Gauge</td></tr></tbody></table><h5 id="JVM-Memory"><a href="#JVM-Memory" class="headerlink" title="JVM Memory"></a>JVM Memory</h5><table><thead><tr><th align="center">Scope</th><th align="left">Infix</th><th align="left">Metrics</th><th align="left">Description</th><th align="left">Type</th></tr></thead><tbody><tr><td align="center"><strong>Job-&#x2F;TaskManager</strong></td><td align="left">Status.JVM.Memory</td><td align="left">Heap.Used</td><td align="left">The amount of heap memory currently used (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Heap.Committed</td><td align="left">The amount of heap memory guaranteed to be available to the JVM (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Heap.Max</td><td align="left">The maximum amount of heap memory that can be used for memory management (in bytes). This value might not be necessarily equal to the maximum value specified through -Xmx or the equivalent Flink configuration parameter. Some GC algorithms allocate heap memory that wonâ€™t be available to the user code and, therefore, not being exposed through the heap metrics.</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">NonHeap.Used</td><td align="left">The amount of non-heap memory currently used (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">NonHeap.Committed</td><td align="left">The amount of non-heap memory guaranteed to be available to the JVM (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">NonHeap.Max</td><td align="left">The maximum amount of non-heap memory that can be used for memory management (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Metaspace.Used</td><td align="left">The amount of memory currently used in the Metaspace memory pool (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Metaspace.Committed</td><td align="left">The amount of memory guaranteed to be available to the JVM in the Metaspace memory pool (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Metaspace.Max</td><td align="left">The maximum amount of memory that can be used in the Metaspace memory pool (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Direct.Count</td><td align="left">The number of buffers in the direct buffer pool.</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Direct.MemoryUsed</td><td align="left">The amount of memory used by the JVM for the direct buffer pool (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Direct.TotalCapacity</td><td align="left">The total capacity of all buffers in the direct buffer pool (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Mapped.Count</td><td align="left">The number of buffers in the mapped buffer pool.</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Mapped.MemoryUsed</td><td align="left">The amount of memory used by the JVM for the mapped buffer pool (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Mapped.TotalCapacity</td><td align="left">The number of buffers in the mapped buffer pool (in bytes).</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left">Status.Flink.Memory</td><td align="left">Managed.Used</td><td align="left">The amount of managed memory currently used.</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Managed.Total</td><td align="left">The total amount of managed memory.</td><td align="left">Gauge</td></tr></tbody></table><h5 id="GarbageCollection"><a href="#GarbageCollection" class="headerlink" title="GarbageCollection"></a>GarbageCollection</h5><table><thead><tr><th align="center">Scope</th><th align="left">Infix</th><th align="left">Metrics</th><th align="left">Description</th><th align="left">Type</th></tr></thead><tbody><tr><td align="center"><strong>Job-&#x2F;TaskManager</strong></td><td align="left">Status.JVM.GarbageCollector</td><td align="left"><GarbageCollector>.Count</td><td align="left">The total number of collections that have occurred.</td><td align="left">Gauge</td></tr><tr><td align="center"></td><td align="left"></td><td align="left"><GarbageCollector>.Time</td><td align="left">The total time spent performing garbage collection.</td><td align="left">Gauge</td></tr></tbody></table><h4 id="ä½¿ç”¨RestAPIè·å–TM-JVMæ€§èƒ½æŒ‡æ ‡"><a href="#ä½¿ç”¨RestAPIè·å–TM-JVMæ€§èƒ½æŒ‡æ ‡" class="headerlink" title="ä½¿ç”¨RestAPIè·å–TM JVMæ€§èƒ½æŒ‡æ ‡"></a>ä½¿ç”¨RestAPIè·å–TM JVMæ€§èƒ½æŒ‡æ ‡</h4><h5 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h5><p><code>url</code>: <code>http://&lt;jobmanager&gt;:&lt;port&gt;/taskmanagers/:taskmanagerid/metrics</code></p><p><code>params</code>:</p><ul><li><code>Status.JVM.CPU.Time</code></li><li><code>Status.JVM.CPU.Load</code>è·å–jvmè¿›ç¨‹çš„CPUè´Ÿè½½ï¼Œè¦æƒ³è·å¾—çº¿ç¨‹çº§çš„éœ€è¦è¿›ä¸€æ­¥è€ƒè™‘</li></ul><h2 id="System-Metricsé‡‡é›†"><a href="#System-Metricsé‡‡é›†" class="headerlink" title="System Metricsé‡‡é›†"></a>System Metricsé‡‡é›†</h2><h3 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><p>Flinkä½¿ç”¨<code>OSHI</code>æ¥é‡‡é›†ç³»ç»Ÿç¡¬ä»¶ä¿¡æ¯</p><h4 id="CPUä½¿ç”¨ç‡è·å–æ–¹å¼"><a href="#CPUä½¿ç”¨ç‡è·å–æ–¹å¼" class="headerlink" title="CPUä½¿ç”¨ç‡è·å–æ–¹å¼"></a>CPUä½¿ç”¨ç‡è·å–æ–¹å¼</h4><p>Flinkä¸­å…³äºCPUè´Ÿè½½éƒ¨åˆ†çš„é‡‡é›†æºç å¦‚ä¸‹ï¼Œå…¶ä¸­<code>getSystemCpuLoadTicks()</code>æ–¹æ³•ä¸º<a href="https://oshi.github.io/oshi/apidocs/oshi/hardware/CentralProcessor.html#getSystemCpuLoadTicks()">OSHIçš„æ–¹æ³•</a>ã€‚</p><p>è¯¥æ–¹æ³•è¿”å›çš„æŒ‡æ ‡ä¸­ï¼Œ<code>irq</code>ä¸º<code>Hardware interrupts</code>ï¼Œ<code>SoftIRQ</code>ä¸º<code>Software interrupts</code>ã€‚</p><p>oshiè®¿é—®<code>/proc/stat</code>æ–‡ä»¶è·å–CPUä¿¡æ¯</p><p><code>/proc/stat</code>æ–‡ä»¶éƒ¨åˆ†æˆªå›¾</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131765.png" alt="image-20201223170433096"></p><p><em><strong>é‡è¦</strong></em></p><p><code>oshi</code>åœ¨å¯¹<code>cpuUsage</code>ä½¿ç”¨çš„<code>getSystemCpuLoad()</code>æ–¹æ³•è°ƒç”¨äº†è°ƒç”¨äº†<code>com.sun.management.OperatingSystemMXBean</code>ä¸­çš„<a href="https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getSystemCpuLoad()"><code>getSystemCpuLoad()</code>æ–¹æ³•</a>æ¥è·å¾—è´Ÿè½½ã€‚è¯¥æ–¹æ³•è¯´æ˜å¦‚ä¸‹ï¼š</p><blockquote><p>è¿”å›æ•´ä¸ªç³»ç»Ÿçš„â€œæœ€è¿‘çš„CPUä½¿ç”¨æƒ…å†µâ€ã€‚ æ­¤å€¼æ˜¯[0.0,1.0]åŒºé—´ä¸­çš„å°æ•°ã€‚ å€¼0.0è¡¨ç¤ºåœ¨æœ€è¿‘è§‚å¯Ÿåˆ°çš„æ—¶é—´å†…æ‰€æœ‰CPUéƒ½å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå€¼1.0è¡¨ç¤ºåœ¨è§‚å¯Ÿåˆ°çš„æœ€è¿‘ä¸€æ®µæ—¶é—´å†…æ‰€æœ‰CPU 100ï¼…å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ ä»‹äº0.0åˆ°1.0ä¹‹é—´çš„æ‰€æœ‰å€¼éƒ½æ˜¯å¯èƒ½çš„ï¼Œå…·ä½“å–å†³äºç³»ç»Ÿä¸­æ­£åœ¨è¿›è¡Œçš„æ´»åŠ¨ã€‚ å¦‚æœç³»ç»Ÿæœ€è¿‘çš„CPUä½¿ç”¨ç‡ä¸å¯ç”¨ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›è´Ÿå€¼ã€‚</p><p>Returns the â€œrecent cpu usageâ€ for the whole system. This value is a double in the [0.0,1.0] interval. A value of 0.0 means that all CPUs were idle during the recent period of time observed, while a value of 1.0 means that all CPUs were actively running 100% of the time during the recent period being observed. All values betweens 0.0 and 1.0 are possible depending of the activities going on in the system. If the system recent cpu usage is not available, the method returns a negative value.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/SystemResourcesCounter.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">calculateCPUUsage</span><span class="params">(CentralProcessor processor)</span> &#123;</span><br><span class="line"><span class="type">long</span>[] ticks = processor.getSystemCpuLoadTicks();</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.previousCpuTicks == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.previousCpuTicks = ticks;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸¤æ¬¡æ£€æµ‹ä¹‹é—´çš„æ—¶é’Ÿæ•°æ¥è®¡ç®—ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="type">long</span> <span class="variable">userTicks</span> <span class="operator">=</span> ticks[TickType.USER.getIndex()] - previousCpuTicks[TickType.USER.getIndex()];</span><br><span class="line"><span class="type">long</span> <span class="variable">niceTicks</span> <span class="operator">=</span> ticks[TickType.NICE.getIndex()] - previousCpuTicks[TickType.NICE.getIndex()];</span><br><span class="line"><span class="type">long</span> <span class="variable">sysTicks</span> <span class="operator">=</span> ticks[TickType.SYSTEM.getIndex()] - previousCpuTicks[TickType.SYSTEM.getIndex()];</span><br><span class="line"><span class="type">long</span> <span class="variable">idleTicks</span> <span class="operator">=</span> ticks[TickType.IDLE.getIndex()] - previousCpuTicks[TickType.IDLE.getIndex()];</span><br><span class="line"><span class="type">long</span> <span class="variable">iowaitTicks</span> <span class="operator">=</span> ticks[TickType.IOWAIT.getIndex()] - previousCpuTicks[TickType.IOWAIT.getIndex()];</span><br><span class="line"><span class="type">long</span> <span class="variable">irqTicks</span> <span class="operator">=</span> ticks[TickType.IRQ.getIndex()] - previousCpuTicks[TickType.IRQ.getIndex()];</span><br><span class="line"><span class="type">long</span> <span class="variable">softIrqTicks</span> <span class="operator">=</span> ticks[TickType.SOFTIRQ.getIndex()] - previousCpuTicks[TickType.SOFTIRQ.getIndex()];</span><br><span class="line">        <span class="comment">// è¿™è¯´æ˜userã€niceã€sysã€idleã€iowã€irqã€softirqä¹‹å’Œåº”ä¸º100%ã€‚</span></span><br><span class="line">        <span class="comment">// åœ¨flinkæä¾›çš„æŒ‡æ ‡ä¸­ï¼Œæ”¾å¼ƒäº†getSystemCpuLoadTicks()æ–¹æ³•è¿”å›çš„Stealæ—¶é—´ï¼ŒStealæ—¶é—´è¡¨ç¤ºæœ‰è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œè¢«è™šæ‹Ÿæœºå ç”¨çš„æ—¶é—´</span></span><br><span class="line"><span class="type">long</span> <span class="variable">totalCpuTicks</span> <span class="operator">=</span> userTicks + niceTicks + sysTicks + idleTicks + iowaitTicks + irqTicks + softIrqTicks;</span><br><span class="line"><span class="built_in">this</span>.previousCpuTicks = ticks;</span><br><span class="line"></span><br><span class="line">cpuUser = <span class="number">100d</span> * userTicks / totalCpuTicks;</span><br><span class="line">cpuNice = <span class="number">100d</span> * niceTicks / totalCpuTicks;</span><br><span class="line">cpuSys = <span class="number">100d</span> * sysTicks / totalCpuTicks;</span><br><span class="line">cpuIdle = <span class="number">100d</span> * idleTicks / totalCpuTicks;</span><br><span class="line">cpuIOWait = <span class="number">100d</span> * iowaitTicks / totalCpuTicks;</span><br><span class="line">cpuIrq = <span class="number">100d</span> * irqTicks / totalCpuTicks;</span><br><span class="line">cpuSoftIrq = <span class="number">100d</span> * softIrqTicks / totalCpuTicks;</span><br><span class="line"></span><br><span class="line">cpuUsage = processor.getSystemCpuLoad() * <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span>[] loadAverage = processor.getSystemLoadAverage(<span class="number">3</span>);</span><br><span class="line">cpuLoad1 = (loadAverage[<span class="number">0</span>] &lt; <span class="number">0</span> ? Double.NaN : loadAverage[<span class="number">0</span>]);</span><br><span class="line">cpuLoad5 = (loadAverage[<span class="number">1</span>] &lt; <span class="number">0</span> ? Double.NaN : loadAverage[<span class="number">1</span>]);</span><br><span class="line">cpuLoad15 = (loadAverage[<span class="number">2</span>] &lt; <span class="number">0</span> ? Double.NaN : loadAverage[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="type">double</span>[] load = processor.getProcessorCpuLoadBetweenTicks();</span><br><span class="line">checkState(load.length == cpuUsagePerProcessor.length());</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; load.length; i++) &#123;</span><br><span class="line">cpuUsagePerProcessor.set(i, load[i] * <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å†…å­˜ä½¿ç”¨ç‡è·å–æ–¹å¼"><a href="#å†…å­˜ä½¿ç”¨ç‡è·å–æ–¹å¼" class="headerlink" title="å†…å­˜ä½¿ç”¨ç‡è·å–æ–¹å¼"></a>å†…å­˜ä½¿ç”¨ç‡è·å–æ–¹å¼</h4><p>oshiè®¿é—®æ–‡ä»¶<code>/proc/meminfo</code>æ¥è·å–å†…å­˜ä¿¡æ¯</p><p><code>/proc/meminfo</code>æ–‡ä»¶éƒ¨åˆ†æˆªå›¾</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131311.png" alt="image-20201223165623999"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/SystemResourcesMetricsInitializer.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">instantiateMemoryMetrics</span><span class="params">(MetricGroup metrics, GlobalMemory memory)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–Availableå¤§å°ï¼Œè¿™ä¸Freeä¸åŒï¼ŒFreeè¡¨ç¤ºä¸€ç›´æ²¡æœ‰è¢«ä½¿ç”¨è¿‡çš„å†…å­˜ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç¨‹åºä¹‹å‰ä½¿ç”¨äº†éƒ¨åˆ†å†…å­˜ï¼Œç°åœ¨ä¸ç”¨äº†ï¼ŒLinuxä¹Ÿä¸ä¼šå°†è¿™éƒ¨åˆ†å†…å­˜ç®—æˆFree</span></span><br><span class="line">    <span class="comment">// è€ŒAvailableåŒ…å«äº†è¿™éƒ¨åˆ†å¯ä»¥å›æ”¶çš„å†…å­˜ï¼Œå› æ­¤Availableè¦å¤§äºFree</span></span><br><span class="line">    metrics.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(<span class="string">&quot;Available&quot;</span>, memory::getAvailable);</span><br><span class="line">    metrics.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(<span class="string">&quot;Total&quot;</span>, memory::getTotal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="swapäº¤æ¢åˆ†åŒºä½¿ç”¨ç‡è·å–æ–¹å¼"><a href="#swapäº¤æ¢åˆ†åŒºä½¿ç”¨ç‡è·å–æ–¹å¼" class="headerlink" title="swapäº¤æ¢åˆ†åŒºä½¿ç”¨ç‡è·å–æ–¹å¼"></a>swapäº¤æ¢åˆ†åŒºä½¿ç”¨ç‡è·å–æ–¹å¼</h4><p>oshiè®¿é—®æ–‡ä»¶<code>/proc/meminfo</code>æ¥è·å–å†…å­˜ä¿¡æ¯ï¼Œä¸è·å–å†…å­˜ä½¿ç”¨ç›¸åŒ</p><p>è¿™é‡Œç›´æ¥è°ƒç”¨<code>oshi</code>çš„<code>getSwapUsed</code>æ–¹æ³•ï¼Œåœ¨<code>oshi</code>ä¸­ï¼Œ<code>SwapUsed</code>æ˜¯é€šè¿‡<code>/proc/meminfo</code>æ–‡ä»¶ä¸­çš„<code>Total</code>å’Œ<code>Free</code>ç›¸å‡å¾—åˆ°çš„ã€‚</p><p>Swapçš„ä½¿ç”¨ï¼Œèƒ½è¡¨ç°å‡ºç³»ç»Ÿå†…å­˜æ˜¯å¦å¤Ÿç”¨ï¼Œå¦‚æœé¢‘ç¹ä½¿ç”¨Swapï¼Œåˆ™è¡¨ç¤º<em>ç³»ç»Ÿå†…å­˜ä¸è¶³</em>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310131950.png" alt="image-20201223170913324"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/SystemResourcesMetricsInitializer.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">instantiateSwapMetrics</span><span class="params">(MetricGroup metrics, GlobalMemory memory)</span> &#123;</span><br><span class="line">    metrics.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(<span class="string">&quot;Used&quot;</span>, memory::getSwapUsed);</span><br><span class="line">    metrics.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(<span class="string">&quot;Total&quot;</span>, memory::getSwapTotal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç½‘ç»œä½¿ç”¨æƒ…å†µè·å–æ–¹å¼"><a href="#ç½‘ç»œä½¿ç”¨æƒ…å†µè·å–æ–¹å¼" class="headerlink" title="ç½‘ç»œä½¿ç”¨æƒ…å†µè·å–æ–¹å¼"></a>ç½‘ç»œä½¿ç”¨æƒ…å†µè·å–æ–¹å¼</h4><p><code>oshi</code>é€šè¿‡<code>getNetworkIFs()</code>æ–¹æ³•è·å–ç½‘ç»œæ¥å£åˆ—è¡¨ï¼ŒåŒ…æ‹¬æœ¬åœ°æ¥å£ã€‚è®¿é—®ä»¥ä¸‹è¿™äº›æ–‡ä»¶è·å–æ¥å£æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// oshi/hardware/platform/linux/LinuxNetworks.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">updateNetworkStats</span><span class="params">(NetworkIF netIF)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">txBytesPath</span> <span class="operator">=</span> String.format(<span class="string">&quot;/sys/class/net/%s/statistics/tx_bytes&quot;</span>, netIF.getName());</span><br><span class="line">    <span class="type">String</span> <span class="variable">rxBytesPath</span> <span class="operator">=</span> String.format(<span class="string">&quot;/sys/class/net/%s/statistics/rx_bytes&quot;</span>, netIF.getName());</span><br><span class="line">    <span class="type">String</span> <span class="variable">txPacketsPath</span> <span class="operator">=</span> String.format(<span class="string">&quot;/sys/class/net/%s/statistics/tx_packets&quot;</span>, netIF.getName());</span><br><span class="line">    <span class="type">String</span> <span class="variable">rxPacketsPath</span> <span class="operator">=</span> String.format(<span class="string">&quot;/sys/class/net/%s/statistics/rx_packets&quot;</span>, netIF.getName());</span><br><span class="line">    <span class="type">String</span> <span class="variable">txErrorsPath</span> <span class="operator">=</span> String.format(<span class="string">&quot;/sys/class/net/%s/statistics/tx_errors&quot;</span>, netIF.getName());</span><br><span class="line">    <span class="type">String</span> <span class="variable">rxErrorsPath</span> <span class="operator">=</span> String.format(<span class="string">&quot;/sys/class/net/%s/statistics/rx_errors&quot;</span>, netIF.getName());</span><br><span class="line">    <span class="type">String</span> <span class="variable">speed</span> <span class="operator">=</span> String.format(<span class="string">&quot;/sys/class/net/%s/speed&quot;</span>, netIF.getName());</span><br><span class="line"></span><br><span class="line">    netIF.setTimeStamp(System.currentTimeMillis());</span><br><span class="line">    netIF.setBytesSent(FileUtil.getLongFromFile(txBytesPath));</span><br><span class="line">    netIF.setBytesRecv(FileUtil.getLongFromFile(rxBytesPath));</span><br><span class="line">    netIF.setPacketsSent(FileUtil.getLongFromFile(txPacketsPath));</span><br><span class="line">    netIF.setPacketsRecv(FileUtil.getLongFromFile(rxPacketsPath));</span><br><span class="line">    netIF.setOutErrors(FileUtil.getLongFromFile(txErrorsPath));</span><br><span class="line">    netIF.setInErrors(FileUtil.getLongFromFile(rxErrorsPath));</span><br><span class="line">    netIF.setSpeed(FileUtil.getLongFromFile(speed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Flinkä¸­ï¼Œè·å¾—æ¯ä¸ªæ¥å£çš„å‘é€æ¥æ”¶çš„é€Ÿç‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/flink/runtime/metrics/util/SystemResourcesMetricsInitializer.java</span></span><br><span class="line"><span class="comment">// è¿™é‡Œåˆ†åˆ«è·å–ä¸åŒç½‘å¡çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">instantiateNetworkMetrics</span><span class="params">(MetricGroup metrics, SystemResourcesCounter usageCounter)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; usageCounter.getNetworkInterfaceNames().length; i++) &#123;</span><br><span class="line">        <span class="type">MetricGroup</span> <span class="variable">interfaceGroup</span> <span class="operator">=</span> metrics.addGroup(usageCounter.getNetworkInterfaceNames()[i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">interfaceNo</span> <span class="operator">=</span> i;</span><br><span class="line">        interfaceGroup.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(<span class="string">&quot;ReceiveRate&quot;</span>, () -&gt; usageCounter.getReceiveRatePerInterface(interfaceNo));</span><br><span class="line">        interfaceGroup.&lt;Long, Gauge&lt;Long&gt;&gt;gauge(<span class="string">&quot;SendRate&quot;</span>, () -&gt; usageCounter.getSendRatePerInterface(interfaceNo));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">calculateNetworkUsage</span><span class="params">(NetworkIF[] networkIFs)</span> &#123;</span><br><span class="line">    checkState(networkIFs.length == receiveRatePerInterface.length());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; networkIFs.length; i++) &#123;</span><br><span class="line">        <span class="type">NetworkIF</span> <span class="variable">networkIF</span> <span class="operator">=</span> networkIFs[i];</span><br><span class="line">        networkIF.updateNetworkStats();</span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œè®¾ç½®æ¯ä¸ªæ¥å£å‘é€æ¥æ”¶çš„é€Ÿç‡</span></span><br><span class="line">        receiveRatePerInterface.set(i, (networkIF.getBytesRecv() - bytesReceivedPerInterface[i]) * <span class="number">1000</span> / probeIntervalMs);</span><br><span class="line">        sendRatePerInterface.set(i, (networkIF.getBytesSent() - bytesSentPerInterface[i]) * <span class="number">1000</span> / probeIntervalMs);</span><br><span class="line"></span><br><span class="line">        bytesReceivedPerInterface[i] = networkIF.getBytesRecv();</span><br><span class="line">        bytesSentPerInterface[i] = networkIF.getBytesSent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®Flink"><a href="#é…ç½®Flink" class="headerlink" title="é…ç½®Flink"></a>é…ç½®Flink</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FLINK_HOME/libæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">wget https://repo1.maven.org/maven2/com/github/oshi/oshi-core/3.4.0/oshi-core-3.4.0.jar</span><br><span class="line">wget https://repo1.maven.org/maven2/net/java/dev/jna/jna-platform/4.2.2/jna-platform-4.2.2.jar</span><br><span class="line">wget https://repo1.maven.org/maven2/net/java/dev/jna/jna/4.2.2/jna-4.2.2.jar</span><br></pre></td></tr></table></figure><h3 id="Metricsåˆ—è¡¨"><a href="#Metricsåˆ—è¡¨" class="headerlink" title="Metricsåˆ—è¡¨"></a>Metricsåˆ—è¡¨</h3><h4 id="System-CPU"><a href="#System-CPU" class="headerlink" title="System CPU"></a>System CPU</h4><table><thead><tr><th align="center">Scope</th><th align="left">Infix</th><th align="left">Metrics</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><strong>Job-&#x2F;TaskManager</strong></td><td align="left">System.CPU</td><td align="left">Usage</td><td align="left">æ€»ä½“CPUä½¿ç”¨ã€‚Overall % of CPU usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Idle</td><td align="left">CPUç©ºé—²åŠåˆ†æ¯”ï¼Œ% of CPU Idle usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Sys</td><td align="left">CPUå†…æ ¸æ—¶é—´å ç”¨ç™¾åˆ†æ¯”ï¼Œ% of System CPU usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">User</td><td align="left">CPUç”¨æˆ·ç©ºé—´å ç”¨ç™¾åˆ†æ¯”ï¼Œ% of User CPU usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">IOWait</td><td align="left">CPUç­‰å¾…è¾“å…¥è¾“å‡ºç™¾åˆ†æ¯”ï¼Œ% of IOWait CPU usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Irq</td><td align="left">% of Irq CPU usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">SoftIrq</td><td align="left">% of SoftIrq CPU usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Nice</td><td align="left">% of Nice Idle usage on the machine.</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Load1min</td><td align="left">Average CPU load over 1 minute</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Load5min</td><td align="left">Average CPU load over 5 minute</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Load15min</td><td align="left">Average CPU load over 15 minute</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">UsageCPU*</td><td align="left">% of CPU usage per each processor</td></tr></tbody></table><h4 id="System-memory"><a href="#System-memory" class="headerlink" title="System memory"></a>System memory</h4><table><thead><tr><th align="center">Scope</th><th align="left">Infix</th><th align="left">Metrics</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><strong>Job-&#x2F;TaskManager</strong></td><td align="left">System.Memory</td><td align="left">Available</td><td align="left">Available memory in bytes</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Total</td><td align="left">Total memory in bytes</td></tr><tr><td align="center"></td><td align="left">System.Swap</td><td align="left">Used</td><td align="left">Used swap bytes</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">Total</td><td align="left">Total swap in bytes</td></tr></tbody></table><h4 id="System-network"><a href="#System-network" class="headerlink" title="System network"></a>System network</h4><table><thead><tr><th align="center">Scope</th><th align="left">Infix</th><th align="left">Metrics</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><strong>Job-&#x2F;TaskManager</strong></td><td align="left">System.Network.INTERFACE_NAME</td><td align="left">ReceiveRate</td><td align="left">Average receive rate in bytes per second</td></tr><tr><td align="center"></td><td align="left"></td><td align="left">SendRate</td><td align="left">Average send rate in bytes per second</td></tr></tbody></table><h3 id="ä½¿ç”¨REST-APIè·å–TMç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡"><a href="#ä½¿ç”¨REST-APIè·å–TMç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡" class="headerlink" title="ä½¿ç”¨REST APIè·å–TMç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡"></a>ä½¿ç”¨REST APIè·å–TMç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡</h3><p>ä¸¾ä¾‹éƒ¨åˆ†API</p><h4 id="è·å–TMåˆ—è¡¨"><a href="#è·å–TMåˆ—è¡¨" class="headerlink" title="è·å–TMåˆ—è¡¨"></a>è·å–TMåˆ—è¡¨</h4><p><code>url</code>: <code>http://&lt;jobmanager&gt;:&lt;port&gt;/taskmanagers</code></p><h4 id="è·å–TMç³»ç»Ÿä¿¡æ¯"><a href="#è·å–TMç³»ç»Ÿä¿¡æ¯" class="headerlink" title="è·å–TMç³»ç»Ÿä¿¡æ¯"></a>è·å–TMç³»ç»Ÿä¿¡æ¯</h4><h5 id="CPU-1"><a href="#CPU-1" class="headerlink" title="CPU"></a>CPU</h5><p><code>url</code>: <code>http://&lt;jobmanager&gt;:&lt;port&gt;/taskmanagers/:taskmanagerid/metrics</code></p><p><code>params</code>: </p><ul><li><code>System.CPU.Usage</code>ï¼Œè¿™ä¸€æŒ‡æ ‡æ˜¾ç¤ºå¯èƒ½ä¸Topä¸åŒ</li><li><code>System.CPU.Idle</code>ï¼Œé‡‡é›†ç©ºé—²æŒ‡æ ‡</li></ul><h5 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h5><p><code>url</code>: <code>http://&lt;jobmanager&gt;:&lt;port&gt;/taskmanagers/:taskmanagerid/metrics</code></p><p><code>params</code>: </p><ul><li><code>System.Memory.Total</code>ï¼Œå­—èŠ‚æ•°</li><li><code>System.Memory.Available</code>ï¼Œé‡‡é›†ç©ºé—²å†…å­˜ï¼Œå­—èŠ‚æ•°</li><li><code>System.Swap.Used</code>ï¼Œä½¿ç”¨Swapæ˜¯å¦è¢«ä½¿ç”¨ï¼Œæ¥è€ƒè™‘ç³»ç»Ÿå†…å­˜æ˜¯å¦è¶³å¤Ÿç”¨ï¼Œå¦‚æœç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œåˆ™ä¼šä½¿ç”¨Swapåˆ†åŒº</li><li><code>System.Swap.Total</code>ï¼Œ</li></ul><h6 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h6><p><code>url</code>: <code>http://&lt;jobmanager&gt;:&lt;port&gt;/taskmanagers/:taskmanagerid/metrics</code></p><p><code>params</code>: </p><ul><li><code>System.Network.&lt;interface_name&gt;.ReceiveRate</code>ï¼Œæ¯ç§’å­—èŠ‚æ•°</li><li><code>System.Network.&lt;interface_name&gt;.SendRate</code>ï¼Œå‘é€å­—èŠ‚æ•°</li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
          <category> æµå¤„ç† </category>
          
          <category> Flink </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flink </tag>
            
            <tag> æµå¤„ç† </tag>
            
            <tag> metrics </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux Top å‘½ä»¤è¯¦è§£</title>
      <link href="/2020/8649918/"/>
      <url>/2020/8649918/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxä¸‹Topå‘½ä»¤è¯¦è§£"><a href="#Linuxä¸‹Topå‘½ä»¤è¯¦è§£" class="headerlink" title="Linuxä¸‹Topå‘½ä»¤è¯¦è§£"></a>Linuxä¸‹Topå‘½ä»¤è¯¦è§£</h1><h2 id="å‘½ä»¤ç®€ä»‹"><a href="#å‘½ä»¤ç®€ä»‹" class="headerlink" title="å‘½ä»¤ç®€ä»‹"></a>å‘½ä»¤ç®€ä»‹</h2><p><strong>topå‘½ä»¤</strong> å¯ä»¥å®æ—¶åŠ¨æ€åœ°æŸ¥çœ‹ç³»ç»Ÿçš„æ•´ä½“è¿è¡Œæƒ…å†µï¼Œæ˜¯ä¸€ä¸ªç»¼åˆäº†å¤šæ–¹ä¿¡æ¯ç›‘æµ‹ç³»ç»Ÿæ€§èƒ½å’Œè¿è¡Œä¿¡æ¯çš„å®ç”¨å·¥å…·ã€‚é€šè¿‡topå‘½ä»¤æ‰€æä¾›çš„äº’åŠ¨å¼ç•Œé¢ï¼Œç”¨çƒ­é”®å¯ä»¥ç®¡ç†ã€‚</p><h2 id="å‘½ä»¤é€‰é¡¹"><a href="#å‘½ä»¤é€‰é¡¹" class="headerlink" title="å‘½ä»¤é€‰é¡¹"></a>å‘½ä»¤é€‰é¡¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-bï¼šä»¥æ‰¹å¤„ç†æ¨¡å¼æ“ä½œï¼›</span><br><span class="line">-cï¼šæ˜¾ç¤ºå®Œæ•´çš„æ²»å‘½ä»¤ï¼›</span><br><span class="line">-dï¼šå±å¹•åˆ·æ–°é—´éš”æ—¶é—´ï¼›</span><br><span class="line">-Iï¼šå¿½ç•¥å¤±æ•ˆè¿‡ç¨‹ï¼›</span><br><span class="line">-sï¼šä¿å¯†æ¨¡å¼ï¼›</span><br><span class="line">-Sï¼šç´¯ç§¯æ¨¡å¼ï¼›</span><br><span class="line">-i&lt;æ—¶é—´&gt;ï¼šè®¾ç½®é—´éš”æ—¶é—´ï¼›</span><br><span class="line">-u&lt;ç”¨æˆ·å&gt;ï¼šæŒ‡å®šç”¨æˆ·åï¼›</span><br><span class="line">-p&lt;è¿›ç¨‹å·&gt;ï¼šæŒ‡å®šè¿›ç¨‹ï¼›</span><br><span class="line">-n&lt;æ¬¡æ•°&gt;ï¼šå¾ªç¯æ˜¾ç¤ºçš„æ¬¡æ•°ã€‚</span><br></pre></td></tr></table></figure><h2 id="äº¤äº’å‘½ä»¤"><a href="#äº¤äº’å‘½ä»¤" class="headerlink" title="äº¤äº’å‘½ä»¤"></a>äº¤äº’å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">hï¼šæ˜¾ç¤ºå¸®åŠ©ç”»é¢ï¼Œç»™å‡ºä¸€äº›ç®€çŸ­çš„å‘½ä»¤æ€»ç»“è¯´æ˜ï¼›</span><br><span class="line">kï¼šç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼›</span><br><span class="line">iï¼šå¿½ç•¥é—²ç½®å’Œåƒµæ­»è¿›ç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å¼å‘½ä»¤ï¼›</span><br><span class="line">qï¼šé€€å‡ºç¨‹åºï¼›</span><br><span class="line">rï¼šé‡æ–°å®‰æ’ä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ«ï¼›</span><br><span class="line">Sï¼šåˆ‡æ¢åˆ°ç´¯è®¡æ¨¡å¼ï¼›</span><br><span class="line">sï¼šæ”¹å˜ä¸¤æ¬¡åˆ·æ–°ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼ˆå•ä½ä¸ºsï¼‰ï¼Œå¦‚æœæœ‰å°æ•°ï¼Œå°±æ¢ç®—æˆmsã€‚è¾“å…¥0å€¼åˆ™ç³»ç»Ÿå°†ä¸æ–­åˆ·æ–°ï¼Œé»˜è®¤å€¼æ˜¯5sï¼›</span><br><span class="line">fæˆ–è€…Fï¼šä»å½“å‰æ˜¾ç¤ºä¸­æ·»åŠ æˆ–è€…åˆ é™¤é¡¹ç›®ï¼›</span><br><span class="line">oæˆ–è€…Oï¼šæ”¹å˜æ˜¾ç¤ºé¡¹ç›®çš„é¡ºåºï¼›</span><br><span class="line">lï¼šåˆ‡æ¢æ˜¾ç¤ºå¹³å‡è´Ÿè½½å’Œå¯åŠ¨æ—¶é—´ä¿¡æ¯ï¼›</span><br><span class="line">mï¼šåˆ‡æ¢æ˜¾ç¤ºå†…å­˜ä¿¡æ¯ï¼›</span><br><span class="line">tï¼šåˆ‡æ¢æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯ï¼›</span><br><span class="line">cï¼šåˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œï¼›</span><br><span class="line">Mï¼šæ ¹æ®é©»ç•™å†…å­˜å¤§å°è¿›è¡Œæ’åºï¼›</span><br><span class="line">Pï¼šæ ¹æ®CPUä½¿ç”¨ç™¾åˆ†æ¯”å¤§å°è¿›è¡Œæ’åºï¼›</span><br><span class="line">Tï¼šæ ¹æ®æ—¶é—´/ç´¯è®¡æ—¶é—´è¿›è¡Œæ’åºï¼›</span><br><span class="line">wï¼šå°†å½“å‰è®¾ç½®å†™å…¥~/.toprcæ–‡ä»¶ä¸­ã€‚</span><br><span class="line">I: åˆ‡æ¢Irixæ¨¡å¼å’ŒSolarisæ¨¡å¼</span><br></pre></td></tr></table></figure><h2 id="æ˜¾ç¤ºç»“æœä»‹ç»"><a href="#æ˜¾ç¤ºç»“æœä»‹ç»" class="headerlink" title="æ˜¾ç¤ºç»“æœä»‹ç»"></a>æ˜¾ç¤ºç»“æœä»‹ç»</h2><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133699.png" alt="image-20201223140206196"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">top - 14:12:41 up 40 days,  8:58,  1 user,  load average: 0.01, 0.04, 0.05</span><br><span class="line">Tasks: 150 total,   1 running, 149 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.2 us,  0.1 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem : 16265208 total, 13027888 free,  1907500 used,  1329820 buff/cache</span><br><span class="line">KiB Swap:  2097148 total,  2097148 free,        0 used. 14028784 avail Mem</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line">31413lsy       20   0 7789400 810980  28092 S   1.7  5.0   0:38.60 java</span><br><span class="line">14052lsy       20   0 6060348 282744  22764 S   0.7  1.7  96:03.88 java</span><br><span class="line">31983root      20   0  162152   2288   1548 R   0.3  0.0   0:00.50 top</span><br><span class="line">1root      20   0  191284   4280   2596 S   0.0  0.0   0:15.67 systemd</span><br><span class="line">2root      20   0       0      0      0 S   0.0  0.0   0:00.60 kthreadd</span><br><span class="line">4root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H</span><br><span class="line">5root      20   0       0      0      0 S   0.0  0.0   0:10.16 kworker/u16:0</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€è¡Œ</strong></p><ul><li><code>top - 14:09:28</code>ï¼šæ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´</li><li><code>up 40 days,  8:57</code>ï¼šç³»ç»Ÿå·²ç»è¿è¡Œäº†16å¤©</li><li><code> 1 user</code>ï¼šä¸€ä¸ªç”¨æˆ·ç™»å½•</li><li><code>load average: 0.04, 0.05, 0.05</code>ï¼šç³»ç»Ÿè´Ÿè½½ï¼Œå³ä»»åŠ¡é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦ï¼Œä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸ºæˆªæ­¢ç›®å‰1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿå†…çš„å¹³å‡å€¼</li></ul><p><strong>ç¬¬äºŒè¡Œ</strong></p><ul><li><code>Tasks: 150 total</code>ï¼šæ€»è¿›ç¨‹æ•°</li><li><code>1 running</code>ï¼šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°</li><li><code>149 sleeping</code>ï¼šç¡çœ è¿›ç¨‹æ•°</li><li><code>0 stopped</code>ï¼šåœæ­¢è¿›ç¨‹æ•°</li><li><code>0 zombie</code>ï¼šå†»ç»“è¿›ç¨‹æ•°</li></ul><p><strong>ç¬¬ä¸‰è¡Œ</strong></p><ul><li><p><code>%Cpu(s):  0.2 us</code>ï¼šç”¨æˆ·ç©ºé—´è¿›ç¨‹å ç”¨CPUæ—¶é—´çš„ç™¾åˆ†æ¯”</p></li><li><p><code>0.1 sy</code>ï¼šå†…æ ¸ç©ºé—´è¿›ç¨‹å ç”¨CPUæ—¶é—´çš„ç™¾åˆ†æ¯”</p></li><li><p><code>0.0 ni</code>ï¼šniè¡¨ç¤ºniceçš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯å“ªäº›ç”¨æˆ·è¿›ç¨‹è¢«æå‡ä¼˜å…ˆçº§ä¹‹åï¼Œå ç”¨çš„CPUè¿è¡Œæ—¶é—´</p></li><li><p><code>99.7 id</code>ï¼šç³»ç»Ÿç©ºé—²æ—¶é—´</p></li><li><p><code>0.0 wa</code>ï¼šç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUç™¾åˆ†æ¯”</p></li><li><p><code>0.0 hi</code>ï¼šCPUå¤„ç†ç¡¬ä¸­æ–­(hard interruptï¼‰çš„æ—¶é—´ç™¾åˆ†æ¯”</p></li><li><p><code> 0.0 si</code>ï¼šCPUå¤„ç†è½¯ä¸­æ–­(soft interruptï¼‰çš„æ—¶é—´ç™¾åˆ†æ¯”</p></li><li><p><code>0.0 st</code>ï¼šè¿™ä¸ªè¡¨ç¤ºåœ¨æœ‰è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œè¢«è™šæ‹Ÿæœºå ç”¨çš„CPUæ—¶é—´ã€‚stè¡¨ç¤ºçªƒå–çš„æ„æ€ï¼Œstealçš„æ„æ€ã€‚</p><p><em><strong>ä¸Šé¢è¿™äº›ç™¾åˆ†æ¯”ç›¸åŠ çš„è¯ï¼Œæ˜¯ç­‰äº100%çš„ï¼ŒæŒ‰æ•°å­—é”® 1 å¯ä»¥çœ‹åˆ°ä¸åŒæ ¸å¿ƒçš„è´Ÿè½½</strong></em></p></li></ul><p><strong>ç¬¬å››è¡Œ</strong></p><ul><li><code>KiB Mem : 16265208 total</code>ï¼šè¡¨ç¤ºç³»ç»Ÿå¯ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡</li><li><code>13027888 free</code>ï¼šè¡¨ç¤ºå½“å‰ç©ºé—²çš„å†…å­˜æ€»é‡</li><li><code>1907500 used</code>ï¼šè¡¨ç¤ºå½“å‰å·²ç”¨çš„å†…å­˜æ€»é‡</li><li><code>1329820 buff/cache</code>ï¼šç”¨ä½œç³»ç»Ÿå†…æ ¸ç¼“å­˜çš„ç‰©ç†å†…å­˜æ€»é‡</li></ul><p><strong>ç¬¬äº”è¡Œ</strong></p><ul><li><code>KiB Swap:  2097148 total</code>ï¼šäº¤æ¢åŒºæ€»é‡</li><li><code>2097148 free</code>ï¼šäº¤æ¢åŒºç©ºé—²</li><li><code>      0 used</code>ï¼šäº¤æ¢åŒºä½¿ç”¨</li><li><code>14028784 avail Mem</code>ï¼šavail numberæ˜¯åœ¨ä¸è¿›è¡Œäº¤æ¢çš„æƒ…å†µä¸‹ï¼Œç”¨äºå¯åŠ¨æ–°åº”ç”¨ç¨‹åºçš„å¯ç”¨ç‰©ç†å†…å­˜çš„ä¼°è®¡ã€‚ä¸freeå­—æ®µä¸åŒï¼Œå®ƒè¯•å›¾è€ƒè™‘å®¹æ˜“å›æ”¶çš„é¡µé¢ç¼“å­˜å’Œå†…å­˜ã€‚å®ƒåœ¨å†…æ ¸3.14ä¸Šå¯ç”¨ï¼Œåœ¨å†…æ ¸2.6.27+ä¸Šå¯æ¨¡æ‹Ÿï¼Œå¦åˆ™å°±åƒfreeä¸€æ ·</li></ul><p><strong>ç¬¬ä¸ƒè¡Œä»¥ä¸‹</strong></p><ul><li><code>PID</code>ï¼šè¿›ç¨‹id</li><li><code>USER</code>ï¼šè¿›ç¨‹æ‰€æœ‰è€…</li><li><code>PR</code>ï¼šè¿›ç¨‹ä¼˜å…ˆçº§</li><li><code>NI</code>ï¼šniceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§</li><li><code>VIRT</code>ï¼šè¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT&#x3D;SWAP+RES</li><li><code>RES</code>ï¼šè¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES&#x3D;CODE+DATA</li><li><code>SHR</code>ï¼šå…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kb</li><li><code>S</code>ï¼šè¿›ç¨‹çŠ¶æ€ã€‚D&#x3D;ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ R&#x3D;è¿è¡Œ S&#x3D;ç¡çœ  T&#x3D;è·Ÿè¸ª&#x2F;åœæ­¢ Z&#x3D;åƒµå°¸è¿›ç¨‹</li><li><code>%CPU</code>ï¼šä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯”ï¼Œå¯¹ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºï¼Œå¦‚æœä¸æ˜¯åœ¨çº¿ç¨‹æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªæ•°å€¼æ˜¯å¯èƒ½è¶…è¿‡100%çš„ã€‚å¯¹äºå¤šå¤„ç†å™¨ç¯å¢ƒï¼Œå¦‚æœ<code>Irix</code>æ¨¡å¼æ˜¯å…³é—­çŠ¶æ€ï¼Œtopå°†åœ¨<code>Solaris</code>æ¨¡å¼ä¸‹å·¥ä½œï¼Œä»»åŠ¡çš„CPUä½¿ç”¨ç‡å°†é™¤ä»¥CPUæ•°é‡ï¼Œå¯ä»¥é€šè¿‡äº¤äº’å‘½ä»¤<code>I</code>æ¥æ›´æ”¹çŠ¶æ€</li><li><code>%MEM</code>ï¼šè¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”</li><li><code>TIME+</code>ï¼šè¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1&#x2F;100ç§’</li><li><code>COMMAND</code>ï¼šè¿›ç¨‹åç§°ï¼ˆå‘½ä»¤å&#x2F;å‘½ä»¤è¡Œï¼‰</li></ul><p>å‚è€ƒï¼š</p><p>[1] <a href="https://wangchujiang.com/linux-command/c/top.html">https://wangchujiang.com/linux-command/c/top.html</a></p><p>[2] <a href="https://www.cnblogs.com/taobataoma/archive/2007/12/26/1015167.html">https://www.cnblogs.com/taobataoma/archive/2007/12/26/1015167.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> å‘½ä»¤ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> å‘½ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GOè¯­è¨€å­¦ä¹ ç¬”è®°-åŸºç¡€</title>
      <link href="/2020/e5c841b2/"/>
      <url>/2020/e5c841b2/</url>
      
        <content type="html"><![CDATA[<h1 id="Goè¯­è¨€å­¦ä¹ ç¬”è®°-åŸºç¡€å†…å®¹"><a href="#Goè¯­è¨€å­¦ä¹ ç¬”è®°-åŸºç¡€å†…å®¹" class="headerlink" title="Goè¯­è¨€å­¦ä¹ ç¬”è®°-åŸºç¡€å†…å®¹"></a>Goè¯­è¨€å­¦ä¹ ç¬”è®°-åŸºç¡€å†…å®¹</h1><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p><strong>é€šé“</strong>æ˜¯ä¸€ç§å…è®¸æŸä¸€ä¾‹ç¨‹å‘å¦ä¸€ä¾‹ç¨‹ä¼ é€’æŒ‡å®šç±»å‹çš„å€¼çš„é€šä¿¡æœºåˆ¶ã€‚</p><p>å½“ä¸€ä¸ªgoroutineè¯•å›¾åœ¨ä¸€ä¸ªé€šé“ä¸Šè¿›è¡Œå‘é€æˆ–æ¥æ”¶æ“ä½œæ—¶ï¼Œå®ƒä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€ä¸ªgoroutineè¯•å›¾è¿›è¡Œæ¥æ”¶æˆ–å‘é€æ“ä½œæ‰ä¼ é€’å€¼ï¼Œå¹¶å¼€å§‹å¤„ç†ä¸¤ä¸ªgoroutineã€‚</p><h3 id="ä¸€äº›ä¹ æƒ¯"><a href="#ä¸€äº›ä¹ æƒ¯" class="headerlink" title="ä¸€äº›ä¹ æƒ¯"></a>ä¸€äº›ä¹ æƒ¯</h3><ul><li>Goè¯­è¨€ä½¿ç”¨<strong>é©¼å³°å¼</strong>é£æ ¼</li><li>åŒ…åç§°æœ¬èº«æ€»æ˜¯ç”±å°å†™å­—æ¯ç»„æˆã€‚</li><li>é€šå¸¸åç§°çš„ä½œç”¨åŸŸè¶Šå¤§ï¼Œå°±ä½¿ç”¨è¶Šé•¿ä¸”æ›´æœ‰æ„ä¹‰çš„åç§°ã€‚</li></ul><h3 id="ç”Ÿå‘½å‘¨æœŸé—®é¢˜"><a href="#ç”Ÿå‘½å‘¨æœŸé—®é¢˜" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸé—®é¢˜"></a>ç”Ÿå‘½å‘¨æœŸé—®é¢˜</h3><ul><li>å¦‚æœä¸€ä¸ªå®ä½“åœ¨å‡½æ•°ä¸­å£°æ˜ï¼Œé‚£ä¹ˆå®ƒä»…å¯¹å‡½æ•°å±€éƒ¨æœ‰æ•ˆã€‚å¦‚æœä¸€ä¸ªå®ä½“åœ¨å‡½æ•°å¤–éƒ¨å£°æ˜ï¼Œå®ƒå°†å¯¹&#x3D;&#x3D;<strong>åŒ…</strong>&#x3D;&#x3D;é‡Œæ‰€æœ‰æºæ–‡ä»¶å¯è§ã€‚</li><li>å®ä½“ç¬¬ä¸€ä¸ªå­—æ¯çš„å¤§å°å†™å†³å®šå…¶å¯è§æ€§æ˜¯å¦è·¨åŒ…ã€‚</li></ul><h3 id="ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ"><a href="#ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ"></a>ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ</h3><p>å£°æ˜çš„ä½œç”¨åŸŸæ˜¯å£°æ˜åœ¨ç¨‹åºæ–‡æœ¬ä¸­å‡ºç°çš„åŒºåŸŸï¼Œå®ƒæ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å±æ€§ã€‚å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å˜é‡åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´èƒ½è¢«ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†æ‰€å¼•ç”¨çš„èµ·æ­¢æ—¶é—´ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å±æ€§ã€‚</p><p>åœ¨åŒ…çº§åˆ«å£°æ˜ï¼Œå¯ä»¥è¢«åŒä¸€ä¸ªåŒ…é‡Œçš„ä»»ä½•æ–‡ä»¶å¼•ç”¨ï¼›å¯¼å…¥çš„åŒ…æ˜¯æ–‡ä»¶çº§åˆ«çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨åŒä¸€ä¸ªæ–‡ä»¶å†…å¼•ç”¨ï¼›</p><p>å†…éƒ¨çš„å£°æ˜ä¼šè¦†ç›–å¤–å±‚çš„ã€‚</p><h2 id="åŸºç¡€è¯­å¥"><a href="#åŸºç¡€è¯­å¥" class="headerlink" title="åŸºç¡€è¯­å¥"></a>åŸºç¡€è¯­å¥</h2><h3 id="å¾ªç¯è¯­å¥"><a href="#å¾ªç¯è¯­å¥" class="headerlink" title="å¾ªç¯è¯­å¥"></a>å¾ªç¯è¯­å¥</h3><p>foræ˜¯goé‡Œé¢å”¯ä¸€çš„å¾ªç¯è¯­å¥ï¼Œæœ‰ä»¥ä¸‹å½¢å¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ç¬¬ä¸€ç§ï¼Œä¸å…¶ä»–è¯­è¨€çš„forå¾ªç¯ç±»ä¼¼</span></span><br><span class="line"><span class="keyword">for</span> initialization;condition;post&#123;</span><br><span class="line">    <span class="comment">// 0ä¸ªæˆ–å¤šä¸ªè¯­å¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2. ç¬¬äºŒç§ï¼Œå…¶ä»–è¯­è¨€çš„whileè¯­å¥</span></span><br><span class="line"><span class="keyword">for</span> condition&#123;</span><br><span class="line">    <span class="comment">// è¯­å¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3. ç¬¬ä¸‰ç§ï¼Œä¼ ç»Ÿçš„æ— é™å¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// è¯­å¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4. ç¬¬å››ç§ï¼Œåœ¨å­—ç¬¦ä¸²æˆ–sliceæ•°æ®ä¸Šè¿­ä»£</span></span><br><span class="line"><span class="keyword">for</span> _,_ := <span class="keyword">range</span> os.Args[<span class="number">1</span>:]&#123;</span><br><span class="line">    <span class="comment">//è¯­å¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="new-å‡½æ•°"><a href="#new-å‡½æ•°" class="headerlink" title="new å‡½æ•°"></a>new å‡½æ•°</h3><p>ä½¿ç”¨newå‡½æ•°åˆ›å»ºå˜é‡ï¼Œè¡¨è¾¾å¼<code>new(T)</code>åˆ›å»ºä¸€ä¸ªæœªå‘½åçš„Tç±»å‹å˜é‡ï¼Œåˆå§‹åŒ–æœªTç±»å‹çš„é›¶å€¼ï¼Œ<strong>å¹¶è¿”å›å…¶åœ°å€</strong>ã€‚</p><h2 id="ä¸€äº›å¾…è§£å†³çš„é—®é¢˜"><a href="#ä¸€äº›å¾…è§£å†³çš„é—®é¢˜" class="headerlink" title="ä¸€äº›å¾…è§£å†³çš„é—®é¢˜"></a>ä¸€äº›å¾…è§£å†³çš„é—®é¢˜</h2><h3 id="1-URLå“åº”é—®é¢˜"><a href="#1-URLå“åº”é—®é¢˜" class="headerlink" title="1. URLå“åº”é—®é¢˜"></a>1. URLå“åº”é—®é¢˜</h3><p>ä½¿ç”¨goåšæœåŠ¡å™¨æ—¶ï¼Œ<strong>ä»¥<code>/</code>ç»“å°¾çš„å¤„ç†æ¨¡å¼åŒ¹é…æ‰€æœ‰å«æœ‰è¿™ä¸ªå‰ç¼€çš„URL</strong>ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œä¼šè§¦å‘ä¸¤æ¬¡å¤„ç†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, handler2)</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/count&quot;</span>,counter)</span><br></pre></td></tr></table></figure><p>ä½†æœ‰ä¸ªé—®é¢˜ï¼Œä½¿ç”¨<code>http.Get</code>å¯¹urlè¿›è¡Œè¯·æ±‚æ—¶ï¼Œå°±ä¸ä¼šè§¦å‘<code>/</code>ã€‚æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼Œè®¿é—®ç»“æœåœ¨ä»£ç ä¸‹æ–¹ã€‚</p><p>æœåŠ¡ç«¯ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> mu sync.Mutex</span><br><span class="line"><span class="keyword">var</span> count <span class="type">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// é—®é¢˜ï¼šè¿™ç§æ–¹å¼å¤„ç†ï¼Œæ˜¯å¦ä¸¤ä¸ªå¤„ç†å‡½æ•°éƒ½ä¼šè§¦å‘</span></span><br><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, handler2)</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/count&quot;</span>,counter)</span><br><span class="line">log.Fatal(http.ListenAndServe(<span class="string">&quot;localhost:8000&quot;</span>,<span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler2</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">mu.Lock()</span><br><span class="line">count++</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;URL.Path = %q\n&quot;</span>, r.URL.Path)</span><br><span class="line">fmt.Println(<span class="string">&quot;this is path &#x27;/&#x27;&quot;</span>)</span><br><span class="line">mu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">counter</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span>&#123;</span><br><span class="line">mu.Lock()</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;Count %d\n&quot;</span>,count)</span><br><span class="line">fmt.Println(<span class="string">&quot;this is path &#x27;count&#x27;&quot;</span>)</span><br><span class="line">mu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä»£ç :</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> getURL(ch)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">fmt.Println(&lt;-ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getURL</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">url := <span class="string">&quot;http://localhost:8000/count&quot;</span></span><br><span class="line">start := time.Now()</span><br><span class="line">resp, err := http.Get(url)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Sprint(os.Stderr, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">reader := <span class="built_in">new</span>(strings.Builder)</span><br><span class="line">io.Copy(reader, resp.Body)</span><br><span class="line">resp.Body.Close()</span><br><span class="line">secs := time.Since(start).Seconds()</span><br><span class="line">ch &lt;- fmt.Sprintf(<span class="string">&quot;%.2fs %s&quot;</span>, secs, reader.String())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310132710.png" alt="image-20201120172805036"></p><h3 id="2-ç®—æ³•åŸç†"><a href="#2-ç®—æ³•åŸç†" class="headerlink" title="2. ç®—æ³•åŸç†"></a>2. ç®—æ³•åŸç†</h3><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310132305.png" alt="image-20201127210210047"></p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
          <category> Goè¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> goè¯­è¨€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç”¨æˆ·æƒé™&#39;/etc/sudoer&#39;é…ç½®</title>
      <link href="/2020/4adf7b4/"/>
      <url>/2020/4adf7b4/</url>
      
        <content type="html"><![CDATA[<h1 id="ã€è½¬è½½ã€‘Linux-x2F-etc-x2F-sudoer-é…ç½®"><a href="#ã€è½¬è½½ã€‘Linux-x2F-etc-x2F-sudoer-é…ç½®" class="headerlink" title="ã€è½¬è½½ã€‘Linux &#x2F;etc&#x2F;sudoer é…ç½®"></a>ã€è½¬è½½ã€‘Linux &#x2F;etc&#x2F;sudoer é…ç½®</h1><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/43934300">https://zhuanlan.zhihu.com/p/43934300</a></p></blockquote><p>å½“æ™®é€šç”¨æˆ·å‘å…¶ä»–çš„ç”¨æˆ·è·å–å®ƒçš„æƒé™çš„æ—¶å€™ï¼Œå…¶ä»–ç”¨æˆ·æ€ä¹ˆå»åˆ¤æ–­æ˜¯ä¸æ˜¯éœ€è¦ç»™è¿™æ ·çš„æƒé™ç»™è¿™ä¸ªæ™®é€šç”¨æˆ·ã€‚å…¶ä¸­çš„æƒé™åˆ†é…ä½“ç°åœ¨ç»™äºˆæƒé™è€…çš„<code>/etc/sudoers</code>æ–‡ä»¶å½“ä¸­ã€‚</p><p>æ¯”å¦‚åœ¨æ–‡ä»¶ä¸­é…ç½®æœ‰è¿™æ ·ä¸€æ¡ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310135159.png" alt="v2-aabac307640f3d2f50be74d9c6cc2497_r"></p><ul><li><code>zhang</code>ï¼šè¡¨ç¤ºç”¨æˆ·å</li><li><code>ALL=(ALL)</code>ï¼šç¬¬ä¸€ä¸ª<code>ALL</code>è¡¨ç¤ºæ‰€æœ‰çš„ä¸»æœºï¼Œç¬¬äºŒä¸ª<code>ALL</code>è¡¨ç¤ºæ‰€æœ‰çš„ç”¨æˆ·</li><li>NOPASSWDï¼šè¡¨ç¤ºä¸éœ€è¦å¯†ç å°±èƒ½åˆ‡æ¢åˆ°ç”¨æˆ·</li><li><code>/usr/bin/bash,/usr/bin/sh</code>ï¼šè¡¨ç¤ºèƒ½å¤Ÿæ‰§è¡Œçš„å‘½ä»¤</li></ul><p>è¿™ä¸ªé…ç½®çš„æ„æ€å°±æ˜¯ï¼Œ<code>zhang</code>ç”¨æˆ·å¯ä»¥åœ¨ä»»æ„ä¸»æœºä¸Šä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹ä»¥ä»»æ„ç”¨æˆ·æ‰§è¡Œ<code>/usr/bin/bash,/usr/bin/sh</code></p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/v2-df97d0ae89d65a68445075be4e4a7304_r.jpg" alt="v2-df97d0ae89d65a68445075be4e4a7304_r"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ç”¨æˆ·æƒé™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµå¤„ç†å¼¹æ€§ç›¸å…³è®ºæ–‡é˜…è¯»ç¬”è®°</title>
      <link href="/2020/575ad623/"/>
      <url>/2020/575ad623/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤§æ•°æ®æµå¤„ç†å¼¹æ€§ä¼¸ç¼©è®ºæ–‡é˜…è¯»ç¬”è®°"><a href="#å¤§æ•°æ®æµå¤„ç†å¼¹æ€§ä¼¸ç¼©è®ºæ–‡é˜…è¯»ç¬”è®°" class="headerlink" title="å¤§æ•°æ®æµå¤„ç†å¼¹æ€§ä¼¸ç¼©è®ºæ–‡é˜…è¯»ç¬”è®°"></a>å¤§æ•°æ®æµå¤„ç†å¼¹æ€§ä¼¸ç¼©è®ºæ–‡é˜…è¯»ç¬”è®°</h1><h2 id="1-Multi-Level-Elasticity-for-Data-Stream-Processing-IEEE-Transactions-on-Parallel-and-Distributed-Systems-TPDS-2019-A"><a href="#1-Multi-Level-Elasticity-for-Data-Stream-Processing-IEEE-Transactions-on-Parallel-and-Distributed-Systems-TPDS-2019-A" class="headerlink" title="[1] Multi-Level Elasticity for Data Stream Processing. IEEE Transactions on Parallel and Distributed Systems(TPDS).2019.A"></a>[1] Multi-Level Elasticity for Data Stream Processing. IEEE Transactions on Parallel and Distributed Systems(TPDS).2019.A</h2><h3 id="ç ”ç©¶å†…å®¹"><a href="#ç ”ç©¶å†…å®¹" class="headerlink" title="ç ”ç©¶å†…å®¹"></a>ç ”ç©¶å†…å®¹</h3><p>æ›´æ”¹ä¸åŒçš„æ‰§è¡Œå®¹å™¨(è™šæ‹Ÿæœºã€è¿›ç¨‹ã€çº¿ç¨‹)çš„æ•°é‡æ¥å½±å“å®¹å™¨çš„æ€§èƒ½ã€‚åŸºæœ¬çš„æƒ³æ³•æ˜¯ä¸åŒçš„æ‰§è¡Œå®¹å™¨ä¼šæœ‰ä¸åŒçš„æ€§èƒ½ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥ä¸åŒçš„å¼€é”€ã€‚ä½œè€…çš„æƒ³æ³•æ˜¯è‡ªåŠ¨æä¾›æœ€å°‘çš„èµ„æºæ¥æ»¡è¶³åº”ç”¨æ‰€éœ€çš„æ€§èƒ½ã€‚åœ¨ä½œè€…çš„æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ä½çº§åˆ«çš„å®¹å™¨ç»„åˆæ¥å……åˆ†åˆ©ç”¨é«˜çº§åˆ«å®¹å™¨çš„èµ„æºã€‚</p><h3 id="æŠ€æœ¯è·¯çº¿"><a href="#æŠ€æœ¯è·¯çº¿" class="headerlink" title="æŠ€æœ¯è·¯çº¿"></a>æŠ€æœ¯è·¯çº¿</h3><p>å¤šå±‚æ¬¡æ‰©å±•çš„ä¸»è¦æ€è·¯æ˜¯ï¼Œæ£€æŸ¥å½“å‰èŠ‚ç‚¹æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Œå¦‚æœè¾¾åˆ°äº†å°±æ‰©å±•èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡è¾¾åˆ°å°±è€ƒè™‘å¢åŠ ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸»è¦æ˜¯åœ¨è¿›è¡Œè¿›ç¨‹ä¸è™šæ‹Ÿæœºä¹‹é—´çš„è°ƒåº¦ã€‚</p><p>æ–‡ç« ä¸­çš„åº”ç”¨ç¨‹åºä¸»è¦è€ƒè™‘å¤„ç†å¤§é‡å°ä¿¡æ¯çš„æµå¤„ç†ç¨‹åº(æ¯”å¦‚ï¼Œæ¨ç‰¹æ¶ˆæ¯ï¼Œä¼ æ„Ÿå™¨æ—¥å¿—)ã€‚æ–‡ç« æå‡ºäº†ä½¿ç”¨ç¯å¢ƒæ˜¯éå¤šç§Ÿæˆ·ç¯å¢ƒï¼Œå¹¶ä¸”èŠ‚ç‚¹æ˜¯åº”ç”¨ä¸“ç”¨(è¿™ä¸ªåº”è¯¥å°±æ˜¯ä¸ºäº†é¿å…CPUç­‰ä¿¡æ¯å—å¹²æ‰°çš„é—®é¢˜)ã€‚ç®—å­å®ä¾‹ä¹‹é—´å¹³å‡åˆ†é…æ•°æ®æµ(ä¸è€ƒè™‘æ•°æ®å€¾æ–œ)ã€‚</p><p>ä½œè€…æå‡ºçš„æ–¹æ³•ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œï¼ˆ1ï¼‰è¯„ä¼°ä¸åŒå±‚æ¬¡çš„æ‰§è¡Œå®¹å™¨çš„æ€§èƒ½ï¼ˆ2ï¼‰ä¸ºç»™å®šçš„è´Ÿè½½æä¾›é€‚å½“çš„é…ç½®ï¼ˆ3ï¼‰æ„é€ å…·ä½“åº”ç”¨çš„å¼¹æ€§æ§åˆ¶å™¨ã€‚</p><p>ä¸ºäº†å†³å®šæä¾›ä»€ä¹ˆæ ·çš„æ‰§è¡Œå®¹å™¨ï¼Œéœ€è¦çŸ¥é“ä¸åŒçº§åˆ«çš„æ‰§è¡Œå®¹å™¨çš„å¹¶è¡Œåº¦å¦‚ä½•å½±å“æ€§èƒ½ï¼Œä½œè€…è·å¾—è¿™ä¸ªä¿¡æ¯çš„æ–¹å¼æ˜¯é€šè¿‡å¹³å°æä¾›ï¼Œæˆ–è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚åœ¨è€ƒè™‘ç“¶é¢ˆç®—å­çš„æ—¶å€™ï¼Œæ˜¯ä»ç¦»æºç®—å­è¿‘çš„åœ°æ–¹å¼€å§‹è€ƒè™‘ï¼Œé¿å…ä¸Šæ¸¸å½±å“ä¸‹æ¸¸ã€‚</p><h4 id="ä»€ä¹ˆæ—¶å€™å†³å®šæ‰©å±•"><a href="#ä»€ä¹ˆæ—¶å€™å†³å®šæ‰©å±•" class="headerlink" title="ä»€ä¹ˆæ—¶å€™å†³å®šæ‰©å±•"></a>ä»€ä¹ˆæ—¶å€™å†³å®šæ‰©å±•</h4><p>ä½œè€…åœ¨è€ƒè™‘æ˜¯å¦è¿›è¡Œæ‰©å±•æ—¶ï¼Œæ˜¯æŒ‰ç…§ç®—å­å®ä¾‹é€ä¸ªè€ƒè™‘ï¼Œé€šè¿‡æ¯”è¾ƒå®ä¾‹çš„$Health$å€¼æ˜¯å¦ä½äº$minHealth$æ¥åˆ¤æ–­å®ä¾‹æ˜¯å¦éœ€è¦æ‰©å±•ã€‚</p><h4 id="å¦‚ä½•è¿›è¡Œæ‰©å±•"><a href="#å¦‚ä½•è¿›è¡Œæ‰©å±•" class="headerlink" title="å¦‚ä½•è¿›è¡Œæ‰©å±•"></a>å¦‚ä½•è¿›è¡Œæ‰©å±•</h4><p>é¦–å…ˆæ‰¾åˆ°å…·æœ‰æœ€å°èµ„æºè´Ÿè½½çš„èŠ‚ç‚¹(ä¹Ÿå°±æ˜¯å½“å‰ç©ºé—²èµ„æºæœ€å¤šçš„èŠ‚ç‚¹)ã€‚å½“å…·æœ‰æœ€å¤šèµ„æºçš„èŠ‚ç‚¹çš„CPUä¸å†…å­˜çš„å ç”¨è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™ä¼šæ‰©å±•èµ·ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚å¦‚æœèŠ‚ç‚¹è¿˜æœ‰èµ„æºï¼Œåˆ™ä¼šæ ¹æ®æœ€ä¼˜å®¹å™¨é…ç½®éƒ¨ç½²ä¸€ä¸ªæ–°çš„å®ä¾‹æ¥æå¢åŠ æ€§èƒ½ï¼Œè¿™ä¸ªæœ€ä¼˜ä¿¡æ¯æ˜¯é€šè¿‡ç¬¬ä¸€æ­¥ä¸­è·å¾—çš„ã€‚ç®—æ³•ä¹Ÿä¼šæ›´æ–°æ–°çš„é…ç½®ä¿¡æ¯ã€‚</p><p>ä¸ºäº†é˜²æ­¢éœ‡è¡å‘ç”Ÿï¼Œä¸æ˜¯æ¯æ¬¡è§‚å¯Ÿæ—¶éƒ½ä¼šè¿›è¡Œç¼©æ”¾ï¼Œè€Œæ˜¯å¯¹å¤šä¸ªè§‚å¯Ÿå€¼è¿›è¡Œçº¿æ€§å›å½’æ¥è®¡ç®—å˜åŒ–è¶‹åŠ¿ã€‚</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><h3 id="è®ºæ–‡å†…å®¹"><a href="#è®ºæ–‡å†…å®¹" class="headerlink" title="è®ºæ–‡å†…å®¹"></a>è®ºæ–‡å†…å®¹</h3><h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>æ–‡ç« ç ”ç©¶äº†åœ¨ä½å»¶è¿Ÿå’Œæœ€å°èµ„æºä½¿ç”¨æƒ…å†µä¸‹ï¼Œä»¥åˆ†æå¤§é‡æ•°æ®ä¸ºç›®æ ‡çš„æµå¤„ç†ç¯å¢ƒçš„è¢«åŠ¨å¼¹æ€§é—®é¢˜ã€‚æ–‡ç« æå‡ºäº†ä¸€ç§å¼¹æ€§ç®¡ç†ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥å¤ªè—•èŠ‚åº”ç”¨ç¨‹åºç»„ä»¶çš„å¹¶è¡Œåº¦ï¼ŒåŒæ—¶æ˜ç¡®è§£å†³æ‰§è¡Œå®¹å™¨çš„å±‚æ¬¡ç»“æ„(è™šæ‹Ÿæœºã€è¿›ç¨‹ã€çº¿ç¨‹)ã€‚å±•ç¤ºäº†é”™è¯¯æä¾›æ‰§è¡Œå®¹å™¨æ‰€å¯¼è‡´çš„æ€§èƒ½è¡°å‡ï¼Œå¹¶æå‡ºäº†ä¸€ç§æ–¹æ³•æ¥ä½¿ç”¨æœ€å°‘çš„èµ„æºå¢åŠ æ€§èƒ½ã€‚æ–‡ç« æè¿°äº†ç›‘æ§æŒ‡æ ‡å¹¶å±•ç¤ºäº†å¦‚ä½•è€ƒè™‘æ‰§è¡Œç¯å¢ƒçš„ç»†èŠ‚ã€‚é€šè¿‡ä½¿ç”¨çœŸå®åº”ç”¨ç¨‹åºè¿›è¡Œå®éªŒéªŒè¯äº†æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚</p><h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>åœ¨ä¸åŒçš„è®¡ç®—ç³»ç»Ÿé¢†åŸŸï¼Œå¤§æ•°æ®éƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚éšç€äº’è¿è®¾å¤‡çš„æ™®åŠï¼Œå®ƒå‡ºç°åœ¨ç‰©è”ç½‘ä¸­ï¼Œéšç€é«˜æ€§èƒ½è®¡ç®—ç³»ç»Ÿè§„æ¨¡çš„å¢é•¿è€Œå¢é•¿ï¼Œå¹¶ä¼´éšç€äº’è”ç½‘å’Œç¤¾äº¤ç½‘ç»œæ´»åŠ¨çš„æ‰©å±•ã€‚ä¹Ÿæ˜¯æ•°æ®åªèƒ½çš„ä¸»è¦ä¸»é¢˜ã€‚</p><p>å¤„ç†å¤§æ•°æ®æœ‰ä¸¤ç§ä¸»è¦æŠ€æœ¯ï¼šæ‰¹å¤„ç†å’Œæµå¤„ç†ã€‚æ‰¹å¤„ç†æ˜¯å…ˆå°†æ•°æ®å­˜å‚¨åœ¨å·¨å¤§çš„æ•°æ®åº“ä¸­ï¼Œç„¶åå†è¿›è¡Œå¤„ç†ï¼Œé€šå¸¸ä½¿ç”¨å¯æ‰©å±•çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä¾‹å¦‚Googleçš„MapReduceã€‚ ä½†æ˜¯ï¼Œéšç€æ•°æ®è§„æ¨¡çš„ä¸æ–­å¢é•¿ï¼Œæ•°æ®ä¼ è¾“å’Œå­˜å‚¨çš„æˆæœ¬å˜å¾—ä»¤äººæœ›è€Œå´æ­¥ã€‚</p><p>ä½œè€…å…³æ³¨äºæ‰§è¡Œç¯å¢ƒï¼Œå¹¶ç ”ç©¶å¦‚ä½•æ›´æ”¹ä¸åŒæ‰§è¡Œå®¹å™¨çš„æ•°é‡æ¥å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚</p><h4 id="Motivation-for-Multi-level-Elasticity"><a href="#Motivation-for-Multi-level-Elasticity" class="headerlink" title="Motivation for Multi-level Elasticity"></a>Motivation for Multi-level Elasticity</h4><h5 id="System-Model"><a href="#System-Model" class="headerlink" title="System Model"></a>System Model</h5><p>ä¸»è¦ä»‹ç»äº†æµå¤„ç†æ¨¡å‹ï¼Œå¹¶å¼•å‡ºå¤šçº§å¹¶è¡Œå®ä¾‹åŠå¼¹æ€§ç­‰ã€‚</p><h5 id="Preformance-mertrics"><a href="#Preformance-mertrics" class="headerlink" title="Preformance mertrics"></a>Preformance mertrics</h5><p>åœ¨æµå¤„ç†ç¯å¢ƒä¸‹ï¼Œä¸»è¦çš„æ€§èƒ½è¯„ä»·æ˜¯åº”ç”¨ç¨‹åºå¤„ç†è¾“å…¥è´Ÿè½½å¹¶åŠæ—¶äº§ç”Ÿç»“æœçš„èƒ½åŠ›ã€‚æ–‡ç« ä¸»è¦è€ƒè™‘å•ä¸ªç®—å­å®ä¾‹çš„å¤„ç†æ´»åŠ¨ã€‚æå‡ºä»¥ä¸‹æŒ‡æ ‡ï¼š</p><ul><li>å…ƒç»„æ¥æ”¶æ•°é‡ï¼šä½¿ç”¨$received_T(c)$è¡¨ç¤ºï¼Œé‡åŒ–å®ä¾‹$c$åœ¨æ—¶é—´$T$å†…æ‰€æ¥æ”¶åˆ°çš„å…ƒç»„æ•°é‡ã€‚</li><li>å…ƒç»„å¤„ç†æ•°é‡ï¼š$processed_T(c)$ï¼Œé‡åŒ–å®ä¾‹$c$åœ¨æ—¶é—´$T$å†…æ‰€å¤„ç†çš„å…ƒç»„æ•°é‡ã€‚</li><li>å¤„ç†æ´»æ€§ï¼šå®šä¹‰$health$æŒ‡æ ‡ï¼Œç”¨æ¥è¡¨ç¤ºå®ä¾‹åœ¨æ—¶é—´$T$å†…æ‰€å¤„ç†çš„å…ƒç»„ä¸æ”¶åˆ°çš„å…ƒç»„çš„æ¯”ä¾‹$health_T(c)&#x3D;\frac{processed_T(c)}{received_T(c)}$ã€‚å¦‚æœä¸€ä¸ªå®ä¾‹çš„$ä¸º$$health_T(c)&#x3D;100%$ï¼Œåˆ™è¡¨ç¤ºå®ä¾‹èƒ½å¤ŸåŠæ—¶å¤„ç†æ‰€æœ‰è¾“å…¥ï¼Œç›¸åï¼Œå¦‚æœ$health_T(c)&lt;100%$ï¼Œåˆ™è¯´æ˜æœ‰äº›å…ƒç»„éœ€è¦ç­‰å¾…ã€‚å¦‚æœè¿™ç§æƒ…å†µæŒç»­ï¼Œåˆ™è¿™ä¸ªå®ä¾‹åˆ™ä¼šå˜æˆåº”ç”¨çš„ç“¶é¢ˆã€‚</li></ul><p>åº”ç”¨ç¨‹åºèƒ½å¦æ»¡è¶³å…·ä½“çš„æ—¶é—´çº¦æŸï¼Œä¾èµ–äºå¤šç§å› ç´ ï¼ŒåŒ…æ‹¬æ‰§è¡ŒèŠ‚ç‚¹çš„å¯ç”¨èµ„æºã€ç½‘ç»œé“¾æ¥å±æ€§ã€è¾“å…¥è´Ÿè½½çš„æ³¢åŠ¨ã€åº”ç”¨ç¨‹åºçš„è®¡ç®—ã€‚æ–‡ç« ä¸­çš„åº”ç”¨ç¨‹åºä¸»è¦è€ƒè™‘å¤„ç†å¤§é‡å°ä¿¡æ¯çš„æµå¤„ç†ç¨‹åº(æ¯”å¦‚ï¼Œæ¨ç‰¹æ¶ˆæ¯ï¼Œä¼ æ„Ÿå™¨æ—¥å¿—)ã€‚è¿™ç§åº”ç”¨ç¨‹åºçš„æ€§èƒ½å—é™äºè®¡ç®—èµ„æºçš„å¯ç”¨æ€§ï¼Œè€Œä¸æ˜¯ç½‘ç»œã€‚ç”±äºä¸ºåº”ç”¨ç¨‹åºé…ç½®çš„èµ„æºæ˜¯åˆ†é…ç»™åº”ç”¨ç¨‹åºçš„æ‰§è¡Œå®¹å™¨çš„èµ„æºï¼Œå› æ­¤åœ¨æ‰§è¡ŒèŠ‚ç‚¹çº§åˆ«ï¼Œå®ƒä»¬å—èŠ‚ç‚¹çš„å†…å­˜å’ŒCPUå®¹é‡çš„é™åˆ¶ã€‚å› æ­¤ç›‘æ§å¦‚ä¸‹èµ„æºï¼š</p><ul><li>$CPU occupation$. ä½¿ç”¨$totalCPU_T(n)$è¡¨ç¤ºåœ¨ç»™å®šæ‰§è¡ŒèŠ‚ç‚¹$n$ä¸Šåœ¨æ—¶é—´$T$å†…çš„å¹³å‡$CPU$ä½¿ç”¨ç‡ã€‚</li><li>$Memory occupation$. ä½¿ç”¨$totalMem_T(n)$è¡¨ç¤ºåœ¨ç»™å®šæ‰§è¡ŒèŠ‚ç‚¹$n$ä¸Šåœ¨æ—¶é—´$T$å†…çš„å¹³å‡å†…å­˜ä½¿ç”¨ã€‚</li></ul><p>ä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‡æ ‡å¯ä»¥è·Ÿè¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼Œå¦‚æœè¿™ä¸¤ä¸ªæŒ‡æ ‡éƒ½æ²¡æœ‰é¥±å’Œï¼Œåˆ™è¯´æ˜å¯ä»¥åˆ†é…æ–°çš„æ‰§è¡Œå®¹å™¨ï¼Œå¦åˆ™ï¼Œéœ€è¦è€ƒè™‘æ‰©å±•å†³å®šã€‚</p><h5 id="Preformances-of-Storm"><a href="#Preformances-of-Storm" class="headerlink" title="Preformances of Storm"></a>Preformances of Storm</h5><ul><li><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201111230437.png"></p><p>è¿™å¼ å›¾åœ¨æ›´æ”¹ä»»åŠ¡å¹¶è¡Œåº¦ï¼Œ1-4-4è¡¨ç¤º1ä¸ªworker(è¿›ç¨‹)ï¼Œ4ä¸ªexecutors(çº¿ç¨‹)ï¼Œ4ä¸ªtaskï¼Œè¯´æ˜æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªTaskï¼Œ1-4-16è¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ4ä¸ªä»»åŠ¡ï¼Œ1-4-64è¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ16ä¸ªä»»åŠ¡ã€‚ä¸‰æ¡çº¿æœ‰ç€ç±»ä¼¼çš„è¡¨ç°ï¼Œè¿™è¯´æ˜åªå¢åŠ Taskå¹¶è¡Œåº¦å¯¹ä»»åŠ¡çš„æ€§èƒ½æ²¡æœ‰å½±å“ã€‚åœ¨Stormæ‹“æ‰‘çš„å®é™…ä½¿ç”¨ä¸­ï¼Œä»»åŠ¡çš„æ•°é‡å®é™…ä¸Šå®šä¹‰äº†è¿™ä¸ªä»»åŠ¡æ‰€ç”¨çš„æœ€å¤§çš„æ‰§è¡Œå™¨(çº¿ç¨‹)çš„æ•°é‡ã€‚</p></li><li><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201111232803371.png" alt="image-20201111232803371"></p><p>çº¿ç¨‹çº§åˆ«çš„å¹¶è¡Œåº¦å˜åŒ–èƒ½å¤Ÿæ”¹å˜æ€§èƒ½ï¼Œåªè¦çº¿ç¨‹æ²¡æœ‰è¾¾åˆ°CPUæ ¸æ•°é™åˆ¶ã€‚ï¼ˆå®éªŒç¯å¢ƒæ˜¯å››æ ¸çš„æœºå™¨ï¼‰å¯ä»¥ä»bä¸­çœ‹åˆ°ï¼Œæå‡äº†çº¿ç¨‹æ•°é‡åä»»åŠ¡çš„å‡ºæ€§èƒ½æœ‰æå‡ï¼Œè€Œå½“çº¿ç¨‹æ•°é‡ä¸º8æ—¶ï¼Œå’Œ4çš„è¡¨ç°åŸºæœ¬ä¸€è‡´ã€‚å½“CPUé¥±å’Œæ—¶ï¼Œhealthä¸‹é™ï¼Œå½“å†…å­˜é¥±å’Œæ—¶èŠ‚ç‚¹å®•æœºã€‚</p></li><li><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201111231828781.png" alt="image-20201111231828781"></p><p>è¿‡é‡æä¾›è¿›ç¨‹èµ„æºåè€Œå¯¼è‡´äº†æ€§èƒ½ä¸‹é™ï¼Œè€Œä¸”æ›´å¤šçš„è¿›ç¨‹å¯¼è‡´äº†æ€§èƒ½ä¸ç¨³å®šï¼Œè¿™æ˜¯å› ä¸ºå¤šä¸ªè¿›ç¨‹å ç”¨æ›´å¤šçš„å†…å­˜ï¼Œå¯¼è‡´äº†åˆ°è¾¾äº†èŠ‚ç‚¹çš„æé™ã€‚</p></li></ul><h4 id="A-Strategty-for-multi-level-elasticity"><a href="#A-Strategty-for-multi-level-elasticity" class="headerlink" title="A Strategty for multi-level elasticity"></a>A Strategty for multi-level elasticity</h4><p>æ–‡ç« æå‡ºäº†ä½¿ç”¨ç¯å¢ƒæ˜¯éå¤šç§Ÿæˆ·ç¯å¢ƒï¼Œå¹¶ä¸”èŠ‚ç‚¹æ˜¯åº”ç”¨ä¸“ç”¨(è¿™ä¸ªåº”è¯¥å°±æ˜¯ä¸ºäº†é¿å…CPUç­‰ä¿¡æ¯å—å¹²æ‰°çš„é—®é¢˜)ã€‚ç®—å­å®ä¾‹ä¹‹é—´å¹³å‡åˆ†é…æ•°æ®æµ(ä¸è€ƒè™‘æ•°æ®å€¾æ–œ)ã€‚</p><p>ä½œè€…æå‡ºçš„æ–¹æ³•ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œï¼ˆ1ï¼‰è¯„ä¼°ä¸åŒå±‚æ¬¡çš„æ‰§è¡Œå®¹å™¨çš„æ€§èƒ½ï¼ˆ2ï¼‰ä¸ºç»™å®šçš„è´Ÿè½½æä¾›é€‚å½“çš„é…ç½®ï¼ˆ3ï¼‰æ„é€ å…·ä½“åº”ç”¨çš„å¼¹æ€§æ§åˆ¶å™¨ã€‚</p><p>ç¬¬ä¸€æ­¥è§£å†³äº†ç³»ç»Ÿæ¨¡å‹ä¸­çš„æ‰§è¡Œå®¹å™¨çš„å±‚æ¬¡ç»“æ„ï¼Œä¸ºäº†å†³å®šæä¾›ä»€ä¹ˆæ ·çš„æ‰§è¡Œå®¹å™¨ï¼Œéœ€è¦çŸ¥é“ä¸åŒçº§åˆ«çš„æ‰§è¡Œå®¹å™¨çš„å¹¶è¡Œåº¦å¦‚ä½•å½±å“æ€§èƒ½ï¼Œä½œè€…è·å¾—è¿™ä¸ªä¿¡æ¯çš„æ–¹å¼æ˜¯é€šè¿‡å¹³å°æä¾›ï¼Œæˆ–è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚</p><p>åœ¨ç¬¬äºŒæ­¥ä¸­ï¼Œä½œè€…è‡ªåŠ¨æµ‹è¯•åº”ç”¨ç¨‹åºï¼Œä»¥å»ºç«‹ç»™å®šçº§åˆ«çš„è¾“å…¥è´Ÿè½½å’Œåˆé€‚åº”ç”¨ç¨‹åºé…ç½®ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ä¸ºäº†å˜åŒ–è¾“å…¥è´Ÿè½½ç„¶åå‘ç°æŒ‡å®šç®—å­æ‰€éœ€çš„å¹¶è¡Œåº¦çº§åˆ«(ç›¸å…³çš„æ‰§è¡Œå®¹å™¨)ã€‚</p><p>æµ‹è¯•ç¨‹åºå¦‚ç®—æ³•1æ‰€ç¤ºï¼Œä½¿ç”¨çº¿æ€§è´Ÿè½½ä¸ºåº”ç”¨ç¨‹åºæä¾›è¾“å…¥ã€‚ä½œè€…åœ¨è€ƒè™‘æ˜¯å¦è¿›è¡Œæ‰©å±•æ—¶ï¼Œæ˜¯æŒ‰ç…§ç®—å­å®ä¾‹é€ä¸ªè€ƒè™‘ï¼Œé€šè¿‡æ¯”è¾ƒå®ä¾‹çš„$Health$å€¼æ˜¯å¦ä½äº$minHealth$æ¥åˆ¤æ–­å®ä¾‹æ˜¯å¦éœ€è¦æ‰©å±•ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201112110527246.png" alt="image-20201112110527246"></p><p>æ‰©å±•ç®—æ³•å¦‚ç®—æ³•2æ‰€ç¤ºã€‚é¦–å…ˆæ‰¾åˆ°å…·æœ‰æœ€å°èµ„æºè´Ÿè½½çš„èŠ‚ç‚¹(ä¹Ÿå°±æ˜¯å½“å‰ç©ºé—²èµ„æºæœ€å¤šçš„èŠ‚ç‚¹)ã€‚å½“å…·æœ‰æœ€å¤šèµ„æºçš„èŠ‚ç‚¹çš„CPUä¸å†…å­˜çš„å ç”¨è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™ä¼šæ‰©å±•èµ·ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚å¦‚æœèŠ‚ç‚¹è¿˜æœ‰èµ„æºï¼Œåˆ™ä¼šæ ¹æ®æœ€ä¼˜å®¹å™¨é…ç½®éƒ¨ç½²ä¸€ä¸ªæ–°çš„å®ä¾‹æ¥æå¢åŠ æ€§èƒ½ï¼Œè¿™ä¸ªæœ€ä¼˜ä¿¡æ¯æ˜¯é€šè¿‡ç¬¬ä¸€æ­¥ä¸­è·å¾—çš„ã€‚ç®—æ³•ä¹Ÿä¼šæ›´æ–°æ–°çš„é…ç½®ä¿¡æ¯ã€‚åœ¨è¿›è¡Œå‘ä¸‹æ‰©å±•æ—¶ï¼Œä¼šå°½å¿«é‡Šæ”¾æ–°åˆ†é…çš„èŠ‚ç‚¹ï¼Œä¸»è¦ç›®çš„æ˜¯ä½¿ç”¨æ›´å°‘çš„èŠ‚ç‚¹ã€‚ä¸ºäº†é˜²æ­¢éœ‡è¡å‘ç”Ÿï¼Œä¸æ˜¯æ¯æ¬¡è§‚å¯Ÿæ—¶éƒ½ä¼šè¿›è¡Œç¼©æ”¾ï¼Œè€Œæ˜¯å¯¹å¤šä¸ªè§‚å¯Ÿå€¼è¿›è¡Œçº¿æ€§å›å½’æ¥è®¡ç®—å˜åŒ–è¶‹åŠ¿ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201112111630936.png" alt="image-20201112111630936"></p><h4 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h4><h4 id="Experimental-Evaluation"><a href="#Experimental-Evaluation" class="headerlink" title="Experimental Evaluation"></a>Experimental Evaluation</h4><h4 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h4><h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><h2 id="2-Joker-Elastic-stream-processing-with-organic-adaptation-Journal-of-Parallel-and-Distributed-Computingï¼ˆJPDCï¼‰-2020-x2F-03-x2F-01-B"><a href="#2-Joker-Elastic-stream-processing-with-organic-adaptation-Journal-of-Parallel-and-Distributed-Computingï¼ˆJPDCï¼‰-2020-x2F-03-x2F-01-B" class="headerlink" title="[2] Joker: Elastic stream processing with organic adaptation. Journal of Parallel and Distributed Computingï¼ˆJPDCï¼‰,2020&#x2F;03&#x2F;01.B"></a>[2] Joker: Elastic stream processing with organic adaptation. Journal of Parallel and Distributed Computingï¼ˆJPDCï¼‰,2020&#x2F;03&#x2F;01.B</h2><h3 id="ä½œè€…ä¿¡æ¯"><a href="#ä½œè€…ä¿¡æ¯" class="headerlink" title="ä½œè€…ä¿¡æ¯"></a>ä½œè€…ä¿¡æ¯</h3><p>æ¯•å°”è‚¯å¤§å­¦ï¼Œæ˜¯åœŸè€³å…¶æœ€å¥½çš„å¤§å­¦ä¹‹ä¸€ï¼Œä¸–ç•Œæ’å501-600th</p><h3 id="ç ”ç©¶å†…å®¹-1"><a href="#ç ”ç©¶å†…å®¹-1" class="headerlink" title="ç ”ç©¶å†…å®¹"></a>ç ”ç©¶å†…å®¹</h3><p>é€šè¿‡å¼¹æ€§æ–¹æ³•æ¥è§£å†³æµå¤„ç†åº”ç”¨ä¸­æ•°æ®æµå›¾å­å›¾å¹¶è¡Œåº¦åŠç®—å­å¹¶è¡Œåº¦çš„å¼¹æ€§é—®é¢˜ã€‚</p><h3 id="æŠ€æœ¯è·¯çº¿-1"><a href="#æŠ€æœ¯è·¯çº¿-1" class="headerlink" title="æŠ€æœ¯è·¯çº¿"></a>æŠ€æœ¯è·¯çº¿</h3><h3 id="ç»“è®º-1"><a href="#ç»“è®º-1" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><h3 id="è®ºæ–‡å†…å®¹-1"><a href="#è®ºæ–‡å†…å®¹-1" class="headerlink" title="è®ºæ–‡å†…å®¹"></a>è®ºæ–‡å†…å®¹</h3><h4 id="æ‘˜è¦-1"><a href="#æ‘˜è¦-1" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>ä½œè€…æå‡ºä¸€ç§åœ¨çº¿å¹¶è¡Œåº¦ä¼˜åŒ–ç®—æ³•ï¼Œä»¥è”åˆæ–¹å¼è°ƒæ•´æµæ°´çº¿å’Œæ•°æ®å¹¶è¡Œåº¦ã€‚ä½œè€…æå‡ºçš„å¹¶è¡Œæ‰§è¡Œæ¨¡å‹å°†æ•°æ®æµå›¾åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸã€‚ä¸€ä¸ªåŒºåŸŸåŒ…å«ä¸€ç³»åˆ—å¯ä»¥å…¼å®¹çš„ç®—å­ï¼Œè¿™äº›ç®—å­é‡‡ç”¨ç›¸åŒçš„æ•°æ®å¹¶è¡Œåº¦ï¼Œå¹¶ä¸”ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæµæ°´çº¿å¹¶è¡ŒåŒ–ã€‚ä½œè€…æå‡ºçš„è¿è¡Œæ—¶Jokerå¯ä»¥æŒç»­ç›‘æ§è¿è¡Œæ—¶æ€§èƒ½ï¼Œå¹¶è¿è¡Œä¼˜åŒ–ç®—æ³•æ¥è§£å†³ç“¶é¢ˆï¼Œå¹¶é€šè¿‡è°ƒæ•´æ•°æ®å¹¶è¡Œåº¦å’Œæµæ°´çº¿å¹¶è¡Œåº¦æ¥æ‰©å±•åº”ç”¨ç¨‹åºã€‚</p><h4 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h4><p>éšç€ä¸–ç•Œä¸‡ç‰©äº’è”çš„å˜åŒ–ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„äººå…³æ³¨å¯ä»¥æ¥è¿‘å®æ—¶è®¡ç®—è¿ç»­æ•°æ®çš„ç³»ç»Ÿã€‚ç”µä¿¡ï¼Œé‡‘èï¼Œåˆ¶é€ ç³»ç»Ÿï¼Œç½‘ç»œç›‘æ§ç³»ç»Ÿï¼ŒåŒ»ç–—å¥åº·ç³»ç»Ÿéƒ½æ˜¯ä½¿ç”¨è¿™ç§è¿ç»­æµæ•°æ®çš„ä¸€ä¸ªé¢†åŸŸï¼Œè¿™äº›é¢†åŸŸéƒ½è¦æ±‚å¿«é€Ÿåˆ†æé«˜é€Ÿç‡çš„æ•°æ®æµï¼Œå¹¶æå–å…¶ä¸­çš„æœ‰ç”¨ä¿¡æ¯ã€‚</p><p>æµå¤„ç†æ˜¯ä¸€ç§å¤„ç†å¤§è§„æ¨¡è¿ç»­æµæ•°æ®çš„è®¡ç®—èŒƒå¼ã€‚é«˜ååé‡çš„å¤„ç†è¦æ±‚æµå¤„ç†ç¨‹åºå¿…é¡»åˆ©ç”¨å¤šä¸ªå¤„ç†å™¨æˆ–å¤šä¸ªæœºå™¨ã€‚æµå¤„ç†åº”ç”¨é€šå¸¸ä½¿ç”¨æ•°æ®æµå›¾è¡¨ç¤ºï¼Œå…¶ä¸­ç®—å­æ˜¯æ•°æ®çš„å¤„ç†è€…ï¼Œé€šè¿‡FIFOè¯­ä¹‰çš„æµå°†ç®—å­é“¾æ¥èµ·æ¥ã€‚ä½†åˆ©ç”¨å¹¶è¡Œåº¦å¯¹æ•°æ®æµè¿›è¡Œæ‰©å±•è¿˜æœ‰ä¸€äº›é—®é¢˜ã€‚</p><p>ç¼ºå°‘ç›´æ¥çš„æ–¹å¼æ‰¾åˆ°æµå¤„ç†åº”ç”¨åˆé€‚çš„å¹¶è¡Œæ•°é‡ï¼Œå¹¶ä¸”æµå¤„ç†ä»»åŠ¡æ˜¯åœ¨è´Ÿè½½å˜åŠ¨çš„æƒ…å†µä¸‹é•¿æ—¶é—´è¿è¡Œã€‚æœ‰æ•ˆçš„æ–¹å¼æ˜¯è¿ç»­åº”ç”¨å¹¶è¡Œä¼˜åŒ–ï¼Œå¹¶è°ƒæ•´é€»è¾‘åº”ç”¨ä¸è®¡ç®—èµ„æºçš„æ˜ å°„ï¼Œæ¥å®ç°å¼¹æ€§ã€‚</p><p>ä½œè€…æ‰©å±•äº†æµæ°´çº¿åˆ†è£‚æ¨¡å‹ï¼Œå°†æ•°æ®æµå›¾åˆ’åˆ†ä¸ºåŒºåŸŸã€‚ä¸€ä¸ªåŒºåŸŸåŒ…å«æœ€é•¿çš„å…¼å®¹åºåˆ—ï¼Œè¿™äº›ç®—å­æ€»ä½“ä¸Šé€‚åˆæ•°æ®å¹¶è¡Œï¼Œå¹¶ä¸”å¯ä»¥è¿›ä¸€æ­¥å®ç°å­æµæ°´çº¿å¹¶è¡Œã€‚å…¶æ¬¡ï¼Œå¹¶è¡Œä¼˜åŒ–ç®—æ³•æ£€æµ‹æµåº”ç”¨ä¸­çš„ç“¶é¢ˆï¼Œå¹¶é€šè¿‡è”åˆè°ƒæ•´æµæ°´çº¿å¹¶è¡Œåº¦å’Œæ•°æ®å¹¶è¡Œåº¦æ¥è§£å†³ç“¶é¢ˆã€‚</p><h4 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h4><h4 id="Solution-overview"><a href="#Solution-overview" class="headerlink" title="Solution overview"></a>Solution overview</h4><p>ä»æºç®—å­å¼€å§‹è€ƒè™‘å½¢æˆåŒºåŸŸï¼Œåªè¦ç®—å­ä¸å½“å‰åŒºåŸŸå…¼å®¹ï¼Œå°±åŠ å…¥åŒºåŸŸï¼Œå½“é‡åˆ°ä¸å…¼å®¹çš„ç®—å­åˆ™ç»ˆæ­¢å½“å‰åŒºåŸŸçš„æ„å»ºï¼Œè€Œå»ºç«‹ä¸€ä¸ªæ–°çš„åŒºåŸŸã€‚ä½œè€…è‡ªå·±å®šä¹‰äº†ä¸€ä¸ªå…¼å®¹æ€§è§„åˆ™ï¼Œä¸»è¦æ€æƒ³æ˜¯æµåº”ç”¨ç¨‹åºåº”è¯¥å‡å°‘æ•°æ®äº¤æ¢ã€‚ä½œè€…çš„æ–¹æ³•æ˜¯åœ¨æ—©æœŸå½¢æˆè¾ƒé•¿çš„åŒºåŸŸï¼Œå¹¶åˆ†é…æ›´å¤šçš„å¤„ç†èµ„æºï¼Œä»¥ä¾¿æœ‰æ›´å¤šçš„æ‰©å±•æœºä¼šã€‚ä½œè€…åŒºåŸŸæ„é€ çš„è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>æºç®—å­æœ‰ç‹¬ç«‹åŒºåŸŸï¼Œç§°ä¹‹ä¸ºæºåŒºåŸŸ$source\ regions$ã€‚æºåŒºåŸŸä¸åœ¨ä¼˜åŒ–èŒƒå›´å†…</li><li>åŒºåŸŸä¸­çš„ç®—å­æœ‰è‡³å¤šä¸€ä¸ªä¸Šæ¸¸æˆ–è‡³å¤šä¸€ä¸ªä¸‹æ¸¸ï¼Œå¦‚æœéœ€è¦æ„é€ åˆ†æ”¯ï¼Œåˆ™ä¼šä¸­æ–­å½“å‰çš„åŒºåŸŸå¹¶å¼€å§‹ä¸€ä¸ªæ–°çš„åŒºåŸŸã€‚è¿™è¡¨ç¤ºæ¯ä¸ªåŒºåŸŸåªä¼šæœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£ã€‚å¦‚æœä¸€ä¸ªç®—å­æœ‰å¤šä¸ªä¸‹æ¸¸ï¼Œé‚£ä¸‹æ¸¸ç®—å­ä¼šå¼€å§‹è‡ªå·±çš„åŒºåŸŸã€‚</li><li>æ•°æ®å¹¶è¡ŒåŒºåŸŸå¼€å§‹äºæ— çŠ¶æ€æˆ–å·²åˆ†åŒºçš„çŠ¶æ€ç®—å­ï¼Œå¹¶ä¸”åªä¼šåŒ…å«è¿™ä¸¤ç§ç®—å­ã€‚</li><li>æ•°æ®å¹¶è¡ŒåŒºåŸŸçš„ç¬¬ä¸€ä¸ªåˆ†åŒºçŠ¶æ€ç®—å­çš„$Key$ä¸ºè¯¥åŒºåŸŸçš„$Key$å±æ€§ï¼ŒéšååŠ å…¥çš„åˆ†åŒºçŠ¶æ€ç®—å­å¿…é¡»ä¸å½“å‰åŒºåŸŸå…¼å®¹ã€‚(å…¶å®æ˜¯åœ¨ç‰©ç†æ‰§è¡Œå›¾ä¸Šè¿›è¡ŒåŒºåŸŸåˆ’åˆ†)</li></ul><p>ä¸‹å›¾åŒ…å«ä¸¤ä¸ªåŒºåŸŸï¼Œå…¶ä¸­é»‘ç‚¹ä¸ºåŒºåŸŸåˆ†éš”ç¬¦ï¼Œç¬¬ä¸€ä¸ªåŒºåŸŸæ˜¯æºç®—å­åŒºåŸŸï¼Œç¬¬äºŒä¸ªæ˜¯åŒ…å«ä¸‰ä¸ªç®—å­çš„åŒºåŸŸï¼Œç¬¬äºŒä¸ªåŒºåŸŸä¸­æœ‰ä¸¤ä¸ªæµæ°´çº¿ï¼Œç¬¬ä¸€ä¸ªæµæ°´çº¿åŒ…å«$O_2$å’Œ$O_3$ï¼Œç¬¬äºŒä¸ªæµæ°´çº¿åªåŒ…å«$O_4$ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201112220629106.png" alt="image-20201112220629106"></p><h5 id="Organic-adaptation"><a href="#Organic-adaptation" class="headerlink" title="Organic adaptation"></a>Organic adaptation</h5><p>åœ¨å¼€å§‹è¿è¡Œæ—¶ï¼Œä¸ºæ¯ä¸ªåŒºåŸŸåˆ›å»ºä¸€ä¸ªæµæ°´çº¿å’Œä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åè¿è¡Œä¸€ä¸ªä¸‰é˜¶æ®µçš„æ­¥éª¤æ¥æ”¹å˜åº”ç”¨ç¨‹åºå¹¶è¡Œåº¦ã€‚</p><ul><li><p>åˆ†æé˜¶æ®µï¼šæ¢æŸ¥å™¨æ”¶é›†é€‚åº”é˜¶æ®µè¦ä½¿ç”¨çš„æŒ‡æ ‡ã€‚æ”¶é›†ä¸‰ä¸ªç±»å‹çš„æŒ‡æ ‡ã€‚</p><ul><li>æ”¶é›†æµæ°´çº¿å‰¯æœ¬çº¿ç¨‹çš„CPUä½¿ç”¨ç‡ï¼Œä½¿ç”¨å‰¯æœ¬çº¿ç¨‹åˆ©ç”¨CPUçš„æ—¶é—´å¤„ç†CPUæ—¶é’Ÿæ•°æ¥è®¡ç®—CPUåˆ©ç”¨ç‡ï¼Œçº¿ç¨‹çš„CPUæ—¶é—´æ˜¯é€šè¿‡JMXæ¥å£è·å–çš„ã€‚</li><li>å®šä¹‰ç®—å­æˆæœ¬$operator\ cost$ï¼Œä½œä¸ºæµæ°´çº¿å®ä¾‹çº¿ç¨‹åœ¨ç®—å­ä¸ŠèŠ±è´¹çš„CPUæ—¶é—´çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæµæ°´çº¿åŒ…å«ä¸¤ä¸ªç®—å­$O_1$å’Œ$O_2$ï¼Œä»–ä»¬çš„æˆæœ¬ä¼°è®¡æ˜¯0.4å’Œ0.5ï¼Œè¿™è¡¨ç¤ºç®—å­$O_1$æ¶ˆè€—äº†$40%$çš„æµæ°´çº¿æ˜¯æ¥CPUæ—¶é—´ã€‚ç®—å­æˆæœ¬ä¹‹å’Œå¹¶ä¸ç­‰äº1ï¼Œè¿™æ˜¯å› ä¸ºæµæ°´çº¿åŒ…å«äº†å…¶ä»–çš„CPUå¼€é”€ã€‚å°†è¿™ä¸€éƒ¨åˆ†å¼€é”€ç§°ä¹‹ä¸ºæµæ°´çº¿å¼€é”€$pipeline\ overhead$ï¼Œä½¿ç”¨$1-\sum_{i&#x3D;1}^{n}{cost_i}$ã€‚ç®—å­æˆæœ¬çš„è®¡ç®—ä¼šéå†æµæ°´çº¿ä¸­çš„æ‰€æœ‰ç®—å­ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œé‡‡æ ·çº¿ç¨‹ä¼šä¸æ–­æ£€æŸ¥ç®—å­çš„æŒ‡æ ‡å€¼ï¼Œå¦‚æœåœ¨æœ€åä¸€ç§’å†…ï¼Œé‡‡æ ·çº¿ç¨‹è®¿é—®äº†Næ¬¡æ•°æ®ï¼Œè€Œå…¶ä¸­æœ‰Cæ¬¡å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™è¯´æ˜æ­¤ç®—å­çš„å¼€é”€ä¸º$C&#x2F;N$ã€‚</li><li>ååé‡ä»¥ä¸€ä¸ªæ—¶é—´æ®µå†…å¤„ç†çš„å…ƒç»„æ•°é‡æ¥è¡¡é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒºåŸŸååé‡ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ã€‚ä½œè€…å°è¯•é€šè¿‡è°ƒæ•´æ•°æ®æµå›¾ä¸­æ¯ä¸ªåŒºåŸŸçš„æµæ°´çº¿ç¨‹åº¦å’Œæ•°æ®å¹¶è¡Œåº¦æ¥ä¼˜åŒ–åŒºåŸŸååé‡ã€‚</li></ul><p>åˆ†æé˜¶æ®µä¼šå¯¹é‡‡é›†çš„æŒ‡æ ‡è¿›è¡Œå¹³å‡ã€‚</p></li><li><p>è‡ªé€‚åº”é˜¶æ®µï¼šç¬¬äºŒé˜¶æ®µå¼€å§‹è¯†åˆ«ç“¶é¢ˆæµæ°´çº¿ï¼Œç„¶åè‡ªé€‚åº”ç®—æ³•å°†å¯èƒ½çš„å¹¶è¡Œåº¦æ›´æ”¹æ¥è§£å†³å­˜åœ¨çš„ç“¶é¢ˆã€‚å¹¶å°½å¯èƒ½æœ€å¤§ç¨‹åº¦çš„æé«˜æ‰§è¡Œæ€§èƒ½ã€‚</p><p>åŒºåŸŸä¸­çš„æµæ°´çº¿å¯èƒ½ä¼šåˆ©ç”¨æµæ°´çº¿å¹¶è¡Œæ•°é‡è¢«è¿›ä¸€æ­¥åˆ†å‰²ï¼Œè‡ªé€‚åº”é˜¶æ®µçš„ç›®æ ‡æ—¶ä¸ºäº†è§£å†³ç“¶é¢ˆï¼Œå¹¶å¢åŠ ååé‡æ¥æ”¹å˜æµæ°´çº¿ç¨‹åº¦å’Œæ•°æ®å¹¶è¡Œæ•°é‡ã€‚å¦‚æœä¸€ä¸ªåŒºåŸŸåŒ…å«äº†ç“¶é¢ˆæµæ°´çº¿ï¼Œåˆ™è®¤ä¸ºè¯¥åŒºåŸŸæ˜¯ç“¶é¢ˆåŒºåŸŸã€‚ç®—æ³•é‡‡ç”¨è´ªå©ªç­–ç•¥ï¼Œé€šè¿‡å¹¶è¡Œåº¦æ›´æ”¹æ¥æ”¹å˜æµåº”ç”¨ç¨‹åºååé‡ã€‚åœ¨æ¯ä¸ªé˜¶æ®µï¼Œä¼šåŒæ—¶æ”¹å˜æ‰€æœ‰éœ€è¦æ”¹å˜çš„ç“¶é¢ˆã€‚</p><p>åœ¨å¯¹ç“¶é¢ˆåŒºåŸŸè¿›è¡Œå¤„ç†æ—¶ï¼Œä¼šå¼€å§‹å¯»æ‰¾åŒºåŸŸå†…çš„ç“¶é¢ˆæµæ°´çº¿ï¼Œä¼šè¿”å›CPUä½¿ç”¨ç‡æ¯”é…ç½®é˜ˆå€¼é«˜çš„æµæ°´çº¿ã€‚ç„¶åä¼šå°è¯•å°†æµæ°´çº¿åˆ†å‰²ä¸ºä¸¤ä¸ªæ›´å°çš„æµæ°´çº¿ï¼Œç„¶åä¼šå¯¹å…¶ä¸­çš„å‰¯æœ¬æ•°é‡è¿›è¡Œæ›´æ”¹ã€‚åœ¨å¯¹æµæ°´çº¿è¿›è¡Œåˆ†å‰²æ—¶ï¼Œä¼šè€ƒè™‘ä½¿ç”¨ç®—å­æˆæœ¬ï¼Œåœ¨åˆ†å‰²æ—¶å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æŒ‡æ ‡ï¼Œç§°ä¹‹ä¸ºåˆ†å‰²æ•ˆç”¨$split\ utility$ï¼Œè¿™ä¸€æŒ‡æ ‡ç”¨æ¥é¢„æµ‹å½“æµæ°´çº¿åœ¨æŒ‡å®šç®—å­åˆ†å‰²æ—¶ï¼Œååé‡çš„å¢åŠ æ¯”ç‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ª3ç®—å­çš„æµæ°´çº¿ï¼Œå…¶ç®—å­æˆæœ¬åˆ†åˆ«ä¸º0.2,0.1,0.4ï¼Œæµæ°´çº¿å¼€é”€ä¸º0.3ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªç®—å­å¤„åˆ†å‰²æµæ°´çº¿ï¼Œé‚£ç¬¬ä¸€ä¸ªæµæ°´çº¿è¿è¡Œç¬¬ä¸€ä¸ªç®—å­ï¼Œç¬¬äºŒä¸ªæµæ°´çº¿è¿è¡Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªç®—å­ï¼Œå› ä¸ºç¬¬äºŒä¸ªæµæ°´çº¿çš„æ€»ç®—å­æˆæœ¬å¤§äºç¬¬ä¸€ä¸ªæµæ°´çº¿ï¼Œæˆ‘ä»¬æ¨æµ‹ç¬¬äºŒæ¡æµæ°´çº¿å°†é™åˆ¶æ–°çš„ååé‡å€¼ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒä¸ªç®—å­å¤„çš„åˆ†å‰²æ•ˆç”¨$split\ utility&#x3D;1&#x2F;(0.3+max(0.2,0.1+0.4))$ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœåœ¨ç¬¬ä¸‰ä¸ªç®—å­å¤„è¿›è¡Œåˆ†å‰²ï¼Œåˆ†å‰²æ•ˆç”¨ä¸º$split\ utility&#x3D;1&#x2F;(0.3+max(0.2+0.1,0.4))$åœ¨ç¬¬ä¸‰ä¸ªç®—å­å¤„åˆ†å‰²ä¼šå¯¼è‡´æ›´é«˜çš„åˆ†å‰²æ•ˆç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ç¬¬ä¸‰ä¸ªç®—å­ä½œä¸ºåˆ†å‰²ç‚¹ã€‚</p></li><li><p>è¯„ä¼°å’Œæ§åˆ¶é˜¶æ®µï¼šåœ¨æœ€åçš„é˜¶æ®µï¼Œæ¥è¯„ä¼°æ–°çš„å¹¶è¡ŒåŒ–é…ç½®ï¼Œå¦‚æœæ–°é…ç½®æé«˜äº†æ€§èƒ½ï¼Œåˆ™ç®—æ³•å°†å¼ºåˆ¶åº”ç”¨æ›´æ”¹ï¼Œå¦åˆ™å°†è¿”å›ç¬¬äºŒé˜¶æ®µæ¥å¯»æ‰¾å…¶ä»–å¯èƒ½çš„æ›´æ”¹ã€‚</p></li></ul><h1 id="æµå¤„ç†ç®—å­æ”¾ç½®ã€åˆ†å‰²è®ºæ–‡é˜…è¯»"><a href="#æµå¤„ç†ç®—å­æ”¾ç½®ã€åˆ†å‰²è®ºæ–‡é˜…è¯»" class="headerlink" title="æµå¤„ç†ç®—å­æ”¾ç½®ã€åˆ†å‰²è®ºæ–‡é˜…è¯»"></a>æµå¤„ç†ç®—å­æ”¾ç½®ã€åˆ†å‰²è®ºæ–‡é˜…è¯»</h1><h2 id="å¯èƒ½éœ€è¦é˜…è¯»çš„ä¸€äº›è®ºæ–‡"><a href="#å¯èƒ½éœ€è¦é˜…è¯»çš„ä¸€äº›è®ºæ–‡" class="headerlink" title="å¯èƒ½éœ€è¦é˜…è¯»çš„ä¸€äº›è®ºæ–‡"></a>å¯èƒ½éœ€è¦é˜…è¯»çš„ä¸€äº›è®ºæ–‡</h2><p>Placement strategies for Internet-scale  data  stream  systems,</p><p>Optimal operator placement for distributed stream processing applications, è¯æ˜äº†æœ€ä¼˜ç®—å­æ”¾ç½®é—®é¢˜æ˜¯NPéš¾é—®é¢˜ã€‚</p><p>â€œOptimal operator replication and placement for distributed stream processing systems,</p><p>å¾ˆä¹…ä¹‹å‰çš„è®ºæ–‡ï¼š</p><p>Amarasinghe, Exploiting coarse-grained task, data, and pipeline parallelism in stream programs</p><h2 id="1-Efficient-Operator-Placement-for-DistributedData-Stream-Processing-Applications-TPDS-2019"><a href="#1-Efficient-Operator-Placement-for-DistributedData-Stream-Processing-Applications-TPDS-2019" class="headerlink" title="[1]Efficient Operator Placement for DistributedData Stream Processing Applications.TPDS.2019"></a>[1]Efficient Operator Placement for DistributedData Stream Processing Applications.TPDS.2019</h2><h3 id="ç ”ç©¶å†…å®¹-2"><a href="#ç ”ç©¶å†…å®¹-2" class="headerlink" title="ç ”ç©¶å†…å®¹"></a>ç ”ç©¶å†…å®¹</h3><p>è®ºæ–‡æå‡ºäº†å‡ ä¸ªå¯å‘å¼ç®—æ³•ï¼Œèƒ½å¤Ÿè§£å†³åœ¨å¼‚æ„åº”ç”¨è¦æ±‚åŠè®¡ç®—èµ„æºæƒ…å†µä¸‹çš„ç®—å­æ”¾ç½®é—®é¢˜ã€‚</p><h3 id="è®ºæ–‡å†…å®¹-2"><a href="#è®ºæ–‡å†…å®¹-2" class="headerlink" title="è®ºæ–‡å†…å®¹"></a>è®ºæ–‡å†…å®¹</h3><h4 id="Introduction-2"><a href="#Introduction-2" class="headerlink" title="Introduction"></a>Introduction</h4><p>è¿‡å»ä¹Ÿæ›¾æœ‰ä¸€äº›å¯å‘å¼çš„æ–¹æ³•ï¼Œä½†æ˜¯å…¶ä¸­éƒ½æ˜¯åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œæ²¡æœ‰è€ƒè™‘ç½‘ç»œå»¶è¿Ÿã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116172209.png" alt="image-20201116172209198"></p><p>è¿˜æœ‰ä¸€äº›ç¼ºå°‘çµæ´»æ€§ï¼Œä¸èƒ½ç®€å•çš„ä¼˜åŒ–æ–°çš„æ”¾ç½®ç›®æ ‡ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116172322.png" alt="image-20201116172322456"></p><p>è®ºæ–‡æå‡ºäº†å‡ ä¸ªå¯å‘å¼ç®—æ³•ï¼Œèƒ½å¤Ÿè§£å†³åœ¨å¼‚æ„åº”ç”¨è¦æ±‚åŠè®¡ç®—èµ„æºæƒ…å†µä¸‹çš„ç®—å­æ”¾ç½®é—®é¢˜ã€‚ä½œè€…æå‡ºçš„å¯å‘å¼æ–¹æ³•éµå¾ªä¸‰ä¸ªè§„åˆ™ï¼šçµæ´»æ€§ï¼Œè®¡ç®—èµ„æºé«˜è´¨é‡çš„æ”¾ç½®ï¼Œæœ€ä¼˜æ¨¡å‹å¼€å‘ã€‚</p><ul><li><p>å¯¹äºçµæ´»æ€§ï¼Œç°æœ‰çš„ä¸€äº›æ–¹æ³•ä¸»è¦éƒ½æ˜¯ä¸ºå…·ä½“çš„QOSæŒ‡æ ‡è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä¸èƒ½å®¹æ˜“çš„å®šåˆ¶æˆ–æ‰©å±•ä½¿ç”¨æ–°çš„æŒ‡æ ‡ã€‚è€Œä½œè€…æƒ³æå‡ºä¸€ç§é€šç”¨çš„æ¡†æ¶èƒ½å¤Ÿå®¹æ˜“è°ƒæ•´ä¸åŒæŒ‡æ ‡çš„æœ€ä¼˜æ–¹æ³•(å“åº”æ—¶é—´ã€å¯ç”¨æ€§ã€ç½‘ç»œä½¿ç”¨ã€ç»„åˆå‚æ•°)ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116182511.png" alt="image-20201116182511348"></p></li><li><p>å¯¹äºæœåŠ¡è´¨é‡ï¼Œå¤§å¤šæ•°ç°æœ‰çš„å¯å‘å¼æ–¹æ³•é€šå¸¸ç¡®å®šå°½åŠ›è€Œä¸ºè§£å†³æ–¹æ¡ˆï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸æä¾›æœ‰å…³å…¶è®¡ç®—è¿‘ä¼¼æœ€ä¼˜è§£çš„èƒ½åŠ›çš„ä¿è¯ï¼Œå®šé‡æˆ–å®šæ€§ä¿¡æ¯ã€‚æ¯”å¦‚å¾ˆå¤šçš„å·¥ä½œéƒ½æ˜¯åŸºäºè´ªå©ªç­–ç•¥ï¼Œé€šè¿‡æœ¬åœ°çš„ä¼˜åŒ–æ¥æ”¹å–„ï¼Œä½†è¿™æ ·å¯èƒ½ä¼šå¿½ç•¥ä¸€äº›å…¨å±€ä¼˜åŒ–é…ç½®ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116182839.png" alt="image-20201116182839537"></p></li><li><p>å…³äºæœ€ä¼˜æ¨¡å‹å¼€å‘ï¼Œä½œè€…åœ¨æ¢ç´¢ä½¿ç”¨æœ‰æ•ˆæœ€ä¼˜æ¨¡å‹çš„å¯èƒ½æ€§ï¼Œä¸ºäº†ç¡®å®šé«˜è´¨é‡çš„æ”¾ç½®æ–¹æ¡ˆã€‚<img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116183126.png" alt="image-20201116183126412"></p></li></ul><h4 id="ç›¸å…³å·¥ä½œ"><a href="#ç›¸å…³å·¥ä½œ" class="headerlink" title="ç›¸å…³å·¥ä½œ"></a>ç›¸å…³å·¥ä½œ</h4><p>ç®—å­æ”¾ç½®é—®é¢˜å·²ç»åœ¨ä¸åŒçš„æ¨¡å‹å‡è®¾å’Œä¼˜åŒ–ç›®æ ‡ä¸‹å‘—å¹¿æ³›è®¨è®ºï¼Œã€2ã€‘ã€17ã€‘å¯¹æ­¤ä½œäº†ç»¼è¿°ã€‚ä¸‹é¢ä¸»è¦ä½¿ç”¨ä¸‰ä¸ªç»´åº¦å¯¹æœ¬é¢†åŸŸçš„ç›¸å…³å·¥ä½œè¿›è¡Œå›é¡¾ã€‚</p><ol><li><p>æ”¾ç½®ç›®æ ‡ï¼šæœ€ä¼˜åŒ–çš„ç›®æ ‡</p><p>ç°å­˜çš„æ–¹æ¡ˆä¸»è¦æ˜¯ä¼˜åŒ–ä¸€ä¸ªå¤šæ ·æ€§çš„ç›®æ ‡ï¼Œæ¯”å¦‚æœ€å°åŒ–åº”ç”¨å“åº”æ—¶é—´ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„æµé‡ï¼Œç½‘ç»œä½¿ç”¨ç‡ï¼Œæˆ–è€…åŒ…å«ä¸åŒqosæŒ‡æ ‡çš„é€šç”¨å¼€é”€å‡½æ•°ã€‚ä½œè€…æå‡ºçš„ä¼˜åŒ–ç›®æ ‡ä¹Ÿæ˜¯å¤šå‚æ•°ç»„åˆçš„å¤šç›®æ ‡ä¼˜åŒ–æ–¹æ³•ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116185522.png" alt="image-20201116185521976"></p></li><li><p>å®šä¹‰åº”ç”¨ç¨‹åºæ”¾ç½®çš„æ–¹æ³•è®º</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116185831.png" alt="image-20201116185831900"></p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201116190020.png" alt="image-20201116190020805"></p></li><li><p>æ”¾ç½®è§£å†³æ–¹æ¡ˆç®¡ç†çš„åˆ†å¸ƒå¼è®¡ç®—åŸºç¡€æ¶æ„çš„ç‰¹å¾</p></li></ol><p>æ–¹æ¡ˆä¹Ÿéœ€è¦è€ƒè™‘åœ¨çº¿é‡æ–°éƒ¨ç½²çš„çŠ¶æ€è¿ç§»çš„ç½‘ç»œå¼€é”€ï¼Œä»¥åŠå†é¢å¤–è€ƒè™‘å‰¯æœ¬æ•°é‡ã€‚</p><h4 id="Systemc-model-and-problem-statement"><a href="#Systemc-model-and-problem-statement" class="headerlink" title="Systemc model and problem statement"></a>Systemc model and problem statement</h4><h5 id="Data-Stream-process-DSPæ•°æ®æµæ¨¡å‹"><a href="#Data-Stream-process-DSPæ•°æ®æµæ¨¡å‹" class="headerlink" title="Data Stream process DSPæ•°æ®æµæ¨¡å‹"></a>Data Stream process DSPæ•°æ®æµæ¨¡å‹</h5><p>DSPåº”ç”¨é€šè¿‡ç”±æ•°æ®æµé“¾æ¥èµ·æ¥çš„ç®—å­ç½‘ç»œç»„æˆã€‚ç®—å­æ˜¯æ‰§è¡Œç‰¹å®šæ“ä½œçš„ç‹¬ç«‹çš„å¤„ç†å•å…ƒ(filtering aggregation mergingç­‰)ã€‚æµæ˜¯åªæ— é™çš„æ•°æ®é˜Ÿåˆ—ã€‚ç”±äºéš¾ä»¥æŠ½è±¡åŒ–æŠ½è±¡è¿ç®—ç¬¦çš„éåŠŸèƒ½å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¯¹å…¶éåŠŸèƒ½å±æ€§è¿›è¡Œäº†ç‰¹å¾æè¿°ï¼š</p><p>$C_i$è¡¨ç¤ºæ‰§è¡Œæ‰€éœ€è¦çš„èµ„æºæ•°é‡ï¼Œ$R_i$è¡¨ç¤ºç®—å­å¤„ç†æ¯å•å…ƒæ•°æ®çš„å¹³å‡å»¶è¿Ÿã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œå‡è®¾èµ„æºæ•°é‡$C_i$è¶³å¤Ÿä¿æŒç®—å­$i$è¾“å…¥é€Ÿç‡ï¼Œ</p><h5 id="Resource-Modelèµ„æºæ¨¡å‹"><a href="#Resource-Modelèµ„æºæ¨¡å‹" class="headerlink" title="Resource Modelèµ„æºæ¨¡å‹"></a>Resource Modelèµ„æºæ¨¡å‹</h5><p>è®¡ç®—èµ„æºå’Œç½‘ç»œèµ„æºä¹Ÿå¯ä»¥ä½¿ç”¨æœ‰æ ‡è®°çš„ã€å…¨è¿æ¥çš„ã€æœ‰å‘å›¾æ¥è¡¨ç¤ºã€‚å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å˜é‡ä½œä¸ºç‰¹å¾ï¼Œ$C_u$è¡¨ç¤ºå¯ç”¨èµ„æºæ•°é‡ï¼Œ$S_u$è¡¨ç¤ºå“åº”å¤„ç†å™¨ä¸Šå¤„ç†é€Ÿåº¦çš„æé«˜ï¼Œ$A_u$è¡¨ç¤ºå¯ç”¨æ€§æ¦‚ç‡ï¼Œæ¯”å¦‚èŠ‚ç‚¹$u$æ˜¯å¦å¯åŠ¨å’Œè¿è¡Œã€‚</p><h5 id="ç®—å­æ”¾ç½®é—®é¢˜"><a href="#ç®—å­æ”¾ç½®é—®é¢˜" class="headerlink" title="ç®—å­æ”¾ç½®é—®é¢˜"></a>ç®—å­æ”¾ç½®é—®é¢˜</h5><p>æ”¾ç½®é—®é¢˜ä¸»è¦æ˜¯ç¡®å®šæµå¤„ç†æ‰§è¡Œå›¾ä¸èµ„æºå›¾ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201117133603.png" alt="image-20201117133603759"></p><h4 id="The-Placement-Problem"><a href="#The-Placement-Problem" class="headerlink" title="The Placement Problem"></a>The Placement Problem</h4><p>æ­£å¼æå‡ºç®—å­æ”¾ç½®é—®é¢˜ï¼Œå¹¶æå‡ºå¯å‘å¼æ–¹æ³•çš„æ¦‚è¿°ï¼ŒåŒæ—¶å®šä¹‰èµ„æºæƒ©ç½šå‡½æ•°ã€‚</p><h5 id="Optimal-Placement-Formulation"><a href="#Optimal-Placement-Formulation" class="headerlink" title="Optimal Placement Formulation"></a>Optimal Placement Formulation</h5><p>æœ€ä¼˜æµå¤„ç†æ”¾ç½®é—®é¢˜(ODP)ï¼Œå¯ä»¥è¢«æ–¹ä¾¿çš„å®šä¹‰ä¸ºæ•´æ•°æ•°é—®é¢˜ï¼Œå…¶ä¸­ç®—å­æ”¾ç½®å¯ä»¥ä½¿ç”¨äºŒå…ƒå˜é‡å»ºæ¨¡$x_{i,u}$ï¼Œ$i\in V_{dsp}$ï¼Œ$u \in V_{res}^{i}$ã€‚$x_{i,u}&#x3D;1$è¡¨ç¤ºç®—å­$i$åœ¨èŠ‚ç‚¹$u$ä¸Šï¼Œå¦åˆ™$x_{i,u}&#x3D;0$ã€‚</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201117135021.png" alt="image-20201117135021000"></p><p>å…¶ä¸­$F(x)$è¡¨ç¤ºæœ€åˆé€‚çš„ç›®æ ‡å‡½æ•°ï¼Œ$x$ä¸ºæ”¾ç½®å‘é‡ã€‚å…¬å¼1è¡¨ç¤ºèŠ‚ç‚¹èµ„æºé™åˆ¶ï¼Œæ ¹æ®å…¶å¯ç”¨èµ„æºå¯¹æ”¾ç½®åœ¨èŠ‚ç‚¹$u$ä¸Šçš„èµ„æºè¿›è¡Œé™åˆ¶ã€‚å…¬å¼ï¼ˆ2ï¼‰ä¿è¯äº†æ¯ä¸ªç®—å­$i$è¢«æ”¾ç½®åœ¨1ä¸ªä¸”ä»…1ä¸ªèŠ‚ç‚¹$u$ä¸Šã€‚ç›®æ ‡å‡½æ•°$F(x)$å®šä¹‰äº†æ”¾ç½®ç­–ç•¥ç›®æ ‡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œä½œè€…è€ƒè™‘äº†åº”ç”¨å“åº”æ—¶é—´$R(x)$ï¼Œåº”ç”¨å¯ç”¨æ€§$A(x)$ï¼Œç½‘ç»œä½¿ç”¨ç‡$Z(x)$ã€‚è¿™å°±äº§ç”Ÿäº†å¤šç›®æ ‡ä¼˜åŒ–é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ç®€å•çš„åŠ æ³•åŠ æƒæŠ€æœ¯è½¬æ¢ä¸ºå•ç›®æ ‡ä¼˜åŒ–é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†$F(x)$ä½œä¸ºåŠ æƒå’Œçš„åº”ç”¨çš„æ ‡å‡†åŒ–æœåŠ¡è´¨é‡å±æ€§ï¼š<br>$$<br>F(x)&#x3D;w_r \frac{R(x)-R_{min}}{R_{max}-R_{min}}+w_a \frac{logA_{max}-logA(x)}{logA_{max}-logA_{min}}+w_z \frac{Z(x)-Z_{min}}{Z_{max}-Z_{min}}<br>$$</p><p>å…¶ä¸­$w_r$ï¼Œ$w_a$ï¼Œ$w_z \geq 0$ï¼Œ$w_r+w_a+w_z&#x3D;1$ï¼Œæ˜¯æœåŠ¡è´¨é‡$QoS$å‚æ•°çš„æƒé‡ã€‚$R_{max}(R_{min}), A_{max}(A_{min}), Z_{max}(Z_{min})$åˆ†åˆ«è¡¨ç¤ºæœŸæœ›å“åº”æ—¶é—´ã€å¯ç”¨æ€§ã€ç½‘ç»œä½¿ç”¨ç‡çš„æœ€å¤§ï¼ˆæœ€å°ï¼‰å€¼ã€‚è¿™é‡Œä½¿ç”¨å¯¹æ•°è¡¨è¾¾å¼å¯¹å¯ç”¨æ€§è¿›è¡Œæè¿°ï¼Œæ˜¯ä¸ºäº†è·å¾—çº¿æ€§è¡¨è¾¾å¼ã€‚</p><p>ç›®æ ‡å‡½æ•°ä¼šåœ¨$[0,1]$èŒƒå›´å†…ï¼Œå…¶ä¸­å€¼0å¯¹åº”æœ€ä½³æŒ‡æ ‡ï¼Œ1å¯¹åº”æœ€å·®æŒ‡æ ‡ã€‚</p><h5 id="Heuristicsï¼šOverview"><a href="#Heuristicsï¼šOverview" class="headerlink" title="Heuristicsï¼šOverview"></a>Heuristicsï¼šOverview</h5><p>ä½œè€…ä¸»è¦æå‡ºäº†åŸºäºæ¨¡å‹åŠä¸åŸºäºæ¨¡å‹çš„å¯å‘å¼æ–¹æ³•ã€‚éƒ½æ˜¯ä¸ºäº†æœ€å°åŒ–ç›®æ ‡å‡½æ•°$F(x)$ï¼Œä¸ºæ­¤ï¼Œå¯å‘å¼æ–¹æ³•ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æƒ©ç½šå‡½æ•°ï¼Œå…¶å®šä¹‰äº†èµ„æºä¹‹é—´çš„é¡ºåºå…³ç³»ã€‚</p><p>åŸºäºæ¨¡å‹çš„å¯å‘å¼æ–¹æ³•å°è¯•é™åˆ¶è®¡ç®—èµ„æºçš„å¤‡ç”¨èµ„æºé›†ï¼Œå±‚æ¬¡åŒ–çš„æœ€ä¼˜èµ„æºæ–¹æ³•è¡¨ç¤ºæŒ‰è™šæ‹Ÿæ•°æ®ä¸­å¿ƒä¸­çš„å±‚æ¬¡ç»“æ„ç»„ç»‡çš„è®¡ç®—ä½“ç³»ç»“æ„ã€‚</p><p>æ— æ¨¡å‹çš„å¯å‘å¼æ–¹æ³•å®ç°çš„è‘—åçš„å…ƒå¯å‘å¼æ–¹æ³•æ¥è§£å†³æœ€ä¼˜æ”¾ç½®é—®é¢˜ã€‚è´ªå©ªå’Œé¦–æ¬¡é€‚åº”ç®—æ³•æ˜¯è§£å†³è£…ç®±é—®é¢˜æœ€æµè¡Œçš„æ–¹æ³•ã€‚ä¹Ÿå¹¿æ³›çš„ç”¨äºè§£å†³ç®—å­æ”¾ç½®é—®é¢˜ã€4ã€‘ã€20ã€‘ã€‚</p><h5 id="Resource-Penalty-Function"><a href="#Resource-Penalty-Function" class="headerlink" title="Resource Penalty Function"></a>Resource Penalty Function</h5><p>å¯å‘å¼æ–¹æ³•åŒ…å«äº†ä¸åŒé˜¶æ®µçš„é€‰æ‹©ï¼ŒèŠ‚ç‚¹æ˜¯å¦åˆé€‚ä¼šæŒ‡å¼•æ”¾ç½®çš„å†³å®šã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒ‡æ ‡æ¥æ¯”è¾ƒä¸åŒçš„æ–¹æ¡ˆã€‚</p><p>å¼•å…¥é“¾è·¯å¼€é”€å‡½æ•°$\delta (u,v) \in [0,1]$ï¼Œä½œä¸ºé“¾è·¯$link(u,v) \in E_{res}$çš„æƒ©ç½šã€‚åŒæ ·çš„ï¼Œä¸å®šä¹‰$QoS$å±æ€§çš„åŠ æƒç»„åˆç±»ä¼¼ï¼Œé“¾è·¯æƒ©ç½šå‡½æ•°$\delta (u,v)$å¦‚ä¸‹ï¼š<br>$$<br>\delta (u,v) &#x3D; w_r\delta _R(u,v)+w_a\delta_A(u,v)+w_z\delta_Z(u,v)<br>$$<br>å…¶ä¸­$w_r$ï¼Œ$w_a$ï¼Œ$w_z \in [0,1]$ï¼Œ</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201117152931.png" alt="image-20201117152931510"></p><p>é“¾è·¯$link(u,v)$ä¸Šçš„å“åº”æ—¶é—´$\widetilde R(u,v)$ä¾èµ–äºç½‘ç»œå»¶è¿Ÿ$d_{(u,v)}$ä»¥åŠå‚è€ƒç®—å­çš„æ‰§è¡Œæ—¶é—´</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201117153457.png" alt="image-20201117153457707"></p><h4 id="Model-Based-Heuristics"><a href="#Model-Based-Heuristics" class="headerlink" title="Model-Based Heuristics"></a>Model-Based Heuristics</h4><h5 id="Hierarchical-ODP"><a href="#Hierarchical-ODP" class="headerlink" title="Hierarchical ODP"></a>Hierarchical ODP</h5><p>åˆ†å±‚æœ€ä¼˜ç®—å­æ”¾ç½®(hierarchical ODP)è¡¨ç¤ºä»¥æœ‰é™æ•°é‡çš„å®ä½“(è™šæ‹Ÿæ•°æ®ä¸­å¿ƒVDC)ç»„ç»‡çš„åŸºç¡€æ¶æ„ã€‚VDCå¯ä»¥å°†è®¸å¤šèŠ‚ç‚¹åŠå…¶ç›¸åº”çš„ç½‘ç»œé“¾æ¥æŠ½è±¡æˆä¸ºèƒ½åŠ›æ›´å¼ºçš„è®¡ç®—èŠ‚ç‚¹ã€‚</p><h5 id="Model-free-Heuristics"><a href="#Model-free-Heuristics" class="headerlink" title="Model-free Heuristics"></a>Model-free Heuristics</h5><h5 id="Greedy-First-fit"><a href="#Greedy-First-fit" class="headerlink" title="Greedy First-fit"></a>Greedy First-fit</h5><h5 id="local-search"><a href="#local-search" class="headerlink" title="local search"></a>local search</h5><h4 id="Experimental-Results"><a href="#Experimental-Results" class="headerlink" title="Experimental Results"></a>Experimental Results</h4><h5 id="Experimental-Setup"><a href="#Experimental-Setup" class="headerlink" title="Experimental Setup"></a>Experimental Setup</h5><h5 id="Application-Topologies-and-network-size"><a href="#Application-Topologies-and-network-size" class="headerlink" title="Application Topologies and network size"></a>Application Topologies and network size</h5><h5 id="Optimization-Objectives"><a href="#Optimization-Objectives" class="headerlink" title="Optimization Objectives"></a>Optimization Objectives</h5><h5 id="Heuristics-Overall-Performance"><a href="#Heuristics-Overall-Performance" class="headerlink" title="Heuristics Overall Performance"></a>Heuristics Overall Performance</h5><h2 id="2-B-Gedik-H-G-Ozsema-O-Ozturk-Pipelined-fission-for-stream-programs-with-dynamic-selectivity-and-partitioned-state-Journal-of-Parallel-and-Distributed-Computing-2016-x2F-10-x2F-01-x2F-B"><a href="#2-B-Gedik-H-G-Ozsema-O-Ozturk-Pipelined-fission-for-stream-programs-with-dynamic-selectivity-and-partitioned-state-Journal-of-Parallel-and-Distributed-Computing-2016-x2F-10-x2F-01-x2F-B" class="headerlink" title="[2] B. Gedik, H. G. Ã–zsema, Ã– Ã–ztÃ¼rk. Pipelined fission for stream programs with dynamic selectivity and partitioned state. Journal of Parallel and Distributed Computing,2016&#x2F;10&#x2F;01&#x2F;.B"></a>[2] B. Gedik, H. G. Ã–zsema, Ã– Ã–ztÃ¼rk. Pipelined fission for stream programs with dynamic selectivity and partitioned state. Journal of Parallel and Distributed Computing,2016&#x2F;10&#x2F;01&#x2F;.B</h2><h3 id="ç ”ç©¶å†…å®¹-3"><a href="#ç ”ç©¶å†…å®¹-3" class="headerlink" title="ç ”ç©¶å†…å®¹"></a>ç ”ç©¶å†…å®¹</h3><h3 id="æŠ€æœ¯è·¯çº¿-2"><a href="#æŠ€æœ¯è·¯çº¿-2" class="headerlink" title="æŠ€æœ¯è·¯çº¿"></a>æŠ€æœ¯è·¯çº¿</h3><h3 id="è®ºæ–‡å†…å®¹-3"><a href="#è®ºæ–‡å†…å®¹-3" class="headerlink" title="è®ºæ–‡å†…å®¹"></a>è®ºæ–‡å†…å®¹</h3><h4 id="æ‘˜è¦-2"><a href="#æ‘˜è¦-2" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>æœ¬æ–‡è§£å†³äº†æµæ°´çº¿åˆ†å‰²çš„é—®é¢˜ï¼Œåˆ©ç”¨ç®¡é“å¹¶è¡Œæ€§å’Œæ•°æ®å¹¶è¡Œæ¥å¹¶è¡ŒåŒ–ç¨‹åºã€‚å°†æµæ°´çº¿åˆ†å‰²é—®é¢˜è¡¨è¾¾ä¸ºä¼˜åŒ–é—®é¢˜ï¼Œä½¿ç”¨ä¸€ç§å¯å‘å¼ç®—æ³•ã€‚</p><h4 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h4><p>åœ¨æœ¬æ–‡ä¸­ï¼Œä¸»è¦ç ”ç©¶æµæ°´çº¿åˆ†å‰²é—®é¢˜ï¼Œè‡ªåŠ¨å¯»æ‰¾ç»„åˆæµæ°´çº¿çš„æœ€ä¼˜é…ç½®å’Œæ•°æ®å¹¶è¡Œåº¦æ¥ä¼˜åŒ–åº”ç”¨ååé‡ã€‚æµæ°´çº¿å¹¶è¡Œåº¦æ˜¯æµå¤„ç†åº”ç”¨è‡ªç„¶è€Œç„¶çš„é—®é¢˜ã€39ã€‘ã€‚æœ¬æ–‡çš„ç›®æ ‡æ˜¯ç¡®å®šå¦‚ä½•åœ¨æµåº”ç”¨ç¨‹åºä¸­åœ¨æ•°æ®å’Œæµæ°´çº¿å¹¶è¡Œæ–¹é¢åˆ†é…å¤„ç†èµ„æºï¼Œä»¥ä¾¿æœ€ä½³åœ°ä¼˜åŒ–ååé‡ã€‚ç”±äºæ•°æ®å¹¶è¡Œè¢«åº”ç”¨ä¸æ‹“æ‰‘ä¸­ç®—å­çš„è‡ªå·±ï¼Œå› æ­¤æ€§èƒ½ä»ç„¶å—åˆ°æ— æ³•è¿›è¡Œæ•°æ®å¹¶è¡Œçš„è¿ç®—ç¬¦çš„é™åˆ¶ï¼Œæ­£æ˜¯è¿™ä¸€ç‚¹æ¿€å‘äº†æµæ°´çº¿åˆ†å‰²çš„é‡è¦æ€§ï¼Œå³ç»„åˆæµæ°´çº¿ä¸æ•°æ®å¹¶è¡Œçš„éœ€æ±‚ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä¸“æ³¨äºé“¾å¼æ‹“æ‰‘çš„æµåº”ç”¨ç¨‹åºï¼Œå°†å…¶ä¸­å¤šä¸ªé˜¶æ®µç»„ç»‡ä¸ºä¸€ç³»åˆ—ï¼Œæ¯ä¸ªé˜¶æ®µæ¶ˆè´¹å‰ä¸ªé˜¶æ®µçš„æ•°æ®ï¼Œç„¶åå°†æ•°æ®è¾“å‡ºåˆ°ä¸‹ä¸€é˜¶æ®µã€‚æ¯ä¸€é˜¶æ®µå¯ä»¥æ˜¯å•ä¸ªç®—å­æˆ–ç»„åˆçš„ç®—å­ã€‚</p><p>æœ¬æ–‡å·¥ä½œé€‚ç”¨äºå…·æœ‰ä»¥ä¸‹ç‰¹æ€§çš„æµå¤„ç†ç³»ç»Ÿï¼š</p><ul><li>åŠ¨æ€é€‰æ‹©æ€§ï¼šæ¶ˆè´¹çš„è¾“å…¥æ•°æ®æ•°ç›®æˆ–ç®—å­äº§ç”Ÿçš„è¾“å‡ºæ•°æ®é¡¹ç›®æœªå›ºå®šï¼Œå¹¶å¯èƒ½ä¼šæ›´æ ¹æ®è¾“å…¥æ•°æ®çš„å†…å®¹è€Œå˜åŒ–ï¼Œåˆ™ç®—å­å…·æœ‰åŠ¨æ€é€‰æ‹©æ€§ã€‚</li><li>èƒŒå‹</li><li>æµåˆ†åŒº</li></ul><p>åœ¨è§£å†³æµæ°´çº¿åˆ†å‰²æ–¹é¢é¢ä¸´çš„æŒ‘æˆ˜ï¼Œé¦–å…ˆé€šè¿‡DSPSæ‰€ç”¨çš„æ‰§è¡Œæ¨¡å‹æ¥æ­£å¼å®šä¹‰æœ‰æ•ˆçš„å¹¶è¡ŒåŒ–é…ç½®ï¼Œè¿™æ¶‰åŠå¯¹çº¿ç¨‹å’Œåº”ç”¨å¹¶è¡Œéƒ¨åˆ†è¿›è¡Œæ˜ å°„çš„å®šä¹‰ã€‚å…¶æ¬¡ï¼Œéœ€è¦å¯¹æµæ°´çº¿åˆ†å‰²çš„é…ç½®ä¸ååé‡è¿›è¡Œå»ºæ¨¡ï¼Œä»¥ä¾¿æ¯”è¾ƒä¸åŒé…ç½®æ–¹æ¡ˆä¹‹é—´çš„åŒºåˆ«ã€‚æœ€åï¼Œå³ä¾¿æ˜¯å°è§„æ¨¡çš„ç®—å­ã€å¤„ç†å™¨æ ¸å¿ƒã€çº¿ç¨‹ï¼Œç»„åˆèµ·æ¥ä¹Ÿæœ‰å¤šç§æ–¹æ¡ˆï¼Œé‡è¦çš„æ˜¯è¦å¿«é€Ÿæ‰¾åˆ°å¯ä»¥æä¾›æ¥è¿‘æœ€ä½³ååé‡çš„é…ç½®ã€‚</p><p>è¿™ä¸€é—®é¢˜æœ‰ä¸¤ä¸ªå¼ºçƒˆçš„åŠ¨æœºï¼Œé¦–å…ˆæ˜¯å¯¹åº”ç”¨ç¨‹åºæœ‰å¿«é€Ÿçš„ç¼–è¾‘-è°ƒè¯•å‘¨æœŸï¼Œç¬¬äºŒæ˜¯åŠ¨æ€è¿›è¡Œæµæ°´çº¿åˆ†å‰²çš„å¼€é”€è¾ƒä½ï¼Œå³èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ›´æ–°å¹¶è¡ŒåŒ–é…ç½®ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œé‡ç‚¹æ˜¯åœ¨åˆç†çš„æ—¶é—´èŒƒå›´ã€é«˜ååé‡çš„è§£å†³æµæ°´çº¿åˆ†å‰²çš„é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ¡ˆåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬åŸºäºåº”ç”¨èåˆå’Œç®—å­åˆ†å‰²å®šä¹‰æœ‰æ•ˆçš„æµæ°´çº¿åˆ†å‰²é…ç½®ï¼Œèåˆæ˜¯ä¸€ç§ç”¨äºæœ€å°åŒ–è°ƒåº¦å¼€é”€å’Œä»¥æµæ°´çº¿æ–¹å¼æ‰§è¡Œæµåº”ç”¨çš„ä¸€é¡¹æŠ€æœ¯ã€25ï¼Œ13ã€‘ã€‚ä½¿ç”¨åˆ†å‰²ï¼Œå¤åˆ¶å½¢æˆå¹¶è¡ŒåŒºåŸŸçš„æµæ°´çº¿ï¼Œæ¥å®ç°æ•°æ®å¹¶è¡Œæ€§ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬å¯¹ç›¸å…³æ¦‚å¿µè¿›è¡Œå»ºæ¨¡ï¼Œæ¯”å¦‚ç®—å­å…¼å®¹æ€§(ç”¨äºå®šä¹‰å¹¶è¡ŒåŒºåŸŸ)ã€èƒŒå‹(å®šä¹‰ååé‡çš„å…³é”®å› ç´ )ã€ç³»ç»Ÿå¼€é”€ï¼ˆçº¿ç¨‹åˆ‡æ¢å’Œå‰¯æœ¬å¼€é”€ï¼‰ï¼Œå¹¶ä½¿ç”¨æ¨å¯¼å‡ºæ¥çš„å…¬å¼è®¡ç®—ååé‡ã€‚æœ€åï¼Œæˆ‘ä»¬æå‡ºä¸€ä¸ªå¯å‘å¼ç®—æ³•å¯ä»¥å¿«é€Ÿå®šä½æµæ°´çº¿åˆ†å‰²é…ç½®ï¼Œå¹¶æä¾›è¿‘ä¼¼æœ€ä¼˜çš„æ€§èƒ½ã€‚ç®—æ³•ä¾èµ–äºä¸‰ä¸ªä¸»è¦æƒ³æ³•ï¼š1.åŸºäºæœ€é•¿å…¼å®¹é˜Ÿåˆ—è§„åˆ™å½¢æˆåŒºåŸŸï¼Œå…¶ä¸­å…¼å®¹å¼å½¢æˆçš„åŒºåŸŸå…·æœ‰ä½¿ä¹‹é€‚åˆæ•´ä½“æ•°æ®å¹¶è¡Œçš„ç‰¹æ€§ã€‚2.ä½¿ç”¨è´ªå©ªç“¶é¢ˆè§£å†³æ–¹æ³•æ¥å°†åŒºåŸŸåˆ†å‰²ä¸ºæµæ°´çº¿ï¼Œè¯¥è¿‡ç¨‹ä½¿ç”¨å¯å˜çš„åŸºäºåˆ©ç”¨ç‡çš„ä¸Šé™ä½œä¸ºåœæ­¢æ¡ä»¶ï¼Œæ¥æ‰§è¡Œè¿­ä»£æµæ°´çº¿æ“ä½œã€‚3.ä½¿ç”¨è´ªå©ªçš„æ–¹å¼é€šè¿‡å¢åŠ åŒºåŸŸå‰¯æœ¬æ•°é‡è§£å†³å‰©ä¸‹çš„ç“¶é¢ˆã€‚</p><h4 id="BackGround"><a href="#BackGround" class="headerlink" title="BackGround"></a>BackGround</h4><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201117220238.png" alt="image-20201117220238360"></p><h4 id="Problem-Formulation"><a href="#Problem-Formulation" class="headerlink" title="Problem Formulation"></a>Problem Formulation</h4><p>æ‰©å±•å‡½æ•°</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201117222551.png" alt="image-20201117222551835"></p><p>åŒºåŸŸå’Œæµæ°´çº¿</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20201118095712.png" alt="image-20201118095712355"></p><h1 id="ç®—å­æ€§èƒ½æ¨¡å‹ç›¸å…³è®ºæ–‡"><a href="#ç®—å­æ€§èƒ½æ¨¡å‹ç›¸å…³è®ºæ–‡" class="headerlink" title="ç®—å­æ€§èƒ½æ¨¡å‹ç›¸å…³è®ºæ–‡"></a>ç®—å­æ€§èƒ½æ¨¡å‹ç›¸å…³è®ºæ–‡</h1><h2 id="1-An-Experiment-Driven-Performance-Model-of-StreamProcessing-Operators-in-Fog-Computing-Environments-ACM-SAC-2020"><a href="#1-An-Experiment-Driven-Performance-Model-of-StreamProcessing-Operators-in-Fog-Computing-Environments-ACM-SAC-2020" class="headerlink" title="[1]An Experiment-Driven Performance Model of StreamProcessing Operators in Fog Computing Environments.ACM SAC.2020"></a>[1]An Experiment-Driven Performance Model of StreamProcessing Operators in Fog Computing Environments.ACM SAC.2020</h2><p>æ³•å›½æ•°å­—ç§‘å­¦ä¸æŠ€æœ¯ç ”ç©¶åˆ›æ–°å®éªŒå®¤</p><p><strong>è®ºæ–‡ä»…è€ƒè™‘æ— çŠ¶æ€ç®—å­</strong></p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><ul><li>flink1.7.0</li><li>ä½¿ç”¨dockerï¼Œæ¯ä¸ªdockerä¸­æ”¾ç½®ä¸€ä¸ªTMï¼Œæ¯ä¸ªTMä¸­æœ‰ä¸€ä¸ªslotã€‚(æ²¡æœ‰è¿›è¡Œslotgroupè®¾ç½®)</li><li>ä½¿ç”¨ncå‘½ä»¤æ¥è¿›è¡Œç½‘ç»œå»¶è¿Ÿçš„ä»¿çœŸï¼Œä»¿çœŸçš„æ•°æ®æ¥è‡ªGlobal ping statistics. <a href="https://wondernetwork.com/pings">https://wondernetwork.com/pings</a></li><li>ä½¿ç”¨æ•°æ®ç”Ÿæˆå™¨ç”Ÿæˆæ•°æ®</li><li>ä½¿ç”¨æ–æ³¢é‚£å¥‘å‡½æ•°ä½œä¸ºå¤„ç†ç®—å­</li><li>æ¯æ¬¡å®éªŒæ‰§è¡Œ4æ¬¡ï¼Œç„¶åèˆå¼ƒç¬¬ä¸€æ¬¡çš„æ•°æ®ï¼Œå½“åšç³»ç»Ÿçƒ­èº«</li><li>è¾“å…¥ç³»ç»Ÿ100_000ä¸ªè®°å½•</li><li>å‡è®¾sourceã€sinkå¤„ç†æ—¶é—´å¿½ç•¥ä¸è®¡</li></ul><h3 id="æ€§èƒ½å‚æ•°"><a href="#æ€§èƒ½å‚æ•°" class="headerlink" title="æ€§èƒ½å‚æ•°"></a>æ€§èƒ½å‚æ•°</h3><p>æ–‡ä¸­ä¸»è¦å…³æ³¨ååé‡</p><ul><li>å®šä¹‰å¤„ç†æ—¶é—´PTï¼Œä¸ºæ¯ä¸ªç®—å­å®šä¹‰å¤„ç†æ—¶é—´PTï¼Œä»ä¸Šä¸€ä¸ªç®—å­è¾“å‡ºåˆ°å½“å‰ç®—å­è¾“å‡ºçš„æ—¶é—´é—´éš”ã€‚åŒ…å«äº†ç½‘ç»œå»¶è¿Ÿã€‚</li><li>ä»»åŠ¡è¿è¡Œæ—¶é—´JRTï¼Œä»ç¬¬ä¸€ä¸ªè®°å½•è¿›å…¥åˆ°flinkï¼Œåˆ°æœ€åä¸€ä¸ªè®°å½•è¾“å‡ºã€‚</li></ul><h3 id="æ€§èƒ½æ¨¡å‹"><a href="#æ€§èƒ½æ¨¡å‹" class="headerlink" title="æ€§èƒ½æ¨¡å‹"></a>æ€§èƒ½æ¨¡å‹</h3><h4 id="ç®€å•ç”¨ä¾‹"><a href="#ç®€å•ç”¨ä¾‹" class="headerlink" title="ç®€å•ç”¨ä¾‹"></a>ç®€å•ç”¨ä¾‹</h4><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118142727.png" alt="image-20210118142727549"></p><p>æ­¤æ—¶æ‰€æœ‰ç®—å­éƒ½è¿è¡Œåœ¨ä¸€ä¸ªTMä¸­ï¼Œç„¶åè¡¡é‡å¤„ç†å…¨éƒ¨è¾“å…¥æ‰€ç”¨çš„æ—¶é—´$\alpha$ï¼Œè¿™ä¹Ÿè¡¨ç¤ºäº†ä¸€ä¸ªèŠ‚ç‚¹çš„å…¨éƒ¨å¤„ç†èƒ½åŠ›ã€‚</p><p>å¦‚æœå¢åŠ ç®—å­å‰¯æœ¬ï¼Œç†è®ºä¸Šä¼šæŒ‰æ¯”ä¾‹å‡å°‘æ—¶é—´</p><ul><li>åˆå§‹ç®€å•æ€§èƒ½æ¨¡å‹å¦‚ä¸‹ï¼š</li></ul><p>$$<br>\Pi_n &#x3D; \frac{\alpha}{n}<br>$$</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118143244.png" alt="image-20210118143244205"></p><p>â€‹ç”±äºå®é™…æƒ…å†µå¹¶ä¸æ˜¯çº¿æ€§ï¼Œæ‰€ä»¥æå‡ºå¹¶è¡Œå¼€é”€å‚æ•°$\beta$</p><ul><li><p>ç¬¬äºŒä¸ªç‰ˆæœ¬çš„æ€§èƒ½æ¨¡å‹å¦‚ä¸‹ï¼š<br>$$<br>\Pi_n &#x3D; \frac{\alpha}{n^{\beta}}<br>$$<br><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118144823.png" alt="image-20210118144823615"></p><p>å½“$\Pi$æ˜¯æ‰€é€‰ç®—å­çš„å¤„ç†å…¨éƒ¨æ•°æ®æ‰€éœ€æ—¶é—´æ—¶ï¼Œ$\alpha$è¡¨ç¤ºå•ä¸€å®ä¾‹çš„å¤„ç†èƒ½åŠ›ã€‚ï¼ˆå› ä¸ºæ— è®ºæ˜¯$\Pi$è¿˜æ˜¯$\alpha$è¡¨ç¤ºçš„éƒ½æ˜¯å¤„ç†ä¸€å®šé‡æ•°æ®æ‰€éœ€çš„æ—¶é—´ï¼‰ã€‚å¯¹$\alpha$ä»¥åŠ$\beta$è¿›è¡Œæ‹Ÿåˆï¼Œå¯ä»¥å¾—åˆ°ç®—å­çš„æ€§èƒ½é¢„æµ‹æ¨¡å‹ã€‚å®éªŒè¡¨æ˜$\beta \in[0.8,0.9]$</p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118150032.png" alt="image-20210118150032046" style="zoom:50%;" /></li></ul><h4 id="è€ƒè™‘å¼‚æ„ç½‘ç»œå»¶è¿Ÿ"><a href="#è€ƒè™‘å¼‚æ„ç½‘ç»œå»¶è¿Ÿ" class="headerlink" title="è€ƒè™‘å¼‚æ„ç½‘ç»œå»¶è¿Ÿ"></a>è€ƒè™‘å¼‚æ„ç½‘ç»œå»¶è¿Ÿ</h4><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118150631.png" alt="image-20210118150631438"></p><p>æå‡ºäº†ä¸€ä¸ªçº¿æ€§æ¨¡å‹æ¥è¡¨ç¤ºç½‘ç»œå»¶è¿Ÿå¯¹ä¸¤ä¸ªTMä¹‹é—´çš„å¤„ç†æ—¶é—´çš„å½±å“<br>$$<br>\Pi_2&#x3D;a \times ND+b<br>$$<br>$ND$è¡¨ç¤ºä¸¤ä¸ªTMä¹‹é—´çš„ç½‘ç»œå»¶è¿Ÿï¼Œ$\Pi_2$è¡¨ç¤ºæœ‰ä¸¤ä¸ªå‰¯æœ¬çš„ç®—å­çš„å¤„ç†æ—¶é—´ã€‚$a$å’Œ$b$æ˜¯ä¸¤ä¸ªå¸¸æ•°ã€‚</p><p>ä¸‹å›¾è¡¨ç¤ºäº†ä¸¤ä¸ªTMä¹‹é—´ä¸åŒå»¶è¿Ÿçš„å½±å“</p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118151615.png" alt="image-20210118151615736" style="zoom:50%;" /><p>ä¸‹å›¾è¡¨ç¤ºäº†ä¸åŒå»¶è¿Ÿä»¥åŠä¸åŒæ•°é‡çš„TMå¯¹å¤„ç†æ—¶é—´çš„å½±å“</p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118151640.png" alt="image-20210118151640450" style="zoom:50%;" /><p>å½“æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œå»¶è¿Ÿéƒ½ä¸åŒæ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸»å¯¼å› ç´ æ˜¯sourceä¸ä»»æ„TMä¹‹é—´æœ€å¤§çš„å»¶è¿Ÿã€‚è¿™æ˜¯å› ä¸ºæ•´ä½“çš„å¤„ç†æ—¶é—´æ˜¯ç”±æœ€æ…¢çš„ç®—å­å‰¯æœ¬æ‰€å†³å®šçš„ã€‚</p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118152041.png" alt="image-20210118152041838" style="zoom:50%;" /><p>å› æ­¤æå‡ºçš„æ›´æ–°ç‰ˆæœ¬çš„æ€§èƒ½æ¨¡å‹ï¼š<br>$$<br>\Pi_n &#x3D; \frac{\alpha}{n^{\beta}}+\gamma \times ND_{max}<br>$$<br><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118152418.png" alt="image-20210118152418370"></p><p>å…¶ä¸­$\gamma$é€šè¿‡å®éªŒè¡¨æ˜$\gamma \in [50,150]$</p><h4 id="å¤šæºæƒ…å†µ"><a href="#å¤šæºæƒ…å†µ" class="headerlink" title="å¤šæºæƒ…å†µ"></a>å¤šæºæƒ…å†µ</h4><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118153015.png" alt="image-20210118153015222"></p><p>ä½¿ç”¨ä¸åŒç½‘ç»œå»¶è¿Ÿå¢åŠ æºç®—å­æ•°é‡æ²¡æœ‰æ›´æ”¹é€šç”¨æ¨¡å¼ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„æ¨¡å‹ï¼Œä»…éœ€è¦æ›´æ–°$ND_{max}$å‚æ•°</p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118153147.png" alt="image-20210118153147809" style="zoom:50%;" /><h3 id="æ¨¡å‹å‚æ•°æ ¡å‡†"><a href="#æ¨¡å‹å‚æ•°æ ¡å‡†" class="headerlink" title="æ¨¡å‹å‚æ•°æ ¡å‡†"></a>æ¨¡å‹å‚æ•°æ ¡å‡†</h3><p>ä»¥ä¸Šæ¨¡å‹éœ€è¦æ¨æµ‹$\alpha , \beta , \gamma$ä¸‰ä¸ªå‚æ•°ã€‚</p><ul><li>å¦‚æœè¿›è¡Œäº†ä¸€æ¬¡æµ‹é‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½å°†å•ä¸ªæ¨¡å‹å‚æ•°æ‹Ÿåˆåˆ°æ•°æ®ä¸­ã€‚å› æ­¤æˆ‘ä»¬æä¾›äº†é»˜è®¤å€¼$\beta&#x3D;1$ä»¥åŠ$\gamma&#x3D;0$ï¼Œåªæ‹Ÿåˆ$\alpha$å‚æ•°ã€‚è¿™æ ·ä½¿å¾—æ¨¡å‹ç®€åŒ–ä¸ºç®€å•æ¨¡å‹$\Pi_n &#x3D; \frac{\alpha}{n}$ï¼Œè¯¥æ¨¡å‹æ²¡æœ‰å¤„ç†å¤æ‚çš„é•¿æ±Ÿï¼Œä½†æ˜¯å¯ä»¥æä¾›è‰¯å¥½çš„æ€§èƒ½é¢„æµ‹ã€‚</li><li>å¦‚æœå¯ä»¥è¿›è¡Œä¸¤æ¬¡æµ‹é‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‹Ÿåˆä¸¤ä¸ªå‚æ•°$\alpha$å’Œ$\beta$æˆ–$\alpha$å’Œ$\gamma$ã€‚å‰©ä¸‹çš„é‚£ä¸ªå‚æ•°ä½¿ç”¨é»˜è®¤å€¼ã€‚åœ¨å®éªŒä¸­å‘ç°ï¼Œæ‹Ÿåˆ$\alpha$ä»¥åŠ$\gamma$ä¼šè·å¾—æ›´å¥½çš„ç»“æœï¼Œå› æ­¤æ¨¡å‹æ›´æ”¹ä¸º$\Pi_n&#x3D;\frac{\alpha}{n}+\gamma \times ND_{max}$</li><li>å¦‚æœå¯ä»¥è¿›è¡Œä¸‰æ¬¡æˆ–æ›´å¤šæ¬¡æµ‹é‡ï¼Œå°±å¯ä»¥ä½¿ç”¨å®Œæ•´æ¨¡å‹ã€‚</li></ul><h3 id="å…¶ä»–ä¿¡æ¯"><a href="#å…¶ä»–ä¿¡æ¯" class="headerlink" title="å…¶ä»–ä¿¡æ¯"></a>å…¶ä»–ä¿¡æ¯</h3><h4 id="1-æµå¤„ç†æ€§èƒ½åˆ†æ"><a href="#1-æµå¤„ç†æ€§èƒ½åˆ†æ" class="headerlink" title="1. æµå¤„ç†æ€§èƒ½åˆ†æ"></a>1. æµå¤„ç†æ€§èƒ½åˆ†æ</h4><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118134629.png" alt="image-20210118134629173"></p><h4 id="2-å„ç§æ–¹æ³•çš„è°ƒåº¦"><a href="#2-å„ç§æ–¹æ³•çš„è°ƒåº¦" class="headerlink" title="2.å„ç§æ–¹æ³•çš„è°ƒåº¦"></a>2.å„ç§æ–¹æ³•çš„è°ƒåº¦</h4><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/20210118134954.png" alt="image-20210118134954888"></p>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡é˜…è¯»ç¬”è®° </category>
          
          <category> æµå¤„ç† </category>
          
          <category> å¼¹æ€§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®ºæ–‡é˜…è¯»ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ ç¬”è®°-åŸºæœ¬</title>
      <link href="/2020/42d8e328/"/>
      <url>/2020/42d8e328/</url>
      
        <content type="html"><![CDATA[<h1 id="Dockerå­¦ä¹ ç¬”è®°"><a href="#Dockerå­¦ä¹ ç¬”è®°" class="headerlink" title="Dockerå­¦ä¹ ç¬”è®°"></a>Dockerå­¦ä¹ ç¬”è®°</h1><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108236.png"></p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>é•œåƒ(image)ï¼šdockeré•œåƒå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé•œåƒæ¥åˆ›å»ºå®¹å™¨æœåŠ¡ã€‚</p><p>å®¹å™¨(container)ï¼šæŠŠå®¹å™¨ç†è§£ä¸ºç®€æ˜“çš„linuxï¼Œç‹¬ç«‹çš„è¿è¡Œä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œé€šè¿‡é•œåƒæ¥åˆ›å»º</p><p>ä»“åº“ï¼šå­˜æ”¾é•œåƒçš„ä½ç½®ï¼Œåˆ†ä¸ºå…¬æœ‰å’Œç§æœ‰</p><h2 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>Linuxç¯å¢ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm ~]<span class="comment"># uname -r</span></span><br><span class="line">3.10.0-1062.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@centos7vm ~]<span class="comment"># cat /etc/os-release</span></span><br><span class="line">NAME=<span class="string">&quot;CentOS Linux&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;7 (Core)&quot;</span></span><br><span class="line">ID=<span class="string">&quot;centos&quot;</span></span><br><span class="line">ID_LIKE=<span class="string">&quot;rhel fedora&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;7&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;CentOS Linux 7 (Core)&quot;</span></span><br><span class="line">ANSI_COLOR=<span class="string">&quot;0;31&quot;</span></span><br><span class="line">CPE_NAME=<span class="string">&quot;cpe:/o:centos:centos:7&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;https://www.centos.org/&quot;</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">&quot;https://bugs.centos.org/&quot;</span></span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=<span class="string">&quot;CentOS-7&quot;</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=<span class="string">&quot;7&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT=<span class="string">&quot;centos&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=<span class="string">&quot;7&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><a href="https://docs.docker.com/engine/install/centos/">å®˜ç½‘å¸®åŠ©æ–‡æ¡£</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. å¸è½½æ—§ç‰ˆæœ¬</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"><span class="comment"># 2. éœ€è¦çš„å®‰è£…åŒ…</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"><span class="comment"># 3. è®¾ç½®é•œåƒä»“åº“</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo <span class="comment"># é»˜è®¤æ˜¯å›½å¤–çš„</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo  </span><br><span class="line"><span class="comment"># è¿™é‡Œç”¨é˜¿é‡Œäº‘çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å®‰è£…dockerç›¸å…³çš„åŒ…  docker-ce ç¤¾åŒº  eeä¼ä¸šç‰ˆ</span></span><br><span class="line">sudo yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="comment"># 5. å¯åŠ¨docker</span></span><br><span class="line">sudo systemctl start docker</span><br><span class="line"><span class="comment"># 6. ä½¿ç”¨docker versionæµ‹è¯•æ˜¯å¦æˆåŠŸ    </span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.13</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        4484c46d9d</span><br><span class="line"> Built:             Wed Sep 16 17:03:45 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.13</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       4484c46d9d</span><br><span class="line">  Built:            Wed Sep 16 17:02:21 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.3.7</span><br><span class="line">  GitCommit:        8fba4e9a7d01810a393d5d25a3621dc101981175</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683    </span><br><span class="line"><span class="comment"># 7. ä½¿ç”¨Hello worldæµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108047.png" alt="image-20201107230858385"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 8. æŸ¥çœ‹ä¸‹è½½çš„helloworldé•œåƒ</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        10 months ago       13.3kB</span><br></pre></td></tr></table></figure><h2 id="é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"><a href="#é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ" class="headerlink" title="é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"></a>é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://l5e8i15v.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h2><p><strong>Dockeræ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</strong></p><p>Dockeræ˜¯ä¸€ä¸ªClient-serverç»“æ„çš„ç³»ç»Ÿï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œé€šè¿‡Socketä»å®¢æˆ·ç«¯è®¿é—®ã€‚</p><p>DockerServeræ¥æ”¶åˆ°Docker-clientçš„æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚</p><p><strong>Dockerä¸ºä»€ä¹ˆæ¯”VMå¿«ï¼Ÿ</strong></p><ol><li>Dockeræ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚</li><li>Dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œvméœ€è¦çš„æ˜¯Guest os</li></ol><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108495.png" alt="image-20201107232451728"></p><p>æ‰€ä»¥ï¼Œæ–°å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼ŒDockerä¸éœ€è¦åƒè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œé¿å…å¼•å¯¼ã€‚è™šæ‹Ÿæœºæ˜¯åŠ è½½Guest osï¼Œåˆ†é’Ÿçº§åˆ«ï¼Œè€ŒDockeræ˜¯åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿ ï¼Œçœç•¥è¿™ä¸ªè¿‡ç¨‹ï¼Œç§’çº§ã€‚</p><h2 id="Dockerå¸¸ç”¨å‘½ä»¤"><a href="#Dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Dockerå¸¸ç”¨å‘½ä»¤"></a>Dockerå¸¸ç”¨å‘½ä»¤</h2><hr><h3 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version<span class="comment"># ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">docker info<span class="comment"># æ˜¾ç¤ºDockerç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡</span></span><br><span class="line">docker å‘½ä»¤ --<span class="built_in">help</span>    <span class="comment"># å¸®åŠ©å‘½ä»¤</span></span><br></pre></td></tr></table></figure><p><a href="https://docs.docker.com/reference/">å®˜æ–¹å¸®åŠ©æ–‡æ¡£</a></p><h3 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h3><hr><p><strong>docker images æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°çš„ä¸»æœºä¸Šçš„é•œåƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm docker]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        10 months ago       13.3kB</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é‡Š</span></span><br><span class="line">REPOSITORYé•œåƒçš„ä»“åº“æº</span><br><span class="line">TAGé•œåƒçš„æ ‡ç­¾</span><br><span class="line">IMAGE IDé•œåƒçš„ID</span><br><span class="line">CREATEDé•œåƒçš„åˆ›å»ºæ—¶é—´</span><br><span class="line">SIZEé•œåƒçš„å¤§å°</span><br><span class="line"><span class="comment"># å¯é€‰é¡¹</span></span><br><span class="line">-a, --all<span class="comment"># åˆ—å‡ºæ‰€æœ‰é•œåƒ</span></span><br><span class="line">-q, --quiet<span class="comment"># åªæ˜¾ç¤ºé•œåƒid</span></span><br></pre></td></tr></table></figure><p><strong>docker search æœç´¢é•œåƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm docker]<span class="comment"># docker search mysql</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relationâ€¦   10134               [OK]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯é€‰é¡¹ï¼Œé€šè¿‡æ”¶è—æ¥è¿‡æ»¤</span></span><br><span class="line">--filter=stars=3000 <span class="comment">#æœç´¢3000ä»¥ä¸Šçš„</span></span><br></pre></td></tr></table></figure><p><strong>docker pull ä¸‹è½½é•œåƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm docker]<span class="comment"># docker pull mysql</span></span><br><span class="line">Using default tag: latest <span class="comment"># ä¸å†™tag é»˜è®¤æ˜¯latest</span></span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">bb79b6b2107f: Pull complete <span class="comment"># åˆ†å±‚ä¸‹è½½ï¼Œè”åˆæ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">49e22f6fb9f7: Pull complete</span><br><span class="line">842b1255668c: Pull complete</span><br><span class="line">9f48d1f43000: Pull complete</span><br><span class="line">c693f0615bce: Pull complete</span><br><span class="line">8a621b9dbed2: Pull complete</span><br><span class="line">0807d32aef13: Pull complete</span><br><span class="line">a56aca0feb17: Pull complete</span><br><span class="line">de9d45fd0f07: Pull complete</span><br><span class="line">1d68a49161cc: Pull complete</span><br><span class="line">d16d318b774e: Pull complete</span><br><span class="line">49e112c55976: Pull complete</span><br><span class="line">Digest: sha256:8c17271df53ee3b843d6e16d46cff13f22c9c04d6982eb15a9a47bd5c9ac7e2d <span class="comment"># ç­¾å</span></span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:latest</span><br><span class="line">docker.io/library/mysql:latest <span class="comment">#çœŸå®åœ°å€</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull docker.io/library/mysql:latest  <span class="comment"># è¿™ä¸¤ä¸ªå‘½ä»¤ç­‰ä»·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç‰ˆæœ¬ä¸‹è½½</span></span><br><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure><p><strong>docker rmi åˆ é™¤é•œåƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm docker]<span class="comment"># docker rmi -f db2b37ec6181 # åˆ é™¤æŒ‡å®šé•œåƒ</span></span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker rmi -f é•œåƒid é•œåƒid é•œåƒid  # åˆ é™¤å¤šä¸ªé•œåƒ</span></span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker rmi -f $(docker images -aq)  # åˆ é™¤å…¨éƒ¨é•œåƒ</span></span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h3><hr><p><em>è¯´æ˜ï¼šæˆ‘ä»¬æœ‰äº†é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œä¸‹è½½ä¸€ä¸ªcentosæµ‹è¯•å­¦ä¹ </em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure><p><strong>æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker run [å¯é€‰å‚æ•°] image</span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line">--name=<span class="string">&quot;Name&quot;</span>  å®¹å™¨åå­—ï¼Œç”¨æ¥åŒºåˆ†å®¹å™¨</span><br><span class="line">-dåå°æ–¹å¼è¿è¡Œ</span><br><span class="line">-itä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹</span><br><span class="line">-pæŒ‡å®šå®¹å™¨ç«¯å£  -p 8080:8080</span><br><span class="line">-p ip:ä¸»æœºç«¯å£:ç«¯å£</span><br><span class="line">-p ä¸»æœºç«¯å£:å®¹å™¨  (å¸¸ç”¨)</span><br><span class="line">-p å®¹å™¨ç«¯å£</span><br><span class="line">å®¹å™¨ç«¯å£</span><br><span class="line">-PéšæœºæŒ‡å®šç«¯å£</span><br><span class="line"><span class="comment"># æµ‹è¯• å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker run -it centos /bin/bash</span></span><br><span class="line">[root@02861391cd3a /]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»å®¹å™¨é€€å›ä¸»æœº</span></span><br></pre></td></tr></table></figure><p><strong>é€€å‡ºå®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span> <span class="comment"># åœæ­¢å®¹å™¨å¹¶é€€å‡º</span></span><br><span class="line">ctrl + p + q  <span class="comment">#é€€å‡ºå®¹å™¨ä¸åœæ­¢</span></span><br></pre></td></tr></table></figure><p><strong>åˆ—å‡ºæ‰€æœ‰è¿è¡Œå®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker ps å‘½ä»¤</span><br><span class="line"><span class="comment"># åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">-a  <span class="comment"># åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„+å†å²è¿è¡Œè¿‡çš„å®¹å™¨</span></span><br><span class="line">-n=? <span class="comment">#æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨</span></span><br><span class="line">-q <span class="comment"># åªæ˜¾ç¤ºå®¹å™¨çš„ä¸ç¼–å·</span></span><br><span class="line"></span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker ps  </span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                      PORTS               NAMES</span><br><span class="line">02861391cd3a        centos              <span class="string">&quot;/bin/bash&quot;</span>         About a minute ago   Exited (0) 41 seconds ago                       brave_wright</span><br><span class="line">67d2c31f379c        bf756fb1ae65        <span class="string">&quot;/hello&quot;</span>            48 minutes ago       Exited (0) 48 minutes ago                       exciting_mirzakhani</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤å®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> å®¹å™¨<span class="built_in">id</span> <span class="comment"># åˆ é™¤æŒ‡å®šå®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> -f $(docker ps -aq) <span class="comment">#åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker ps -aq | xargs docker <span class="built_in">rm</span> <span class="comment">#åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start å®¹å™¨<span class="built_in">id</span><span class="comment">#å¯åŠ¨å®¹å™¨</span></span><br><span class="line">docker restart  å®¹å™¨<span class="built_in">id</span><span class="comment"># é‡å¯å®¹å™¨</span></span><br><span class="line">docker stop  å®¹å™¨<span class="built_in">id</span> <span class="comment"># åœæ­¢å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">kill</span>  å®¹å™¨<span class="built_in">id</span><span class="comment"># å¼ºåˆ¶åœæ­¢å®¹å™¨</span></span><br></pre></td></tr></table></figure><p><strong>åå°å¯åŠ¨å®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d centos</span><br><span class="line"></span><br><span class="line"><span class="comment"># é—®é¢˜ docker ps å‘ç°å®¹å™¨åœæ­¢äº†</span></span><br><span class="line"><span class="comment"># å¸¸è§çš„é—®é¢˜ï¼Œdockerå®¹å™¨åå°è¿è¡Œï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œdockerå‘ç°æ²¡æœ‰å¯¹å¤–æä¾›æœåŠ¡çš„åº”ç”¨ï¼Œå°±ä¼šåœæ­¢</span></span><br><span class="line"><span class="comment"># nginxï¼Œå®¹å™¨å¯åŠ¨åï¼Œå‘ç°è‡ªå·±æ²¡æœ‰æä¾›æœåŠ¡ï¼Œå°±ä¼šç«‹åˆ»åœæ­¢ï¼Œå°±æ˜¯æ²¡æœ‰ç¨‹åºäº†</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ—¥å¿—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker logs</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ—¥å¿—</span></span><br><span class="line">docker logs -tf --<span class="built_in">tail</span> 10 19d1483e6662</span><br><span class="line">-tf   <span class="comment"># æ˜¾ç¤ºæ—¥å¿—</span></span><br><span class="line">--<span class="built_in">tail</span> number  <span class="comment"># è¦æ˜¾ç¤ºæ—¥å¿—çš„è·³æ•°</span></span><br><span class="line"><span class="comment"># è‡ªå·±å†™ä¸€æ®µè„šæœ¬</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹å®¹å™¨ä¸­è¿›ç¨‹ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤ docker top å®¹å™¨id</span></span><br><span class="line">[root@centos7vm docker]<span class="comment">#  docker top 19d1483e6662</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                21885               21867               0                   17:02               ?                   00:00:00            /bin/sh -c <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> <span class="built_in">echo</span> 123;<span class="built_in">sleep</span> 1;<span class="keyword">done</span></span><br><span class="line">root                22090               21885               0                   17:04               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=<span class="built_in">sleep</span> /usr/bin/sleep 1</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹é•œåƒå…ƒæ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm docker]<span class="comment"># docker inspect --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br><span class="line"></span><br><span class="line">Return low-level information on Docker objects</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -f, --format string   Format the output using the given Go template</span><br><span class="line">  -s, --size            Display total file sizes <span class="keyword">if</span> the <span class="built_in">type</span> is container</span><br><span class="line">      --<span class="built_in">type</span> string     Return JSON <span class="keyword">for</span> specified <span class="built_in">type</span></span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">19d1483e6662        centos              <span class="string">&quot;/bin/sh -c &#x27;while tâ€¦&quot;</span>   4 minutes ago       Up 4 minutes                            confident_murdock</span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker inspect 19d1483e6662</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;19d1483e66621a38c4e175b4c4615adb3427eaaa07a632f3fa5835ff264a639a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2020-11-08T09:02:27.513000805Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">            <span class="string">&quot;while true;do echo 123;sleep 1;done&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: 21885,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2020-11-08T09:02:28.217868188Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/19d1483e66621a38c4e175b4c4615adb3427eaaa07a632f3fa5835ff264a639a/resolv.conf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/19d1483e66621a38c4e175b4c4615adb3427eaaa07a632f3fa5835ff264a639a/hostname&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/19d1483e66621a38c4e175b4c4615adb3427eaaa07a632f3fa5835ff264a639a/hosts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;LogPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/19d1483e66621a38c4e175b4c4615adb3427eaaa07a632f3fa5835ff264a639a/19d1483e66621a38c4e175b4c4615adb3427eaaa07a632f3fa5835ff264a639a-json.log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;/confident_murdock&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RestartCount&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Platform&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;MountLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ProcessLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AppArmorProfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ExecIDs&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Binds&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;ContainerIDFile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LogConfig&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Config&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PortBindings&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaximumRetryCount&quot;</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;AutoRemove&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;VolumeDriver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;VolumesFrom&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapDrop&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Capabilities&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Dns&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsOptions&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsSearch&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;ExtraHosts&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;GroupAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;IpcMode&quot;</span>: <span class="string">&quot;private&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Cgroup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomScoreAdj&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;PidMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Privileged&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PublishAllPorts&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ReadonlyRootfs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;SecurityOpt&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;UTSMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;UsernsMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ShmSize&quot;</span>: 67108864,</span><br><span class="line">            <span class="string">&quot;Runtime&quot;</span>: <span class="string">&quot;runc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ConsoleSize&quot;</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Isolation&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Memory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CgroupParent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;BlkioWeight&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;BlkioWeightDevice&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Devices&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DeviceCgroupRules&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;DeviceRequests&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;KernelMemory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;KernelMemoryTCP&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemoryReservation&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwap&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwappiness&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomKillDisable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PidsLimit&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Ulimits&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumIOps&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumBandwidth&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MaskedPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/asound&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/acpi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/kcore&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/keys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/latency_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_list&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sched_debug&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/scsi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;ReadonlyPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/bus&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/fs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/irq&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/86b18b8dd45c45fd5ed8e6d2ed808c689e9061e61c6526c055637d349d4f98dc-init/diff:/var/lib/docker/overlay2/b61e299d2bb31a1fb57bbdf890f6d559b1a92394e98c4b2463c1e0c34ed37341/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/86b18b8dd45c45fd5ed8e6d2ed808c689e9061e61c6526c055637d349d4f98dc/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/86b18b8dd45c45fd5ed8e6d2ed808c689e9061e61c6526c055637d349d4f98dc/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/86b18b8dd45c45fd5ed8e6d2ed808c689e9061e61c6526c055637d349d4f98dc/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;19d1483e6662&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">                <span class="string">&quot;while true;do echo 123;sleep 1;done&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;centos&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;org.label-schema.build-date&quot;</span>: <span class="string">&quot;20200809&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.license&quot;</span>: <span class="string">&quot;GPLv2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.name&quot;</span>: <span class="string">&quot;CentOS Base Image&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.schema-version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.vendor&quot;</span>: <span class="string">&quot;CentOS&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SandboxID&quot;</span>: <span class="string">&quot;06d26833c3845620a37f361cda733999dba841c8f80bd14691d7a6275e2f0430&quot;</span>,</span><br><span class="line">            <span class="string">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Ports&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/06d26833c384&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SecondaryIPAddresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;SecondaryIPv6Addresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;990d153ba0bf1db91808560d3f87069dda4a2d98f8d614bf50dcde4e9e95d9a2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">            <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;8c37dffaecb4dec076d5745cb032f23a991ec67976c1e2ae78e837d60075d48c&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;990d153ba0bf1db91808560d3f87069dda4a2d98f8d614bf50dcde4e9e95d9a2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>è¿›å…¥å½“å‰è¿è¡Œçš„å®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¹å™¨é€šå¸¸éƒ½æ˜¯åå°è¿è¡Œï¼Œéœ€è¦è¿›å…¥å®¹å™¨ä¿®æ”¹ä¸€äº›é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½ä»¤</span></span><br><span class="line"><span class="comment"># æ–¹å¼ä¸€</span></span><br><span class="line">docker <span class="built_in">exec</span> -it å®¹å™¨<span class="built_in">id</span> bashshell</span><br><span class="line">[root@centos7vm docker]<span class="comment"># docker exec -it 19d1483e6662 /bin/bash</span></span><br><span class="line">[root@19d1483e6662 /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@19d1483e6662 /]<span class="comment"># ps -ef</span></span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 09:02 ?        00:00:00 /bin/sh -c <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> <span class="built_in">echo</span> 123;<span class="built_in">sleep</span> 1;<span class="keyword">done</span></span><br><span class="line">root        448      0  0 09:09 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        465      1  0 09:09 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=<span class="built_in">sleep</span> /usr/bin/sleep 1</span><br><span class="line">root        466    448  3 09:09 pts/0    00:00:00 ps -ef</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼äºŒ</span></span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">docker attach -it 19d1483e6662</span><br><span class="line">æ­£åœ¨æ‰§è¡Œçš„ä»£ç ....</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒºåˆ«</span></span><br><span class="line"><span class="comment"># docker exec  # è¿›å…¥å®¹å™¨åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ“ä½œ</span></span><br><span class="line"><span class="comment"># docker attach# è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹</span></span><br></pre></td></tr></table></figure><p><strong>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„   ç›®çš„ä¸»æœºè·¯å¾„</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨å†…éƒ¨</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">df42673d50f2        centos              <span class="string">&quot;/bin/bash&quot;</span>         28 seconds ago      Up 25 seconds                           magical_jones</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker attach df42673d50f2</span></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªæ–‡ä»¶æµ‹è¯•ï¼Œå°†æ–‡ä»¶copyå‡ºæ¥</span></span><br><span class="line">[root@df42673d50f2 /]<span class="comment"># touch test.java</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker cp df42673d50f2:/test.java ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copyæ˜¯ä¸€ä¸ªæ‰‹åŠ¨è¿‡ç¨‹ï¼Œæœªæ¥ä½¿ç”¨å·çš„æŠ€æœ¯æ¥å¯¹è·¯å¾„åšæ˜ å°„</span></span><br></pre></td></tr></table></figure><h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><h3 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h3><hr><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108501.png" alt="image-20201108173050520"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æœç´¢é•œåƒ   å»ºè®®åœ¨Docker Hubä¸Šæœç´¢  èƒ½å¤Ÿçœ‹åˆ°è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker search -f stars=1000 nginx</span></span><br><span class="line">NAME                  DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">nginx                 Official build of Nginx.                        13977               [OK]                </span><br><span class="line">jwilder/nginx-proxy   Automated Nginx reverse proxy <span class="keyword">for</span> docker conâ€¦   1906                                    [OK]</span><br><span class="line"><span class="comment"># 2. ä¸‹è½½é•œåƒ</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker pull nginx</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">bb79b6b2107f: Pull complete </span><br><span class="line">5a9f1c0027a7: Pull complete </span><br><span class="line">b5c20b2b484f: Pull complete </span><br><span class="line">166a2418f7e8: Pull complete </span><br><span class="line">1966ea362d23: Pull complete </span><br><span class="line">Digest: sha256:aeade65e99e5d5e7ce162833636f692354c227ff438556e5f3ed0335b7cc2f1b</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line"><span class="comment"># 3. å¯åŠ¨å®¹å™¨</span></span><br><span class="line">-d<span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line">--name <span class="comment"># ä¸ºå®¹å™¨èµ·åå­—</span></span><br><span class="line">-p <span class="comment"># æš´éœ²ç«¯å£   å®¿ä¸»æœºç«¯å£ï¼šå®¹å™¨å†…éƒ¨ç«¯å£</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d --name nginx01 -p 3344:80 nginx</span></span><br><span class="line">cb3b7175c1b43ee40bd2f398ed24854eb1a487ee305cec13735603ed5ab8c8e6</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">cb3b7175c1b4        nginx               <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   6 seconds ago       Up 4 seconds        0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="comment"># 4. è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> nginx01 /bin/bash</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…tomcat"><a href="#å®‰è£…tomcat" class="headerlink" title="å®‰è£…tomcat"></a>å®‰è£…tomcat</h3><hr><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®˜æ–¹çš„ä½¿ç”¨</span></span><br><span class="line">$ docker run -it --<span class="built_in">rm</span> tomcat:9.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬ä¹‹å‰çš„å¯åŠ¨éƒ½æ˜¯åå°ï¼Œåœæ­¢äº†å®¹å™¨åï¼Œå®¹å™¨è¿˜æ˜¯å¯ä»¥æŸ¥åˆ°  docker run -it --rmï¼Œ ä¸€èˆ¬ç”¨æ¥æµ‹è¯•ï¼Œç”¨å®Œå³åˆ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½å†å¯åŠ¨</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -p 3355:8080 --name tomcat01 tomcat</span></span><br><span class="line"><span class="comment"># æµ‹è¯•è®¿é—®æ²¡æœ‰é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec -it tomcat01 /bin/bash</span></span><br><span class="line"><span class="comment"># linuxå‘½ä»¤å°‘ã€æ²¡æœ‰webapps   é»˜è®¤æ˜¯æœ€å°çš„é•œåƒï¼Œä¸å¿…è¦çš„éƒ½å‰”é™¤</span></span><br><span class="line"><span class="comment"># ä¿è¯æœ€å°å¯è¿è¡Œçš„ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²es-kibana"><a href="#éƒ¨ç½²es-kibana" class="headerlink" title="éƒ¨ç½²es+kibana"></a>éƒ¨ç½²es+kibana</h3><hr><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># eså å†…å­˜å¤š</span></span><br><span class="line"><span class="comment"># esæš´éœ²ç«¯å£å¤š</span></span><br><span class="line"><span class="comment"># esçš„æ•°æ®ä¸€èˆ¬éœ€è¦æ”¾ç½®åˆ°å®‰å…¨ç›®å½• æŒ‚è½½</span></span><br><span class="line"><span class="comment"># --net somenetwork ç½‘ç»œé…ç½®</span></span><br><span class="line">$ docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨elasticsearch</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker statsæŸ¥çœ‹CPUçŠ¶æ€</span></span><br><span class="line">docker stats</span><br><span class="line"><span class="comment"># å¢åŠ å†…å­˜çš„é™åˆ¶  -eå‚æ•°è¿›è¡Œç¯å¢ƒä¿®æ”¹</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=<span class="string">&quot;-Xms64m -Xmx512m&quot;</span> elasticsearch</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108534.png" alt="image-20201108180804691"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm ~]<span class="comment"># curl localhost:9211</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;UrvHV2Q&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;NHWT8qNERMe9UhNZSUSGpw&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;5.6.12&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;cfe3d9f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2018-09-10T20:12:43.732Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;6.6.1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h2><ul><li>portainer</li><li>Rancher(CI&#x2F;CDå†ç”¨)</li></ul><p>ä»€ä¹ˆæ˜¯portainerï¼Ÿ</p><p>Dockerå›¾å½¢åŒ–ç•Œé¢ç®¡ç†å·¥å…·ï¼Œæä¾›ä¸€ä¸ªåå°é¢æ¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer-ce</span></span><br></pre></td></tr></table></figure><h2 id="commit-é•œåƒ"><a href="#commit-é•œåƒ" class="headerlink" title="commit é•œåƒ"></a>commit é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit æäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„å‰¯æœ¬</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘½ä»¤å’Œgitç±»ä¼¼</span></span><br><span class="line">docker commit -m=&quot;æäº¤çš„æè¿°ä¿¡æ¯&quot; -a=&quot;ä½œè€…&quot; å®¹å™¨ID  ç›®æ ‡é•œåƒåï¼š[TAG]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç»ƒä¹ </strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨ä¸€ä¸ªé»˜è®¤çš„tomcat</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é»˜è®¤çš„tomcatæ²¡æœ‰webappsåº”ç”¨ï¼Œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è‡ªå·±å°†webapps.distå†…å®¹æ‹·è´è¿›å»</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡commitæäº¤äº†ä¸€ä¸ªæ–°çš„é•œåƒ</span></span><br><span class="line">docker commit -a=&quot;halfcoke&quot; -m=&quot;add webapps app&quot; å®¹å™¨ID tomcat01:1.1</span><br><span class="line"></span><br><span class="line">[root@centos7vm ~]# docker commit -a=&quot;halfcoke&quot; -m=&quot;add webapps app&quot; d59f955ed1ac tomcat_test:1.0</span><br><span class="line">sha256:8119e221b3f258d762ca461759af00417f2ea2e3d6eccf0b7dee850c5cb7ee53</span><br><span class="line">[root@centos7vm ~]# docker images</span><br><span class="line">REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tomcat_test              1.0                 8119e221b3f2        7 seconds ago       653MB</span><br><span class="line">tomcat                   9.0                 dab3cf97dd54        39 hours ago        648MB</span><br><span class="line">tomcat                   latest              dab3cf97dd54        39 hours ago        648MB</span><br></pre></td></tr></table></figure><h2 id="å®¹å™¨æ•°æ®å·"><a href="#å®¹å™¨æ•°æ®å·" class="headerlink" title="å®¹å™¨æ•°æ®å·"></a>å®¹å™¨æ•°æ®å·</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°æ®å·"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®å·" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®å·"></a>ä»€ä¹ˆæ˜¯æ•°æ®å·</h3><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108967.png" alt="image-20201108195121399"></p><p>å®¹å™¨å†…çš„ç›®å½•æ˜ å°„åˆ°å¤–éƒ¨ç›®å½•ï¼Œä¸ºäº†å®¹å™¨çš„æŒä¹…åŒ–å’ŒåŒæ­¥æ“ä½œï¼Œå®¹å™¨é—´æ•°æ®èƒ½å¤Ÿå…±äº«</p><h3 id="ä½¿ç”¨æ•°æ®å·"><a href="#ä½¿ç”¨æ•°æ®å·" class="headerlink" title="ä½¿ç”¨æ•°æ®å·"></a>ä½¿ç”¨æ•°æ®å·</h3><p><strong>æ–¹å¼ä¸€</strong>ï¼šä½¿ç”¨å‘½ä»¤æŒ‚è½½ -v</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v ä¸»æœºç›®å½•ï¼šå®¹å™¨å†…ç›®å½• -p ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£</span><br><span class="line"> </span><br><span class="line">docker run -it -v /root/test:/home centos /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡inspect æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</span></span><br><span class="line">docker inspect å®¹å™¨id</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108732.png" alt="image-20201108195708778"></p><p>å…¶ä¸­sourceæ˜¯ä¸»æœºå†…çš„åœ°å€ï¼ŒDestinationæ˜¯å®¹å™¨å†…çš„åœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æµ‹è¯•</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108813.png" alt="image-20201108200240055"></p><p>ä¹‹åä¿®æ”¹ç›´æ¥åœ¨æœ¬åœ°ä¿®æ”¹</p><p><strong>ç»ƒä¹ </strong> <strong>å®‰è£…mysql</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½é•œåƒ</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker pull mysql:5.7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®˜æ–¹æµ‹è¯•</span></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨ï¼Œéœ€è¦æ•°æ®æŒ‚è½½</span></span><br><span class="line">-d åå°è¿è¡Œ</span><br><span class="line">-e ç¯å¢ƒé…ç½®</span><br><span class="line">--name åå­—</span><br><span class="line">-v å·æŒ‚è½½</span><br><span class="line">-p ç«¯å£æ˜ å°„</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -p 3310:3306 -v /root/mysql/conf:/etc/mysql/conf.d -v /root/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123 --name mysql01 mysql:5.7</span></span><br><span class="line"><span class="comment"># å¯åŠ¨æˆåŠŸåï¼Œé“¾æ¥æµ‹è¯•</span></span><br><span class="line"><span class="comment"># å®¹å™¨åˆ é™¤åï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</span></span><br></pre></td></tr></table></figure><h3 id="å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½"><a href="#å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½" class="headerlink" title="å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½"></a>å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒ¿åæŒ‚è½½</span></span><br><span class="line">-v å®¹å™¨å†…è·¯å¾„</span><br><span class="line">-P éšæœºæŒ‡å®šç«¯å£</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æŒ‚è½½çš„å·</span></span><br><span class="line">docker volume --<span class="built_in">help</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker volume --help</span></span><br><span class="line"></span><br><span class="line">Usage:docker volume COMMAND</span><br><span class="line"></span><br><span class="line">Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a volume</span><br><span class="line">  inspect     Display detailed information on one or more volumes</span><br><span class="line">  <span class="built_in">ls</span>          List volumes</span><br><span class="line">  prune       Remove all unused <span class="built_in">local</span> volumes</span><br><span class="line">  <span class="built_in">rm</span>          Remove one or more volumes</span><br><span class="line"></span><br><span class="line">Run <span class="string">&#x27;docker volume COMMAND --help&#x27;</span> <span class="keyword">for</span> more information on a <span class="built_in">command</span>.</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„å·çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment"># è¿™é‡Œå‘ç°volume nameéƒ½æ˜¯åŠ å¯†åçš„ï¼Œæ²¡æœ‰æŒ‡å®šå®¹å™¨å¤–çš„è·¯å¾„ï¼Œå°±æ˜¯åŒ¿åæŒ‚è½½</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               4ec45c6cdf92869673d25a42192fb0fe4d272e90343a4ca55650364e4ffda7fc</span><br><span class="line"><span class="built_in">local</span>               5b4a7949963490b29a916aec8dbac7e552bbf915fb3863da2902475d2c9483c2</span><br><span class="line"><span class="built_in">local</span>               5dfa3b399cff8cc630c709e738ace5feacd91085f0e2aad61f7cc7353abf3fa1</span><br><span class="line"><span class="built_in">local</span>               d5cdb69a6cc404ebb990956c8c8132e589010d1176e3a0a4bf3624992f74c236</span><br><span class="line"><span class="built_in">local</span>               f258608b52225ead6f764860b476f188cd1794e1533e667953fb6b98855b09ee</span><br><span class="line"><span class="built_in">local</span>               fece1a11094a2f65d572ea20c0e2561efc4a738a9a84667f5f6d5d9d0bf9a6a8</span><br><span class="line"><span class="comment"># å¯ä»¥ç›´æ¥ä»¥  åå­—:å®¹å™¨å†…è·¯å¾„ çš„æ–¹å¼æŒ‡å®šæ•°æ®å·æŒ‚è½½ï¼Œè¿™å°±æ˜¯å…·åæŒ‚è½½</span></span><br><span class="line"><span class="comment"># docker -v å·åï¼šå®¹å™¨å†…è·¯å¾„</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -P --name nginx02 -v juming:/etc/nginx nginx</span></span><br><span class="line">7dba2abd87dfd70ea89c957b03dd797a3b9a8ae9597ed478dc22155c4676eb05</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               4ec45c6cdf92869673d25a42192fb0fe4d272e90343a4ca55650364e4ffda7fc</span><br><span class="line"><span class="built_in">local</span>               5b4a7949963490b29a916aec8dbac7e552bbf915fb3863da2902475d2c9483c2</span><br><span class="line"><span class="built_in">local</span>               5dfa3b399cff8cc630c709e738ace5feacd91085f0e2aad61f7cc7353abf3fa1</span><br><span class="line"><span class="built_in">local</span>               d5cdb69a6cc404ebb990956c8c8132e589010d1176e3a0a4bf3624992f74c236</span><br><span class="line"><span class="built_in">local</span>               f258608b52225ead6f764860b476f188cd1794e1533e667953fb6b98855b09ee</span><br><span class="line"><span class="built_in">local</span>               fece1a11094a2f65d572ea20c0e2561efc4a738a9a84667f5f6d5d9d0bf9a6a8</span><br><span class="line"><span class="built_in">local</span>               juming</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡docker volume inspect æ¥æŸ¥çœ‹å·åçš„å…·ä½“ä½ç½®</span></span><br><span class="line"><span class="comment"># åœ¨æ²¡æœ‰æŒ‡å®šç›®å½•çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯åœ¨/var/lib/docker/volumes/xxxx/_data</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬é€šè¿‡å…·åæŒ‚è½½å¯ä»¥æ–¹ä¾¿çš„æ‰¾ä¸€ä¸ªå·ï¼Œå¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯å…·åæŒ‚è½½</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker volume inspect juming</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2020-11-08T20:25:02+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/juming/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;juming&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">-v å®¹å™¨å†…è·¯å¾„  <span class="comment"># åŒ¿åæŒ‚è½½</span></span><br><span class="line">-v å·åï¼šå®¹å™¨å†…è·¯å¾„ <span class="comment"># å…·åæŒ‚è½½</span></span><br><span class="line">-v /å®¿ä¸»æœºè·¯å¾„ï¼šå®¹å™¨è·¯å¾„  <span class="comment"># æŒ‡å®šè·¯å¾„æŒ‚è½½</span></span><br></pre></td></tr></table></figure><p>æ‹“å±•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡ -v å®¹å™¨å†…è·¯å¾„  ro rw æ”¹å˜è¯»å†™æƒé™</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€æ—¦è®¾ç½®äº†å®¹å™¨æƒé™ï¼Œå®¹å™¨å¯¹æˆ‘ä»¬æŒ‚è½½å‡ºæ¥çš„å†…å®¹å°±æœ‰é™å®šäº†</span></span><br><span class="line">[root@centos7vm ~]# docker run -d -P --name nginx02 -v juming:/etc/nginx:ro nginx</span><br><span class="line">[root@centos7vm ~]# docker run -d -P --name nginx02 -v juming:/etc/nginx:rw nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">roåªèƒ½ä»å¤–éƒ¨æ”¹å˜ï¼Œåªèƒ½ä»å®¿ä¸»æœºä¿®æ”¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rwåˆ™å¯è¯»å¯å†™</span></span><br></pre></td></tr></table></figure><h3 id="åˆè¯†DockerFile"><a href="#åˆè¯†DockerFile" class="headerlink" title="åˆè¯†DockerFile"></a>åˆè¯†DockerFile</h3><p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨DockerFileæŒ‚è½½</strong></p><p>é€šè¿‡dokerFileè¿™ä¸ªè„šæœ¬å¯ä»¥ç”Ÿæˆé•œåƒï¼Œæ¯ä¸ªå‘½ä»¤éƒ½æ˜¯ä¸€å±‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim dockerfile01å†…å®¹</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>]</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;----------end------------&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="comment"># ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆé•œåƒ</span></span><br><span class="line">-f æŒ‡å®šä»é‚£ä¸ªæ–‡ä»¶ç”Ÿæˆ</span><br><span class="line">-t é•œåƒå</span><br><span class="line">. ä½ç½®</span><br><span class="line">[root@centos7vm docker-test-volume]<span class="comment"># docker build -f dockerfile1 -t test_os/centos:1.0 .</span></span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"> ---&gt; 0d120b6ccaa8</span><br><span class="line">Step 2/4 : VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 6e98aba39de7</span><br><span class="line">Removing intermediate container 6e98aba39de7</span><br><span class="line"> ---&gt; e2b73d377118</span><br><span class="line">Step 3/4 : CMD <span class="built_in">echo</span> <span class="string">&quot;----------end------------&quot;</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> b36b63a3e0e8</span><br><span class="line">Removing intermediate container b36b63a3e0e8</span><br><span class="line"> ---&gt; f5f1b57f30fa</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> f5ac620b0aac</span><br><span class="line">Removing intermediate container f5ac620b0aac</span><br><span class="line"> ---&gt; 22cd294f67ad</span><br><span class="line">Successfully built 22cd294f67ad</span><br><span class="line">Successfully tagged test_os/centos:1.0</span><br><span class="line"><span class="comment"># æ‰§è¡Œè‡ªå·±çš„é•œåƒ</span></span><br><span class="line">[root@centos7vm docker-test-volume]<span class="comment"># docker run -it 22cd294f67ad /bin/bash</span></span><br><span class="line">[root@08b42c895f34 /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01volume02</span><br><span class="line"><span class="comment"># æœ€åé¢ä¸¤ä¸ªæ–‡ä»¶å¤¹å°±æ˜¯è‡ªåŠ¨æŒ‚è½½çš„æ•°æ®å·ç›®å½•</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åä¸¤ä¸ªå·ä¸€å®šä¸å¤–éƒ¨æœ‰åŒæ­¥çš„ã€‚</p><p>æ²¡æœ‰å†™åå­—ï¼Œè¿™æ˜¯åŒ¿åæŒ‚è½½</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108237.png" alt="image-20201108210619365"></p><p>æŸ¥çœ‹å®¹å™¨å±æ€§ï¼Œç¡®å®šæ˜¯åŒ¿åæŒ‚è½½</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310108658.png" alt="image-20201108210750028"></p><p>è¿™ç§ä½¿ç”¨æ–¹å¼éå¸¸å¤šï¼Œå¦‚æœæ„å»ºé•œåƒçš„æ—¶å€™æ²¡æœ‰æŒ‚è½½ï¼Œå°±è¦æ‰‹åŠ¨æŒ‚è½½ -v å·å:å®¹å™¨å†…è·¯å¾„ã€‚</p><h3 id="æ•°æ®å·å®¹å™¨"><a href="#æ•°æ®å·å®¹å™¨" class="headerlink" title="æ•°æ®å·å®¹å™¨"></a>æ•°æ®å·å®¹å™¨</h3><p>ä¸¤ä¸ªmysqlä¹‹é—´åŒæ­¥æ•°æ®</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109275.png" alt="image-20201108211127849"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨å®¹å™¨ï¼Œé€šè¿‡è‡ªå·±å†™çš„é•œåƒå¯åŠ¨</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109026.png" alt="image-20201108211313942"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†æ–°å»ºä¸€ä¸ªå®¹å™¨ï¼Œä»docker01ä¸­ç»§æ‰¿æ•°æ®å·</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -it --name docker02 --volumes-from docker01 test_os/centos:1.0</span></span><br><span class="line">åŒä¸€ä¸ªç›®å½•æ•°æ®å¯ä»¥åŒæ­¥</span><br><span class="line"></span><br><span class="line">è¿™é‡Œé¢docker01å°±å«åšæ•°æ®å·å®¹å™¨</span><br></pre></td></tr></table></figure><p>å¤šä¸ªmysqlæ•°æ®å…±äº«</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -p 3310:3306 --volumes-from mysql01 -e MYSQL_ROOT_PASSWORD=123 --name mysql01 mysql:5.7</span></span><br></pre></td></tr></table></figure><h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><hr><h3 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h3><p>DockerFileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ç§å‘½ä»¤å‚æ•°è„šæœ¬</p><p>æ„å»ºæ­¥éª¤ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªdockerfileæ–‡ä»¶</li><li>docker buildæ„å»ºæˆä¸ºä¸€ä¸ªé•œåƒ</li><li>docker run è¿è¡Œé•œåƒ</li><li>docker push å‘å¸ƒé•œåƒ(Docker Hubã€é˜¿é‡Œäº‘é•œåƒä»“åº“)</li></ol><h3 id="dockerfileæ„å»ºè¿‡ç¨‹"><a href="#dockerfileæ„å»ºè¿‡ç¨‹" class="headerlink" title="dockerfileæ„å»ºè¿‡ç¨‹"></a>dockerfileæ„å»ºè¿‡ç¨‹</h3><p><strong>åŸºç¡€çŸ¥è¯†ï¼š</strong></p><ol><li>ä¿ç•™å…³é”®å­—(æŒ‡ä»¤)éƒ½å¿…é¡»æ˜¯å¤§å†™å­—æ¯</li><li>æŒ‡ä»¤é¡ºåºæ‰§è¡Œ</li><li># è¡¨ç¤ºæ³¨é‡Š</li><li>æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½æ˜¯ä¸€ä¸ªé•œåƒå±‚</li></ol><p>DockerFileæ˜¯é¢å‘å¼€å‘çš„ï¼Œä»¥åå‘å¸ƒé¡¹ç›®ï¼Œåšé•œåƒï¼Œå°±éœ€è¦ç¼–å†™dockerfileæ–‡ä»¶ã€‚</p><p>DockerFileï¼š æ„å»ºæ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€åˆ‡æ­¥éª¤ï¼Œæºä»£ç </p><p>DockerImagesï¼šé€šè¿‡DockerFileæ„å»ºç”Ÿæˆçš„é•œåƒï¼Œæœ€ç»ˆå‘å¸ƒå’Œè¿è¡Œçš„äº§å“</p><p>Dockerå®¹å™¨ï¼šå®¹å™¨å°±æ˜¯é•œåƒè¿è¡Œèµ·æ¥æä¾›æœåŠ¡çš„</p><p><strong>DockerFileå‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM <span class="comment"># åŸºç¡€é•œåƒï¼Œä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹æ„å»º</span></span><br><span class="line">MAINTAINER<span class="comment"># é•œåƒæ˜¯è°å†™çš„ï¼Œå§“å+é‚®ç®±</span></span><br><span class="line">RUN<span class="comment"># é•œåƒæ„å»ºçš„æ—¶å€™éœ€è¦è¿è¡Œçš„å‘½ä»¤</span></span><br><span class="line">ADD<span class="comment"># æ­¥éª¤ï¼štomcaté•œåƒï¼Œè¿™ä¸ªtomcatå‹ç¼©åŒ…ï¼Œæ·»åŠ å†…å®¹</span></span><br><span class="line">WORKDIR<span class="comment"># é•œåƒçš„å·¥ä½œç›®å½•   è¿›å…¥é•œåƒæ—¶çš„ç›®å½•</span></span><br><span class="line">VOLUME<span class="comment"># æŒ‚è½½çš„ç›®å½•ä½ç½®</span></span><br><span class="line">EXPOSE<span class="comment"># æš´éœ²ç«¯å£é…ç½®</span></span><br><span class="line">CMD<span class="comment"># æŒ‡å®šå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼ŒCMDåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œè€Œä¸”å¯è¢«æ›¿ä»£</span></span><br><span class="line">ENTRYPOINT   <span class="comment"># å®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥è¿½åŠ å‘½ä»¤  </span></span><br><span class="line"><span class="comment"># CMD ä¸ENTRYPOINT åŒºåˆ«ï¼Œæ¯”å¦‚è¯´   ls -l   å¦‚æœæ˜¯ä½¿ç”¨CMD å†™ls -a  åˆ™æ‰§è¡Œdocker run ä¼šæ›¿æ¢æ‰ls -l   å¦‚æœæ˜¯ENTRYPOINTåˆ™ä¼šå˜æˆ ls -a  ls -l ä¸‹é¢è¯¦ç»†ä»‹ç»</span></span><br><span class="line">ONBUILD <span class="comment"># å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿DockerFileçš„æ—¶å€™ï¼Œå°±ä¼šæ­˜ONBUILDæ‰§è¡Œï¼Œè§¦å‘æŒ‡ä»¤</span></span><br><span class="line">COPY <span class="comment">#  ç±»ä¼¼ADD,å°†æˆ‘ä»¬çš„æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­</span></span><br><span class="line">ENV <span class="comment"># æ„å»ºçš„æ—¶å€™ï¼Œè®¾ç½®çš„ç¯å¢ƒå˜é‡    </span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ”¾çš„å›¾ç‰‡æ¯”è¾ƒå¤šï¼Œæ›´å…¨é¢çš„å†™å±•ç¤ºå„ç§å‘½ä»¤</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109001.png" alt="image-20201108213930017"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109418.png" alt="image-20201108213418167"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109331.png" alt="image-20201108213512266"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109341.png" alt="image-20201108213536145"></p><h3 id="å®æˆ˜æµ‹è¯•"><a href="#å®æˆ˜æµ‹è¯•" class="headerlink" title="å®æˆ˜æµ‹è¯•"></a>å®æˆ˜æµ‹è¯•</h3><p>Docker Hubä¸­ç»å¤§å¤šæ•°é•œåƒéƒ½æ˜¯ä»åŸºç¡€é•œåƒè¿‡æ¥çš„FROM scratchï¼Œç„¶åé…ç½®éœ€è¦çš„è½¯ä»¶å’Œç¯å¢ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109369.png" alt="image-20201108214918038"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè‡ªå·±çš„centos</span></span><br><span class="line"><span class="comment"># 1. ç¼–å†™dockerfileæ–‡ä»¶</span></span><br><span class="line">[root@centos7vm dockerfile]<span class="comment"># cat mycentos.dockerfile </span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER halfcoke&lt;halfcoke@163.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line">CMD ECHO <span class="string">&quot;------END-----&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="comment"># 2. é€šè¿‡æ–‡ä»¶æ„å»ºé•œåƒ</span></span><br><span class="line">docker build -f mycentos.dockerfile -t mycentos:0.1 .</span><br><span class="line"><span class="comment"># 3. æµ‹è¯•è¿è¡Œä¸€ä¸‹</span></span><br></pre></td></tr></table></figure><h3 id="CMD-å’Œ-ENTRYPOINTåŒºåˆ«"><a href="#CMD-å’Œ-ENTRYPOINTåŒºåˆ«" class="headerlink" title="CMD å’Œ ENTRYPOINTåŒºåˆ«"></a>CMD å’Œ ENTRYPOINTåŒºåˆ«</h3><p>CMD åªæœ‰æœ€åä¸€ä¸ªCMDä¼šç”Ÿæ•ˆ</p><h4 id="æµ‹è¯•cmd"><a href="#æµ‹è¯•cmd" class="headerlink" title="æµ‹è¯•cmd"></a>æµ‹è¯•cmd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dockerfileæ–‡ä»¶å†…å®¹</span></span><br><span class="line">FROM centos</span><br><span class="line">CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]</span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒ</span></span><br><span class="line">docker build -f file -t cmdtest .</span><br><span class="line"><span class="comment"># è¿è¡Œç»“æœ</span></span><br><span class="line">[root@centos7vm dockerfile]<span class="comment"># docker run cmdtest</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">.........</span><br><span class="line"><span class="comment"># æƒ³è¿½åŠ ä¸€ä¸ªå‘½ä»¤ -l</span></span><br><span class="line">[root@centos7vm dockerfile]<span class="comment"># docker run cmdtest -l</span></span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused <span class="string">&quot;exec: \&quot;-l\&quot;: executable file not found in <span class="variable">$PATH</span>&quot;</span>: unknown.</span><br><span class="line">ERRO[0000] error waiting <span class="keyword">for</span> container: context canceled </span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•entrypoint"><a href="#æµ‹è¯•entrypoint" class="headerlink" title="æµ‹è¯•entrypoint"></a>æµ‹è¯•entrypoint</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dockerfileæ–‡ä»¶å†…å®¹</span></span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]</span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒ</span></span><br><span class="line">docker build -f file -t cmdtest .</span><br><span class="line"><span class="comment"># è¿è¡Œç»“æœ</span></span><br><span class="line"></span><br><span class="line">[root@centos7vm dockerfile]<span class="comment"># docker run entrytest</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">...............</span><br><span class="line"><span class="comment"># æƒ³è¿½åŠ ä¸€ä¸ªå‘½ä»¤ -l</span></span><br><span class="line">[root@centos7vm dockerfile]<span class="comment"># docker run entrytest -l</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   1 root root   6 Nov  8 14:08 .</span><br><span class="line">drwxr-xr-x   1 root root   6 Nov  8 14:08 ..</span><br><span class="line">-rwxr-xr-x   1 root root   0 Nov  8 14:08 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root   7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 340 Nov  8 14:08 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Nov  8 14:08 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 May 11  2019 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 May 11  2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 May 11  2019 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Aug  9 21:40 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 May 11  2019 media</span><br><span class="line">drwxr-xr-x   2 root root   6 May 11  2019 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 May 11  2019 opt</span><br><span class="line">dr-xr-xr-x 301 root root   0 Nov  8 14:08 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Aug  9 21:40 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Aug  9 21:40 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 May 11  2019 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 May 11  2019 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Nov  8 13:12 sys</span><br><span class="line">drwxrwxrwt   7 root root 145 Aug  9 21:40 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Aug  9 21:40 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Aug  9 21:40 var</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ ï¼šTomCaté•œåƒ"><a href="#ç»ƒä¹ ï¼šTomCaté•œåƒ" class="headerlink" title="ç»ƒä¹ ï¼šTomCaté•œåƒ"></a>ç»ƒä¹ ï¼šTomCaté•œåƒ</h3><ol><li><p>å‡†å¤‡å‹ç¼©æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109751.png" alt="image-20201109103657554"></p></li><li><p>ç¼–å†™Dockerfileæ–‡ä»¶ å®˜æ–¹å‘½å<code>Dockerfile</code>ï¼Œbuildå°±ä¼šè‡ªåŠ¨å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œä¸éœ€è¦<code>-f</code>æŒ‡å®š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER halcoke&lt;halfcoke@163.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u271-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.39.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_271</span><br><span class="line">ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.39</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.39</span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.39/bin/startup.sh &amp;&amp; <span class="built_in">tail</span> -F /usr/localapache-tomcat-9.0.39/bin/logs/catalina.out</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æ„å»ºé•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t diytomcat .</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨é•œåƒ</p></li><li><p>è®¿é—®æµ‹è¯•</p></li><li><p>å‘å¸ƒé¡¹ç›®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;èœé¸Ÿæ•™ç¨‹(runoob.com)&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Hello World!&lt;br/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">out.println(<span class="string">&quot;ä½ çš„ IP åœ°å€ &quot;</span> + request.getRemoteAddr());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="å‘å¸ƒé•œåƒ"><a href="#å‘å¸ƒé•œåƒ" class="headerlink" title="å‘å¸ƒé•œåƒ"></a>å‘å¸ƒé•œåƒ</h3><p><strong>å‘å¸ƒåˆ°é˜¿é‡Œäº‘</strong></p><p>å‚è€ƒé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109789.png" alt="image-20201109135918607"></p></li></ol><h2 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h2><hr><h3 id="ç†è§£Docker0"><a href="#ç†è§£Docker0" class="headerlink" title="ç†è§£Docker0"></a>ç†è§£Docker0</h3><p>dockerç”Ÿæˆçš„ç½‘å¡</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201109140804266.png" alt="image-20201109140804266"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker æ˜¯å¦‚ä½•å¤„ç†ç½‘ç»œé“¾æ¥çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„ipåœ°å€  ip addrï¼Œ å‘ç°å®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šå¾—åˆ°ä¸€ä¸ªeth0@if97ipåœ°å€</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -P --name tomcat01 tomcat</span></span><br><span class="line">Unable to find image <span class="string">&#x27;tomcat:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">e4c3d3e4f7b0: Pull complete </span><br><span class="line">101c41d0463b: Pull complete </span><br><span class="line">8275efcd805f: Pull complete </span><br><span class="line">751620502a7a: Pull complete </span><br><span class="line">a59da3a7d0e7: Pull complete </span><br><span class="line">9c0f1dffe039: Pull complete </span><br><span class="line">474314d81831: Pull complete </span><br><span class="line">90ee5d998c5c: Pull complete </span><br><span class="line">a79c7e2a85e1: Pull complete </span><br><span class="line">1e48dd1bb576: Pull complete </span><br><span class="line">Digest: sha256:ad82afe54f2aa67167e873162578a751aed3173e42250a9ed68f306aa4b83025</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> tomcat:latest</span><br><span class="line">04c9ac8b93a7efd8c19b0932bcfe5803be94d059fb6f365dd47d2ee63e935fe8</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec -it 04c9a /bin/bash</span></span><br><span class="line">root@04c9ac8b93a7:/usr/local/tomcat<span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">96: eth0@if97: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">root@04c9ac8b93a7:/usr/local/tomcat<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># linuxèƒ½å¤Ÿpingé€šå®¹å™¨å†…éƒ¨</span></span><br></pre></td></tr></table></figure><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><ol><li><p>æ¯å¯åŠ¨ä¸€ä¸ªdockerå®¹å™¨ï¼Œdockerå°±ä¼šç»™dockerå®¹å™¨åˆ†é…ä¸€ä¸ªipï¼Œæˆ‘ä»¬åªè¦å®‰è£…äº†dockerï¼Œå°±ä¼šæœ‰ä¸€ä¸ªdocker0</p></li><li><p>å¯åŠ¨ä¸€ä¸ªå®¹å™¨åï¼Œä¼šå¤šå‡ºä¸€å¯¹ç½‘å¡ï¼Œå®¹å™¨å†…ä¸€ä¸ªï¼Œä¸»æœºä¸Šä¸€ä¸ª</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201109143414467.png" alt="image-20201109143414467"></p></li></ol><p>æˆ‘ä»¬å…ˆè¿™ä¸ªå®¹å™¨ç½‘å¡ï¼Œéƒ½æ˜¯ä¸€å¯¹ä¸€å¯¹çš„</p><p>evth-pairå°±æ˜¯ä¸€å¯¹è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œä»–ä»¬éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œ</p><p>evth-pairå……å½“ä¸€ä¸ªæ¡¥æ¢ï¼Œé“¾æ¥å„ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡</p><ol start="3"><li>ä¸¤ä¸ªå®¹å™¨ä¹‹é—´ä¹Ÿèƒ½å¤Ÿpingé€š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨tcpdump æŠ“åŒ…</span></span><br><span class="line">root@60f31d3cc794:/usr/local/tomcat<span class="comment"># tcpdump -i eth0</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">06:51:02.491361 ARP, Request who-has 172.17.0.3 tell 60f31d3cc794, length 28</span><br><span class="line">06:51:02.491396 ARP, Reply 172.17.0.3 is-at 02:42:ac:11:00:03 (oui Unknown), length 28</span><br><span class="line">06:51:02.491398 IP 60f31d3cc794 &gt; 172.17.0.3: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 371, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">06:51:02.491420 IP 172.17.0.3 &gt; 60f31d3cc794: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 371, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">06:51:02.491718 IP 60f31d3cc794.47353 &gt; 192.168.3.1.domain: 56068+ PTR? 3.0.17.172.in-addr.arpa. (41)</span><br><span class="line">06:51:02.502944 IP 192.168.3.1.domain &gt; 60f31d3cc794.47353: 56068 NXDomain* 0/1/0 (95)</span><br><span class="line">06:51:02.503226 IP 60f31d3cc794.52337 &gt; 192.168.3.1.domain: 16962+ PTR? 1.3.168.192.in-addr.arpa. (42)</span><br><span class="line">06:51:02.504061 IP 192.168.3.1.domain &gt; 60f31d3cc794.52337: 16962 NXDomain- 0/0/0 (42)</span><br><span class="line">06:51:03.494530 IP 60f31d3cc794 &gt; 172.17.0.3: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 371, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">06:51:03.494575 IP 172.17.0.3 &gt; 60f31d3cc794: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 371, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">06:51:07.501141 ARP, Request who-has 172.17.0.1 tell 60f31d3cc794, length 28</span><br><span class="line">06:51:07.501159 ARP, Request who-has 60f31d3cc794 tell 172.17.0.3, length 28</span><br><span class="line">06:51:07.501165 ARP, Reply 60f31d3cc794 is-at 02:42:ac:11:00:04 (oui Unknown), length 28</span><br><span class="line">06:51:07.501246 ARP, Reply 172.17.0.1 is-at 02:42:65:8d:e1:2b (oui Unknown), length 28</span><br><span class="line">06:51:07.501342 IP 60f31d3cc794.56205 &gt; 192.168.3.1.domain: 41516+ PTR? 1.0.17.172.in-addr.arpa. (41)</span><br><span class="line">06:51:07.507059 IP 192.168.3.1.domain &gt; 60f31d3cc794.56205: 41516 NXDomain* 0/1/0 (95)</span><br><span class="line">06:51:12.522774 ARP, Request who-has 60f31d3cc794 tell 172.17.0.1, length 28</span><br><span class="line">06:51:12.522783 ARP, Reply 60f31d3cc794 is-at 02:42:ac:11:00:04 (oui Unknown), length 28</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>evth-pairæœ‰ç‚¹ç±»ä¼¼äºä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœºï¼Œä¸ºæ¯ä¸ªè™šæ‹Ÿè®¾å¤‡å»ºç«‹ä¸€å¯¹ç«¯å£ï¼Œè™šæ‹Ÿè®¾å¤‡ä¸Šä¸€ä¸ªï¼Œå®¿ä¸»æœºä¸Šä¸€ä¸ªï¼Œç›¸å½“äºç”¨ç½‘çº¿é“¾æ¥èµ·æ¥ã€‚<a href="https://www.cnblogs.com/bakari/p/10613710.html">å‚è€ƒé“¾æ¥</a></p><h3 id="â€“link"><a href="#â€“link" class="headerlink" title="â€“link"></a>â€“link</h3><p>å®¹å™¨ä¹‹é—´ä¸é€šè¿‡ipå¯ä»¥äº’ç›¸pingé€š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥pingæ— æ³•pingé€š</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec tomcat01 ping tomcat02</span></span><br><span class="line">ping: tomcat02: Name or service not known</span><br><span class="line"><span class="comment"># å¦‚ä½•è§£å†³ï¼Ÿ</span></span><br><span class="line"><span class="comment"># é€šè¿‡--linkçš„æ–¹å¼å¯ä»¥è¿æ¥</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -P --name tomcat03 --link tomcat02 tomcat</span></span><br><span class="line">adde4bc5e9fb8e398bbaba77f889819d623df12190f42a4c9eaa93e910ad2bf4</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">adde4bc5e9fb        tomcat              <span class="string">&quot;catalina.sh run&quot;</span>   4 seconds ago       Up 3 seconds        0.0.0.0:32781-&gt;8080/tcp   tomcat03</span><br><span class="line">f7fa8f2e44a8        tomcat              <span class="string">&quot;catalina.sh run&quot;</span>   5 hours ago         Up 5 hours          0.0.0.0:32778-&gt;8080/tcp   tomcat02</span><br><span class="line">04c9ac8b93a7        tomcat              <span class="string">&quot;catalina.sh run&quot;</span>   5 hours ago         Up 5 hours          0.0.0.0:32777-&gt;8080/tcp   tomcat01</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec -it tomcat03 ping tomcat02</span></span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.251 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.080 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=3 ttl=64 time=0.097 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat02 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 6ms</span><br><span class="line">rtt min/avg/max/mdev = 0.080/0.142/0.251/0.078 ms</span><br><span class="line"><span class="comment"># åå‘æ— æ³•è¿é€š</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec -it tomcat02 ping tomcat03</span></span><br><span class="line">ping: tomcat03: Name or service not known</span><br><span class="line"><span class="comment"># --link æ˜¯åœ¨hostæ–‡ä»¶ä¸­è¿›è¡Œäº†é…ç½®</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec tomcat03 cat /etc/hosts</span></span><br><span class="line">127.0.0.1localhost</span><br><span class="line">::1localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0ip6-localnet</span><br><span class="line">ff00::0ip6-mcastprefix</span><br><span class="line">ff02::1ip6-allnodes</span><br><span class="line">ff02::2ip6-allrouters</span><br><span class="line">172.17.0.3tomcat02 f7fa8f2e44a8</span><br><span class="line">172.17.0.4adde4bc5e9fb</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç°åœ¨ä¸å»ºè®®ä½¿ç”¨â€“link</strong></p><p>docker0é—®é¢˜ï¼Œä¸æ”¯æŒå®¹å™¨åé“¾æ¥è®¿é—®</p><h3 id="è‡ªå®šä¹‰ç½‘ç»œ"><a href="#è‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="è‡ªå®šä¹‰ç½‘ç»œ"></a>è‡ªå®šä¹‰ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„ç½‘ç»œæ¨¡å¼</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">8c37dffaecb4        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">35c2a571afd2        host                host                <span class="built_in">local</span></span><br><span class="line">b9de4a74c582        none                null                <span class="built_in">local</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç½‘ç»œæ¨¡å¼</strong></p><p>bridgeï¼š æ¡¥æ¥</p><p>noneï¼šä¸é…ç½®ç½‘ç»œ</p><p>hostï¼šå’Œå®¿ä¸»æœºå…±äº«ç½‘ç»œ</p><p>containerï¼šå®¹å™¨å†…ç½‘ç»œè¿é€š</p><p><strong>æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯é»˜è®¤å¢åŠ äº†--net bridgeï¼Œ è¿™ä¸ªå°±æ˜¯docker0</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -P --name tomcat01  tomcat </span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -P --name tomcat01 --net bridge tomcat </span></span><br><span class="line"><span class="comment"># docker0ç‰¹ç‚¹ï¼Œé»˜è®¤ï¼ŒåŸŸåä¸èƒ½è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ç½‘ç»œ</span></span><br><span class="line"><span class="comment"># --driver bridge</span></span><br><span class="line"><span class="comment"># --subnet 192.168.0.0/16</span></span><br><span class="line"><span class="comment"># --gateway 192.168.0.1</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span></span><br><span class="line">8df9a7ad718555216a856cf0c5fa4cf02788f4c840a2d832453a4ab3d3ef3ef6</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">8c37dffaecb4        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">35c2a571afd2        host                host                <span class="built_in">local</span></span><br><span class="line">8df9a7ad7185        mynet               bridge              <span class="built_in">local</span></span><br><span class="line">b9de4a74c582        none                null                <span class="built_in">local</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109378.png" alt="image-20201109192308737"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ä¸¤ä¸ªå®¹å™¨</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -P --name tomcat01 --net mynet tomcat</span></span><br><span class="line">54c6db4b62e6ea50dbbffb7559a08f93ff62d3944e10ffa6a32dbec56dc70a22</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker run -d -P --name tomcat02 --net mynet tomcat</span></span><br><span class="line">80b3e7d6343eca724f0c99c43dfeb0df985163dea8b207046bf375b724a25f6e</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;8df9a7ad718555216a856cf0c5fa4cf02788f4c840a2d832453a4ab3d3ef3ef6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2020-11-09T19:21:57.212203173+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;192.168.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;54c6db4b62e6ea50dbbffb7559a08f93ff62d3944e10ffa6a32dbec56dc70a22&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;967a2066e520708347d6b4f7ce52d3eb0d6284684808a6f7222f96f5461dc424&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;80b3e7d6343eca724f0c99c43dfeb0df985163dea8b207046bf375b724a25f6e&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;758970ddbc8affa25a1de8a36ce9e013863dc1769694081713affd587cfdf81e&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.3/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># ç°åœ¨ä¸éœ€è¦ä½¿ç”¨--linkï¼Œä¹Ÿèƒ½pingåå­—äº†</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec tomcat01 ping 192.168.0.3</span></span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.067 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.055 ms</span><br><span class="line">^C</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec tomcat01 ping tomcat02</span></span><br><span class="line">PING tomcat02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.039 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.073 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è‡ªå®šä¹‰ç½‘ç»œéƒ½å·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤å¥½äº†å¯¹åº”çš„å…³ç³»ï¼Œæ¨èä½¿ç”¨ã€‚</p><p>å¥½å¤„ï¼š</p><p>ä¸åŒé›†ç¾¤ä½¿ç”¨ä¸åŒç½‘ç»œï¼Œè¿™æ ·èƒ½ä¿è¯ç½‘ç»œå¥åº·</p><h3 id="ç½‘ç»œè¿é€š"><a href="#ç½‘ç»œè¿é€š" class="headerlink" title="ç½‘ç»œè¿é€š"></a>ç½‘ç»œè¿é€š</h3><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109757.png" alt="image-20201109192920354"></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310109184.png" alt="image-20201109192945986"></p><p><strong>æµ‹è¯•æ‰“é€š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7vm ~]<span class="comment"># docker network connect mynet tomcat03</span></span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;8df9a7ad718555216a856cf0c5fa4cf02788f4c840a2d832453a4ab3d3ef3ef6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2020-11-09T19:21:57.212203173+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;192.168.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;4fb292c8352c281860cb89dd8be171bdc4872f5bca008dc3924256fc6ac7a32a&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;bcc695da7144029eb0fc674249d3286fb8cc2bba863ef5e1c1197f579e9e6d76&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:04&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.4/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;54c6db4b62e6ea50dbbffb7559a08f93ff62d3944e10ffa6a32dbec56dc70a22&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;967a2066e520708347d6b4f7ce52d3eb0d6284684808a6f7222f96f5461dc424&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;80b3e7d6343eca724f0c99c43dfeb0df985163dea8b207046bf375b724a25f6e&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;758970ddbc8affa25a1de8a36ce9e013863dc1769694081713affd587cfdf81e&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.3/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec tomcat03 ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">111: eth0@if112: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">113: eth1@if114: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:c0:a8:00:04 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.0.4/16 brd 192.168.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec tomcat03 ping tomcat01</span></span><br><span class="line">PING tomcat01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.108 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.048 ms</span><br><span class="line">^C</span><br><span class="line">[root@centos7vm ~]<span class="comment"># docker exec tomcat03 ping tomcat02</span></span><br><span class="line">PING tomcat02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.057 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.063 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“è®ºï¼Œå‡è®¾è·¨ç½‘ç»œæ“ä½œï¼Œå°±éœ€è¦è¿™ä¹ˆæ“ä½œã€‚</p><h2 id="Redisé›†ç¾¤"><a href="#Redisé›†ç¾¤" class="headerlink" title="Redisé›†ç¾¤"></a>Redisé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºredisé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 6);</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf</span><br><span class="line"><span class="built_in">touch</span> /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span></span><br><span class="line"><span class="string">port 6379</span></span><br><span class="line"><span class="string">bind 0.0.0.0</span></span><br><span class="line"><span class="string">cluster-enabled yes</span></span><br><span class="line"><span class="string">cluster-config-file nodes.conf</span></span><br><span class="line"><span class="string">cluster-node-timeout 5000</span></span><br><span class="line"><span class="string">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span></span><br><span class="line"><span class="string">cluster-announce-port 6379</span></span><br><span class="line"><span class="string">cluster-announce-bus-port 16379</span></span><br><span class="line"><span class="string">appendonly yes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 6);</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">docker run -p 637<span class="variable">$&#123;n&#125;</span>:6379 -p 1637<span class="variable">$&#123;n&#125;</span>:16379 --name redis-<span class="variable">$&#123;n&#125;</span> \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;n&#125;</span>/data:/data \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;n&#125;</span>/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1<span class="variable">$&#123;n&#125;</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé›†ç¾¤</span></span><br><span class="line">/data <span class="comment"># redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>å®šä¹‰è¿è¡Œå¤šä¸ªå®¹å™¨</p><p>YAML fileé…ç½®æ–‡ä»¶</p><p>single command å‘½ä»¤ï¼Ÿ</p><h3 id="ä½¿ç”¨composeä¸‰ä¸ªæ­¥éª¤"><a href="#ä½¿ç”¨composeä¸‰ä¸ªæ­¥éª¤" class="headerlink" title="ä½¿ç”¨composeä¸‰ä¸ªæ­¥éª¤"></a>ä½¿ç”¨composeä¸‰ä¸ªæ­¥éª¤</h3><blockquote><p>å®˜æ–¹è¯´æ˜ï¼š</p><p>Using Compose is basically a three-step process:</p><ol><li>Define your appâ€™s environment with a <code>Dockerfile</code> so it can be reproduced anywhere.</li><li>Define the services that make up your app in <code>docker-compose.yml</code> so they can be run together in an isolated environment.</li><li>Run <code>docker-compose up</code> and Compose starts and runs your entire app.</li></ol></blockquote><p><code>dockerfile</code> ä¿è¯æˆ‘ä»¬çš„é¡¹ç›®åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è¿è¡Œ</p><p>docker-compose.yamlæ€ä¹ˆå†™</p><p>ä½¿ç”¨docker-compose upå‘½ä»¤å¯åŠ¨compose</p><h3 id="å…¶ä»–ä»‹ç»"><a href="#å…¶ä»–ä»‹ç»" class="headerlink" title="å…¶ä»–ä»‹ç»"></a>å…¶ä»–ä»‹ç»</h3><p>compose æ˜¯dockerå®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œéœ€è¦å®‰è£…ã€‚</p><p><code>docker-compose.yml</code>æ–‡ä»¶æ ¼å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/code</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">logvolume01:/var/log</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">logvolume01:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>Composeï¼šé‡è¦çš„æ¦‚å¿µ</p><ul><li>æœåŠ¡serviceï¼šå®¹å™¨ï¼Œåº”ç”¨</li><li>é¡¹ç›®projectã€‚ä¸€ç»„å…³è”çš„å®¹å™¨ã€‚</li></ul><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><a href="https://docs.docker.com/compose/install/#install-compose-on-linux-systems">å®˜æ–¹é“¾æ¥</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ -1"><a href="#ç»ƒä¹ -1" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><p><a href="https://docs.docker.com/compose/gettingstarted/">å®˜æ–¹é“¾æ¥</a></p><h3 id="yamlè§„åˆ™"><a href="#yamlè§„åˆ™" class="headerlink" title="yamlè§„åˆ™"></a>yamlè§„åˆ™</h3><p><code>docker-compose.yml</code>æ ¸å¿ƒ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3å±‚</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;&#x27;</span> <span class="comment"># ç‰ˆæœ¬  æ ¹æ®dockerç‰ˆæœ¬æ¥</span></span><br><span class="line"><span class="attr">services:</span> <span class="comment"># æœåŠ¡</span></span><br><span class="line">  <span class="string">æœåŠ¡1:</span> <span class="string">web</span></span><br><span class="line">    <span class="comment"># æœåŠ¡é…ç½®</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">images:</span> <span class="string">....</span></span><br><span class="line">  <span class="string">æœåŠ¡2:</span> <span class="string">redis</span></span><br><span class="line">  <span class="string">....</span></span><br><span class="line"><span class="comment"># å…¶ä»–é…ç½®  ç½‘ç»œ/å·/å…¨å±€è§„åˆ™</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">configs:</span></span><br></pre></td></tr></table></figure><h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2><h3 id="åˆ›å»ºSwarmé›†ç¾¤"><a href="#åˆ›å»ºSwarmé›†ç¾¤" class="headerlink" title="åˆ›å»ºSwarmé›†ç¾¤"></a>åˆ›å»ºSwarmé›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker swarm init åˆå§‹åŒ–ä¸€ä¸ªé›†ç¾¤</span></span><br><span class="line">[root@docker-0 ~]<span class="comment"># docker swarm init</span></span><br><span class="line">Swarm initialized: current node (0onzn4z1ljxw7delulxewvnvk) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm <span class="built_in">join</span> --token SWMTKN-1-3vk8ohuxr68hy9o6udjzfi5q8dmasvapcu500tzvs22vpijnny-7qt31z6lamb831ym9qjd23s3y 192.168.3.20:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run <span class="string">&#x27;docker swarm join-token manager&#x27;</span> and follow the instructions.</span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯ä»¥ç”ŸæˆåŠ å…¥é›†ç¾¤çš„å‘½ä»¤</span></span><br><span class="line">docker swarm join-token manager</span><br><span class="line">docker swarm join-token worker</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæœåŠ¡"><a href="#åˆ›å»ºæœåŠ¡" class="headerlink" title="åˆ›å»ºæœåŠ¡"></a>åˆ›å»ºæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-0 ~]<span class="comment"># docker service --help</span></span><br><span class="line"></span><br><span class="line">Usage:docker service COMMAND</span><br><span class="line"></span><br><span class="line">Manage services</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a new service</span><br><span class="line">  inspect     Display detailed information on one or more services</span><br><span class="line">  logs        Fetch the logs of a service or task</span><br><span class="line">  <span class="built_in">ls</span>          List services</span><br><span class="line">  ps          List the tasks of one or more services</span><br><span class="line">  <span class="built_in">rm</span>          Remove one or more services</span><br><span class="line">  rollback    Revert changes to a service<span class="string">&#x27;s configuration</span></span><br><span class="line"><span class="string">  scale       Scale one or multiple replicated services</span></span><br><span class="line"><span class="string">  update      Update a service</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run &#x27;</span>docker service COMMAND --<span class="built_in">help</span><span class="string">&#x27; for more information on a command.</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h3 id="æ¦‚å¿µæ€»ç»“"><a href="#æ¦‚å¿µæ€»ç»“" class="headerlink" title="æ¦‚å¿µæ€»ç»“"></a>æ¦‚å¿µæ€»ç»“</h3><h4 id="swarm"><a href="#swarm" class="headerlink" title="swarm"></a>swarm</h4><p>é›†ç¾¤çš„ç®¡ç†å’Œç¼–å·ï¼Œdockerå¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªé›†ç¾¤ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥åŠ å…¥</p><h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><p>å°±æ˜¯ä¸€ä¸ªdockerèŠ‚ç‚¹ï¼Œå¤šä¸ªèŠ‚ç‚¹å°±ç»„æˆäº†ä¸€ä¸ªç½‘ç»œé›†ç¾¤(ç®¡ç†è€…ï¼Œå·¥ä½œè€…)</p><h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><p>ä»»åŠ¡ï¼Œå¯ä»¥åœ¨ç®¡ç†èŠ‚ç‚¹æˆ–å·¥ä½œèŠ‚ç‚¹æ¥è¿è¡Œï¼Œ</p><h4 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h4>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¦‚ä½•ä½¿ç”¨LVMè¿›è¡Œç£ç›˜æ‰©å®¹</title>
      <link href="/2020/189b3b4/"/>
      <url>/2020/189b3b4/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxå¦‚ä½•ä½¿ç”¨LVMè¿›è¡Œç£ç›˜æ‰©å®¹"><a href="#Linuxå¦‚ä½•ä½¿ç”¨LVMè¿›è¡Œç£ç›˜æ‰©å®¹" class="headerlink" title="Linuxå¦‚ä½•ä½¿ç”¨LVMè¿›è¡Œç£ç›˜æ‰©å®¹"></a>Linuxå¦‚ä½•ä½¿ç”¨LVMè¿›è¡Œç£ç›˜æ‰©å®¹</h1><p><em><strong>æé†’ï¼šæ“ä½œç£ç›˜çš„å·¥ä½œéƒ½éœ€è¦å°å¿ƒè°¨æ…ï¼Œé¿å…æ•°æ®ä¸¢å¤±æŸåï¼Œä¸‹æ–‡æ¶‰åŠåˆ°åˆ†åŒºè¡¨çš„æ“ä½œè¯·å†ä¸‰ç¡®è®¤</strong></em></p><h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><p>å…³äºLVMçš„ä»‹ç»è¯·å‚è€ƒ<a href="https://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)">ç»´åŸºç™¾ç§‘</a>æˆ–<a href="https://baike.baidu.com/item/LVM">ç™¾åº¦ç™¾ç§‘</a>ã€‚</p><p>æœ¬æ–‡ä¸æä¾›å¦‚ä½•å°†ç°æœ‰çš„éLVMåˆ†åŒºè½¬æ¢ä¸ºLVMåˆ†åŒºçš„æ–¹æ³•ï¼Œæœ¬æ–‡ä¸»è¦è§£å†³ç°æœ‰LVMå¦‚ä½•è¿›è¡Œæ‰©å®¹çš„é—®é¢˜ã€‚</p><h2 id="ç£ç›˜çŠ¶æ€æŸ¥çœ‹"><a href="#ç£ç›˜çŠ¶æ€æŸ¥çœ‹" class="headerlink" title="ç£ç›˜çŠ¶æ€æŸ¥çœ‹"></a>ç£ç›˜çŠ¶æ€æŸ¥çœ‹</h2><p><em><strong>æ³¨æ„ï¼šç£ç›˜æ“ä½œéœ€è¦æœ‰ç®¡ç†å‘˜æƒé™ï¼Œè¯·ç¡®è®¤ä½ æœ‰ç®¡ç†å‘˜æƒé™å†æ‰§è¡Œå¦‚ä¸‹æ“ä½œã€‚</strong></em></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç¡¬ç›˜çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å‰ç£ç›˜å®¹é‡ä»¥åŠåˆ†åŒºä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œç»“æœä¸ä¸‹å›¾ç±»ä¼¼ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133707.png" alt="image-20201106185215998"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™å—ç£ç›˜æœ‰<code>268.4GB</code>å¤§å°çš„ç©ºé—´ï¼Œä½†åªæœ‰ä¸¤ä¸ªåˆ†åŒº<code>vda1</code>å’Œ<code>vda2</code>ã€‚æˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨<span id="lsblk"><code>lsblk</code></span>æ¥æŸ¥çœ‹å½“å‰åˆ†åŒºçŠ¶æ€ã€‚æ‰§è¡Œç»“æœåº”è¯¥ç±»ä¼¼ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133939.png" alt="image-20201106190400637"></p><p>é€šè¿‡è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œä¸»è¦è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•æŠŠæˆ‘ä»¬è¿™200å¤šGBçš„ç©ºé—´éƒ½ç”¨ä¸Šã€‚</p><h2 id="ç£ç›˜æ‰©å®¹"><a href="#ç£ç›˜æ‰©å®¹" class="headerlink" title="ç£ç›˜æ‰©å®¹"></a>ç£ç›˜æ‰©å®¹</h2><p>æ ¹æ®æˆ‘ä»¬çš„ç¡¬ç›˜åç§°ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›å…¥ç£ç›˜åˆ†åŒºç®¡ç†ã€‚å…¶ä¸­<code>/dev/vda</code>åº”è¯¥æ›´æ¢ä¸ºä½ è‡ªå·±æŸ¥è¯¢åˆ°çš„åå­—ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/vda</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œåçš„çŠ¶æ€åº”è¯¥ç±»ä¼¼ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133328.png" alt="image-20201106190949198"></p><p>æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè¾“å…¥<code>p</code>æ¥æŸ¥çœ‹å½“å‰ç¡¬ç›˜çš„ä¿¡æ¯ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310133271.png" alt="image-20201106191051650"></p><p>æ¥ä¸‹æ¥æ‰§è¡Œæˆ‘ä»¬çš„æ‰©å®¹è¿‡ç¨‹ã€‚</p><h3 id="æ–°å»ºä¸€å—åˆ†åŒº"><a href="#æ–°å»ºä¸€å—åˆ†åŒº" class="headerlink" title="æ–°å»ºä¸€å—åˆ†åŒº"></a>æ–°å»ºä¸€å—åˆ†åŒº</h3><p>æ–°å»ºåˆ†åŒºçš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¾“å…¥<code>n</code>ï¼Œç„¶åè¾“å…¥<code>P</code>ï¼ˆæœ€å¤šå››ä¸ªåˆ†åŒºï¼‰ã€‚æ¥ä¸‹æ¥çš„<code>Partition number</code>ã€<code>First sector</code>åŠ<code>Last sector</code>æˆ‘è¿™é‡Œé€‰æ‹©çš„éƒ½æ˜¯é»˜è®¤å€¼ï¼Œå› ä¸ºæˆ‘è¦ç”¨åˆ°å‰©ä¸‹å…¨éƒ¨çš„ç£ç›˜ç©ºé—´ï¼Œä½ åœ¨è®¾ç½®çš„æ—¶å€™æ ¹æ®ä½ è‡ªå·±çš„æƒ…å†µå†³å®šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134519.png" alt="image-20201106191356630"></p><p>å†æ¬¡è¾“å…¥<code>p</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°å»ºçš„åˆ†åŒºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134126.png" alt="image-20201106191912730"></p><h3 id="ä¿®æ”¹åˆ†åŒºç±»å‹"><a href="#ä¿®æ”¹åˆ†åŒºç±»å‹" class="headerlink" title="ä¿®æ”¹åˆ†åŒºç±»å‹"></a>ä¿®æ”¹åˆ†åŒºç±»å‹</h3><p>æˆ‘ä»¬è¿™é‡Œçš„åˆ†åŒºç±»å‹æœ‰é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹åˆ†åŒºç±»å‹ä¸º<code>8e</code>ã€‚</p><p>è¾“å…¥<code>t</code>ï¼Œé€‰æ‹©æ–°å»ºå‡ºæ¥çš„åˆ†åŒºå·ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>3</code>ï¼Œç„¶åè¾“å…¥<code>8e</code>ï¼Œå†è¾“å…¥<code>p</code>æŸ¥çœ‹åˆ†åŒºç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°å»ºçš„åˆ†åŒºçš„ç±»å‹å·²ç»æ›´æ”¹è¿‡æ¥äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134288.png" alt="image-20201106192200782"></p><h3 id="å†™å…¥åˆ†åŒºè¡¨"><a href="#å†™å…¥åˆ†åŒºè¡¨" class="headerlink" title="å†™å…¥åˆ†åŒºè¡¨"></a>å†™å…¥åˆ†åŒºè¡¨</h3><p>è¾“å…¥<code>w</code>ï¼Œå°†åˆšåˆšçš„æ›´æ”¹å†™å…¥ã€‚ç„¶åæ‰§è¡Œ<code>partprobe</code>é‡è¯»åˆ†åŒºè¡¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134435.png" alt="image-20201106192900952"></p><h3 id="æ‰©å®¹VG"><a href="#æ‰©å®¹VG" class="headerlink" title="æ‰©å®¹VG"></a>æ‰©å®¹VG</h3><p>è¾“å…¥<code>vgdisplay</code>æŸ¥çœ‹å½“å‰VGä¿¡æ¯ã€‚</p><p>è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå…¶ä¸­<code>centos</code>æ˜¯åˆšåˆšçœ‹åˆ°çš„<code>VG Name</code>ï¼Œ<code>/dev/vda3</code>æ˜¯åˆšåˆšæ–°å»ºçš„åˆ†åŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgextend centos /dev/vda3</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134753.png" alt="image-20201106193352723"></p><h3 id="æ‰©å®¹LV"><a href="#æ‰©å®¹LV" class="headerlink" title="æ‰©å®¹LV"></a>æ‰©å®¹LV</h3><p>è¾“å…¥<code>lvdisplay</code>æ¥æŸ¥çœ‹å½“å‰å­˜åœ¨çš„LVä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134700.png" alt="image-20201106194122215"></p><p>ç¡®å®šæˆ‘ä»¬è¦æ‰©å®¹çš„åˆ†åŒºï¼Œå¯ä»¥é€šè¿‡åˆšæ‰æ‰§è¡Œçš„<a href="#lsblk"><code>lsblk</code></a>å‘½ä»¤æŸ¥çœ‹ï¼Œæˆ‘ä»¬è¿™é‡Œè¦æ‰©å®¹çš„<code>LV Path</code>æ˜¯<code>/dev/centos/root</code>ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lvextend -l +100%FREE /dev/centos/root</span><br><span class="line">xfs_growfs /dev/centos/root</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬æ‰§è¡Œä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼Œå°±èƒ½çœ‹åˆ°å·²ç»æˆåŠŸæ‰©å®¹äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134157.png" alt="image-20201106201915719"></p><hr><p>æ¬¢è¿æ‰«ç å…³æ³¨ï¼Œä¸å®šæœŸæ›´æ–°å„ç§ç»éªŒã€‚</p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202203310134385.jpeg" style="zoom: 67%;" />]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> LVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> LVM </tag>
            
            <tag> ç£ç›˜æ‰©å®¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºHexoåŠGitHubåœ¨Windowsä¸‹æ­å»ºä¸ªäººåšå®¢</title>
      <link href="/2020/fa08f4c5/"/>
      <url>/2020/fa08f4c5/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºäºHexoåŠGitHubåœ¨Windowsä¸‹æ­å»ºä¸ªäººåšå®¢"><a href="#åŸºäºHexoåŠGitHubåœ¨Windowsä¸‹æ­å»ºä¸ªäººåšå®¢" class="headerlink" title="åŸºäºHexoåŠGitHubåœ¨Windowsä¸‹æ­å»ºä¸ªäººåšå®¢"></a>åŸºäºHexoåŠGitHubåœ¨Windowsä¸‹æ­å»ºä¸ªäººåšå®¢</h1><h2 id="Hexoå®‰è£…"><a href="#Hexoå®‰è£…" class="headerlink" title="Hexoå®‰è£…"></a>Hexoå®‰è£…</h2><p>Hexo<a href="https://hexo.io/zh-cn/">å®˜ç½‘</a>æä¾›äº†ä¸€äº›<a href="https://hexo.io/zh-cn/docs/">å®‰è£…è¯´æ˜</a>ï¼Œä½†æ˜¯æœ‰äº›éƒ¨åˆ†ä¸å¤Ÿæ¸…æ™°ï¼Œå¯¹æ–°æ‰‹ä¸å¤Ÿå‹å¥½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨Windowsç¯å¢ƒä¸‹å®‰è£…Hexoã€‚</p><p>æˆ‘ä¼šå…ˆä»‹ç»Hexoå¦‚ä½•å®‰è£…ï¼Œç„¶ååœ¨åæ–‡å†ä»‹ç»å¦‚ä½•è¿›è¡Œé…ç½®Hexoä»¥åŠå¦‚ä½•å®‰è£…ä¸»é¢˜ï¼Œå¦‚ä½•è®¾ç½®å›¾åºŠç­‰ã€‚</p><h3 id="Hexoå®‰è£…å‰"><a href="#Hexoå®‰è£…å‰" class="headerlink" title="Hexoå®‰è£…å‰"></a>Hexoå®‰è£…å‰</h3><p>åœ¨Hexoå®‰è£…å‰éœ€è¦å®‰è£…ä¸‹åˆ—ç¯å¢ƒï¼š</p><ul><li><a href="https://nodejs.org/zh-cn/">Node.js</a></li><li><a href="https://git-scm.com/">GIt</a></li></ul><h4 id="Node-jså®‰è£…åŠéªŒè¯"><a href="#Node-jså®‰è£…åŠéªŒè¯" class="headerlink" title="Node.jså®‰è£…åŠéªŒè¯"></a>Node.jså®‰è£…åŠéªŒè¯</h4><ol><li><p>ä¸‹è½½</p><p>å½“å‰Node.jså®˜ç½‘<a href="https://nodejs.org/zh-cn/">https://nodejs.org/zh-cn/</a>æ‰€æä¾›çš„ä¸‹è½½ç‰ˆæœ¬ä¸º14.15.0ï¼Œå¯ç›´æ¥<a href="https://nodejs.org/dist/v14.15.0/node-v14.15.0-x64.msi">ç‚¹å‡»ä¸‹è½½</a>ã€‚</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102312931.png"></p><ol start="2"><li><p>å®‰è£…</p><p>ä¸‹è½½å®Œæˆåï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤è®¾ç½®ä¸€ç›´<code>next</code>å°±å¯ä»¥ï¼Œå®‰è£…è·¯å¾„è‡ªè¡Œæ›´æ”¹ã€‚</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102312851.png"></p><ol start="3"><li><p>éªŒè¯</p><p>ä½¿ç”¨<code>WIN+R</code>æ‰“å¼€è¿è¡Œï¼Œè¾“å…¥<code>cmd</code>ï¼Œç„¶åè¾“å…¥<code>npm -v</code>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºåˆ™æ²¡æœ‰é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102312437.png"></p></li></ol><h4 id="Gitå®‰è£…"><a href="#Gitå®‰è£…" class="headerlink" title="Gitå®‰è£…"></a>Gitå®‰è£…</h4><ol><li><p>ä¸‹è½½</p><p>Gitä¸‹è½½é¡µé¢ä¸º<a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a>ï¼Œå¯ç›´æ¥<a href="https://github.com/git-for-windows/git/releases/download/v2.29.2.windows.1/Git-2.29.2-64-bit.exe">ç‚¹å‡»ä¸‹è½½</a>ï¼Œä¸‹è½½2.29.2 64ä½ç‰ˆæœ¬ã€‚</p></li><li><p>å®‰è£…</p><p>å¦‚æœæœ‰å…¶ä»–Gitéœ€æ±‚çš„ç”¨æˆ·å¯ä»¥æœç´¢Gitå®‰è£…æ•™ç¨‹ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–éœ€æ±‚ç›´æ¥é»˜è®¤é…ç½®å®‰è£…ã€‚</p></li><li><p>éªŒè¯</p><p>å®‰è£…å®Œæˆåï¼Œé‡æ–°æ‰“å¼€cmdï¼Œè¾“å…¥<code>git --version</code>ï¼Œåº”è¯¥å‡ºç°å¦‚ä¸‹æç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102312903.png"></p></li><li><p>åˆå§‹åŒ–é…ç½®</p><p>é¦–æ¬¡å®‰è£…gitéœ€è¦å¯¹gitè¿›è¡Œé…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;halfcoke&quot;</span></span><br><span class="line">git config --global user.email halfcoke@163.com</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ åç»­æƒ³ä¿®æ”¹è¿™ä¸ªé…ç½®ï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–è€…åœ¨<code>C:\Users\&lt;ä½ çš„ç”¨æˆ·å&gt;\.gitconfig</code>æ–‡ä»¶ä¸­ä¿®æ”¹</p></li></ol><h3 id="Hexoå®‰è£…-1"><a href="#Hexoå®‰è£…-1" class="headerlink" title="Hexoå®‰è£…"></a>Hexoå®‰è£…</h3><p>Hexoéœ€è¦åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¥å­˜æ”¾ä¸è‡ªå·±åšå®¢æœ‰å…³çš„å†…å®¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ä¸èƒ½åˆ é™¤ï¼Œä¹‹åå†™åšå®¢ä¹Ÿéœ€è¦ç»§ç»­ç”¨åˆ°ï¼Œåç»­ä¼šè¯´æ˜å¦‚ä½•åœ¨äº‘ç«¯ä¿å­˜è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œç°åœ¨æˆ‘ä»¬ä¸»è¦è¯´æ˜å¦‚ä½•å®‰è£…Hexoã€‚</p><ol><li><p>åœ¨ä¸€ä¸ªä½ å–œæ¬¢çš„åœ°æ–¹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102312899.png"></p></li><li><p>å®‰è£…Hexo</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>git bash</code>åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­æ‰“å¼€å‘½ä»¤è¡Œçª—å£ï¼Œæˆ–è€…ä½¿ç”¨<code>cmd</code>è¿›å…¥å½“å‰è·¯å¾„ã€‚ç„¶åè¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥æ¥éªŒè¯å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo version</span><br></pre></td></tr></table></figure><p>åº”è¯¥è¾“å‡ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102312619.png"></p></li><li><p>åˆå§‹åŒ–</p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¹Hexoè¿›è¡Œåˆå§‹åŒ–ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init your_blog_name</span><br><span class="line"><span class="built_in">cd</span> your_blog_name</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯å®‰è£…</p><p>ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g  <span class="comment"># ç”Ÿæˆé¡µé¢</span></span><br><span class="line">hexo server <span class="comment"># åœ¨æœ¬åœ°æµ‹è¯•</span></span><br></pre></td></tr></table></figure><p>æœ€ååº”è¯¥ä¼šå‡ºç°è¿™æ ·çš„æç¤ºï¼š</p><p><img src="https://gitee.com/halfcoke/blog_img/raw/master/img/image-20201102142855559.png"></p><p>åœ¨ä½ çš„æµè§ˆå™¨ä¸­è¾“å…¥<code>localhost:4000</code>ã€‚</p><p>è‡³æ­¤ä½ çš„ç¬¬ä¸€ä¸ªé¡µé¢åº”è¯¥ç”Ÿæˆå®Œæˆäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313441.png"></p><p>ä½†æ˜¯è¿™é¡µé¢ä¹Ÿå¤ªç®€å•äº†ï¼ï¼ï¼</p><p>å¥½å§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•è¿›è¡Œé…ç½®ï¼Œä»¥åŠå¦‚ä½•éƒ¨ç½²åˆ°GitHubä¸Šã€‚</p></li></ol><h2 id="Hexoéƒ¨ç½²åˆ°GitHub"><a href="#Hexoéƒ¨ç½²åˆ°GitHub" class="headerlink" title="Hexoéƒ¨ç½²åˆ°GitHub"></a>Hexoéƒ¨ç½²åˆ°GitHub</h2><p>ä¸ºäº†è¿ç»­æ€§ï¼Œæˆ‘ä»¬å…ˆè®²å¦‚ä½•å°†Hexoéƒ¨ç½²åˆ°GitHubï¼Œè¿™æ ·åç»­é…ç½®å®Œçš„é¡µé¢ä½ è‡ªå·±å°±ä¼šéƒ¨ç½²åˆ°GitHubä¸Šäº†ã€‚</p><p>Hexoéƒ¨ç½²åˆ°GitHubéå¸¸ç®€å•ï¼Œä½†æ˜¯éœ€è¦å…ˆåœ¨GitHubä¸Šåˆ›å»ºå±äºè‡ªå·±çš„ä»“åº“ã€‚</p><h3 id="GitHubç›¸å…³"><a href="#GitHubç›¸å…³" class="headerlink" title="GitHubç›¸å…³"></a>GitHubç›¸å…³</h3><p>å¦‚æœä½ ä¼šGitHubç›¸å…³çš„æ“ä½œï¼Œé‚£ä¹ˆç›´æ¥åˆ›å»ºä¸€ä¸ªä½ è‡ªå·±çš„å…¬å¼€ä»“åº“ï¼Œç„¶åè·³åˆ°ä¸‹ä¸€èŠ‚ï¼Œå‘½åæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">your_repo.github.io   <span class="comment"># å¯¹ ä»“åº“åå«è¿™ä¸ªï¼Œ&lt;your_repo&gt;è®¾ç½®ä¸ºä½ è‡ªå·±GitHubçš„ç”¨æˆ·å</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸ä¼šGitHubï¼Œå¾€ä¸‹çœ‹ï¼š</p><ol><li><p>è¿›å…¥<a href="https://github.com/">GitHub</a>ï¼Œæ³¨å†Œå±äºè‡ªå·±çš„è´¦å·ï¼Œæˆ–è€…ç›´æ¥ç‚¹å‡»åˆ°<a href="https://github.com/join?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=/&source=header-home">æ³¨å†Œé¡µé¢</a>ã€‚</p></li><li><p>ç„¶åç™»å½•è¿›å»ï¼ŒæŒ‰ä¸‹å›¾ç‚¹å‡»åˆ›å»ºä¸€ä¸ªä»“åº“</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313452.png"></p></li><li><p>åœ¨ä¸‹å›¾çº¢æ¡†çš„ä½ç½®å¡«å…¥è‡ªå·±GitHubçš„åå­—ï¼Œåç»­å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªåŸŸåè®¿é—®è‡ªå·±çš„åšå®¢(å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è‡ªå®šä¹‰ï¼Œè¿™ä¸ªåç»­å†è¯´)ã€‚</p><p>æ¯”å¦‚æˆ‘çš„è¿™ä¸ªè´¦å·çš„å°±æ˜¯<code>halfcokey</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313810.png"></p><p>å…³äºGitHubå°±å·®ä¸å¤šè¿™æ ·äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®ä¸€ä¸‹Hexo</p></li></ol><h3 id="Hexoç›¸å…³"><a href="#Hexoç›¸å…³" class="headerlink" title="Hexoç›¸å…³"></a>Hexoç›¸å…³</h3><p>åœ¨æˆ‘ä»¬åˆšæ‰åˆå§‹åŒ–Hexoçš„æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰¾åˆ°<code>_config.yml</code>ï¼Œä¸è¦ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œä½ å¯ä»¥ä¸‹è½½ä¸ª<a href="https://code.visualstudio.com/">VS Code</a>æˆ–è€…<a href="https://www.sublimetext.com/">Sublime</a>ç­‰ä¸€ç±»çš„éƒ½è¡Œã€‚</p><p>æ‹‰åˆ°æœ€ä¸‹é¢æ‰¾åˆ°<code>deploy</code>ï¼Œè¿›è¡Œç±»ä¼¼å¦‚ä¸‹çš„é…ç½®ï¼Œæ³¨æ„<code>yaml</code>æ–‡ä»¶ä¾é ç¼©è¿›ï¼Œå¹¶ä¸”åœ¨<code>:</code>åæœ‰ç©ºæ ¼ï¼Œä¸€å®šè¦æ³¨æ„æ ¼å¼ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/halfcokey/halfcokey.github.io.git</span> <span class="comment"># ä½ åˆšæ‰æ–°å»ºçš„é‚£ä¸ªä»“åº“çš„é“¾æ¥</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>æ›´è¯¦ç»†çš„è¯´æ˜åŠé…ç½®å¯ä»¥<a href="https://hexo.io/zh-cn/docs/one-command-deployment#Git">å‚è€ƒå®˜ç½‘</a>ã€‚</p><p>ç„¶åï¼Œåœ¨è¿™ä¸ªè·¯å¾„ä¸‹æ‰“å¼€<code>cmd</code>ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…éƒ¨ç½²æ’ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p>è¿™ä¸ªæ—¶å€™ä½ å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥è¿›è¡Œéƒ¨ç½²ä½ çš„ä¸ªäººç½‘ç«™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>åº”è¯¥å¯ä»¥å¼¹å‡ºè®©ä½ è¾“å…¥è´¦å·æˆ–è€…æˆæƒçš„é¡µé¢ï¼Œç‚¹å‡»æˆæƒå³å¯ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å°±å¯ä»¥é€šè¿‡<code>&lt;your_repo&gt;.github.io</code>æ¥è®¿é—®ä½ çš„é¡µé¢äº†ï¼Œæ¯”å¦‚æˆ‘çš„å°±æ˜¯<a href="https://halfcoke.github.io/">halfcoke.github.io</a></p><h2 id="Hexoå®‰è£…åŠéƒ¨ç½²å‘½ä»¤æ€»ç»“"><a href="#Hexoå®‰è£…åŠéƒ¨ç½²å‘½ä»¤æ€»ç»“" class="headerlink" title="Hexoå®‰è£…åŠéƒ¨ç½²å‘½ä»¤æ€»ç»“"></a>Hexoå®‰è£…åŠéƒ¨ç½²å‘½ä»¤æ€»ç»“</h2><p>å¦‚æœä½ å¯¹ä¸Šé¢æ‰§è¡Œçš„è¿™äº›å‘½ä»¤å¥½å¥‡ï¼Œæƒ³æŸ¥çœ‹å…·ä½“è¯´æ˜çš„è¯ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://hexo.io/zh-cn/docs/commands">å®˜ç½‘</a></p><p>è¿™äº›å‘½ä»¤åœ¨ä¹‹åå†™æ–‡ç« å¯èƒ½ä¹Ÿä¼šç”¨åˆ°ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦äº†è§£ä¸€ä¸‹éƒ½æ˜¯ä»€ä¹ˆæ„æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–ä½ çš„åšå®¢</span></span><br><span class="line">hexo init &lt;folder&gt;</span><br><span class="line"><span class="comment"># ç”Ÿæˆé™æ€æ–‡ä»¶</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="comment"># éƒ¨ç½²ç½‘ç«™</span></span><br><span class="line">hexo d</span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæ˜¯ä¸€äº›ä¸Šé¢æ²¡æœ‰ç”¨åˆ°çš„å‘½ä»¤ï¼Œä½†ä¹‹åå¯èƒ½ä¼šç”¨åˆ°</span></span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ç¯‡æ ‡é¢˜ä¸ºtitleçš„æ–‡ç« ï¼Œè¿™é»˜è®¤æ”¾åœ¨source/_postsæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line">hexo n <span class="string">&quot;title&quot;</span></span><br><span class="line"><span class="comment"># æ¸…é™¤ç¼“å­˜æ–‡ä»¶ï¼Œå¦‚æœæ›´æ¢ä¸»é¢˜ç­‰ï¼Œå»ºè®®æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">hexo clean</span><br></pre></td></tr></table></figure><p>æ›´è¯¦ç»†çš„å‘½ä»¤ä»‹ç»è¯·ç›´æ¥<a href="https://hexo.io/zh-cn/docs/commands">ç‚¹å‡»å®˜ç½‘</a>æŸ¥çœ‹ã€‚</p><h2 id="Hexoé…ç½®"><a href="#Hexoé…ç½®" class="headerlink" title="Hexoé…ç½®"></a>Hexoé…ç½®</h2><h3 id="åŸºæœ¬é…ç½®"><a href="#åŸºæœ¬é…ç½®" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h3><p>Hexoé…ç½®é¡¹æœ‰å¾ˆå¤šå†…å®¹ï¼Œè¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹<a href="https://hexo.io/zh-cn/docs/configuration">å®˜ç½‘</a>ï¼Œä¸‹é¢æˆ‘ä»‹ç»ä¸€äº›æˆ‘ä¿®æ”¹äº†çš„é…ç½®ã€‚åœ¨å®‰è£…ä¸»é¢˜ä¹‹åï¼Œè¿˜ä¼šå†ä¿®æ”¹ä¸€äº›é…ç½®ï¼Œæˆ‘ä¼šåœ¨ä¸»é¢˜å®‰è£…é‚£é‡Œå†ä»‹ç»ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">&#x27;CCCCCoke&#x27;</span> <span class="comment"># è‡ªå·±ç½‘ç«™çš„åå­—</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh_cn</span> <span class="comment"># ç½‘ç«™è¯­è¨€</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">&#x27;Asia/ShangHai&#x27;</span> <span class="comment"># æ—¶åŒº</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://HalfCoke.github.io</span>  <span class="comment"># æ”¹æˆè‡ªå·±çš„åœ°å€</span></span><br></pre></td></tr></table></figure><h2 id="Hexoæœ¬åœ°æ–‡ä»¶å¤¹ä¸Šä¼ "><a href="#Hexoæœ¬åœ°æ–‡ä»¶å¤¹ä¸Šä¼ " class="headerlink" title="Hexoæœ¬åœ°æ–‡ä»¶å¤¹ä¸Šä¼ "></a>Hexoæœ¬åœ°æ–‡ä»¶å¤¹ä¸Šä¼ </h2><p>æˆ‘åœ¨éƒ¨ç½²Hexoçš„æ—¶å€™ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœæˆ‘çš„Hexoæ–‡ä»¶å¤¹ä¸¢å¤±äº†æ€ä¹ˆåŠã€‚å› ä¸ºä»GitHubä¸Šçœ‹åˆ°ï¼Œé€šè¿‡<code>hexo d</code>ä¸Šä¼ çš„åªæœ‰æˆ‘ä»¬çš„é™æ€é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦å°†Hexoçš„æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬æ¢äº†ä¸€ä¸ªç¯å¢ƒåä¹Ÿèƒ½æ— å·®åˆ«çš„ç¼–è¾‘è‡ªå·±çš„åšå®¢ï¼Œè€Œä¸”æœ€å¥½æ–¹ä¾¿ç®¡ç†è€Œä¸”åˆ«å¤ªéº»çƒ¦ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘å‚è€ƒäº†ç½‘ä¸Šå…¶ä»–äººçš„åšæ³•ï¼Œå°±æ˜¯åœ¨å­˜æ”¾è‡ªå·±åšå®¢çš„GitHubä»“åº“æ–°å»ºä¸€ä¸ªåˆ†æ”¯<code>hexo</code>æ¥å­˜æ”¾è¿™äº›æ–‡ä»¶ã€‚</p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆå»ºè®®å…ˆåˆ›å»º<code>.editorconfig</code>æ–‡ä»¶ï¼Œæ–¹ä¾¿ä½ åœ¨ä½¿ç”¨å„ç§IDEç¼–è¾‘çš„æ—¶å€™é…ç½®ç»Ÿä¸€ï¼Œè¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">root</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[*]</span></span><br><span class="line"><span class="attr">charset</span> = utf-<span class="number">8</span></span><br><span class="line"><span class="attr">end_of_line</span> = lf</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨è‡ªå·±åšå®¢çš„ç›®å½•(æ¯”å¦‚æˆ‘çš„æ˜¯<code>d:\Blog\blog_test</code>)ï¼Œæ‰“å¼€<code>cmd</code>æˆ–<code>git bash</code>ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git init <span class="comment"># åˆå§‹åŒ–gitä»“åº“</span></span><br><span class="line">git add . <span class="comment"># å°†å½“å‰æ–‡ä»¶æ·»åŠ è¿›å»</span></span><br><span class="line">git commit -m <span class="string">&quot;init&quot;</span> <span class="comment"># åœ¨æœ¬åœ°æäº¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è¿œç¨‹ä»“åº“ï¼Œæ³¨æ„å°†halfcokeyæ›¿æ¢ä¸ºè‡ªå·±çš„ç”¨æˆ·å</span></span><br><span class="line">git remote add origin https://github.com/halfcokey/halfcokey.github.io.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåˆ†æ”¯ï¼Œä»¥åçš„æ–‡ä»¶ç›´æ¥åœ¨è¿™ä¸ªåˆ†æ”¯è¿›è¡Œæäº¤</span></span><br><span class="line">git checkout -b <span class="string">&quot;hexo&quot;</span> </span><br><span class="line"><span class="comment"># å°†æœ¬åœ°åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“,å¹¶è¿›è¡Œå…³è”ã€‚</span></span><br><span class="line">git push -u origin hexo</span><br></pre></td></tr></table></figure><p>åœ¨ä¹‹åä¿®æ”¹æ–‡ä»¶ï¼Œåªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git commit -a -m <span class="string">&quot;ä¿®æ”¹...&quot;</span> <span class="comment"># è¿™é‡Œå»ºè®®å¡«å†™ä¸€äº›æœ‰æ„ä¹‰çš„å¤‡æ³¨</span></span><br><span class="line">git push origin hexo</span><br></pre></td></tr></table></figure><h2 id="MarkDownæ–‡ç« å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ GitHub"><a href="#MarkDownæ–‡ç« å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ GitHub" class="headerlink" title="MarkDownæ–‡ç« å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ GitHub"></a>MarkDownæ–‡ç« å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ GitHub</h2><p>åœ¨ä½¿ç”¨MarkDownç¼–è¾‘çš„åšå®¢çš„æ—¶å€™ï¼Œå¦‚æœæ–‡ç« ä¸­çš„å›¾ç‰‡æ•°é‡æ¯”è¾ƒå°‘ï¼Œè¿˜å¯ä»¥æ‰‹åŠ¨çš„å°†å›¾ç‰‡ä¼ åˆ°å›¾åºŠä¸Šï¼Œç„¶åå†æ·»åŠ å›¾ç‰‡é“¾æ¥ã€‚ä½†å¦‚æœä½ æƒ³æ”¾å¾ˆå¤šå›¾ç‰‡ï¼Œæ‰‹åŠ¨å°±éº»çƒ¦çš„è¦æ­»ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä½¿ç”¨<a href="https://typora.io/">Typora</a>+<a href="https://molunerfinn.com/PicGo/">PicGo</a>çš„æ–¹å¼æ¥ç®¡ç†æ–‡ç« çš„å›¾ç‰‡ã€‚</p><p>è¿™ä¸¤ä¸ªè½¯ä»¶çš„å®‰è£…è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä¸‹é¢ä¸»è¦è¯´ä¸€ä¸‹æˆ‘è¿›è¡Œé…ç½®çš„ç›¸å…³çš„å†…å®¹ã€‚</p><h3 id="PicGo"><a href="#PicGo" class="headerlink" title="PicGo"></a>PicGo</h3><p>PicGoçš„é…ç½®æ–¹å¼æ¯”è¾ƒå®¹æ˜“ï¼Œæˆ‘ä»¬é€‰æ‹©<code>GitHubå›¾åºŠ</code></p><p>çœ‹åˆ°æˆ‘ä»¬éœ€è¦å¡«å†™<code>ä»“åº“å</code>ã€<code>åˆ†æ”¯å</code>ã€<code>Token</code>è¿™äº›ä¿¡æ¯ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313065.png"></p><ol><li><p>ä»“åº“å</p><p>æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªä»“åº“ä¸“é—¨ç”¨æ¥å­˜æ”¾å›¾ç‰‡ï¼Œæ–°å»ºä»“åº“çš„æ–¹å¼ä¸ä¹‹å‰ç›¸åŒï¼Œä½†æ˜¯è¿™æ˜¯æˆ‘ä»¬çš„ä»“åº“åå°±æ²¡æœ‰é‚£ä¹ˆå¤šé™åˆ¶äº†ï¼Œå¯ä»¥éšä¾¿èµ·ï¼Œæˆ‘çš„åˆ›å»ºçš„ä»“åº“åæ˜¯<a href="https://github.com/HalfCoke/blog_img">blog_img</a>ï¼Œç„¶ååœ¨è¿™ä¸ªä½ç½®å¡«å…¥<code>&lt;ç”¨æˆ·å&gt;/&lt;ä»“åº“å&gt;</code></p></li><li><p>åˆ†æ”¯å</p><p>é»˜è®¤ä½¿ç”¨masterå°±è¡Œ</p></li><li><p>Token</p><p>åœ¨GitHubè‡ªå·±å¤´åƒçš„ä½ç½®ç‚¹å‡»<code>settings</code>ï¼Œæˆ–è€…ç›´æ¥ç‚¹å‡»<a href="https://github.com/settings/profile">https://github.com/settings/profile</a></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313070.png"></p><p>ç„¶åç‚¹å‡»<code>Developer settings-&gt;Personal access tokens</code>ï¼Œæˆ–è€…ç›´æ¥ç‚¹å‡»<a href="https://github.com/settings/tokens">https://github.com/settings/tokens</a></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313610.png"></p><p>ç„¶åç‚¹å‡»<code>Generate new token</code></p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313413.png"></p><p>åœ¨Noteçš„ä½ç½®éšä¾¿è¾“å…¥ä¸€ä¸ªåå­—ï¼Œä¸‹é¢çš„æƒé™é€‰ç¬¬ä¸€ä¸ªåº”è¯¥å°±è¡Œï¼Œå¦‚æœå‰ä¸¤ä¸ªéƒ½é€‰ä¸Šã€‚æ‹‰åˆ°æœ€ä¸‹é¢ç‚¹å‡»ç”Ÿæˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313481.png"></p><p>è¿™æ—¶ä¼šæœ‰è¿™æ ·çš„æç¤ºï¼ŒæŠŠè¿™ä¸€ä¸²å¤åˆ¶å¡«å†™åœ¨PicGoçš„Tokenä¸­ï¼Œè¿™æ ·å°±å¯ä»¥äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313863.png"></p></li></ol><h3 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h3><p><a href="https://typora.io/">Typora</a>ç›´æ¥æ”¯æŒä½¿ç”¨<a href="https://molunerfinn.com/PicGo/">PicGo</a>ã€‚åœ¨<code>æ–‡ä»¶-&gt;åå¥½è®¾ç½®</code>ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼Œä¸»è¦æ˜¯çº¢æ¡†çš„ä½ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313229.png"></p><p>ç„¶åå½“ä½ æ‰“å¼€ä¸€ä¸ªMarkDownæ–‡ä»¶çš„æ—¶å€™ï¼Œç‚¹å‡»Typoraçš„<code>æ ¼å¼-&gt;å›¾åƒ-&gt;å½“æ’å…¥æœ¬åœ°å›¾ç‰‡æ—¶-&gt;ä¸Šä¼ å›¾ç‰‡</code>å°±å¯ä»¥äº†ã€‚è¿™æ ·ä½ æ”¾è¿›æ¥çš„å›¾ç‰‡å°±ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°ä½ çš„ä»“åº“ä¸­ï¼Œè€Œä¸”é“¾æ¥ä¹Ÿä¼šæ›¿æ¢æˆåœ¨çº¿é“¾æ¥ã€‚</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="Hexoä¸»é¢˜é…ç½®"><a href="#Hexoä¸»é¢˜é…ç½®" class="headerlink" title="Hexoä¸»é¢˜é…ç½®"></a>Hexoä¸»é¢˜é…ç½®</h3><p>æˆ‘æ‰€ä½¿ç”¨çš„ä¸»é¢˜æ˜¯<a href="https://github.com/Mrminfive/hexo-theme-skapp">hexo-theme-skapp</a>ï¼Œä½œè€…æä¾›äº†æ¯”è¾ƒè¯¦ç»†çš„é…ç½®è¿‡ç¨‹ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥å‚è€ƒã€‚</p><h3 id="Hexoæ’ä»¶"><a href="#Hexoæ’ä»¶" class="headerlink" title="Hexoæ’ä»¶"></a>Hexoæ’ä»¶</h3><h4 id="ä¸­æ–‡æ ‡é¢˜é“¾æ¥å¤„ç†"><a href="#ä¸­æ–‡æ ‡é¢˜é“¾æ¥å¤„ç†" class="headerlink" title="ä¸­æ–‡æ ‡é¢˜é“¾æ¥å¤„ç†"></a>ä¸­æ–‡æ ‡é¢˜é“¾æ¥å¤„ç†</h4><p>ä½¿ç”¨Hexoçš„<code>abbrlink</code>æ’ä»¶ï¼Œæ–¹æ³•å‚è€ƒä½œè€…Shinçš„<a href="http://www.ideashin.com/post/2a09be9d/">åšå®¢</a></p><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure></li><li><p>åœ¨Hexoç«™ç‚¹é…ç½®æ–‡ä»¶<code>_config.yml</code>ä¸­ä¿®æ”¹</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permalink: :year/:abbrlink/</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ abbrlinké…ç½®</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># abbrlink config</span><br><span class="line">abbrlink:</span><br><span class="line">  alg: crc32  # ç®—æ³•ï¼šcrc16(default) and crc32</span><br><span class="line">  rep: hex    # è¿›åˆ¶ï¼šdec(default) and hex</span><br></pre></td></tr></table></figure></li></ol><hr><p>æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿ä¸€èµ·æ¢è®¨ï¼<br>æ¬¢è¿æ‰«ç å…³æ³¨ï¼Œä¸å®šæœŸæ›´æ–°å„ç§ç»éªŒã€‚</p><img src="https://cdn.jsdelivr.net/gh/HalfCoke/blog_img@master/img/202204102313614.jpeg" style="zoom: 67%;" />]]></content>
      
      
      <categories>
          
          <category> WEB </category>
          
          <category> WEBéƒ¨ç½² </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> GitHub </tag>
            
            <tag> Windows </tag>
            
            <tag> å›¾åºŠ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
